function formatDate(t,e){var i=new Date,e=i.getTime(),a=new Date(e+864e5*+t);return i.setTime(a.getTime()),iChart.formatDateTime(i,"dd.MM.yyyy")+(e?" 23:59":"")}function intervalNames(t){switch(t){case"S30":return _t("2072","30 секундный");case"I1":return _t("2073","минутный");case"I5":return _t("2074","5 минутный");case"I15":return _t("2075","15 минутный");case"H1":return _t("2076","Часовик");case"D1":return _t("2077","Дневной");case"D7":return _t("2078","Недельный");default:return""}}function intervalShortNames(t){switch(t){case"S30":return _t("1176","30c");case"I1":return _t("1370","М");case"I5":return _t("3331","5М");case"I15":return _t("3332","15М");case"H1":return _t("3333","Ч");case"D1":return _t("1368","Д");case"D3":return _t("15824","3Д");case"D7":return _t("1369","Н");case"M1":return _t("1370","М");case"M3":return _t("1371","3М");default:return""}}!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){var e=[],i=t(document),a=navigator.userAgent.toLowerCase(),r=t(window),s=[],n={ieQuirks:null,msie:/msie/.test(a)&&!/opera/.test(a),opera:/opera/.test(a)};n.ie6=n.msie&&/msie 6./.test(a)&&"object"!=typeof window.XMLHttpRequest,n.ie7=n.msie&&/msie 7.0/.test(a),n.boxModel="CSS1Compat"===document.compatMode,t.modal=function(e,i){return t.modal.impl.init(e,i)},t.modal.close=function(){t.modal.impl.close()},t.modal.focus=function(e){t.modal.impl.focus(e)},t.modal.setContainerDimensions=function(){t.modal.impl.setContainerDimensions()},t.modal.setPosition=function(){t.modal.impl.setPosition()},t.modal.update=function(e,i){t.modal.impl.update(e,i)},t.fn.modal=function(e){return t.modal.impl.init(this,e)},t.modal.defaults={appendTo:"body",focus:!0,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{},containerId:"simplemodal-container",containerCss:{},title:"",titleId:"simplemodal-title",titleCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:!1,autoPosition:!0,zIndex:1e3,close:!0,closeHTML:'<a class="modalCloseImg" title="Close"></a>',closeClass:"uk-icon-close",escClose:!0,overlayClose:!1,fixed:!0,position:null,persist:!1,draggable:!1,modal:!0,onOpen:null,onShow:null,onClose:null},t.modal.impl={d:{},init:function(e,i){var a=this;if(a.d.data)return a;if(n.ieQuirks=n.msie&&!n.boxModel,a.o=t.extend({},t.modal.defaults,i),a.zIndex=a.o.zIndex,a.occb=!1,"object"==typeof e)e=e instanceof t?e:t(e),a.d.placeholder=!1,e.parent().parent().size()>0&&(e.before(t("<span></span>").attr("id","simplemodal-placeholder").css({display:"none"})),a.d.placeholder=!0,a.display=e.css("display"),a.o.persist||(a.d.orig=e.clone(!0)));else{if("string"!=typeof e&&"number"!=typeof e)return alert("SimpleModal Error: Unsupported data type: "+typeof e),a;e=t("<div></div>").html(e)}return a.create(e),e=null,a.open(),t.isFunction(a.o.onShow)&&a.o.onShow.apply(a,[a.d]),a},create:function(i){var a=this;a.getDimensions(),a.o.modal&&n.ie6&&(a.d.iframe=t('<iframe src="javascript:false;"></iframe>').css(t.extend(a.o.iframeCss,{display:"none",opacity:0,position:"fixed",height:s[0],width:s[1],zIndex:a.o.zIndex,top:0,left:0})).appendTo(a.o.appendTo)),a.d.overlay=t("<div></div>").attr("id",a.o.overlayId).addClass("simplemodal-overlay").css(t.extend(a.o.overlayCss,{display:"none",opacity:a.o.opacity/100,height:a.o.modal?e[0]:0,width:a.o.modal?e[1]:0,position:"fixed",left:0,top:0,zIndex:a.o.zIndex+1})).appendTo(a.o.appendTo),a.d.container=t("<div></div>").attr("id",a.o.containerId).addClass("simplemodal-container").css(t.extend({position:a.o.fixed?"fixed":"absolute"},a.o.containerCss,{display:"none",zIndex:a.o.zIndex+2})).append(a.o.close&&a.o.closeHTML?t(a.o.closeHTML).addClass(a.o.closeClass):"").appendTo(a.o.appendTo),a.d.title=t("<div></div>").attr("id",a.o.titleId).addClass("simplemodal-title").css(t.extend({},a.o.titleCss)).append(a.o.title).appendTo(a.d.container),a.d.wrap=t("<div></div>").attr("tabIndex",-1).addClass("simplemodal-wrap").appendTo(a.d.container),a.d.data=i.attr("id",i.attr("id")||a.o.dataId).addClass("simplemodal-data").css(t.extend(a.o.dataCss,{display:"none"})).appendTo("body"),i=null,a.setContainerDimensions(),a.d.data.appendTo(a.d.wrap),a.o.draggable&&"function"==typeof a.d.container.draggable&&a.d.container.draggable({handle:a.d.title,snap:!1}),(n.ie6||n.ieQuirks)&&a.fixIE()},bindEvents:function(){var a=this;t("."+a.o.closeClass).bind("click.simplemodal touchend.simplemodal",function(t){t.preventDefault(),a.close()}),a.o.modal&&a.o.close&&a.o.overlayClose&&a.d.overlay.bind("click.simplemodal touchend.simplemodal",function(t){t.preventDefault(),a.close()}),i.bind("keydown.simplemodal",function(t){a.o.modal&&9===t.keyCode?a.watchTab(t):a.o.close&&a.o.escClose&&27===t.keyCode&&(t.preventDefault(),a.close())}),r.bind("resize.simplemodal orientationchange.simplemodal",function(){a.getDimensions(),a.o.autoResize?a.setContainerDimensions():a.o.autoPosition&&a.setPosition(),n.ie6||n.ieQuirks?a.fixIE():a.o.modal&&(a.d.iframe&&a.d.iframe.css({height:s[0],width:s[1]}),a.d.overlay.css({height:e[0],width:e[1]}))})},unbindEvents:function(){t("."+this.o.closeClass).unbind("click.simplemodal touchend.simplemodal"),i.unbind("keydown.simplemodal"),r.unbind(".simplemodal"),this.d.overlay.unbind("click.simplemodal touchend.simplemodal")},fixIE:function(){var e=this,i=e.o.position;t.each([e.d.iframe||null,e.o.modal?e.d.overlay:null,"fixed"===e.d.container.css("position")?e.d.container:null],function(t,e){if(e){var a="document.body.clientHeight",r="document.body.clientWidth",s="document.body.scrollHeight",n="document.body.scrollLeft",o="document.body.scrollTop",h="document.body.scrollWidth",l="document.documentElement.clientHeight",c="document.documentElement.clientWidth",d="document.documentElement.scrollLeft",p="document.documentElement.scrollTop",u=e[0].style;if(u.position="absolute",t<2)u.removeExpression("height"),u.removeExpression("width"),u.setExpression("height",""+s+" > "+a+" ? "+s+" : "+a+' + "px"'),u.setExpression("width",""+h+" > "+r+" ? "+h+" : "+r+' + "px"');else{var g,f;if(i&&i.constructor===Array){var m=i[0]?"number"==typeof i[0]?i[0].toString():i[0].replace(/px/,""):e.css("top").replace(/px/,"");if(g=m.indexOf("%")===-1?m+" + (t = "+p+" ? "+p+" : "+o+') + "px"':parseInt(m.replace(/%/,""))+" * (("+l+" || "+a+") / 100) + (t = "+p+" ? "+p+" : "+o+') + "px"',i[1]){var v="number"==typeof i[1]?i[1].toString():i[1].replace(/px/,"");f=v.indexOf("%")===-1?v+" + (t = "+d+" ? "+d+" : "+n+') + "px"':parseInt(v.replace(/%/,""))+" * (("+c+" || "+r+") / 100) + (t = "+d+" ? "+d+" : "+n+') + "px"'}}else g="("+l+" || "+a+") / 2 - (this.offsetHeight / 2) + (t = "+p+" ? "+p+" : "+o+') + "px"',f="("+c+" || "+r+") / 2 - (this.offsetWidth / 2) + (t = "+d+" ? "+d+" : "+n+') + "px"';u.removeExpression("top"),u.removeExpression("left"),u.setExpression("top",g),u.setExpression("left",f)}}})},focus:function(e){var i=this,a=e&&t.inArray(e,["first","last"])!==-1?e:"first",r=t(":input:enabled:visible:"+a,i.d.wrap);setTimeout(function(){r.length>0?r.focus():i.d.wrap.focus()},10)},getDimensions:function(){var t="undefined"==typeof window.innerHeight?r.height():window.innerHeight;e=[i.height(),i.width()],s=[t,r.width()]},getVal:function(t,e){return t?"number"==typeof t?t:"auto"===t?0:t.indexOf("%")>0?parseInt(t.replace(/%/,""))/100*("h"===e?s[0]:s[1]):parseInt(t.replace(/px/,"")):null},update:function(t,e){var i=this;return!!i.d.data&&(i.d.origHeight=i.getVal(t,"h"),i.d.origWidth=i.getVal(e,"w"),i.d.data.hide(),t&&i.d.container.css("height",t),e&&i.d.container.css("width",e),i.setContainerDimensions(),i.d.data.show(),i.o.focus&&i.focus(),i.unbindEvents(),void i.bindEvents())},setContainerDimensions:function(){var t=this,e=(n.ie6||n.ie7,""),i="",a=t.d.data.outerHeight(!0)+t.d.container.height(),r=t.d.data.outerWidth(!0)+t.d.container.width();t.d.origHeight=t.d.origHeight||e,t.d.origWidth=t.d.origWidth||i;var o=t.o.maxHeight?t.getVal(t.o.maxHeight,"h"):null,h=t.o.maxWidth?t.getVal(t.o.maxWidth,"w"):null,l=o&&o<s[0]?o:s[0],c=h&&h<s[1]?h:s[1],d=t.o.minHeight?t.getVal(t.o.minHeight,"h"):"auto";e=e?t.o.autoResize&&e>l?l:e<d?d:e:a?a>l?l:t.o.minHeight&&"auto"!==d&&a<d?d:a:d;var p=t.o.minWidth?t.getVal(t.o.minWidth,"w"):"auto";i=i?t.o.autoResize&&i>c?c:i<p?p:i:r?r>c?c:t.o.minWidth&&"auto"!==p&&r<p?p:r:p,t.d.container.css({height:e,width:i}),t.d.wrap.css({overflow:a>e||r>i?"auto":"visible"}),t.o.autoPosition&&t.setPosition()},setPosition:function(){var t,e,i=this,a=s[0]/2-i.d.container.outerHeight(!0)/2,n=s[1]/2-i.d.container.outerWidth(!0)/2,o="fixed"!==i.d.container.css("position")?r.scrollTop():0;i.o.position&&"[object Array]"===Object.prototype.toString.call(i.o.position)?(t=parseFloat(o)+parseFloat(i.o.position[0]||a),e=i.o.position[1]||n):(t=o+a,e=n),i.d.container.css({left:e,top:t})},watchTab:function(e){var i=this;if(t(e.target).parents(".simplemodal-container").length>0){if(i.inputs=t(":input:enabled:visible:first, :input:enabled:visible:last",i.d.data[0]),!e.shiftKey&&e.target===i.inputs[i.inputs.length-1]||e.shiftKey&&e.target===i.inputs[0]||0===i.inputs.length){e.preventDefault();var a=e.shiftKey?"last":"first";i.focus(a)}}else e.preventDefault(),i.focus()},open:function(){var e=this;e.d.iframe&&e.d.iframe.show(),t.isFunction(e.o.onOpen)?e.o.onOpen.apply(e,[e.d]):(e.d.overlay.show(),e.d.container.show(),e.d.data.show()),e.o.focus&&e.focus(),e.bindEvents()},close:function(e){e="undefined"==typeof e||!!e;var i=this;if(!i.d.data)return!1;if(i.unbindEvents(),t.isFunction(i.o.onClose)&&!i.occb&&e)i.occb=!0,i.o.onClose.apply(i,[i.d]);else{if(i.d.placeholder){var a=t("#simplemodal-placeholder");i.o.persist?a.replaceWith(i.d.data.removeClass("simplemodal-data").css("display",i.display)):(i.d.data.hide().remove(),a.replaceWith(i.d.orig))}else i.d.data.hide().remove();i.d.container.hide().remove(),i.d.overlay.hide(),i.d.iframe&&i.d.iframe.hide().remove(),i.d.overlay.remove(),i.d={}}}}}),function(t){var e={palettes:{basic:["#000000","#7f7f7f","#880015","#ed1c24","#ff7f27","#fff200","#22b14c","#00a2e8","#3f48cc","#a349a4","#ffffff","#c3c3c3","#b97a57","#ffaec9","#ffc90e","#efe4b0","#b5e61d","#99d9ea","#7092be","#c8bfe7"]},defaults:{palette:[],columns:1,size:20,value:"",change:function(){}},init:function(i){var a=t.extend({},e.defaults,i);"string"==typeof i.palette&&e.palettes[i.palette]&&(a.palette=e.palettes[i.palette]),a.element=this;for(var r=Math.ceil(a.palette.length/a.columns),s=t("<table>").css({"border-collapse":"collapse",position:"relative",margin:0,padding:0,border:0,outline:0,"text-decoration":"none","font-size":"100%","list-style":"none"}),n=0;n<r;n++){for(var o=t("<tr>"),h=0;h<a.columns;h++){var l=t("<td>",{class:"palette-item"}).attr("data-color",a.palette[n*a.columns+h]).css({width:a.size,height:a.size,"background-color":a.palette[n*a.columns+h]});o.append(l)}s.append(o)}s.on("click touchend","td",function(){a.value=t(this).data("color"),a.change.call(a)}),this.append(s).css({position:"relative","line-height":0,"border-width":0,display:"inline-block"}),this.data("palette",a)}};t.fn.palette=function(i){if("undefined"==typeof i||"object"==typeof i)return this.each(function(a){var r=t(this);return e.init.call(r,i,a),r});if("string"==typeof i){var a=Array.prototype.slice.call(arguments,1);if(e[i]&&"function"==typeof e[i]){if(a.length)return this.each(function(r){var s=t(this);return e[i].call(s,a),s});var r=t(this).eq(0);return e[i].call(r,a)}return console.error("Method should be function")}return console.error("Options should be object, string or undefined")}}(jQuery),"undefined"==typeof tzOffsetMoscow&&(tzOffsetMoscow=10800),"undefined"==typeof LANG_NAME&&(LANG_NAME="ru"),"undefined"==typeof TEXT_TRANSLATOR_MODE,"undefined"==typeof IGUANACHART_THEME&&(IGUANACHART_THEME="White"),Date.parse=function(t){if(!t)return null;if(t instanceof Date)return t.getTime();var e=t.match(/^\s*([0-9]{4})-([0-9]{2})-([0-9]{2})[\s|T]{0,1}(?:\s*(\d\d{0,1}):?(\d\d{0,1})(?::?(\d\d{0,1}))?(?:\.([0-9]{0,3}))?)?\s*$/);if(e){var i=new Date(e[1],e[2]-1,e[3]);return"undefined"!=typeof e[4]&&"undefined"!=typeof e[5]&&i.setHours(e[4],e[5],e[6]||0,e[7]||0),i.getTime()}var e=t.match(new RegExp("^\\s*([0-9]{1,2})(?:.|-|/|\\s)([0-9]{1,2})(?:.|-|/|\\s)([0-9]{4})(?:\\s*([0-9]{1,2}):?([0-9]{1,2})(?::?([0-9]{1,2}))?)?\\s*$"));if(e){var i=new Date(e[3],e[2]-1,e[1]);return"undefined"!=typeof e[4]&&"undefined"!=typeof e[5]&&i.setHours(e[4],e[5],e[6]||0),i.getTime()}return new Date(t).getTime()},"undefined"==typeof _t&&(_t=function(t,e){return e}),"undefined"==typeof String.prototype.hashCode&&(String.prototype.hashCode=function(){var t,e,i,a=0;if(0==this.length)return a;for(t=0,i=this.length;t<i;t++)e=this.charCodeAt(t),a=(a<<5)-a+e,a|=0;return a}),"undefined"==typeof getTimeOffsetServer&&(getTimeOffsetServer=function(t){t=t||0;var e=new Date,i=e.getTimezoneOffset();return t+60*i}),function(t){"use strict";"undefined"!=typeof JSON&&""!==JSON.stringify(document.createElement("input").value)&&!function(){var t=function(t,e){return""===e?"":e},e=JSON.stringify;JSON.stringify=function(i,a,r){return e(i,t,r)}}(),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){if(e="undefined"==typeof e?0:parseInt(e,10),e>=this.length)return-1;e<0&&(e=Math.max(0,this.length+e));for(var i=e;i<this.length;++i)if(this[i]===t)return i;return-1}),String.prototype.expandExponential=function(){return this.replace(/^([+-])?(\d+).?(\d*)[eE]([-+]?\d+)$/,function(t,e,i,a,r){var s=+r<0,n=i.length+ +r,t=(s?i:a).length,r=(r=Math.abs(r))>=t?r-t+s:0,o=new Array(r+1).join("0"),h=i+a;return(e||"")+(s?h=o+h:h+=o).substr(0,n+=s?o.length:0)+(n<h.length?"."+h.substr(n):"")})},t.inheritPrototype=function(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t};var e=function(t){return t<10?"0"+t:t};"undefined"==typeof t.iChart&&(t.iChart={}),t.iChart.dayShortNames=[_t("2129","Пн"),_t("2130","Вт"),_t("2131","Ср"),_t("2132","Чт"),_t("2133","Пт"),_t("2134","Сб"),_t("2135","Вс")],t.iChart.monthNames=[_t("3280","Январь"),_t("3281","Февраль"),_t("3282","Март"),_t("3283","Апрель"),_t("3284","Май"),_t("3285","Июнь"),_t("3286","Июль"),_t("3287","Август"),_t("3288","Сентябрь"),_t("3289","Октябрь"),_t("3290","Ноябрь"),_t("3291","Декабрь")],t.iChart.monthRNames=[_t("1889","января"),_t("1890","февраля"),_t("1891","марта"),_t("1892","апреля"),_t("1893","мая"),_t("1894","июня"),_t("1895","июля"),_t("1896","августа"),_t("1897","сентября"),_t("1898","октября"),_t("1899","ноября"),_t("1900","декабря")],t.iChart.monthShortNames=[_t("3502","янв"),_t("3503","фев"),_t("3504","мар"),_t("3505","апр"),_t("4939","май"),_t("3507","июн"),_t("3508","июл"),_t("3509","авг"),_t("3510","сен"),_t("3511","окт"),_t("3512","ноя"),_t("3513","дек")],t.iChart.declineNoun=function(t,e,i,a){return t=Math.abs(t),t%=100,t>=5&&t<=20?a:(t%=10,1==t?e:t>=2&&t<=4?i:a)},t.iChart.formatDateTime=function(i,a){if(!i)return"";a||(a=0===i.getHours()&&0===i.getMinutes()?"dd.MM.yyyy":0===i.getSeconds()?"dd.MM.yyyy HH:mm":"dd.MM.yyyy HH:mm:ss");for(var r="",s=[],n=0;n<a.length;++n){var o=a.charAt(n);if(0!==r.length){var h=r.charAt(r.length-1);if("d"!==o&&"M"!==o&&"y"!==o&&"H"!==o&&"m"!==o&&"s"!==o){if("d"!==h&&"M"!==h&&"y"!==h&&"H"!==h&&"m"!==h&&"s"!==h){r+=o;continue}}else if(o===h){r+=o;continue}s.push(r),r=o}else r=o}0!==r.length&&s.push(r);for(var l="",n=0;n<s.length;++n){var r=s[n];switch(r){case"d":l+=i.getDate();break;case"dd":l+=e(i.getDate());break;case"M":l+=i.getMonth()+1;break;case"MM":l+=e(i.getMonth()+1);break;case"MMM":l+=t.iChart.monthShortNames[i.getMonth()];break;case"MMMM":l+=t.iChart.monthRNames[i.getMonth()];break;case"yy":l+=i.getFullYear().toString().substr(2,2);break;case"yyyy":l+=i.getFullYear();break;case"H":l+=i.getHours();break;case"HH":l+=e(i.getHours());break;case"m":l+=i.getMinutes();break;case"mm":l+=e(i.getMinutes());break;case"s":l+=i.getSeconds();break;case"ss":l+=e(i.getSeconds());break;default:l+=r}}return l},t.iChart.formatNumber=function(e,i){if("undefined"==typeof e||null===e)return"";i=$.extend({decimalPlaces:null,decimalPrecision:null,decimalSeparator:".",scale:0,thousandsSeparator:" "},i),0!==i.scale&&(e/=Math.pow(10,3*i.scale));var a,r=null!==i.decimalPlaces;a=r?parseFloat(t.iChart.toFixed(e,i.decimalPlaces)):null!==i.decimalPrecision?parseFloat(e.toPrecision(i.decimalPrecision)):e;var s=a.toString().expandExponential().split(".");s[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i.thousandsSeparator)),r&&(s[1]||"").length<i.decimalPlaces&&(s[1]=s[1]||"",s[1]+=new Array(i.decimalPlaces-s[1].length+1).join("0"));var n=s.join(i.decimalSeparator).replace("-","−");switch(i.scale){case 0:break;case 1:n+=_t("3496","тыс.");break;case 2:n+=_t("2137","млн");break;case 3:n+=_t("4708","млрд");break;case 4:n+=_t("2139","трлн");break;default:throw new Error("Number scale '"+i.scale+"' is invalid.")}return n},t.iChart.parseDateTime=function(t,e){if(!t)return null;if(t instanceof Date)return t;if("yyyyMMddHHmm"===e){var i=t.match(new RegExp("^([0-9]{4})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})$"));if(!i)return null;var a=new Date(i[1],i[2]-1,i[3],i[4],i[5],0,0);return a}if("yyyy-MM-dd HH:mm:ss"===e){var i=t.match(new RegExp("^([0-9]{4})-([0-9]{2})-([0-9]{2})\\s([0-9]{2}):([0-9]{2}):([0-9]{2})"));if(!i)return null;var a=new Date(i[1],i[2]-1,i[3],i[4],i[5],i[6],0);return a}var i=t.match(new RegExp("^\\s*([0-9]{1,2})(?:.|-|/|\\s)([0-9]{1,2})(?:.|-|/|\\s)([0-9]{4})(?:\\s*([0-9]{1,2}):?([0-9]{1,2})(?::?([0-9]{1,2}))?)?\\s*$"));if(!i)return null;var a=new Date(i[3],i[2]-1,i[1]);return"undefined"!=typeof i[4]&&"undefined"!=typeof i[5]&&a.setHours(i[4],i[5],i[6]||0),a},t.iChart.parseQueryString=function(t){if("string"!=typeof t)return{};var e=t.indexOf("?");e!==-1&&(t=t.substr(e+1));for(var i=t.split("&"),a={},r=0;r<i.length;++r){var s=i[r].split("=");if(2===s.length){var n=decodeURIComponent(s[0]),o=decodeURIComponent(s[1]);switch(typeof a[n]){case"object":a[n].push(o);break;case"string":a[n]=[a[n],o];break;case"undefined":a[n]=o}}}return a},t.iChart.toFixed=function(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i},t.iChart.roundToPrecision=function(t,e){if(e=parseFloat(e),e<1){var i=parseFloat(e).toString().length-2;return+(Math.round(t*(1/e))/(1/e)).toFixed(i)}return+(Math.round(t*(1/e))/(1/e)).toFixed(0)},t.iChart.toQueryString=function(t,e){var i=[];for(var a in t)if(t.hasOwnProperty(a)){var r=t[a];if("undefined"!=typeof r&&null!==r&&""!==r)if($.isArray(r))for(var s=0;s<r.length;++s)i.push(encodeURIComponent(a)+"="+encodeURIComponent(r[s]));else r instanceof Date&&(r=iChart.formatDateTime(r)),i.push(encodeURIComponent(a)+"="+encodeURIComponent(r))}var n="";return e&&0!==i.length&&(n+="?"),n+=i.join("&")},t.iChart.rgbToHex=function(t){if(/^#[a-fA-F0-9]{3,6}$/.test(t)){if(t.length<7){var e=t.split("");t=e[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]}return t}t=[].slice.call(arguments).join(",").match(/\d+/g);var i,a;for(a=(i=((t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16)).length;a++<6;)i="0"+i;return"#"+i},t.iChart.rgbaGetAlfa=function(t){var e=t.match(/\((.*),(.*),(.*),(.*)\)/);return e&&e[4]?+e[4]:1},t.iChart.hexToRGB=function(t,e){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?"rgba("+parseInt(i[1],16)+","+parseInt(i[2],16)+","+parseInt(i[3],16)+","+e+")":null},t.iChart.invertColor=function(t){t=[].slice.call(arguments).join(",").replace(/rgb\(|\)|rgba\(|\)|\s/gi,"").split(",");for(var e=0;e<t.length;e++)t[e]=(3===e?1:255)-t[e];return t.join(", ")},t.iChart.getIntersection=function(t,e,i,a){if((t.y-e.y)*(a.x-i.x)-(i.y-a.y)*(e.x-t.x)!=0&&a.x-i.x!=0){var r=-((t.x*e.y-e.x*t.y)*(a.x-i.x)-(i.x*a.y-a.x*i.y)*(e.x-t.x))/((t.y-e.y)*(a.x-i.x)-(i.y-a.y)*(e.x-t.x)),s=((i.y-a.y)*-r-(i.x*a.y-a.x*i.y))/(a.x-i.x);return{x:r,y:s}}return!1},t.iChart.getThirdPoint=function(t,e,i){var a=(parseFloat(i)-parseFloat(t.x))*(parseFloat(e.y)-parseFloat(t.y))/(parseFloat(e.x)-parseFloat(t.x))+parseFloat(t.y);return{x:parseFloat(i),y:a}},t.iChart.getLineEquation=function(t,e,i){var a=(+e.y-+t.y)/(+e.x-+t.x),r=+t.y-a*t.x,s=a*+i+r;return{x:+i,y:s,k:a,b:r}},t.iChart.getChartTimeframe=function(t){switch(t){case"I1":return 1;case"I5":return 5;case"I15":return 15;case"H1":return 60;case"D1":return 1440;case"D7":return 10080;default:return 1440}}}(window),function(){"use strict";"undefined"==typeof iChart&&(iChart={}),iChart.Charting={},iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo=function(t,e){var i,a=0,r=t.length-1;if(r===-1)return-1;if(t[a]>=e)return a;if(t[r]<e)return-1;for(;a<=r;){if(a===r)return a;if(a===r-1)return t[a]<e?r:a;i=Math.floor((a+r)/2),t[i]<e?a=i+1:r=i}return i},iChart.Charting.indexOfLastElementLessThanOrEqualTo=function(t,e){var i,a=0,r=t.length-1;if(r===-1)return-1;if(t[a]>e)return-1;if(t[r]<=e)return r;for(;a<=r;){if(a===r)return a;if(a===r-1)return t[r]<=e?r:a;i=Math.floor((a+r)/2),t[i]>e?r=i-1:a=i}return i},iChart.Charting.getNearestNotNullIndex=function(t,e){var i,a;for(i=a=e;;){if($.isArray(t[i])){if(null!=t[i][0])return i}else if(null!=t[i])return i;if($.isArray(t[a])){if(null!=t[a][0])return a}else if(null!=t[a])return a;if(i>0?i--:"",a<t.length-1?a++:"",i<0&&a>t.length-1)return!1}},iChart.Charting.initCanvas=function(t,e,i,a){if(!t)return void console.log("No chart container. Abort");if(e){if(e.width===i&&e.height===a)return e;if("undefined"==typeof FlashCanvas)return e.width=i,e.height=a,e;$(e).remove()}var r=document.createElement("canvas");if(r.style.left=0,r.style.position="absolute",r.style.top=0,$(r).unbind("selectstart"),$(r).attr("unselectable","on").css("user-select","none").on("selectstart",!1),t.appendChild(r),"undefined"==typeof r.getContext){if("undefined"==typeof FlashCanvas)return alert("Ваш браузер не поддерживается."),null;FlashCanvas.initElement(r)}return r.width=i,r.height=a,r},iChart.Charting.pointToPointDistanceSquared=function(t,e){var i=t.x-e.x,a=t.y-e.y;return i*i+a*a},iChart.Charting.pointToSegmentDistanceSquared=function(t,e,i){var a=(e.x-t[0].x)*(t[1].x-t[0].x)+(e.y-t[0].y)*(t[1].y-t[0].y);if(a<0)return i?1/0:iChart.Charting.pointToPointDistanceSquared(e,t[0]);var r=iChart.Charting.pointToPointDistanceSquared(t[1],t[0]),s=1e-5;if(a>r||r<s)return i?1/0:iChart.Charting.pointToPointDistanceSquared(e,t[1]);var n=a/r,o={x:t[0].x+n*(t[1].x-t[0].x),y:t[0].y+n*(t[1].y-t[0].y)};return iChart.Charting.pointToPointDistanceSquared(e,o)}}(),function(){"use strict";iChart.Charting.ChartDrawingLayer=function(t){if(this.$deleteButton=$("<span/>",{class:"m-chart-instrument-delete",text:"✕",title:"Удалить инструмент"}).hide().appendTo(t.container),this.$settingsButton=$("<span class ='m-chart-instrument-settings' href = '#' text = '' title = 'Свойства'><span class='elementSettingsHolder' style='position: relative'></span></span>").hide().appendTo(t.container),this.canvas=null,this.chart=t,this.defaultCursor="default",this.drag=null,this.history=[],this.hover=null,this.controlsHover=null,this.prevX=null,this.prevY=null,this.selected=null,this.unfinished=null,$(t.container).off("mousedown.overlay").unbind("mouseup.overlay").unbind("mousemove.overlay"),$(t.container).on("mousedown.overlay",$.proxy(this.onMouseDown,this)).on("mouseup.overlay",$.proxy(this.onMouseUp,this)).on("mousemove.overlay",$.proxy(this.onMouseMove,this)),0==this.chart.env.dataSource.dataSettings.useHash)var e=this.chart.env.dataSource.dataSettings.hash;else var e=document.location.hash;this.deserialize(iChart.parseQueryString((e||"#").substr(1)))},iChart.Charting.ChartDrawingLayer.prototype.clear=function(t){if(t=!!t,this.history.length)if(t)this.$deleteButton.hide().removeClass("on"),this.$settingsButton.hide(),this.history=[],this.render(),this.syncHash();else{for(var e=this.history,i=0;i<e.length;i++){var a=e[i];"manually"==a.drawType&&(e.splice(i,1),i--)}this.render(),this.syncHash()}},iChart.Charting.ChartDrawingLayer.prototype.createElement=function(t){switch(t){case"Channel":return new iChart.Charting.ChartChannel(this);case"Ellipse":return new iChart.Charting.ChartEllipse(this);case"FibonacciArc":return new iChart.Charting.ChartFibonacciArc(this);case"FibonacciCorrection":return new iChart.Charting.ChartFibonacciCorrection(this);case"FibonacciFan":return new iChart.Charting.ChartFibonacciFan(this);case"HorizontalLine":return new iChart.Charting.ChartHorizontalLine(this);case"Line":return new iChart.Charting.ChartLine(this);case"Rectangle":return new iChart.Charting.ChartRectangle(this);case"Trend":return new iChart.Charting.ChartTrend(this);case"Triangle":return new iChart.Charting.ChartTriangle(this);case"VerticalLine":return new iChart.Charting.ChartVerticalLine(this);case"Mark":return new iChart.Charting.ChartMark(this);case"Label":return new iChart.Charting.ChartLabel(this);case"Arrow":return new iChart.Charting.ChartArrow(this);case"Polygon":return new iChart.Charting.ChartPolygon(this);case"Trade":return new iChart.Charting.ChartTrade(this);case"Bubble":return new iChart.Charting.ChartBubble(this);case"Text":return new iChart.Charting.ChartText(this);case"Order":return new iChart.Charting.ChartOrder(this);case"Trendorder":return new iChart.Charting.ChartTrendorder(this);case"Position":return new iChart.Charting.ChartPosition(this);case"Visualtrade":return new iChart.Charting.ChartVisualtrade(this);case"TradePanel":return new iChart.Charting.ChartTradePanel(this);case"Button":return new iChart.Charting.ChartButton(this);case"Event":return new iChart.Charting.ChartEvent(this);case"Level":return new iChart.Charting.ChartLevel(this);case"Range":return new iChart.Charting.ChartRange(this);default:return}},iChart.Charting.ChartDrawingLayer.prototype.deserialize=function(t){this.$deleteButton.unbind("mousedown").hide().removeClass("on"),this.$settingsButton.unbind("mousedown").hide(),this.history=[];var e=parseInt(t.L,10);if(!isNaN(e))t:for(var i=0;i<e;++i){var a=t["L"+i+"_T"],r=this.createElement(a);if("undefined"!=typeof r){r.points=[];for(var s=0;s<r.maxPointCount;++s){var n={x:parseFloat(t["L"+i+"_X"+s]),y:parseFloat(t["L"+i+"_Y"+s])};if(isNaN(n.x)||isNaN(n.y))continue t;r.points.push(n)}t["L"+i+"_S"]&&(r.settings=JSON.parse(decodeURIComponent(window.atob(t["L"+i+"_S"].replace(/@/g,"="))))),this.history.push(r)}}},iChart.Charting.ChartDrawingLayer.prototype.elementAt=function(t,e){this.history.sort(function(t,e){return t&&t.selected?-1:t&&"TradePanel"==t.elementType?-1:1});for(var i=0;i<this.history.length;++i){var a=this.history[i],r=a.isMouseOver.call(a,t,e);if(r!==-1)return{mode:r,value:a}}},iChart.Charting.ChartDrawingLayer.prototype.finalizePoint=function(t,e){this.unfinished.points[this.unfinished.points.length-1].x=t,this.unfinished.points[this.unfinished.points.length-1].y=e,this.unfinished.isComplete()?(this.chart.env.wrapper.trigger("iguanaChartEvents",["drawComplete",this.unfinished]),this.unfinished=null,this.syncHash(),this.chart.container.style.cursor=this.defaultCursor):(this.unfinished.points.push({}),this.chart.container.style.cursor="crosshair"),this.render()},iChart.Charting.ChartDrawingLayer.prototype.getMarkers=function(t,e){for(var i=[],a=!1,r=0;r<this.drag.element.points.length;++r){var s=this.drag.element.points[r],n={};if(0===this.drag.mode||this.drag.mode===r+1){if(n=$.extend({},s),n.x=1e3*this.area.getXValue(this.area.getXPositionByValue(s.x/1e3)+t),n.y=this.area.getYValue(this.area.getYPosition(s.y)+e),isNaN(n.x)||isNaN(n.y)){a=!0;break}}else n=$.extend({},s);i.push(n)}return{markers:i,outside:a}},iChart.Charting.ChartDrawingLayer.prototype.getPixelPosition=function(t,e){var i=t.length;if(!(i<2||t[0][0]>=e))for(var a=1;a<i;++a){var r=t[a];if(r[0]>=e)return r[1]}},iChart.Charting.ChartDrawingLayer.prototype.onMouseDown=function(t){if("undefined"!=typeof this.offset){var e=Math.round(t.pageX-this.offset.left-this.area.innerOffset.left),i=Math.round(t.pageY-this.offset.top-this.area.innerOffset.top),a=1e3*this.area.getXValue(e),r=this.area.getYValue(i);if($(window).data("mouseValueX",a),$(window).data("mouseValueY",r),this.chart.isComparison&&!isNaN(r)){var s=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,this.chart.areas[0].viewport.x.bounded.min),n=this.chart.areas[0].ySeries[0].points[s][3];r=n+n/100*r}if(!isNaN(a)&&!isNaN(r)){if(null!==this.unfinished)return this.finalizePoint(a,r),void this.selected.onInsert();if(0!==this.history.length&&null===this.drag){var o=this.elementAt(e,i);if(o&&o.value&&"function"==typeof o.value.onMouseDown&&o.value.onMouseDown(t),"undefined"==typeof o)return void this.setSelected(null);if(o.value.controlEnable){if(o.mode.toString().match(new RegExp("^m_","i"))){var h=o.mode.toString().match(new RegExp(/^m_(\d)/i));o.value.maps[h[1]].click()}else{if(o.mode.toString().match(new RegExp("^c_","i"))){var l=o.mode.toString().match(new RegExp(/^c_(\d)/i));return void o.value.controls[l[1]].click()}o.mode.toString().match(new RegExp("^a_","i"))}this.setSelected(o.value),o.hasSettings,this.drag={},this.drag.element=this.selected,this.drag.mode=o.mode,this.drag.x=e,this.drag.y=i,this.chart.selection&&this.chart.selection.disable()}}}}},iChart.Charting.ChartDrawingLayer.prototype.onMouseMove=function(t){if("undefined"!=typeof this.offset){var e=Math.round(t.pageX-this.offset.left-this.area.innerOffset.left),i=Math.round(t.pageY-this.offset.top-this.area.innerOffset.top);if(e!==this.prevX||i!==this.prevY){this.prevX=e,this.prevY=i;var a=1e3*this.area.getXValue(e),r=this.area.getYValue(i);if(this.prevValueX=a,this.prevValueY=r,this.chart.isComparison&&!isNaN(r)){var s=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,this.chart.areas[0].viewport.x.bounded.min),n=this.chart.areas[0].ySeries[0].points[s][3];r=n+n/100*r}if(isNaN(a)||isNaN(r))return this.setHover(null),void(this.chart.container.style.cursor=this.defaultCursor);if(null!==this.unfinished)return this.hover=null,this.unfinished.points[this.unfinished.points.length-1].x=a,this.unfinished.points[this.unfinished.points.length-1].y=r,this.render(),void(this.chart.container.style.cursor="crosshair");if(null!==this.drag){isNaN(parseInt(this.drag.mode))||("undefined"!=typeof this.drag.element.moveCursor?this.chart.container.style.cursor=this.drag.element.moveCursor:this.chart.container.style.cursor="move");var o=e-this.drag.x,h=i-this.drag.y;if(0===o&&0===h)return;var l=this.getMarkers(o,h);return this.drag.element.onDrag(l.markers),void(l.outside?"undefined"!=typeof this.drag.element.markers&&(delete this.drag.element.markers,this.render()):(this.drag.element.markers=l.markers,this.render()))}var c=this.elementAt(e,i);if("undefined"==typeof c)this.setHover(null),this.setControlsHover(null),this.chart.container.style.cursor=this.defaultCursor;else if("function"==c.onHover&&c.onHover(e,i),c.mode.toString().match(new RegExp("^c_","i")))this.chart.container.style.cursor="pointer",this.setControlsHover(c);else if(c.mode.toString().match(new RegExp("^a_","i")))this.setHover(null),this.setControlsHover(c),this.chart.container.style.cursor=this.defaultCursor;else if(c.mode.toString().match(new RegExp("^m_","i"))){c.mode.toString().match(new RegExp(/^m_(\d)/i));this.setControlsHover(c),this.chart.container.style.cursor="pointer"}else this.setHover(c.value),this.setControlsHover(c),"undefined"!=typeof c.value.hoverCursor?this.chart.container.style.cursor=c.value.hoverCursor:this.chart.container.style.cursor="pointer"}}},iChart.Charting.ChartDrawingLayer.prototype.onMouseUp=function(t){var e=Math.round(t.pageX-this.offset.left-this.area.innerOffset.left),i=Math.round(t.pageY-this.offset.top-this.area.innerOffset.top),a=this.elementAt(e,i);if("undefined"==typeof a);else{if(!a.value.controlEnable)return;a.mode.toString().match(new RegExp("^c_","i"))||a.mode.toString().match(new RegExp("^a_","i"))}if("undefined"!=typeof this.offset&&null!==this.drag){var e=Math.round(t.pageX-this.offset.left-this.area.innerOffset.left),i=Math.round(t.pageY-this.offset.top-this.area.innerOffset.top),r=1e3*this.area.getXValue(e),s=this.area.getYValue(i);if(this.chart.isComparison&&!isNaN(s)){var n=this.chart.areas[0].ySeries[0].points[this.chart.areas[0].viewport.x.bounded.min][3];
s=n+n/100*s}if(!isNaN(r)&&!isNaN(s)){var o=e-this.drag.x,h=i-this.drag.y;if(0!==o||0!==h){var l=this.getMarkers(o,h);this.drag.element.onDrag(l.markers),l.outside||(this.drag.element.points=l.markers,delete this.drag.element.testContext,this.syncHash())}this.drag.element.onDrop(this.drag.mode),delete this.drag.element.markers,this.drag=null,this.render(),this.chart.selection&&this.chart.selection.enable()}}},iChart.Charting.ChartDrawingLayer.prototype.remove=function(t){var e=this.history.indexOf(t);e!==-1&&(this.$deleteButton.unbind("mousedown").hide().removeClass("on"),this.$settingsButton.unbind("mousedown").hide(),this.history.splice(e,1),this.render(),this.syncHash())},iChart.Charting.ChartDrawingLayer.prototype.removeSelected=function(t){null===this.selected||t?this.remove(t):this.remove(this.selected)},iChart.Charting.ChartDrawingLayer.prototype.render=function(t){if(!t){if(!this.context)return console.log("ERROR: No context for render"),0;t=this.context,t.clearRect(0,0,t.canvas.width,t.canvas.height)}t.save(),t.translate(this.area.innerOffset.left,this.area.innerOffset.top),t.beginPath(),t.moveTo(0,this.area.innerHeight),t.lineTo(this.area.innerWidth,this.area.innerHeight),t.lineTo(this.area.innerWidth,0),t.lineTo(0,0),t.closePath(),t.clip(),"undefined"!=typeof t.busyPoints&&(t.busyPoints={}),this.history.sort(function(t,e){return t.selected?1:t.inHover&&e.selected?-1:!t.inHover||e.inHover||e.selected?void 0:1});for(var e=0;e<this.history.length;++e)this.history[e].draw(t,-1);t.restore(),t.save(),t.translate(this.area.innerOffset.left,this.area.innerOffset.top),t.beginPath(),t.moveTo(0,this.area.innerHeight),t.lineTo(this.area.outerWidth,this.area.innerHeight),t.lineTo(this.area.outerWidth,0),t.lineTo(0,0),t.closePath(),t.clip();for(var e=0;e<this.history.length;++e)this.history[e].drawExtended(t,-1);t.restore(),"undefined"!=typeof FlashCanvas&&t.e()},iChart.Charting.ChartDrawingLayer.prototype.serialize=function(){var t={},e=0;t.L=0;for(var i=0;i<this.history.length;++i){var a=this.history[i];if(a.isComplete()&&a.controlEnable&&a.storageEnable){t["L"+e+"_T"]=a.elementType;for(var r=0;r<a.points.length;++r)t["L"+e+"_X"+r]=a.points[r].x,t["L"+e+"_Y"+r]=a.points[r].y;a.hasSettings&&(t["L"+e+"_S"]=window.btoa(encodeURIComponent(JSON.stringify(a.settings))).replace(/=/g,"@")),e++,t.L=t.L+1}}return t},iChart.Charting.ChartDrawingLayer.prototype.setControlsHover=function(t){if(this.controlsHover){if(t){if(this.controlsHover.value.id!=t.value.id||this.controlsHover.mode!=t.mode){if(this.controlsHover.toString().match(new RegExp("^c_","i")));else if(this.controlsHover.mode.toString().match(new RegExp("^a_","i")));else if(this.controlsHover.mode.toString().match(new RegExp("^m_","i"))){var e=this.controlsHover.mode.toString().match(new RegExp(/^m_(\d)/i));"undefined"!=typeof this.controlsHover.value.maps&&"function"==typeof this.controlsHover.value.maps[e[1]].hoverOut&&(this.controlsHover.value.maps[e[1]].hoverOut(),this.controlsHover=null)}if(t.mode.toString().match(new RegExp("^c_","i")));else if(t.mode.toString().match(new RegExp("^a_","i")));else if(t.mode.toString().match(new RegExp("^m_","i"))){var e=t.mode.toString().match(new RegExp(/^m_(\d)/i));"undefined"!=typeof t.value.maps&&"function"==typeof t.value.maps[e[1]].hoverIn&&(this.controlsHover=t,t.value.maps[e[1]].hoverIn())}}}else if(this.controlsHover.toString().match(new RegExp("^c_","i")));else if(this.controlsHover.mode.toString().match(new RegExp("^a_","i")));else if(this.controlsHover.mode.toString().match(new RegExp("^m_","i"))){var e=this.controlsHover.mode.toString().match(new RegExp(/^m_(\d)/i));"undefined"!=typeof this.controlsHover.value.maps&&"function"==typeof this.controlsHover.value.maps[e[1]].hoverOut&&(this.controlsHover.value.maps[e[1]].hoverOut(),this.controlsHover=null)}}else if(t)if(t.mode.toString().match(new RegExp("^c_","i")));else if(t.mode.toString().match(new RegExp("^a_","i")));else if(t.mode.toString().match(new RegExp("^m_","i"))){var e=t.mode.toString().match(new RegExp(/^m_(\d)/i));"undefined"!=typeof t.value.maps&&"function"==typeof t.value.maps[e[1]].hoverIn&&(this.controlsHover=t,t.value.maps[e[1]].hoverIn())}},iChart.Charting.ChartDrawingLayer.prototype.setHover=function(t){null===this.hover||null!=t&&this.hover===t||(this.hover.inHover=!1,this.hover.onOut()),null!==t&&(t.inHover=!0),this.hover!==t&&(this.hover=t,this.render())},iChart.Charting.ChartDrawingLayer.prototype.setSelected=function(t){null!==t&&t.drawSettings(),$("#elementSettings").remove(),this.selected!==t&&(null!=this.selected&&(this.selected.onOut(),this.selected.selected=!1,this.selected.onBlur(this.context)),this.selected=t,this.render(),null===t?(this.$deleteButton.hide().removeClass("on"),this.$settingsButton.hide()):(this.$deleteButton.removeClass("on"),this.selected.selected=!0,this.selected.onSelect(this.context)))},iChart.Charting.ChartDrawingLayer.prototype.start=function(t){this.unfinished=this.createElement(t),this.selected=this.unfinished,"undefined"!=typeof this.unfinished&&this.history.push(this.unfinished)},iChart.Charting.ChartDrawingLayer.prototype.syncHash=function(){this.chart.env.setHashValues(this.serialize())},iChart.Charting.ChartDrawingLayer.prototype.update=function(){if(this.chart.areas){this.area=this.chart.areas[0];for(var t=0;t<this.history.length;++t)delete this.history[t].testContext;this._initCanvas(this.chart.canvas.width,this.chart.canvas.height),this.render()}},iChart.Charting.ChartDrawingLayer.prototype._initCanvas=function(t,e){this.canvas=iChart.Charting.initCanvas(this.chart.container,this.canvas,t,e),this.canvas&&(this.context=this.canvas.getContext("2d"),this.offset=this.chart._containerSize.offset)}}(),function(){"use strict";iChart.Charting.ChartWidgetLayer=function(t,e){if(this.canvas=null,this.chart=t,this.widget={widgetCurPrice:{enable:!1,width:200,height:44,valign:"top",halign:"left",vspace:0,hspace:50}},"undefined"!=typeof e)for(var i in e)this.widget[i]=$.extend(this.widget[i],e[i])},iChart.Charting.ChartWidgetLayer.prototype.clear=function(){},iChart.Charting.ChartWidgetLayer.prototype.render=function(t){if(!t){if(!this.context)return console.log("ERROR: No context for render"),0;t=this.context,t.clearRect(0,0,t.canvas.width,t.canvas.height)}t.save(),this.drawWidgets(t),t.restore(),"undefined"!=typeof FlashCanvas&&t.e()},iChart.Charting.ChartWidgetLayer.prototype.update=function(){this.chart.areas&&(this.area=this.chart.areas[0],this._initCanvas(this.chart.canvas.width,this.chart.canvas.height),this.render())},iChart.Charting.ChartWidgetLayer.prototype._initCanvas=function(t,e){this.canvas=iChart.Charting.initCanvas(this.chart.container,this.canvas,t,e),this.canvas&&(this.context=this.canvas.getContext("2d"),this.offset=this.chart._containerSize.offset)},iChart.Charting.ChartWidgetLayer.prototype.drawWidgets=function(t){for(var e in this.widget)this.widget[e].enable&&this[e](t,this.widget[e])},iChart.Charting.ChartWidgetLayer.prototype.widgetCurPrice=function(t,e){var i=e.width,a=e.height;if("top"==e.valign)var r=this.area.innerOffset.top+e.vspace;else var r=this.area.innerHeight+this.area.innerOffset.top-a-e.vspace;if("left"==e.halign)var s=this.area.innerOffset.left+e.hspace;else var s=this.area.innerWidth+this.area.innerOffset.left-i-e.hspace;t.save(),t.translate(s,r),t.beginPath(),t.moveTo(0,a),t.lineTo(i,a),t.lineTo(i,0),t.lineTo(0,0),t.closePath(),t.clip(),t.fillStyle="rgba(214,218,225,0.75)",t.strokeStyle="rgba(171,177,192,1)",t.fillRect(0,0,i,a),t.rect(0,0,i,a),t.stroke();this.chart.env.userSettings.currentSecurity.q;if(t.fillStyle="#20232a",t.font="normal 26px Arial,Helvetica,sans-serif",t.textBaseline="middle",this.chart.areas[0].ySeries[0]){var n=this.chart.areas[0].ySeries[0].points.length-this.chart.chartOptions.futureAmount-1,o=this.chart.areas[0].xSeries[n],h=this.chart.areas[0].ySeries[0].points[n],l=h[3],c=1/this.chart.env.userSettings.currentSecurity.min_step>1?Math.round(1/this.chart.env.userSettings.currentSecurity.min_step).toString().length-1:0;l=l.toFormat(c,"."," "),t.fillText(l,10,30),t.textBaseline="top";var d=iChart.formatDateTime(new Date(1e3*o),"dd MMMM HH:mm");t.font="normal 11px Arial,Helvetica,sans-serif",t.fillText(d,10,5),t.restore()}},iChart.Charting.ChartWidgetLayer.prototype.widgetCurPrice2=function(t,e){var i=e.width,a=e.height;if("undefined"!=typeof this.chart.env.userSettings.currentSecurity.q){if("top"==e.valign)var r=this.area.innerOffset.top+e.vspace;else var r=this.area.innerHeight+this.area.innerOffset.top-a-e.vspace;if("left"==e.halign)var s=this.area.innerOffset.left+e.hspace;else var s=this.area.innerWidth+this.area.innerOffset.left-i-e.hspace;t.save(),t.translate(s,r),t.beginPath(),t.moveTo(0,a),t.lineTo(i,a),t.lineTo(i,0),t.lineTo(0,0),t.closePath(),t.clip(),t.fillStyle="rgba(214,218,225,0.75)",t.strokeStyle="rgba(171,177,192,1)",t.fillRect(0,0,i,a),t.rect(0,0,i,a),t.stroke();var n=this.chart.env.userSettings.currentSecurity.q;t.fillStyle="#20232a",t.font="normal 26px Arial,Helvetica,sans-serif",t.textBaseline="middle";var o=parseFloat(n.ltp),h=1/this.chart.env.userSettings.currentSecurity.min_step>1?Math.round(1/this.chart.env.userSettings.currentSecurity.min_step).toString().length-1:0;if(o=o.toFormat(h,"."," "),t.fillText(o,10,30),t.textBaseline="top","Invalid Date"!=new Date(n.ltt).toString()){var l=n.ltt;l=l.replace(/^[\d-]{10}T?/,"");var c=iChart.formatDateTime(new Date(n.ltt),"dd MMMM")+" "+l;t.font="normal 11px Arial,Helvetica,sans-serif",t.fillText(c,10,5)}n.chg>=0?t.fillStyle="#228B22":t.fillStyle="#b7333b";var d=parseFloat(n.chg),p=d>0?"▲+":"▼",u="0"==n.chg?"0.00":p+d.toFormat(Math.max(d.getDegree(),2),"."," ");if(t.fillText(u,140,13),n.pcp){n.pcp>=0?t.fillStyle="#228B22":t.fillStyle="#b7333b";var p=parseFloat(n.pcp)>0?"▲+":"▼",g=p+n.pcp+"%";t.fillText(g,140,28)}}t.restore()}}(),function(){"use strict";iChart.Charting.ChartElement=function(t){this.layer=t,this.selected=!1,this.maxPointCount=2,this.points=[{}],this.testContext=void 0,this.id=t.history.length+"_"+(new Date).getTime(),this.controlEnable=!0,this.storageEnable=!0,this.hasSettings=!1,this.hasPopupSettings=!1,this.drawSingle=!1,this.positionAbsolute=!1,this.inHover=!1,t.setSelected(null)},iChart.Charting.ChartElement.prototype.draw=function(t){if(this===this.layer.hover)t.fillStyle="rgba(255,255,153,.2)",t.strokeStyle="#52afc9",t.inHover=!0,this.onHover(t);else if(t.inHover=!1,t.hasSettings){var e=t.settings;t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle,t.lineWidth=e.lineWidth}else t.fillStyle="rgba(0,0,0,.0)",t.strokeStyle="#000";if(this.drawSingle)if("undefined"!=typeof this.markers)t.fillStyle="rgba(82,175,201,.2)",t.strokeStyle="#52afc9",i=this.getCoordinates(t,this.markers),this.drawInternal(t,i),this.drawPoints(t,i);else{var i=this.getCoordinates(t,this.points);this.drawInternal(t,i),this.drawPoints(t,i)}else{var i=this.getCoordinates(t,this.points);this.drawInternal(t,i),this.drawPoints(t,i),"undefined"!=typeof this.markers&&(t.fillStyle="rgba(82,175,201,.2)",t.strokeStyle="#52afc9",i=this.getCoordinates(t,this.markers),this.drawInternal(t,i),this.drawPoints(t,i))}},iChart.Charting.ChartElement.prototype.drawInternal=function(t,e){},iChart.Charting.ChartElement.prototype.drawExtended=function(t){},iChart.Charting.ChartElement.prototype.onHover=function(t){},iChart.Charting.ChartElement.prototype.onOut=function(t){},iChart.Charting.ChartElement.prototype.onSelect=function(t){},iChart.Charting.ChartElement.prototype.onBlur=function(t){},iChart.Charting.ChartElement.prototype.onRemove=function(){},iChart.Charting.ChartElement.prototype.onDrop=function(){},iChart.Charting.ChartElement.prototype.onDrag=function(t){},iChart.Charting.ChartElement.prototype.drawPopupSettings=function(t,e){},iChart.Charting.ChartElement.prototype.drawSettings=function(t){if(this.settings){var e=this.settings,i=e.fillStyle?iChart.rgbToHex(e.fillStyle):"",a=e.strokeStyle?iChart.rgbToHex(e.strokeStyle):"",r=e.color?iChart.rgbToHex(e.color):"",s=e.lineWidth?e.lineWidth:"",n=e.size?e.size:"",o=e.fillStyle&&e.fillStyle.split(",")[3]?e.fillStyle.split(",")[3].slice(0,-1):.5,h=e.strokeStyle&&e.strokeStyle.split(",")[3]?e.strokeStyle.split(",")[3].slice(0,-1):.5,l=e.color&&e.color.split(",")[3]?e.color.split(",")[3].slice(0,-1):.5;""!=i&&($("#fillStyleCanvas").show(),$(".fillStyle").css("background-color",e.fillStyle),$("#fillStyle").attr("data-opacity",o).val(i)),""!=a&&($("#strokeStyleCanvas").show(),$(".strokeStyle").css("background-color",e.strokeStyle),$("#strokeStyle").attr("data-opacity",h).val(a)),""!=r&&($("#fontSettingsColor").show(),$("#fontSettingsColor").attr("data-opacity",l).val(r)),""!=s&&$("#lineWidthSelector").attr("data-style",s),""!=n&&$("#fontSettingsSize").val(n)}},iChart.Charting.ChartElement.prototype.setSettings=function(t){this.settings=t,"undefined"!=typeof this.layer&&this.layer.context&&(this.layer.render(),this.layer.syncHash())},iChart.Charting.ChartElement.prototype.initDrawSettings=function(t,e){if(void 0!=e){var e=e;"undefined"!=typeof e.lineDash&&("undefined"!=typeof t.setLineDash&&t.setLineDash(e.lineDash),void 0!==t.mozDash&&(t.mozDash=e.lineDash)),t.inHover?(t.fillStyle=iChart.invertColor(e.fillStyle),t.strokeStyle=iChart.invertColor(e.strokeStyle),t.lineWidth=e.lineWidth):(t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle,t.lineWidth=e.lineWidth)}},iChart.Charting.ChartElement.prototype.onInsert=function(){this.selected=!0},iChart.Charting.ChartElement.prototype.getCoordinates=function(t,e){for(var i=[],a=0;a<e.length;++a){var r={};if(r.x=Math.round(this.layer.area.getXPositionByValue(e[a].x/1e3)),isNaN(r.x))break;if(this.layer.chart.isComparison){var s=100*(e[a].y/this.layer.area.ySeries[0].points[this.layer.area.viewport.x.bounded.min][3]-1);r.y=Math.round(this.layer.area.getYPosition(s))}else r.y=Math.round(this.layer.area.getYPosition(e[a].y));if(isNaN(r.y))break;if(this===this.layer.selected&&this.controlEnable&&this.storageEnable&&0===a){var n=this,o=function(){return $(this).hasClass("on")?n.remove():$(this).addClass("on"),!1};if(this.layer.$deleteButton.unbind("mousedown").mousedown(o).show().css({left:this.layer.area.innerOffset.left+r.x+2,top:this.layer.area.innerOffset.top+r.y+2}),this.hasSettings&&this.hasPopupSettings){var h=function(){return n.drawPopupSettings(t,r),!1};this.layer.$settingsButton.unbind("mousedown").mousedown(h).show().css({left:this.layer.area.innerOffset.left+r.x-10,top:this.layer.area.innerOffset.top+r.y+2})}}i.push(r)}return i},iChart.Charting.ChartElement.prototype.drawPoints=function(t,e){if(this===this.layer.selected&&this.controlEnable)for(var i=0;i<e.length;++i){var a=e[i];t.save(),t.beginPath(),t.arc(a.x,a.y,6,0,2*Math.PI,!0),t.fillStyle="#fff",t.globalAlpha=1,t.lineWidth=2,t.stokeStyle="#eee",t.fill(),t.stroke(),t.restore()}},iChart.Charting.ChartElement.prototype.getTestContext=function(t){if(t=!!t,"undefined"==typeof this.testContext||t){this.testContext={};var e=this;this.testContext.points=$.map(this.points,function(t,i){return{x:Math.round(e.layer.area.getXPositionByValue(t.x/1e3)),y:Math.round(e.layer.area.getYPosition(t.y))}}),this.setTestSegments()}return this.testContext},iChart.Charting.ChartElement.prototype.isComplete=function(){return this.points.length===this.maxPointCount},iChart.Charting.ChartElement.prototype.isMouseOver=function(t,e){if(!this.isComplete())return-1;var i=this.getTestContext();if("undefined"!=typeof i.maps)for(var a in i.maps){var r=i.maps[a];if(t>=r[0].x&&t<=r[1].x&&e>=r[0].y&&e<=r[1].y)return"m_"+a}for(var a=0;a<i.points.length;++a){var s=i.points[a],n=iChart.Charting.pointToPointDistanceSquared(s,{x:t,y:e});if(n<=64)return a+1}for(var a=0;a<i.segments.length;++a){var o=i.segments[a],n=iChart.Charting.pointToSegmentDistanceSquared(o,{x:t,y:e},!0);if(n<=64)return 0}if(this.selected&&"undefined"!=typeof i.controls)for(var a in i.controls){var r=i.controls[a];if(t>=r[0].x&&t<=r[1].x&&e>=r[0].y&&e<=r[1].y)return"c_"+a}if("undefined"!=typeof i.elementArea){var h=i.elementArea;if(t>=h[0].x&&t<=h[1].x&&e>=h[0].y&&e<=h[1].y)return"a_0"}return-1},iChart.Charting.ChartElement.prototype.remove=function(){this.onRemove(),this.layer.remove(this),delete this.layer,delete this.testContext},iChart.Charting.ChartElement.prototype.setTestSegments=function(){this.testContext.segments=[this.testContext.points],this.testContext.controls=[]}}(),function(){"use strict";iChart.Charting.ChartChannel=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Channel",this.drawType="manually",this.maxPointCount=3,this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartChannel,iChart.Charting.ChartElement),iChart.Charting.ChartChannel.prototype.drawInternal=function(t,e){e.length<2||(this.initDrawSettings(t,this.settings),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),e.length<3||(t.beginPath(),t.moveTo(e[2].x,e[2].y),t.lineTo(e[1].x+(e[2].x-e[0].x),e[1].y+(e[2].y-e[0].y)),t.stroke(),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[1].x+(e[2].x-e[0].x),e[1].y+(e[2].y-e[0].y)),t.lineTo(e[2].x,e[2].y),t.fill()))},iChart.Charting.ChartChannel.prototype.setTestSegments=function(){this.testContext.segments=[this.testContext.points,[this.testContext.points[2],{x:this.testContext.points[1].x+(this.testContext.points[2].x-this.testContext.points[0].x),y:this.testContext.points[1].y+(this.testContext.points[2].y-this.testContext.points[0].y)}]]}}(),function(){"use strict";iChart.Charting.ChartEllipse=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Ellipse",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartEllipse,iChart.Charting.ChartElement),iChart.Charting.ChartEllipse.prototype.drawInternal=function(t,e){if(!(e.length<2)){var i=Math.abs(e[1].y-e[0].y),a=Math.abs(e[1].x-e[0].x);if(!(i<=4||a<=4)){var r=(e[0].x+e[1].x)/2,s=(e[0].y+e[1].y)/2,n=2*a/3;this.initDrawSettings(t,this.settings),t.beginPath(),t.moveTo(r,s-i/2),t.bezierCurveTo(r-n,s-i/2,r-n,s+i/2,r,s+i/2),t.bezierCurveTo(r+n,s+i/2,r+n,s-i/2,r,s-i/2),t.fill(),t.stroke()}}},iChart.Charting.ChartEllipse.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[1].y}],[{x:this.testContext.points[0].x,y:this.testContext.points[1].y},this.testContext.points[1]],[this.testContext.points[1],{x:this.testContext.points[1].x,y:this.testContext.points[0].y}],[{x:this.testContext.points[1].x,y:this.testContext.points[0].y},this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartFibonacciArc=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="FibonacciArc",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartFibonacciArc,iChart.Charting.ChartElement),iChart.Charting.ChartFibonacciArc.prototype.drawInternal=function(t,e){if(!(e.length<2)){t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke();var i=Math.sqrt(iChart.Charting.pointToPointDistanceSquared(e[0],e[1]));if(!(i<=4))for(var a=[.382,.5,.618],r=0;r<a.length;++r)t.beginPath(),t.arc(e[0].x,e[0].y,i*a[r],0,Math.PI,e[0].y>e[1].y),t.stroke()}}}(),function(){"use strict";iChart.Charting.ChartFibonacciCorrection=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="FibonacciCorrection",this.drawType="manually",this.percentages=[0,.382,.5,.618,.786,1,1.272,1.618],this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartFibonacciCorrection,iChart.Charting.ChartElement),iChart.Charting.ChartFibonacciCorrection.prototype.drawInternal=function(t,e){if(!(e.length<2)){t.save(),t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke();var i=e[1].y-e[0].y;if(Math.abs(i)<=4)return void t.restore();for(var a=0;a<this.percentages.length;++a){var r=Math.round(e[0].y+i*this.percentages[a]);if(t.beginPath(),t.moveTo(e[0].x,r),t.lineTo(t.canvas.width,r),t.stroke(),0!=this.percentages[a]){t.font="12px Arial";var s=t.measureText(this.percentages[a]);t.fillText(this.percentages[a],e[0].x-s.width-5,r+5)}}t.restore()}}}(),function(){"use strict";iChart.Charting.ChartFibonacciFan=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="FibonacciFan",this.drawType="manually",this.percentages=[.382,.5,.618],this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartFibonacciFan,iChart.Charting.ChartElement),iChart.Charting.ChartFibonacciFan.prototype.drawInternal=function(t,e){if(!(e.length<2)){t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke();var i=e[1].y-e[0].y;if(!(Math.abs(i)<=4)){i/=e[1].x-e[0].x;for(var a=0;a<this.percentages.length;++a)t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(t.canvas.width,e[0].y+this.percentages[a]*i*(t.canvas.width-e[0].x)),t.stroke()}}}}(),function(){"use strict";iChart.Charting.ChartHorizontalLine=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="HorizontalLine",this.drawType="manually",this.maxPointCount=1,this.hasSettings=!0,this.settings=$.extend({drawLabel:!0},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartHorizontalLine,iChart.Charting.ChartElement),iChart.Charting.ChartHorizontalLine.prototype.drawInternal=function(t,e){if(!(e.length<1)){var i=this.layer.area.getXValue(t.canvas.width-200);this.points[0].x=1e3*i,e[0].x=t.canvas.width-200,t.save(),t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(0,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.stroke(),t.restore()}},iChart.Charting.ChartHorizontalLine.prototype.drawExtended=function(t){if(this.settings.drawLabel){var e=this.getCoordinates(t,this.points);if(e.length<1)return;var i=this.settings,a=this.layer.chart.renderer.formatNumber(this.layer.area.getYValue(e[0].y),{decimalPrecision:this.layer.chart.labelPrecision,scale:0});this.layer.chart.renderer.drawLable(t,i.strokeStyle,0,this.layer.area.innerWidth,e[0].y,a)}},iChart.Charting.ChartHorizontalLine.prototype.setTestSegments=function(){this.testContext.segments=[[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]]}}(),function(){"use strict";iChart.Charting.ChartLine=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Line",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartLine,iChart.Charting.ChartElement),iChart.Charting.ChartLine.prototype.drawInternal=function(t,e){e.length<2||(t.save(),t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),t.restore())}}(),function(){"use strict";iChart.Charting.ChartRectangle=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Rectangle",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartRectangle,iChart.Charting.ChartElement),iChart.Charting.ChartRectangle.prototype.drawInternal=function(t,e){if(!(e.length<2)){t.save(),t.beginPath(),this.initDrawSettings(t,this.settings);var i=e[1].x-e[0].x,a=e[1].y-e[0].y;t.moveTo(e[0].x,e[0].y),t.lineTo(e[0].x,e[1].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[1].x,e[0].y),t.lineTo(e[0].x,e[0].y),t.lineTo(e[0].x,e[1].y),t.lineTo(e[1].x,e[1].y),t.stroke(),t.fillRect(e[0].x,e[0].y,i,a),t.restore()}},iChart.Charting.ChartRectangle.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[1].y}],[{x:this.testContext.points[0].x,y:this.testContext.points[1].y},this.testContext.points[1]],[this.testContext.points[1],{x:this.testContext.points[1].x,y:this.testContext.points[0].y}],[{x:this.testContext.points[1].x,y:this.testContext.points[0].y},this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartTrend=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Trend",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartTrend,iChart.Charting.ChartElement),iChart.Charting.ChartTrend.prototype.drawInternal=function(t,e){if(!(e.length<2)){t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke();var i=Math.sqrt(iChart.Charting.pointToPointDistanceSquared(e[0],e[1]));if(!(i<=4)){t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[0].x+i,e[0].y),t.stroke();var a=Math.acos((e[1].x-e[0].x)/i),r=e[0].y>=e[1].y;this===this.layer.selected&&(t.beginPath(),t.arc(e[0].x,e[0].y,i/4,0,r?2*Math.PI-a:a,r),t.stroke()),"function"==typeof t.strokeText&&(t.font="normal 15px Tahoma",t.fillStyle=t.strokeStyle,t.translate(-.5,-.5),r?(t.textBaseline="top",t.fillText(Math.round(180*a/Math.PI)+"°",e[0].x+18,e[0].y+3)):(t.textBaseline="bottom",t.fillText("-"+Math.round(180*a/Math.PI)+"°",e[0].x+18,e[0].y-3)),t.translate(.5,.5))}}},iChart.Charting.ChartTrend.prototype.setTestSegments=function(){var t=Math.sqrt(iChart.Charting.pointToPointDistanceSquared(this.testContext.points[0],this.testContext.points[1]));this.testContext.segments=[this.testContext.points,[this.testContext.points[0],{x:this.testContext.points[0].x+t,y:this.testContext.points[0].y}]]}}(),function(){"use strict";iChart.Charting.ChartTriangle=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Triangle",this.drawType="manually",this.maxPointCount=3,this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartTriangle,iChart.Charting.ChartElement),iChart.Charting.ChartTriangle.prototype.drawInternal=function(t,e){e.length<2||(t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),e.length<3||(t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.fill(),t.stroke()))},iChart.Charting.ChartTriangle.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],this.testContext.points[1]],[this.testContext.points[1],this.testContext.points[2]],[this.testContext.points[2],this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartVerticalLine=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="VerticalLine",this.drawType="manually",this.maxPointCount=1,this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartVerticalLine,iChart.Charting.ChartElement),iChart.Charting.ChartVerticalLine.prototype.drawInternal=function(t,e){e.length<1||(t.save(),t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,0),t.lineTo(e[0].x,t.canvas.height),t.stroke(),t.restore())},iChart.Charting.ChartVerticalLine.prototype.setTestSegments=function(){this.testContext.segments=[[{x:this.testContext.points[0].x,y:this.layer.area.innerOffset.top},{x:this.testContext.points[0].x,y:this.layer.area.innerOffset.top+this.layer.area.innerHeight}]]}}(),function(){"use strict";iChart.Charting.ChartMark=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Mark",this.drawType="manually",this.maxPointCount=1,this.hasSettings=!0,this.hasPopupSettings=!0,this.settings={mark:$("[data-instrument='Mark'].active").attr("data-mark")},$("#elementSettings").remove()},inheritPrototype(iChart.Charting.ChartMark,iChart.Charting.ChartElement),iChart.Charting.ChartMark.prototype.drawInternal=function(t,e){if(!(e.length<1)&&void 0!=this.settings){var i=this.settings,a=new Image;a.src=this.layer.chart.env.lib_path+"/images/icon-"+i.mark+".png",t.drawImage(a,e[0].x-a.width/2,e[0].y-a.height/2,a.width,a.height),$(".Mark-select").hide()}},iChart.Charting.ChartMark.prototype.drawPopupSettings=function(t,e){$("#elementSettings").remove(),$('<div id="elementSettings" class="mark chartInstrument"><div class="uk-flex uk-flex-left"><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="up" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-up"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="left" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-left"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="leftUp" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-leftUp"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="rightUp" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-rightUp"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="smileUp" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-smileUp"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="exclamation" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-exclamation"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="buy" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-buy"></i></div></div><div class="uk-flex uk-flex-left"><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="down" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-down"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="right" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-right"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="leftDown" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-leftDown"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="rightDown" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-rightDown"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="smileDown" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-smileDown"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="question" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-question"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-mark="sell" name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-sell"></i></div></div></div>').appendTo($(this.layer.chart.container));var i=e.x-$("#elementSettings.mark").width()+8;$("#elementSettings").css({left:this.layer.area.innerOffset.left+i,top:this.layer.area.innerOffset.top+e.y+15});var a=this,r=function(t){a.setSettings({mark:t}),a.layer.render()};return $("#elementSettings .chartTool").off("mousedown").on("mousedown",function(t){t.stopPropagation(),r($(this).attr("data-mark")),$("#elementSettings").remove()}),!1},iChart.Charting.ChartMark.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{
x:this.testContext.points[0].x,y:this.testContext.points[0].y}]]}}(),function(){"use strict";iChart.Charting.ChartLabel=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Label",this.drawType="manually",this.maxPointCount=1,this.hasSettings=!0,this.hasPopupSettings=!0,this.settings=0,this.settings={text:"",size:12},this.sizes=[12,15,19],$("#elementSettings").remove()},inheritPrototype(iChart.Charting.ChartLabel,iChart.Charting.ChartElement),iChart.Charting.ChartLabel.prototype.drawString=function(t,e,i,a,r,s,n,o){var h=e.split("\n");n||(n=0),o||(o="Arial,Helvetica,sans-serif"),r||(r=this.sizes[0]),s||(s="#000000"),t.save(),t.font=r+"px "+o,t.fillStyle=s,t.translate(i,a),t.rotate(n*Math.PI/180);for(var l=0;l<h.length;l++)t.fillText(h[l],0,l*r);t.restore()},iChart.Charting.ChartLabel.prototype.drawInternal=function(t,e){if(!(e.length<1)){var i=this.settings;this.drawString(t,i.text,e[0].x,e[0].y,i.size)}},iChart.Charting.ChartLabel.prototype.setSettings=function(t){this.settings=t,this.layer.context&&(this.layer.render(),this.layer.syncHash())},iChart.Charting.ChartLabel.prototype.drawPopupSettings=function(t,e){var i=this.settings,a=i.size==this.sizes[0]?"selected":"",r=i.size==this.sizes[1]?"selected":"",s=i.size==this.sizes[2]?"selected":"";$("#elementSettings").remove(),$('<div id="elementSettings" class="label"><textarea rows="3" style="width: 99%;">'+i.text+'</textarea><br/>Размер шрифта:<br/><select id="elementSize"><option '+a+' value="'+this.sizes[0]+'">Маленький</option><option '+r+' value="'+this.sizes[1]+'">Средний</option><option '+s+' value="'+this.sizes[2]+'">Большой</option></select><img class="save" style="margin-left: 15px; margin-top: 3px;" src="/i/admin/btn/save.gif"/><div class="close">[X]</div></div>').prependTo($(this.layer.chart.container).parent()),$("#elementSettings.label").css({"margin-left":e.x+2,"margin-top":e.y+2});var n=this,o=function(t){n.setSettings(t)},h=function(){n.remove()},l=function(){var t=n.settings;return t.text};return $("#elementSettings .save").unbind("mousedown").mousedown(function(t){t.stopPropagation();var e={text:$("#elementSettings.label textarea").val(),size:$("#elementSettings.label #elementSize").val()};$("#elementSettings.label textarea").val().length?(o(e),$("#elementSettings.label").remove()):(h(),$("#elementSettings.label").remove())}),$("#elementSettings.label .close").unbind("mousedown").mousedown(function(t){t.stopPropagation(),l().length||h(),$("#elementSettings.label").remove()}),!1},iChart.Charting.ChartLabel.prototype.onInsert=function(){var t=this.getCoordinates(this.layer.context,this.points);this.drawSettings(this.layer.context,t[0])},iChart.Charting.ChartLabel.prototype.setTestSegments=function(){var t=this.layer.context,e=this.settings,i="Arial,Helvetica,sans-serif",a=e.size,r="#000000";t.font=a+"px "+i,t.fillStyle=r;for(var s=0,n=0,o=e.text.split("\n"),h=0;h<o.length;h++)t.measureText(o[h]).width>s&&(s=t.measureText(o[h]).width,n+=a);this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x+s,y:this.testContext.points[0].y}],[{x:this.testContext.points[0].x+s,y:this.testContext.points[0].y},{x:this.testContext.points[0].x+s,y:this.testContext.points[0].y+n}],[{x:this.testContext.points[0].x+s,y:this.testContext.points[0].y+n},{x:this.testContext.points[0].x,y:this.testContext.points[0].y+n}],[{x:this.testContext.points[0].x,y:this.testContext.points[0].y+n},this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartArrow=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Arrow",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartArrow,iChart.Charting.ChartElement),iChart.Charting.ChartArrow.prototype.drawInternal=function(t,e){if(!(e.length<2)){t.save(),this.initDrawSettings(t,this.settings);var i=e[0].x,a=e[0].y,r=e[1].y,s=e[1].x,n=2*(5+t.lineWidth),o=(t.lineWidth,Math.atan2(r-a,s-i));t.beginPath(),t.moveTo(s,r),t.lineTo(s-n*Math.cos(o-Math.PI/6),r-n*Math.sin(o-Math.PI/6)),t.lineTo(s-n*Math.cos(o+Math.PI/6),r-n*Math.sin(o+Math.PI/6)),t.lineTo(s,r),t.lineTo(s-n*Math.cos(o-Math.PI/6),r-n*Math.sin(o-Math.PI/6)),t.fillStyle=t.strokeStyle,t.fill(),t.stroke(),t.beginPath(),t.moveTo(i,a),t.lineTo((s-n*Math.cos(o-Math.PI/6)+s-n*Math.cos(o+Math.PI/6))/2,(r-n*Math.sin(o-Math.PI/6)+r-n*Math.sin(o+Math.PI/6))/2),t.stroke(),t.restore()}}}(),function(){"use strict";iChart.Charting.ChartPolygon=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Polygon",this.drawType="manually",this.maxPointCount=4,this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartPolygon,iChart.Charting.ChartElement),iChart.Charting.ChartPolygon.prototype.drawInternal=function(t,e){if(!(e.length<2||(t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),e.length<3))){if(t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),e.length<4)return void t.fill();var i=this.settings;t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),t.beginPath(),t.strokeStyle=i.strokeStyle2,t.lineTo(e[2].x,e[2].y),t.lineTo(e[3].x,e[3].y),t.stroke(),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(e[3].x,e[3].y),t.fill()}},iChart.Charting.ChartPolygon.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],this.testContext.points[1]],[this.testContext.points[2],this.testContext.points[3]]]}}(),function(){"use strict";iChart.Charting.ChartTrade=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Trade",this.drawType="manually",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!1,this.id=0},inheritPrototype(iChart.Charting.ChartTrade,iChart.Charting.ChartElement),iChart.Charting.ChartTrade.prototype.drawInternal=function(t,e){e.length<1||(t.save(),t.beginPath(),t.arc(e[0].x,e[0].y,5,0,2*Math.PI,!0),1==this.settings.type_id?t.fillStyle="#00ff00":t.fillStyle="#ff0000",t.inHover&&(t.fillStyle="#0000ff",t.stokeStyle="#000"),t.fill(),t.closePath(),""!==this.settings.qb&&(t.beginPath(),t.strokeStyle=t.fillStyle,t.moveTo(e[0].x+5,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.closePath(),t.stroke()),2==this.settings.mode&&this.drawTradeLable(t,e[0].x,e[0].y,this.settings),t.globalAlpha=.3,t.lineWidth=1,t.stokeStyle="#eee",t.restore())},iChart.Charting.ChartTrade.prototype.drawTradeLable=function(t,e,i,a){var r=parseFloat(a.price);r=r<100?iChart.formatNumber(r,{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(r,{decimalPlaces:2,decimalPrecision:null,scale:0});var s=(1==a.type_id?"B":"S")+": "+parseInt(a.volume)+"@"+r;t.save(),t.font="normal 11px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.busyPoints=t.busyPoints?t.busyPoints:{},t.setLineDash&&t.setLineDash([5]);var n=e+20,o=70,h=t.measureText(s).width+10,l=n+h,c=0;for(o=70;o<=this.layer.area.innerHeight;o+=30){c=1;for(var d=$.map(t.busyPoints,function(t,e){return t.y==o?t:null}),p=0;p<d.length&&c;p++)(e<=d[p].maxX&&e>=d[p].minX||l<=d[p].maxX&&l>=d[p].minX||e<=d[p].minX&&l>=d[p].maxX)&&(c=0);if(c)break}t.beginPath(),t.strokeStyle="#C5C5C5",t.fillStyle="rgba(238,238,238,0.5)",t.rect(n,o-10,h,20),t.fill(),t.moveTo(e,i+(o>i?5:-5)),t.lineTo(e,o),t.lineTo(n,o),t.moveTo(e,i+(o>i?5:-5)),t.stroke(),t.fillStyle="#000",t.fillText(s,e+24,o),t.busyPoints[a.id]={minX:e,maxX:n+h,y:o},t.restore()},iChart.Charting.ChartTrade.prototype.onHover=function(t){var e=this.getCoordinates(t,this.points),i=e[0].y,a=e[0].x;this.drawTooltip(this.settings,i,a)},iChart.Charting.ChartTrade.prototype.onOut=function(t){$("#chart-element-tooltip").hide()},iChart.Charting.ChartTrade.prototype.drawTooltip=function(t,e,i){0==$("#chart-element-tooltip").length&&$(this.layer.chart.container).append('<div id="chart-element-tooltip" class="qtip qtip-default qtip-tipsy qtip-pos-rc" tracking="false" role="alert" aria-live="polite" aria-atomic="false" style="z-index: 15002;"><div class="qtip-tip" style="background-color: transparent ! important; border: 0px none ! important; height: 6px; width: 6px; line-height: 6px; top: 50%; margin-top: -3px; right: -6px;"><canvas style="background-color: transparent ! important; border: 0px none ! important;" height="6" width="6"></canvas></div><div class="qtip-content" id="qtip-34-content" aria-atomic="true"></div></div></div>');var a=$("<div>"+(1==t.type_id?"Покупка":"Продажа")+"<br/>Дата: "+(this.layer.chart._dataSettings.timeframe>=1440?t.date_time.substr(0,10):t.date_time)+"<br/>Сделок: "+t.count+"<br/>Количество: "+iChart.formatNumber(parseFloat(t.volume),{decimalPlaces:0,decimalPrecision:null,scale:0})+"<br/>Сумма: "+(t.summ<100?iChart.formatNumber(parseFloat(t.summ),{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(parseFloat(t.summ),{decimalPlaces:2,decimalPrecision:null,scale:0}))+"<br/>Цена: "+(t.price<100?iChart.formatNumber(parseFloat(t.price),{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(parseFloat(t.price),{decimalPlaces:2,decimalPrecision:null,scale:0}))+"<br/>"+(0==parseFloat(t.profit)?"":parseFloat(t.profit)>0?"Прибыль: ":"Убыток: ")+(0!=parseFloat(t.profit)?iChart.formatNumber(parseFloat(t.profit),{decimalPlaces:2,decimalPrecision:2,scale:0})+"<br/>":"")+"</div>");$("#chart-element-tooltip .qtip-content").html(a),$("#chart-element-tooltip").css({top:Math.max(e-$("#chart-element-tooltip").height()-12,0)+"px",left:i+12+"px"}).show()},iChart.Charting.ChartTrade.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[0].y}]]}}(),function(){"use strict";iChart.Charting.ChartBubble=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Bubble",this.drawType="manually",this.maxPointCount=3,this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings,t.chart.env.userSettings.chartSettings.fontSettings,{text:""})},inheritPrototype(iChart.Charting.ChartBubble,iChart.Charting.ChartElement),iChart.Charting.ChartBubble.prototype.onInsert=function(){this.selected=!0;var t=this.getCoordinates(null,this.points);t.length<2||(this.settings.width=t[1].x-t[0].x,this.settings.height=t[1].y-t[0].y)},iChart.Charting.ChartBubble.prototype.drawInternal=function(t,e){if(!(e.length<2)){if("undefined"!=typeof this.markers){({width:e[1].x-e[0].x,height:e[1].y-e[0].y});this.settings.width=e[1].x-e[0].x,this.settings.height=e[1].y-e[0].y}else this.settings.width&&this.settings.height&&(this.points[1].x=1e3*this.layer.area.getXValue(e[0].x+this.settings.width),this.points[1].y=this.layer.area.getYValue(e[0].y+this.settings.height),e[1].x=this.layer.area.getXPositionByValue(this.points[1].x/1e3),e[1].y=this.layer.area.getYPosition(this.points[1].y));this.initDrawSettings(t,this.settings),this.drawBubble(t,e)}},iChart.Charting.ChartBubble.prototype.drawBubble=function(t,e){var i,a=30,r=25,s=Math.abs(e[0].x-e[1].x),n=Math.abs(e[0].y-e[1].y),o=e[0].x<e[1].x,h=e[0].y<e[1].y,l=[{},{},{}],c=80,d=!1,p=!1;if(a=Math.min(parseInt(s/3),parseInt(n/3),r),t.save(),t.lineJoin="miter",t.beginPath(),"undefined"!=typeof e[2]&&Math.abs(e[0].x-e[1].x)>2*a&&Math.abs(e[0].y-e[1].y)>2*a&&!(e[2].x<Math.max(e[0].x,e[1].x)&&e[2].x>Math.min(e[0].x,e[1].x)&&e[2].y<Math.max(e[0].y,e[1].y)&&e[2].y>Math.min(e[0].y,e[1].y)))if(Math.abs(e[0].x-e[2].x)<Math.abs(e[1].x-e[2].x)?l[0].x=e[0].x:l[0].x=e[1].x,Math.abs(e[0].y-e[2].y)<Math.abs(e[1].y-e[2].y)?l[0].y=e[0].y:l[0].y=e[1].y,e[2].x>Math.min(e[0].x,e[1].x)&&e[2].x<Math.max(e[0].x,e[1].x)?d=!0:e[2].y>Math.min(e[0].y,e[1].y)&&e[2].y<Math.max(e[0].y,e[1].y)?p=!0:Math.abs((l[0].x-e[2].x)*(o?1:-1))>Math.abs((l[0].y-e[2].y)*(h?1:-1))?p=!0:d=!0,d){var u=Math.abs(l[0].y-e[2].y)*Math.sin(Math.PI/12);c=parseInt(s/6);var g=parseInt(s-2*a);i=u<c&&u<g?u:Math.min(c,g);var f=o?Math.min(e[1].x-a,Math.max(e[0].x+a,e[2].x)):Math.min(e[0].x-a,Math.max(e[1].x+a,e[2].x));l[1].x=f-i/2,l[2].x=f+i/2,l[1].y=l[2].y=l[0].y,o&&Math.min(l[1].x,l[2].x)<e[0].x+a||!o&&Math.min(l[1].x,l[2].x)<e[1].x+a?(l[1].x=l[0].x+(o?a:a),l[2].x=l[1].x+(o?i:i)):(o&&Math.max(l[1].x,l[2].x)>e[1].x-a||!o&&Math.max(l[1].x,l[2].x)>e[0].x-a)&&(l[1].x=l[0].x-(o?a:a),l[2].x=l[1].x-(o?i:i))}else if(p){var u=Math.abs(l[0].x-e[2].x)*Math.sin(Math.PI/12);c=parseInt(n/6);var g=parseInt(n-2*a);i=u<c&&u<g?u:Math.min(c,g);var m=h?Math.min(e[1].y-a,Math.max(e[0].y+a,e[2].y)):Math.min(e[0].y-a,Math.max(e[1].y+a,e[2].y));l[1].y=m-i/2,l[2].y=m+i/2,l[1].x=l[2].x=l[0].x,h&&Math.min(l[1].y,l[2].y)<e[0].y+a||!h&&Math.min(l[1].y,l[2].y)<e[1].y+a?(l[1].y=l[0].y+(h?a:a),l[2].y=l[1].y+(h?i:i)):(h&&Math.max(l[1].y,l[2].y)>e[1].y-a||!h&&Math.max(l[1].y,l[2].y)>e[0].y-a)&&(l[1].y=l[0].y-(h?a:a),l[2].y=l[1].y-(h?i:i))}t.moveTo(e[0].x+(o?a:-a),e[0].y),d&&l[0].y==e[0].y?(t.lineTo(o?Math.min(l[1].x,l[2].x):Math.max(l[1].x,l[2].x),l[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(o?Math.max(l[1].x,l[2].x):Math.min(l[1].x,l[2].x),l[2].y),t.lineTo(e[1].x-(o?a:-a),e[0].y)):t.lineTo(e[1].x-(o?a:-a),e[0].y),t.quadraticCurveTo(e[1].x,e[0].y,e[1].x,e[0].y+(h?a:-a)),p&&l[0].x==e[1].x?(t.lineTo(l[1].x,h?Math.min(l[1].y,l[2].y):Math.max(l[1].y,l[2].y)),t.lineTo(e[2].x,e[2].y),t.lineTo(l[1].x,h?Math.max(l[1].y,l[2].y):Math.min(l[1].y,l[2].y)),t.lineTo(e[1].x,e[1].y-(h?a:-a))):t.lineTo(e[1].x,e[1].y-(h?a:-a)),t.quadraticCurveTo(e[1].x,e[1].y,e[1].x-(o?a:-a),e[1].y),d&&l[0].y==e[1].y?(t.lineTo(o?Math.max(l[1].x,l[2].x):Math.min(l[1].x,l[2].x),l[2].y),t.lineTo(e[2].x,e[2].y),t.lineTo(o?Math.min(l[1].x,l[2].x):Math.max(l[1].x,l[2].x),l[1].y),t.lineTo(e[0].x+(o?a:-a),e[1].y)):t.lineTo(e[0].x+(o?a:-a),e[1].y),t.quadraticCurveTo(e[0].x,e[1].y,e[0].x,e[1].y-(h?a:-a)),p&&l[0].x==e[0].x?(t.lineTo(l[1].x,h?Math.max(l[1].y,l[2].y):Math.min(l[1].y,l[2].y)),t.lineTo(e[2].x,e[2].y),t.lineTo(l[1].x,h?Math.min(l[1].y,l[2].y):Math.max(l[1].y,l[2].y)),t.lineTo(e[0].x,e[0].y+(h?a:-a))):t.lineTo(e[0].x,e[0].y+(h?a:-a)),t.quadraticCurveTo(e[0].x,e[0].y,e[0].x+(o?a:-a),e[0].y),t.closePath(),t.fill(),t.stroke(),this.drawText(t,e,a,""),t.restore()},iChart.Charting.ChartBubble.prototype.drawText=function(t,e,i,a){var r=5,s=Math.abs(e[0].x-e[1].x)-parseInt(2*i/3)-2*r,n=Math.abs(e[0].y-e[1].y)-parseInt(2*i/3)-2*r,o=Math.min(e[0].x,e[1].x)+parseInt(i/3)+r,h=Math.min(e[0].y,e[1].y)+parseInt(i/3)+r,l=this.settings;if(this.selected){var c=h,d=o+this.layer.area.innerOffset.left;$("#chart-bubble-text").is(":visible")?this.settings.text=$("#chart-bubble-text").val():(0==$("#chart-element-bubble").length&&$(this.layer.chart.container).append('<div id="chart-element-bubble" style="z-index: 15002; position: absolute; "><textarea id="chart-bubble-text"></textarea></div>'),$("#chart-bubble-text").val("").focus().val(this.settings.text)),$("#chart-bubble-text").css({font:"normal "+this.settings.size+"px/"+(parseInt(this.settings.size)+Math.round(parseInt(this.settings.size)/5))+"px "+this.settings.famaly,background:"rgba(230,230,230,.0)",color:this.settings.color,overflow:"hidden",border:"0px solid red",width:s+"px",height:n+"px"}),$("#chart-element-bubble").css({top:c+"px",left:d-2+"px"}).show(),$("#chart-bubble-text").width(s-2).height(n-2),$("#chart-element-bubble").off("click mousedown drag dragstart").on("click mousedown drag dragstart",function(t){t.stopPropagation()})}else{a=l.text,t.save(),t.beginPath(),t.fillStyle=this.settings.color,t.font="normal "+this.settings.size+"px "+this.settings.famaly,t.textAlign="left",t.textBaseline="top",t.rect(o,h,s,n),t.clip(),t.translate(o,h),a=a.replace(/\n/g," [%br%] ");for(var p=a.split(/\s/),u=p.length,g="",f=0+Math.round(parseInt(this.settings.size)/10),m=parseInt(this.settings.size)+Math.round(parseInt(this.settings.size)/5),v=0;v<u;v++){var y=g+p[v]+" ",C=t.measureText(y).width;"[%br%]"==p[v]?(t.fillText(g,0,f),g="",f+=m):C>s?(t.fillText(g,0,f),g=p[v]+" ",f+=m):g=y}t.fillText(g,0,f),t.closePath(),t.restore()}},iChart.Charting.ChartBubble.prototype.onSelect=function(t){0==$("#chart-element-bubble").length&&($(this.layer.chart.container).append('<div id="chart-element-bubble" style="z-index: 15002; position: absolute; "><textarea id="chart-bubble-text"></textarea></div>'),$("#chart-bubble-text").css({font:"normal "+this.settings.size+"px/"+(parseInt(this.settings.size)+Math.round(parseInt(this.settings.size)/5))+"px "+this.settings.famaly,background:"rgba(230,230,230,.0)",color:this.settings.color,overflow:"hidden",border:"0px solid red"})),$("#chart-bubble-text").val("").focus().val(this.settings.text)},iChart.Charting.ChartBubble.prototype.onBlur=function(t){var e=this.settings;e.text=$("#chart-bubble-text").val(),this.setSettings(e),$("#chart-element-bubble").css({top:"-12000px",left:"-12000px"}).remove()},iChart.Charting.ChartBubble.prototype.onHover=function(t){this.selected&&(this.settings.text=$("#chart-bubble-text").val())},iChart.Charting.ChartBubble.prototype.onOut=function(t){this.selected&&(this.settings.text=$("#chart-bubble-text").val())},iChart.Charting.ChartBubble.prototype.onRemove=function(){$("#chart-element-bubble").css({top:"-12000px",left:"-12000px"}).hide()},iChart.Charting.ChartBubble.prototype.drawCheckPoint=function(t,e,i,a){t.strokeText(a,e,i),t.beginPath(),t.save(),t.strokeStyle="rgba(50,50,50,.4)",t.arc(e,i,40,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.lineWidth="3",t.arc(e,i,1,0,2*Math.PI,!0),t.stroke(),t.restore()},iChart.Charting.ChartBubble.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[1].y}],[{x:this.testContext.points[0].x,y:this.testContext.points[1].y},this.testContext.points[1]],[this.testContext.points[1],{x:this.testContext.points[1].x,y:this.testContext.points[0].y}],[{x:this.testContext.points[1].x,y:this.testContext.points[0].y},this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartText=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Text",this.drawType="manually",this.maxPointCount=2,this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings,t.chart.env.userSettings.chartSettings.fontSettings,{text:""})},inheritPrototype(iChart.Charting.ChartText,iChart.Charting.ChartElement),iChart.Charting.ChartText.prototype.onInsert=function(){this.selected=!0;var t=this.getCoordinates(null,this.points);t.length<2||(this.settings.width=t[1].x-t[0].x,this.settings.height=t[1].y-t[0].y)},iChart.Charting.ChartText.prototype.drawInternal=function(t,e){if(!(e.length<2)){if("undefined"!=typeof this.markers){({width:e[1].x-e[0].x,height:e[1].y-e[0].y});this.settings.width=e[1].x-e[0].x,this.settings.height=e[1].y-e[0].y}else this.settings.width&&this.settings.height&&(this.points[1].x=1e3*this.layer.area.getXValue(e[0].x+this.settings.width),this.points[1].y=this.layer.area.getYValue(e[0].y+this.settings.height),e[1].x=this.layer.area.getXPositionByValue(this.points[1].x/1e3),e[1].y=this.layer.area.getYPosition(this.points[1].y));this.initDrawSettings(t,this.settings),this.drawLabel(t,e)}},iChart.Charting.ChartText.prototype.drawLabel=function(t,e){var i=30,a=5,r=Math.abs(e[0].x-e[1].x),s=Math.abs(e[0].y-e[1].y),n=e[0].x<e[1].x,o=e[0].y<e[1].y;i=Math.min(parseInt(r/3),parseInt(s/3),a),t.save(),t.beginPath(),t.moveTo(e[0].x+(n?i:-i),e[0].y),t.lineTo(e[1].x-(n?i:-i),e[0].y),t.quadraticCurveTo(e[1].x,e[0].y,e[1].x,e[0].y+(o?i:-i)),t.lineTo(e[1].x,e[1].y-(o?i:-i)),t.quadraticCurveTo(e[1].x,e[1].y,e[1].x-(n?i:-i),e[1].y),t.lineTo(e[0].x+(n?i:-i),e[1].y),t.quadraticCurveTo(e[0].x,e[1].y,e[0].x,e[1].y-(o?i:-i)),t.lineTo(e[0].x,e[0].y+(o?i:-i)),t.quadraticCurveTo(e[0].x,e[0].y,e[0].x+(n?i:-i),e[0].y),t.closePath(),t.fill(),t.stroke(),this.drawText(t,e,i,""),t.restore()},iChart.Charting.ChartText.prototype.drawText=function(t,e,i,a){var r=5,s=Math.abs(e[0].x-e[1].x)-parseInt(2*i/3)-2*r,n=Math.abs(e[0].y-e[1].y)-parseInt(2*i/3)-2*r,o=Math.min(e[0].x,e[1].x)+parseInt(i/3)+r,h=Math.min(e[0].y,e[1].y)+parseInt(i/3)+r,l=this.settings;if(this.selected){var c=h,d=o+this.layer.area.innerOffset.left;$("#chart-bubble-text").is(":visible")?this.settings.text=$("#chart-bubble-text").val():(0==$("#chart-element-bubble").length&&$(this.layer.chart.container).append('<div id="chart-element-bubble" style="z-index: 15002; position: absolute; "><textarea id="chart-bubble-text"></textarea></div>'),$("#chart-bubble-text").val("").focus().val(this.settings.text)),$("#chart-bubble-text").css({font:"normal "+this.settings.size+"px/"+(parseInt(this.settings.size)+Math.round(parseInt(this.settings.size)/5))+"px "+this.settings.famaly,background:"rgba(230,230,230,.0)",color:this.settings.color,overflow:"hidden",border:"0px solid red",width:s+"px",height:n+"px"}),$("#chart-element-bubble").css({top:c-0+"px",left:d-1+"px"}).show(),$("#chart-bubble-text").width(s-2).height(n-2),$("#chart-element-bubble").off("click mousedown drag dragstart").on("click mousedown drag dragstart",function(t){t.stopPropagation()})}else{a=l.text,t.save(),t.beginPath(),t.fillStyle=this.settings.color,t.font="normal "+this.settings.size+"px "+this.settings.famaly,t.textAlign="left",t.textBaseline="top",t.rect(o,h,s,n),t.clip(),t.translate(o,h),a=a.replace(/\n/g," [%br%] ");for(var p=a.split(/\s/),u=p.length,g="",f=0+Math.round(parseInt(this.settings.size)/10),m=parseInt(this.settings.size)+Math.round(parseInt(this.settings.size)/5),v=0;v<u;v++){var y=g+p[v]+" ",C=t.measureText(y).width;"[%br%]"==p[v]?(t.fillText(g,0,f),g="",f+=m):C>s?(t.fillText(g,0,f),g=p[v]+" ",f+=m):g=y}t.fillText(g,0,f),t.closePath(),t.restore()}},iChart.Charting.ChartText.prototype.onSelect=function(t){0==$("#chart-element-bubble").length&&($(this.layer.chart.container).append('<div id="chart-element-bubble" style="z-index: 15002; position: absolute; "><textarea id="chart-bubble-text"></textarea></div>'),$("#chart-bubble-text").css({font:"normal "+this.settings.size+"px/"+(parseInt(this.settings.size)+Math.round(parseInt(this.settings.size)/5))+"px "+this.settings.famaly,background:"rgba(230,230,230,.0)",color:this.settings.color,overflow:"hidden",border:"0px solid red"})),console.log("here"),$("#chart-bubble-text").val("").focus().val(this.settings.text)},iChart.Charting.ChartText.prototype.onBlur=function(t){var e=this.settings;e.text=$("#chart-bubble-text").val(),this.setSettings(e),$("#chart-element-bubble").css({top:"-12000px",left:"-12000px"}).remove()},iChart.Charting.ChartText.prototype.onHover=function(t){this.selected&&(this.settings.text=$("#chart-bubble-text").val())},iChart.Charting.ChartText.prototype.onOut=function(t){this.selected&&(this.settings.text=$("#chart-bubble-text").val())},iChart.Charting.ChartText.prototype.onRemove=function(){$("#chart-element-bubble").css({top:"-12000px",left:"-12000px"}).hide()},iChart.Charting.ChartText.prototype.drawCheckPoint=function(t,e,i,a){t.strokeText(a,e,i),t.beginPath(),t.save(),t.strokeStyle="rgba(50,50,50,.4)",t.arc(e,i,40,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.lineWidth="3",t.arc(e,i,1,0,2*Math.PI,!0),t.stroke(),t.restore()},iChart.Charting.ChartText.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[1].y}],[{x:this.testContext.points[0].x,y:this.testContext.points[1].y},this.testContext.points[1]],[this.testContext.points[1],{x:this.testContext.points[1].x,y:this.testContext.points[0].y}],[{x:this.testContext.points[1].x,y:this.testContext.points[0].y},this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartOrder=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Order",this.drawType="auto",this.hoverCursor="row-resize",this.moveCursor="row-resize",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!1,this.storageEnable=!1,this.settings={},this.positionAbsolute=!0},inheritPrototype(iChart.Charting.ChartOrder,iChart.Charting.ChartElement),iChart.Charting.ChartOrder.prototype.drawInternal=function(t,e){if(!(e.length<1)){this.settings.fillStyle=this.settings.fillStyle||"#3AAE3E";var i=this.layer.chart.areas[0].xSeries[this.layer.chart.areas[0].xSeries.length-this.layer.chart.chartOptions.futureAmount-1];this.points[0].x=1e3*i,e[0].x=this.layer.area.getXPositionByValue(i);var a=this.settings.fillStyle;if(this.selected||t.inHover)t.save(),t.beginPath(),t.strokeStyle=a,t.moveTo(0,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.stroke(),t.restore(),this.drawLable(t,a,this.settings.textColor,e[0].x,e[0].y,this.settings.text);else{t.save(),t.strokeStyle=a,t.lineWidth=1,t.beginPath();for(var r=0;r<=t.canvas.width;r+=20)t.moveTo(r,e[0].y),t.lineTo(r+12,e[0].y);t.stroke(),t.restore()}}},iChart.Charting.ChartOrder.prototype.drawExtended=function(t){if(this.selected){var e=this.getCoordinates(t,this.points);if(e.length<1)return;var i=iChart.formatNumber(this.points[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0});if(this.layer.chart.renderer.drawLable(t,this.settings.fillStyle,0,this.layer.area.innerWidth,e[0].y,i),"undefined"!=typeof this.markers){var e=this.getCoordinates(t,this.markers),i=iChart.formatNumber(this.markers[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),a=t.inHover?"undefined"!=typeof this.settings.fillStyleHover?this.settings.fillStyleHover:iChart.Charting.ChartOrder.lightColor(this.settings.fillStyle):this.settings.fillStyle;this.layer.chart.renderer.drawLable(t,a,0,this.layer.area.innerWidth,e[0].y,i)}}},iChart.Charting.ChartOrder.prototype.drawLable=function(t,e,i,a,r,s){e=e?e:"#333333",i=i?i:"#FFFFFF",t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=e,t.lineWidth="2";var n=t.measureText(s).width,o=n,a=t.canvas.width-120;t.beginPath(),t.moveTo(a-o-5,r+5),t.lineTo(a-o-5,r-5),t.quadraticCurveTo(a-o-5,r-10,a-o,r-10),t.lineTo(a,r-10),t.quadraticCurveTo(a+5,r-10,a+5,r-5),t.lineTo(a+5,r+5),t.quadraticCurveTo(a+5,r+10,a,r+10),t.lineTo(a-o,r+10),t.quadraticCurveTo(a-o-5,r+10,a-o-5,r+5),t.closePath(),t.save();var h=this.layer.chart.chartOptions.shadowColor;this.selected?(t.shadowColor=h,t.shadowBlur=20,t.shadowOffsetX=15,t.shadowOffsetY=15):t.inHover&&(t.shadowColor=h,t.shadowBlur=10,t.shadowOffsetX=5,t.shadowOffsetY=5),t.fill(),t.restore(),this.drawCancelButton(t,a,r-10),t.fillStyle=i,t.fillText(s,a-o,r),t.restore()},iChart.Charting.ChartOrder.prototype.drawCancelButton=function(t,e,i){t.beginPath(),t.moveTo(e,i),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.lineTo(e,i+20),t.stroke(),t.lineTo(e+15,i+20),t.quadraticCurveTo(e+20,i+20,e+20,i+15),t.lineTo(e+20,i+5),t.quadraticCurveTo(e+20,i,e+15,i),t.closePath(),t.fillStyle="#e53935",t.fill(),t.beginPath(),t.moveTo(e+5,i+5),t.lineTo(e+15,i+15),t.moveTo(e+5,i+15),t.lineTo(e+15,i+5),t.stroke(),t.closePath()},iChart.Charting.ChartOrder.prototype.drawTestSegments=function(t){if("undefined"!=typeof this.testContext){t.save(),t.beginPath(),t.fillStyle="rgba(0,0,0,0.75)";for(var e in this.testContext.segments){var i=this.testContext.segments[e];t.moveTo(i[0].x,i[0].y),t.lineTo(i[1].x,i[1].y),t.stroke()}t.closePath(),t.restore()}},iChart.Charting.ChartOrder.prototype.setTestSegments=function(){if(this.selected){var t=this.layer.context;t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle";var e=t.measureText(this.settings.text).width,i=t.canvas.width-120;this.testContext.segments=[[{x:i-e,y:this.testContext.points[0].y-4},{x:i,y:this.testContext.points[0].y-4}],[{x:i,y:this.testContext.points[0].y-4},{x:i,y:this.testContext.points[0].y+4}],[{x:i,y:this.testContext.points[0].y+4},{x:i-e,y:this.testContext.points[0].y+4}],[{x:i-e,y:this.testContext.points[0].y+4},{x:i-e,y:this.testContext.points[0].y-4}],[{x:i-e,y:this.testContext.points[0].y},{x:i,y:this.testContext.points[0].y}],[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]]}else this.testContext&&(this.testContext.segments=[[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]])},iChart.Charting.ChartOrder.prototype.onDrag=function(t){"function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t)},iChart.Charting.ChartOrder.prototype.onSelect=function(){this.setTestSegments()},iChart.Charting.ChartOrder.prototype.onBlur=function(){this.setTestSegments()},iChart.Charting.ChartOrder.prototype.onDrop=function(){"function"==typeof this.settings.onDrop&&this.settings.onDrop.call(this)},iChart.Charting.ChartOrder.prototype.onHover=function(){clearTimeout(this.layer.chart.env.timers.orderClose),this.cancelControl(1)},iChart.Charting.ChartOrder.prototype.onOut=function(){clearTimeout(this.layer.chart.env.timers.orderClose);var t=this;this.layer.chart.env.timers.orderClose=setTimeout(function(){t.cancelControl(0)},300)},iChart.Charting.ChartOrder.prototype.cancelControl=function(t){if("function"==typeof this.settings.onCancel)if(t){$("#ichartOrderCancelCtrl").hide();var e=this.layer.context,i=e.canvas.width-120,a=this.getCoordinates(e,this.points);$("#ichartOrderCancelCtrl").length||$("<span/>",{id:"ichartOrderCancelCtrl",style:"color:transparent",class:"m-chart-instrument-delete",text:"✕",title:_t("2958","Снять")}).hide().appendTo(this.layer.chart.container);var r=this;$("#ichartOrderCancelCtrl").unbind("click").bind("click",function(t){"function"==typeof r.settings.onCancel&&r.settings.onCancel.call(r),$("#ichartOrderCancelCtrl").hide()}).bind("mouseover",function(){clearTimeout(r.layer.chart.env.timers.orderClose)}).bind("mouseleave",function(){clearTimeout(r.layer.chart.env.timers.orderClose),r.layer.chart.env.timers.orderClose=setTimeout(function(){r.cancelControl(0)},1e3)});var s=a[0].y-8,n=i+2;$("#ichartOrderCancelCtrl").css({top:s,left:n}).show()}else $("#ichartOrderCancelCtrl").hide()},iChart.Charting.ChartOrder.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"},iChart.Charting.ChartOrder.prototype.onMouseDown=function(t){"function"==typeof this.settings.onSelect&&this.settings.onSelect.call(this,t)}}(),function(){"use strict";iChart.Charting.ChartVisualtrade=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Visualtrade",this.drawType="auto",this.hoverCursor="url('"+this.layer.chart.env.lib_path+"/styles/cursors/red_vertical_cursor.cur'), move",this.moveCursor="url('"+this.layer.chart.env.lib_path+"/styles/cursors/red_vertical_cursor.cur'), move",this.maxPointCount=5,this.hasSettings=!0,this.controlEnable=!0,this.storageEnable=!1,this.settings={redColor:"#bc353d",greenColor:"#7fcc1a",blueColor:"#4684c6",greyColor:"#999999",offset:40},this.drawSingle=!0},inheritPrototype(iChart.Charting.ChartVisualtrade,iChart.Charting.ChartElement),iChart.Charting.ChartVisualtrade.prototype.setSettings=function(t){this.settings=$.extend(this.settings,t),this.settings.onDrop=function(t){if(!isNaN(parseInt(t))){var e=parseInt(t)-1;if(0===e)$(jNTChartTrading).trigger("priceExternalUpdate",["price",iChart.roundToPrecision(this.points[0].y,this.layer.chart.env.userSettings.currentSecurity.min_step)]);else if(1===e){var i=this.getControlValue("order_type");"sell_at"==i||"sell"==i?$(jNTChartTrading).trigger("priceExternalUpdate",["tp",iChart.roundToPrecision(this.points[1].y,this.layer.chart.env.userSettings.currentSecurity.min_step)]):$(jNTChartTrading).trigger("priceExternalUpdate",["sl",iChart.roundToPrecision(this.points[1].y,this.layer.chart.env.userSettings.currentSecurity.min_step)]);
}else if(2===e){var i=this.getControlValue("order_type");"sell_at"==i||"sell"==i?$(jNTChartTrading).trigger("priceExternalUpdate",["sl",iChart.roundToPrecision(this.points[2].y,this.layer.chart.env.userSettings.currentSecurity.min_step)]):$(jNTChartTrading).trigger("priceExternalUpdate",["tp",iChart.roundToPrecision(this.points[2].y,this.layer.chart.env.userSettings.currentSecurity.min_step)])}}},this.priceControl={width:180,height:30},this.elementArea={top:70,bottom:47,left:10,right:10},this.points[0].fActive=1,this.points[1].fActive=0,this.points[2].fActive=0,this.points[0].enable=1,this.points[1].enable=!!this.settings.stoplossEnable,this.points[2].enable=!!this.settings.takeprofitEnable,this.points[1].fHover=0,this.points[2].fHover=0,this.controls={1:{enabled:!1,element:this,x:10,y:10,w:100,h:17,click:function(){this.element.switchControl(this)},type:"order_type",label:_t("4018","Продать"),value:"sell_at",active:!1},2:{enabled:!1,element:this,x:10,y:33,w:100,h:17,click:function(){this.element.switchControl(this)},type:"order_type",label:_t("4875","Продать по рынку"),value:"sell",active:!1},3:{enabled:!1,element:this,x:120,y:10,w:100,h:17,click:function(){this.element.switchControl(this)},type:"order_type",label:_t("4019","Купить"),value:"buy_at",active:!1},4:{enabled:!1,element:this,x:120,y:33,w:100,h:17,click:function(){this.element.switchControl(this)},type:"order_type",label:_t("5452","Купить по рынку"),value:"buy",active:!1},5:{enabled:!1,element:this,x:120,y:-27,w:100,h:17,click:function(){var t=this.element.getControlValue("order_type"),e=iChart.roundToPrecision(this.element.points[0].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step),i=0,a=0;"buy_at"==t||"buy"==t?(i=Math.min(iChart.roundToPrecision(this.element.points[1].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step),iChart.roundToPrecision(this.element.points[2].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)),a=Math.max(iChart.roundToPrecision(this.element.points[1].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step),iChart.roundToPrecision(this.element.points[2].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)),e==i&&(i=null),e==a&&(a=null)):"sell_at"!=t&&"sell"!=t||(i=Math.min(iChart.roundToPrecision(this.element.points[1].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step),iChart.roundToPrecision(this.element.points[2].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)),a=Math.max(iChart.roundToPrecision(this.element.points[1].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step),iChart.roundToPrecision(this.element.points[2].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)),e==i&&(i=null),e==a&&(a=null))},type:"action",label:_t("614","Ok"),value:"ok",active:!1},6:{enabled:!1,element:this,x:10,y:-27,w:100,h:17,click:function(){this.element.remove()},type:"action",label:_t("1403","Отмена"),value:"cancel",active:!1},7:{enabled:!0,element:this,click:function(){jNTChartTrading.close(),this.element.layer.chart.env.removeVisualTrade()},type:"close",value:"stoploss"},8:{enabled:!0,element:this,click:function(){jNTChartTrading.close(),this.element.layer.chart.env.removeVisualTrade()},type:"close",value:"takeprofit"},9:{enabled:!0,element:this,active:!0,click:function(){this.element.points[0].fActive=0,jNTChartTrading.close(),this.element.layer.chart.env.removeVisualTrade()},type:"close",value:"price"}};for(var e=0;e<this.settings.controls.length;e++)for(var i in this.controls)this.settings.controls[e].type==this.controls[i].type&&this.settings.controls[e].value==this.controls[i].value&&(this.controls[i].active=!0);this.maps={0:{element:this,click:function(){this.element.points[0].fActive=1,this.element.points[1].fActive=0,this.element.points[2].fActive=0,this.element.setTestSegments(),$(jNTChartTrading).trigger("priceExternalUpdate",["price",iChart.roundToPrecision(this.element.points[0].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)])},hoverIn:function(){this.element.points[0].fHover=1,this.element.layer.render()},hoverOut:function(){this.element.points[0].fHover=0,this.element.layer.render()},type:"sltp",value:"price"},1:{element:this,click:function(){this.element.points[1].fActive=1,this.element.points[0].fActive=0,this.element.points[2].fActive=0,this.element.setTestSegments();var t=this.element.getControlValue("order_type");"sell_at"==t||"sell"==t?$(jNTChartTrading).trigger("priceExternalUpdate",["tp",iChart.roundToPrecision(this.element.points[1].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)]):$(jNTChartTrading).trigger("priceExternalUpdate",["sl",iChart.roundToPrecision(this.element.points[1].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)])},hoverIn:function(){this.element.points[1].fHover=1,this.element.layer.render()},hoverOut:function(){this.element.points[1].fHover=0,this.element.layer.render()},type:"sltp",value:"stoploss"},2:{element:this,click:function(){this.element.points[2].fActive=1,this.element.points[0].fActive=0,this.element.points[1].fActive=0,this.element.setTestSegments();var t=this.element.getControlValue("order_type");"sell_at"==t||"sell"==t?$(jNTChartTrading).trigger("priceExternalUpdate",["sl",iChart.roundToPrecision(this.element.points[2].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)]):$(jNTChartTrading).trigger("priceExternalUpdate",["tp",iChart.roundToPrecision(this.element.points[2].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)])},hoverIn:function(){this.element.points[2].fHover=1,this.element.layer.render()},hoverOut:function(){this.element.points[2].fHover=0,this.element.layer.render()},type:"sltp",value:"takeprofit"}}},iChart.Charting.ChartVisualtrade.prototype.drawInternal=function(t,e){if(!(e.length<3)){var i=this.layer.chart.env.viewData.chart.areas[0].getXPositionByIndex(this.layer.chart.env.viewData.chart.areas[0].xSeries.length-1-this.layer.chart.env.viewData.chart.chartOptions.futureAmount)+this.settings.offset;i=Math.min(i,this.layer.chart.env.viewData.chart.areas[0].getXPositionByIndex(this.layer.chart.env.viewData.chart.areas[0].xSeries.length-1));var a=this.layer.chart.env.viewData.chart.areas[0].getXValue(i);this.points[0].x=1e3*a,this.points[1].x=this.points[2].x=this.points[0].x,e[0].x=this.layer.area.getXPositionByValue(a),e[1].x=e[2].x=e[0].x,this.selected&&this.drawArea(t,e),t.fillStyle="rgba(255,255,255,1)";for(var r=e.length-1;r>=0;r--)r>=3||(this.drawPriceBox(t,e,r),this.drawLabel(t,e,r));var s=this.getElementAreaPos(e);this.points[3].y=this.layer.area.getYValue(s[0].y).toFixed(2),this.points[4].y=this.layer.area.getYValue(s[1].y).toFixed(2)}},iChart.Charting.ChartVisualtrade.prototype.drawPoints=function(t,e){},iChart.Charting.ChartVisualtrade.prototype.drawTestSegments=function(t){if("undefined"!=typeof this.testContext){t.save(),t.fillStyle="#000000";for(var e in this.testContext.controls){var i=this.testContext.controls[e];t.rect(i[0].x,i[0].y,i[1].x-i[0].x,i[1].y-i[0].y),t.stroke()}t.restore()}},iChart.Charting.ChartVisualtrade.prototype.getColorForPoint=function(t){var e="#999999";switch(t){case 0:e=this.settings.blueColor;break;case 1:this.points[t].fActive&&(e="sell"==this.getControlValue("order_type")||"sell_at"==this.getControlValue("order_type")?this.settings.greenColor:this.settings.redColor);break;case 2:this.points[t].fActive&&(e="sell"==this.getControlValue("order_type")||"sell_at"==this.getControlValue("order_type")?this.settings.redColor:this.settings.greenColor);break;default:e="#5a6378"}return e},iChart.Charting.ChartVisualtrade.prototype.drawExtended=function(t){if("undefined"!=typeof this.markers)var e=this.getCoordinates(t,this.markers),i=this.markers;else var e=this.getCoordinates(t,this.points),i=this.points;if(!(e.length<1))for(var a=0;a<e.length&&a<3;a++)if(i[a].fActive){var r=iChart.roundToPrecision(i[a].y,this.layer.chart.env.userSettings.currentSecurity.min_step);this.layer.chart.renderer.drawLable(t,this.getColorForPoint(a),0,this.layer.area.innerWidth,e[a].y,r)}},iChart.Charting.ChartVisualtrade.prototype.drawArea=function(t,e){this.getElementAreaPos(e);if(this.selected)for(var i in this.controls){var a=this.controls[i];a.enabled&&this.drawControl(t,e,a)}},iChart.Charting.ChartVisualtrade.prototype.drawControl=function(t,e,i){t.save();var a=this.getElementAreaPos(e);if("order_type"==i.type||"action"==i.type)i.active?t.fillStyle="rgba(57,63,79,1)":t.fillStyle="#ffffff",i.y>=0?t.fillRect(a[0].x+i.x,a[0].y+i.y,i.w,i.h):t.fillRect(a[0].x+i.x,a[1].y+i.y,i.w,i.h),i.active?(t.fillStyle="#ffffff",t.font="normal 11px Arial,Helvetica,sans-serif"):(t.fillStyle="#428bca",t.font="normal 11px Arial,Helvetica,sans-serif"),t.textAlign="left",t.textBaseline="top",i.y>=0?t.fillText(i.label,a[0].x+i.x+2,a[0].y+i.y+4):t.fillText(i.label,a[0].x+i.x+2,a[1].y+i.y+4);else if("close"==i.type){if("stoploss"==i.value||"takeprofit"==i.value){if("sell"==this.getControlValue("order_type")||"sell_at"==this.getControlValue("order_type")){if("stoploss"==i.value&&this.points[2].fActive)var r=e[2];else if("takeprofit"==i.value&&this.points[1].fActive)var r=e[1]}else if("buy"==this.getControlValue("order_type")||"buy_at"==this.getControlValue("order_type"))if("stoploss"==i.value&&this.points[1].fActive)var r=e[1];else if("takeprofit"==i.value&&this.points[2].fActive)var r=e[2]}else if(this.points[0].fActive)var r=e[0];r&&(t.fillStyle="#ff9999",t.strokeStyle="#777777",t.beginPath(),t.lineWidth=2,t.moveTo(r.x+this.priceControl.width+10-4,r.y-15-4),t.lineTo(r.x+this.priceControl.width+10+4,r.y-15+4),t.moveTo(r.x+this.priceControl.width+10+4,r.y-15-4),t.lineTo(r.x+this.priceControl.width+10-4,r.y-15+4),t.closePath(),t.stroke())}t.restore()},iChart.Charting.ChartVisualtrade.prototype.drawPriceBox=function(t,e,i){var a="";switch(i){case 0:a=this.settings.blueColor;break;case 1:if(this.points[i].fActive)switch(this.getControlValue("order_type")){case"sell":case"sell_at":a=this.settings.greenColor;break;case"buy":case"buy_at":a=this.settings.redColor}else a=this.settings.greyColor;break;case 2:if(this.points[i].fActive)switch(this.getControlValue("order_type")){case"sell":case"sell_at":a=this.settings.redColor;break;case"buy":case"buy_at":a=this.settings.greenColor}else a=this.settings.greyColor;break;default:a="ffffff"}this.points[i].fActive?(t.save(),t.fillStyle=a,t.beginPath(),t.moveTo(e[i].x-10,e[i].y-10),t.lineTo(e[i].x+this.priceControl.width,e[i].y-10),t.lineTo(e[i].x+this.priceControl.width+8,e[i].y),t.lineTo(e[i].x+this.priceControl.width,e[i].y+10),t.lineTo(e[i].x-10,e[i].y+10),t.lineTo(e[i].x-10,e[i].y-10),t.moveTo(e[i].x+10,e[i].y-10),t.lineTo(e[i].x+10,e[i].y+10),t.closePath(),t.fill(),t.restore(),t.save(),t.strokeStyle="#ffffff",t.beginPath(),t.moveTo(e[i].x-5,e[i].y-3),t.lineTo(e[i].x+5,e[i].y-3),t.moveTo(e[i].x-5,e[i].y),t.lineTo(e[i].x+5,e[i].y),t.moveTo(e[i].x-5,e[i].y+3),t.lineTo(e[i].x+5,e[i].y+3),t.closePath(),t.stroke(),t.strokeStyle=a,t.beginPath(),t.moveTo(e[i].x+this.priceControl.width+8,e[i].y),t.lineTo(t.canvas.width,e[i].y),t.moveTo(0,e[i].y),t.lineTo(e[i].x-10,e[i].y),t.closePath(),t.stroke(),t.restore()):this.points[i].enable&&(t.save(),this.points[i].fHover?t.strokeStyle=this.settings.blueColor:t.strokeStyle="#AAAAAA",t.beginPath(),t.moveTo(e[i].x-10,e[i].y-10),t.lineTo(e[i].x+this.priceControl.width,e[i].y-10),t.lineTo(e[i].x+this.priceControl.width+8,e[i].y),t.lineTo(e[i].x+this.priceControl.width,e[i].y+10),t.lineTo(e[i].x-10,e[i].y+10),t.lineTo(e[i].x-10,e[i].y-10),t.closePath(),t.stroke(),t.restore())},iChart.Charting.ChartVisualtrade.prototype.drawLabel=function(t,e,i){var a="";switch(i){case 0:var r=this.points[0].y;switch("undefined"!=typeof this.markers&&(r=this.markers[0].y),this.getControlValue("order_type")){case"sell":a=_t("4875","Продать по рынку");break;case"sell_at":a=_t("4876","Продать по")+iChart.roundToPrecision(r,this.layer.chart.env.userSettings.currentSecurity.min_step);break;case"buy":a=_t("5452","Купить по рынку");break;case"buy_at":a=_t("5458","Купить по")+iChart.roundToPrecision(r,this.layer.chart.env.userSettings.currentSecurity.min_step)}break;case 1:var r=this.points[1].y;switch("undefined"!=typeof this.markers&&(r=this.markers[1].y),this.getControlValue("order_type")){case"sell":case"sell_at":a=_t("3917","TakeProfit")+" ";var s=100*(this.points[0].y/r-1);break;case"buy":case"buy_at":a=_t("3916","StopLoss")+" ";var s=100*(1-this.points[0].y/r)}a+=s.toFixed(2)+"%";break;case 2:var r=this.points[2].y;switch("undefined"!=typeof this.markers&&(r=this.markers[2].y),this.getControlValue("order_type")){case"sell":case"sell_at":a=_t("3916","StopLoss")+" ";var s=100*(1-r/this.points[0].y);break;case"buy":case"buy_at":a=_t("3917","TakeProfit")+" ";var s=100*(r/this.points[0].y-1)}a+=s.toFixed(2)+"%"}t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle="#ffffff",this.points[i].fActive?t.fillText(a,e[i].x+15,e[i].y):(this.points[i].fHover?t.fillStyle=this.settings.blueColor:t.fillStyle="#AAAAAA",this.points[i].enable&&t.fillText(a,e[i].x+15,e[i].y)),t.restore()},iChart.Charting.ChartVisualtrade.prototype.setTestSegments=function(){this.testContext.segments=[];var t=this.getElementAreaPos(this.testContext.points);this.testContext.elementArea=t,this.testContext.controls={};for(var e in this.controls)if(this.controls[e].enabled)if("order_type"==this.controls[e].type||"action"==this.controls[e].type)this.controls[e].y>=0?this.testContext.controls[e]=[{x:t[0].x+this.controls[e].x,y:t[0].y+this.controls[e].y},{x:t[0].x+this.controls[e].x+this.controls[e].w,y:t[0].y+this.controls[e].y+this.controls[e].h}]:this.testContext.controls[e]=[{x:t[0].x+this.controls[e].x,y:t[1].y+this.controls[e].y},{x:t[0].x+this.controls[e].x+this.controls[e].w,y:t[1].y+this.controls[e].y+this.controls[e].h}];else if("close"==this.controls[e].type){var i=this.controls[e];if("stoploss"==i.value||"takeprofit"==i.value){if("sell"==this.getControlValue("order_type")||"sell_at"==this.getControlValue("order_type")){if("stoploss"==i.value&&this.points[2].fActive)var a=this.testContext.points[2];else if("takeprofit"==i.value&&this.points[1].fActive)var a=this.testContext.points[1]}else if("stoploss"==i.value&&this.points[1].fActive)var a=this.testContext.points[1];else if("takeprofit"==i.value&&this.points[2].fActive)var a=this.testContext.points[2]}else if(this.points[0].fActive)var a=this.testContext.points[0];a&&(this.testContext.controls[e]=[{x:a.x+this.priceControl.width+2,y:a.y-23},{x:a.x+this.priceControl.width+2+16,y:a.y-23+16}])}this.testContext.maps={},this.points[0].fActive||(this.testContext.maps[0]=[{x:this.testContext.points[0].x+10,y:this.testContext.points[0].y-10},{x:this.testContext.points[0].x+this.priceControl.width+10,y:this.testContext.points[0].y+10}]),!this.points[1].fActive&&this.points[1].enable&&(this.testContext.maps[1]=[{x:this.testContext.points[1].x+10,y:this.testContext.points[1].y-10},{x:this.testContext.points[1].x+this.priceControl.width+10,y:this.testContext.points[1].y+10}]),!this.points[2].fActive&&this.points[2].enable&&(this.testContext.maps[2]=[{x:this.testContext.points[2].x+10,y:this.testContext.points[2].y-10},{x:this.testContext.points[2].x+this.priceControl.width+10,y:this.testContext.points[2].y+10}])},iChart.Charting.ChartVisualtrade.prototype.onDrag=function(t){"function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t)},iChart.Charting.ChartVisualtrade.prototype.onDrop=function(t){"function"==typeof this.settings.onDrop&&this.settings.onDrop.call(this,t)},iChart.Charting.ChartVisualtrade.prototype.getElementAreaPos=function(t){var e=Math.max.apply(Math,t.map(function(t,e){return e<3?t.y:null})),i=Math.min.apply(Math,t.map(function(t,i){return i<3?t.y:e}));return this.selected?[{x:t[0].x-this.elementArea.left,y:i-this.elementArea.top},{x:t[0].x+this.priceControl.width+this.elementArea.right,y:e+this.elementArea.bottom}]:[{x:t[0].x-this.elementArea.left,y:i-this.elementArea.top+30},{x:t[0].x+this.priceControl.width+this.elementArea.right,y:e+this.elementArea.bottom}]},iChart.Charting.ChartVisualtrade.prototype.switchControl=function(t){for(var e in this.controls)t.type==this.controls[e].type&&(this.controls[e].active=!1);t.active=!0,this.layer.render()},iChart.Charting.ChartVisualtrade.prototype.getControl=function(t,e){for(var i in this.controls)if(this.controls[i].type==t&&this.controls[i].value==e)return this.controls[i]},iChart.Charting.ChartVisualtrade.prototype.getControlValue=function(t){for(var e in this.controls)if(this.controls[e].type==t&&this.controls[e].active)return this.controls[e].value},iChart.Charting.ChartVisualtrade.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"}}(),function(){"use strict";iChart.Charting.ChartButton=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Button",this.drawType="auto",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!0,this.storageEnable=!1,this.settings={controls:[]}},inheritPrototype(iChart.Charting.ChartButton,iChart.Charting.ChartElement),iChart.Charting.ChartButton.prototype.setSettings=function(t){this.settings=$.extend(this.settings,t),this.points[0].fActive=1,this.controls={1:{enabled:!0,element:this,x:0,y:0,w:100,h:17,click:function(){console.log(this)},label:_t("6346","Новый приказ"),fillColor:"rgba(220,220,220,1)",strokeStyle:"#999999"}};for(var e=0;e<this.settings.controls.length;e++)for(var i in this.controls)this.settings.controls[e].type==this.controls[i].type&&this.settings.controls[e].value==this.controls[i].value&&(this.controls[i].active=!0);this.maps={0:{element:this,click:function(){this.element.settings.click.call(this)},hoverIn:function(){this.element.points[0].fHover=1,this.element.layer.render()},hoverOut:function(){this.element.points[0].fHover=0,this.element.layer.render()}}}},iChart.Charting.ChartButton.prototype.drawInternal=function(t,e){if(!(e.length<1)){this.settings.fillStyle=this.settings.fillStyle||"#3AAE3E";var i=this.layer.chart.areas[0].getXPositionByIndex(this.layer.chart.areas[0].xSeries.length-1-this.layer.chart.chartOptions.futureAmount)+40;i=Math.min(i,this.layer.chart.areas[0].getXPositionByIndex(this.layer.chart.areas[0].xSeries.length-1));var a=this.layer.chart.areas[0].getXValue(i),r=this.layer.chart.areas[0].ySeries[0].points[this.layer.chart.areas[0].ySeries[0].points.length-this.layer.chart.chartOptions.futureAmount-1];this.points[0].x=1e3*a,this.points[0].y=r[2],e[0].x=this.layer.area.getXPositionByValue(a);for(var s in this.controls){var n=this.controls[s];n.enabled&&this.drawControl(t,e,n)}}},iChart.Charting.ChartButton.prototype.drawControl=function(t,e,i){t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.points[0].fHover?"rgba(58,174,62,1)":i.fillColor,t.lineWidth="1";var a=t.measureText(i.label).width,r=e[0];t.strokeStyle=i.strokeStyle;var s=a;t.beginPath(),t.moveTo(r.x,r.y+Math.round(i.h/2)),t.lineTo(r.x,r.y-Math.round(i.h/2)),t.quadraticCurveTo(r.x,r.y-Math.round(i.h/2)-5,r.x+5,r.y-Math.round(i.h/2)-5),t.lineTo(r.x+s+5,r.y-Math.round(i.h/2)-5),t.quadraticCurveTo(r.x+s+10,r.y-Math.round(i.h/2)-5,r.x+s+10,r.y-Math.round(i.h/2)),t.lineTo(r.x+s+10,r.y+Math.round(i.h/2)),t.quadraticCurveTo(r.x+s+10,r.y+Math.round(i.h/2)+5,r.x+s+5,r.y+Math.round(i.h/2)+5),t.lineTo(r.x+5,r.y+Math.round(i.h/2)+5),t.quadraticCurveTo(r.x,r.y+Math.round(i.h/2)+5,r.x,r.y+Math.round(i.h/2)),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#FFFFFF",t.fillText(i.label,r.x+5,r.y),t.restore()},iChart.Charting.ChartButton.prototype.drawPoints=function(t,e){},iChart.Charting.ChartButton.prototype.setTestSegments=function(){var t=this.layer.context;t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle";var e=t.measureText(this.controls[1].label).width;this.testContext.segments=[],this.testContext.maps={},this.testContext.maps[0]=[{x:this.testContext.points[0].x,y:this.testContext.points[0].y-Math.round(this.controls[1].h/2)-5},{x:this.testContext.points[0].x+e+10,y:this.testContext.points[0].y+Math.round(this.controls[1].h/2)+5}]},iChart.Charting.ChartButton.prototype.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"}}(),function(){"use strict";iChart.Charting.ChartEvent=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Event",this.drawType="auto",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!1,this.id=0,this.settings={color:"red",size:5,shape:"disk",pointFormatter:function(){return""}}},inheritPrototype(iChart.Charting.ChartEvent,iChart.Charting.ChartElement),iChart.Charting.ChartEvent.prototype.setSettings=function(t){this.settings=$.extend(this.settings,t)},iChart.Charting.ChartEvent.prototype.drawInternal=function(t,e){if(!(e.length<1)){switch(t.save(),t.fillStyle=this.settings.color,t.inHover&&(t.fillStyle="#0000ff",t.stokeStyle="#000"),this.settings.shape){case"circle":this.drawCircle(t,e);break;case"disk":this.drawDisc(t,e);break;case"square":this.drawSquare(t,e);break;case"diamond":this.drawDiamond(t,e);break;case"triangle":this.drawTriangle(t,e);break;default:this.drawDisc(t,e)}t.restore()}},iChart.Charting.ChartEvent.prototype.drawDisc=function(t,e){t.beginPath(),t.arc(e[0].x,e[0].y,this.settings.size,0,2*Math.PI,!0),t.fill(),t.closePath()},iChart.Charting.ChartEvent.prototype.drawCircle=function(t,e){t.beginPath(),t.lineWidth=.5*this.settings.size,t.arc(e[0].x,e[0].y,this.settings.size,0,2*Math.PI,!0),t.closePath(),t.inHover||(t.strokeStyle=this.settings.color),t.stroke()},iChart.Charting.ChartEvent.prototype.drawSquare=function(t,e){t.beginPath();var i=this.settings.size;t.moveTo(e[0].x-i,e[0].y-i),t.lineTo(e[0].x-i,e[0].y+i),t.lineTo(e[0].x+i,e[0].y+i),t.lineTo(e[0].x+i,e[0].y-i),t.lineTo(e[0].x-i,e[0].y-i),t.fill(),t.closePath()},iChart.Charting.ChartEvent.prototype.drawDiamond=function(t,e){t.beginPath();var i=this.settings.size;t.moveTo(e[0].x,e[0].y-i),t.lineTo(e[0].x-2*i/3,e[0].y),t.lineTo(e[0].x,e[0].y+i),t.lineTo(e[0].x+2*i/3,e[0].y),t.lineTo(e[0].x,e[0].y-i),t.fill(),t.closePath()},iChart.Charting.ChartEvent.prototype.drawTriangle=function(t,e){t.beginPath();var i=2*this.settings.size*Math.sin(Math.PI/3)/2;t.moveTo(e[0].x,e[0].y-i),t.lineTo(e[0].x-i,e[0].y+this.settings.size),t.lineTo(e[0].x+i,e[0].y+this.settings.size),t.lineTo(e[0].x,e[0].y-i),t.fill(),t.closePath()},iChart.Charting.ChartEvent.prototype.onHover=function(t){var e=this.getCoordinates(t,this.points),i=e[0].y+$(this.layer.chart.container).offset().top,a=e[0].x+$(this.layer.chart.container).offset().left;this.drawTooltip(this.settings,i,a)},iChart.Charting.ChartEvent.prototype.onOut=function(t){$("#chart-element-tooltip").hide()},iChart.Charting.ChartEvent.prototype.drawTooltip=function(t,e,i){0==$("#chart-element-tooltip").length&&$("body").append('<div id="chart-element-tooltip" class="qtip qtip-default qtip-tipsy qtip-pos-rc" tracking="false" role="alert" aria-live="polite" aria-atomic="false" style="z-index: 15002;"><div class="qtip-tip" style="background-color: transparent ! important; border: 0px none ! important; height: 6px; width: 6px; line-height: 6px; top: 50%; margin-top: -3px; right: -6px;"><canvas style="background-color: transparent ! important; border: 0px none ! important;" height="6" width="6"></canvas></div><div class="qtip-content" id="qtip-34-content" aria-atomic="true"></div></div></div>');var a=this.settings.pointFormatter.call(this.settings);a&&($("#chart-element-tooltip .qtip-content").html(a),$("#chart-element-tooltip").css({top:e-$("#chart-element-tooltip").height()-0+"px",left:i+12+"px"}).show())},iChart.Charting.ChartEvent.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[0].y}]]}}(),function(){"use strict";iChart.Charting.ChartLevel=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Level",this.drawType="auto",this.hoverCursor="url('"+this.layer.chart.env.lib_path+"/styles/cursors/red_vertical_cursor.cur'), move",this.moveCursor="url('"+this.layer.chart.env.lib_path+"/styles/cursors/red_vertical_cursor.cur'), move",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!0,this.storageEnable=!1,this.settings={text:"",color:"#ED1ACE",textColor:"red",inactiveHoverColor:"#4684c6",inactiveColor:"#AAAAAA",offset:40,width:150,height:30},this.drawSingle=!0},inheritPrototype(iChart.Charting.ChartLevel,iChart.Charting.ChartElement),iChart.Charting.ChartLevel.prototype.setSettings=function(t){this.points[0].fActive=1,this.points[0].fHover=0,this.settings.onDrop=function(t){if(!isNaN(parseInt(t))){var e=(parseInt(t)-1,{event:"drop",element:this,value:this.points[0].y});this.layer.chart.env.wrapper.trigger("iguanaChartEvents",["instrument",e])}},this.controls={0:{active:!0,enabled:!1,element:this,click:function(){var t={event:"close",element:this,value:this.points[0].y};this.layer.chart.env.wrapper.trigger("iguanaChartEvents",["instrument",t]),this.element.setTestSegments(),this.element.layer.render()},type:"close",value:"element"}},this.maps={0:{element:this,click:function(){this.element.points[0].fActive=1,this.element.setTestSegments();var t={event:"click",element:this.element,value:this.element.points[0].y};this.element.layer.chart.env.wrapper.trigger("iguanaChartEvents",["instrument",t])},hoverIn:function(){this.element.points[0].fHover=1,this.element.layer.render();var t={event:"hoverIn",element:this.element,value:this.element.points[0].y};this.element.layer.chart.env.wrapper.trigger("iguanaChartEvents",["instrument",t])},hoverOut:function(){this.element.points[0].fHover=0,this.element.layer.render();var t={event:"hoverOut",element:this.element,value:this.element.points[0].y};this.element.layer.chart.env.wrapper.trigger("iguanaChartEvents",["instrument",t])},type:"element",value:"element"}},this.settings=$.extend(this.settings,t)},iChart.Charting.ChartLevel.prototype.drawInternal=function(t,e){if(!(e.length<1)){var i=this.layer.chart.env.viewData.chart.areas[0].getXPositionByIndex(this.layer.chart.env.viewData.chart.areas[0].xSeries.length-1-this.layer.chart.env.viewData.chart.chartOptions.futureAmount)+this.settings.offset;i=Math.min(i,this.layer.chart.env.viewData.chart.areas[0].getXPositionByIndex(this.layer.chart.env.viewData.chart.areas[0].xSeries.length-1));var a=this.layer.chart.env.viewData.chart.areas[0].getXValue(i);this.points[0].x=1e3*a,e[0].x=this.layer.area.getXPositionByValue(a);for(var r in this.controls){var s=this.controls[r];s.enabled&&this.drawControl(t,e,s)}t.fillStyle="rgba(255,255,255,1)";for(var r=e.length-1;r>=0;r--)r>=3||(this.drawPriceBox(t,e,r),this.drawLabel(t,e,r))}},iChart.Charting.ChartLevel.prototype.drawPoints=function(t,e){},iChart.Charting.ChartLevel.prototype.drawExtended=function(t){if("undefined"!=typeof this.markers)var e=this.getCoordinates(t,this.markers),i=this.markers;else var e=this.getCoordinates(t,this.points),i=this.points;if(!(e.length<1))for(var a=0;a<e.length&&a<3;a++)if(i[a].fActive){var r=iChart.roundToPrecision(i[a].y,this.layer.chart.env.userSettings.currentSecurity.min_step);this.layer.chart.renderer.drawLable(t,this.settings.color,this.settings.textColor,this.layer.area.innerWidth,e[a].y,r)}},iChart.Charting.ChartLevel.prototype.drawControl=function(t,e,i){if(t.save(),"close"==i.type){var a=e[0];a&&(t.fillStyle="#ff9999",t.strokeStyle="#777777",t.beginPath(),t.lineWidth=2,t.moveTo(a.x+this.settings.width+10-4,a.y-15-4),t.lineTo(a.x+this.settings.width+10+4,a.y-15+4),t.moveTo(a.x+this.settings.width+10+4,a.y-15-4),t.lineTo(a.x+this.settings.width+10-4,a.y-15+4),t.closePath(),t.stroke())}t.restore()},iChart.Charting.ChartLevel.prototype.drawPriceBox=function(t,e,i){var a=this.settings.color;this.points[i].fActive?(t.save(),t.fillStyle=a,t.beginPath(),t.moveTo(e[i].x-10,e[i].y-10),t.lineTo(e[i].x+this.settings.width,e[i].y-10),t.lineTo(e[i].x+this.settings.width+8,e[i].y),t.lineTo(e[i].x+this.settings.width,e[i].y+10),t.lineTo(e[i].x-10,e[i].y+10),t.lineTo(e[i].x-10,e[i].y-10),t.moveTo(e[i].x+10,e[i].y-10),t.lineTo(e[i].x+10,e[i].y+10),t.closePath(),t.fill(),t.restore(),t.save(),t.strokeStyle=this.settings.textColor,t.beginPath(),t.moveTo(e[i].x-5,e[i].y-3),t.lineTo(e[i].x+5,e[i].y-3),t.moveTo(e[i].x-5,e[i].y),t.lineTo(e[i].x+5,e[i].y),t.moveTo(e[i].x-5,e[i].y+3),t.lineTo(e[i].x+5,e[i].y+3),t.closePath(),t.stroke(),t.strokeStyle=a,t.beginPath(),t.moveTo(e[i].x+this.settings.width+8,e[i].y),t.lineTo(t.canvas.width,e[i].y),t.moveTo(0,e[i].y),t.lineTo(e[i].x-10,e[i].y),t.closePath(),t.stroke(),t.restore()):(t.save(),this.points[i].fHover?t.strokeStyle=this.settings.inactiveHoverColor:t.strokeStyle=this.settings.inactiveColor,t.beginPath(),t.moveTo(e[i].x-10,e[i].y-10),t.lineTo(e[i].x+this.settings.width,e[i].y-10),t.lineTo(e[i].x+this.settings.width+8,e[i].y),t.lineTo(e[i].x+this.settings.width,e[i].y+10),t.lineTo(e[i].x-10,e[i].y+10),t.lineTo(e[i].x-10,e[i].y-10),t.closePath(),t.stroke(),t.restore())},iChart.Charting.ChartLevel.prototype.drawLabel=function(t,e,i){var a="",r=this.points[0].y;"undefined"!=typeof this.markers&&(r=this.markers[0].y),a=this.settings.text,t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.settings.textColor,this.points[i].fActive||(this.points[i].fHover?t.fillStyle=this.settings.inactiveHoverColor:t.fillStyle=this.settings.inactiveColor),t.fillText(a,e[i].x+15,e[i].y),t.restore()},iChart.Charting.ChartLevel.prototype.setTestSegments=function(){this.testContext.segments=[],this.testContext.controls={};for(var t in this.controls){var e=this.testContext.points[t];e&&(this.testContext.controls[t]=[{x:e.x+this.settings.width+2,y:e.y-23},{x:e.x+this.settings.width+2+16,y:e.y-23+16}])}this.testContext.maps={},this.testContext.maps[0]=[{x:this.testContext.points[0].x+10,y:this.testContext.points[0].y-10},{x:this.testContext.points[0].x+this.settings.width+10,y:this.testContext.points[0].y+10}]},iChart.Charting.ChartLevel.prototype.onDrag=function(t){"function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t)},iChart.Charting.ChartLevel.prototype.onDrop=function(t){"function"==typeof this.settings.onDrop&&this.settings.onDrop.call(this,t)},iChart.Charting.ChartLevel.prototype.setValue=function(t){this.points[0].y=t,this.layer.render()},iChart.Charting.ChartLevel.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"}}(),function(){"use strict";iChart.Charting.ChartRange=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Range",this.drawType="auto",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartRange,iChart.Charting.ChartElement),iChart.Charting.ChartRange.prototype.drawInternal=function(t,e){if(!(e.length<2)){t.save(),t.beginPath(),this.initDrawSettings(t,this.settings);e[1].x-e[0].x,e[1].y-e[0].y;t.beginPath(),t.moveTo(e[0].x,0),t.lineTo(e[0].x,t.canvas.height),t.stroke(),t.beginPath(),t.lineTo(e[1].x,0),t.lineTo(e[1].x,t.canvas.height),t.stroke(),t.beginPath(),t.moveTo(e[0].x,0),t.lineTo(e[0].x,t.canvas.height),t.lineTo(e[1].x,t.canvas.height),t.lineTo(e[1].x,0),t.fill(),t.restore()}},iChart.Charting.ChartRange.prototype.setTestSegments=function(){var t=(this.layer.context,this.testContext.points[0].x),e=this.testContext.points[1].x,i=16;this.testContext.segments=[];for(var a=t;a<=e;a+=i)this.testContext.segments.push([{
x:a,y:0},{x:a,y:1e11}]);this.testContext.segments.push([{x:e,y:0},{x:e,y:1e11}])}}(),function(){"use strict";iChart.Charting.ChartPosition=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Position",this.drawType="auto",this.hoverCursor="default",this.moveCursor="default",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!1,this.storageEnable=!1,this.settings={},this.positionAbsolute=!0},inheritPrototype(iChart.Charting.ChartPosition,iChart.Charting.ChartElement),iChart.Charting.ChartPosition.prototype.drawInternal=function(t,e){if(!(e.length<1)){this.settings.fillStyle=this.settings.fillStyle||"#3AAE3E";var i=this.layer.chart.areas[0].xSeries[this.layer.chart.areas[0].xSeries.length-this.layer.chart.chartOptions.futureAmount-1];this.points[0].x=1e3*i,e[0].x=this.layer.area.getXPositionByValue(i);var a=this.settings.fillStyle,r=this.getCoordinates(t,[{x:this.settings.time,y:0}]),s=0;if(r.length&&(s=r[0].x),this.selected||t.inHover)t.save(),t.beginPath(),t.strokeStyle=a,t.lineWidth=1,t.moveTo(s,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.stroke(),t.restore(),this.drawLable(t,a,this.settings.textColor,e[0].x,e[0].y,this.settings);else{t.save(),t.strokeStyle=a,t.lineWidth=1,t.beginPath();for(var n=0;n<=t.canvas.width;n+=20)t.moveTo(n,e[0].y),t.lineTo(n+12,e[0].y);t.stroke(),t.restore()}}},iChart.Charting.ChartPosition.prototype.drawExtended=function(t){if(this.selected){var e=this.getCoordinates(t,this.points);if(e.length<1)return;var i=iChart.formatNumber(this.points[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0});if(this.layer.chart.renderer.drawLable(t,this.settings.fillStyle,0,this.layer.area.innerWidth,e[0].y,i),"undefined"!=typeof this.markers){var e=this.getCoordinates(t,this.markers),i=iChart.formatNumber(this.markers[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),a=t.inHover?"undefined"!=typeof this.settings.fillStyleHover?this.settings.fillStyleHover:iChart.Charting.ChartPosition.lightColor(this.settings.fillStyle):this.settings.fillStyle;this.layer.chart.renderer.drawLable(t,a,0,this.layer.area.innerWidth,e[0].y,i)}}},iChart.Charting.ChartPosition.prototype.drawTrades=function(t,e,i){var a=this,r=[];$.each(i.trades,function(t,e){r.push({x:e.x,y:e.y})});var s=a.getCoordinates(t,r);s.forEach(function(i){i.x>e||(t.save(),t.beginPath(),t.arc(i.x,i.y,5,0,2*Math.PI,!0),t.fillStyle="#607d8b",t.fill(),t.arc(i.x,i.y,2,0,2*Math.PI,!0),t.fillStyle="#ffffff",t.fill(),t.closePath(),t.restore())})},iChart.Charting.ChartPosition.prototype.drawLable=function(t,e,i,a,r,s){e=e?e:"#333333",i=i?i:"#FFFFFF",t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=e,t.lineWidth="1";var n=t.measureText(s.positionText+s.profitText).width;a=t.canvas.width-120;var o=t.canvas.width-120-n;t.beginPath(),t.moveTo(a-n-5,r+5),t.lineTo(a-n-5,r-5),t.quadraticCurveTo(a-n-5,r-10,a-n,r-10),t.lineTo(a,r-10),t.quadraticCurveTo(a+5,r-10,a+5,r-5),t.lineTo(a+5,r+5),t.quadraticCurveTo(a+5,r+10,a,r+10),t.lineTo(a-n,r+10),t.quadraticCurveTo(a-n-5,r+10,a-n-5,r+5),t.closePath(),t.fill(),s.profitText&&(t.fillStyle=i,t.fillText(s.positionText,a-n,r),n=t.measureText(s.profitText).width,t.fillStyle=s.profitColor,t.beginPath(),t.moveTo(a-n,r+5),t.lineTo(a-n,r-5),t.lineTo(a-n,r-10),t.lineTo(a,r-10),t.quadraticCurveTo(a+5,r-10,a+5,r-5),t.lineTo(a+5,r+5),t.quadraticCurveTo(a+5,r+10,a,r+10),t.lineTo(a-n,r+10),t.lineTo(a-n,r+10),t.closePath(),t.fill(),this.drawCancelButton(t,a,r-10),t.fillStyle=i,t.fillText(s.profitText,a-n,r)),t.restore(),this.drawTrades(t,o,this.settings)},iChart.Charting.ChartPosition.prototype.drawCancelButton=function(t,e,i){t.beginPath(),t.moveTo(e,i),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.lineTo(e,i+20),t.stroke(),t.lineTo(e+15,i+20),t.quadraticCurveTo(e+20,i+20,e+20,i+15),t.lineTo(e+20,i+5),t.quadraticCurveTo(e+20,i,e+15,i),t.closePath(),t.fillStyle="#e53935",t.fill(),t.beginPath(),t.moveTo(e+5,i+5),t.lineTo(e+15,i+15),t.moveTo(e+5,i+15),t.lineTo(e+15,i+5),t.stroke(),t.closePath(),t.restore()},iChart.Charting.ChartPosition.prototype.drawPoints=function(t,e){},iChart.Charting.ChartPosition.prototype.drawTestSegments=function(t){if("undefined"!=typeof this.testContext){t.save(),t.beginPath(),t.fillStyle="rgba(0,0,0,0.75)";for(var e in this.testContext.segments){var i=this.testContext.segments[e];t.moveTo(i[0].x,i[0].y),t.lineTo(i[1].x,i[1].y),t.stroke()}t.closePath(),t.restore()}},iChart.Charting.ChartPosition.prototype.setTestSegments=function(){if(this.selected){var t=this.layer.context;t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle";var e=t.measureText(this.settings.text).width,i=t.canvas.width-120;this.testContext.segments=[[{x:i-e,y:this.testContext.points[0].y-4},{x:i,y:this.testContext.points[0].y-4}],[{x:i,y:this.testContext.points[0].y-4},{x:i,y:this.testContext.points[0].y+4}],[{x:i,y:this.testContext.points[0].y+4},{x:i-e,y:this.testContext.points[0].y+4}],[{x:i-e,y:this.testContext.points[0].y+4},{x:i-e,y:this.testContext.points[0].y-4}],[{x:i-e,y:this.testContext.points[0].y},{x:i,y:this.testContext.points[0].y}],[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]]}else this.testContext&&(this.testContext.segments=[[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]])},iChart.Charting.ChartPosition.prototype.onDrag=function(t){"function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t)},iChart.Charting.ChartPosition.prototype.onSelect=function(){this.setTestSegments()},iChart.Charting.ChartPosition.prototype.onBlur=function(){this.setTestSegments()},iChart.Charting.ChartPosition.prototype.onDrop=function(){"function"==typeof this.settings.onDrop&&this.settings.onDrop.call(this)},iChart.Charting.ChartPosition.prototype.onHover=function(){clearTimeout(this.layer.chart.env.timers.positionClose),this.cancelControl(1)},iChart.Charting.ChartPosition.prototype.onOut=function(){clearTimeout(this.layer.chart.env.timers.positionClose);var t=this;this.layer.chart.env.timers.orderClose=setTimeout(function(){t.cancelControl(0)},300)},iChart.Charting.ChartPosition.prototype.cancelControl=function(t){if("function"==typeof this.settings.onCancel)if(t){$("#ichartPositionCancelCtrl").hide();var e=this.layer.context,i=e.canvas.width-120,a=this.getCoordinates(e,this.points);$("#ichartPositionCancelCtrl").length||$("<span/>",{id:"ichartPositionCancelCtrl",style:"color:transparent",class:"m-chart-instrument-delete",text:"✕",title:_t("15807","Закрыть позицию по рынку")}).hide().appendTo(this.layer.chart.container);var r=this;$("#ichartPositionCancelCtrl").unbind("click").bind("click",function(t){"function"==typeof r.settings.onCancel&&r.settings.onCancel.call(r),$("#ichartOrderCancelCtrl").hide()}).bind("mouseover",function(){clearTimeout(r.layer.chart.env.timers.positionClose)}).bind("mouseleave",function(){clearTimeout(r.layer.chart.env.timers.positionClose),r.layer.chart.env.timers.positionClose=setTimeout(function(){r.cancelControl(0)},1e3)});var s=a[0].y-8,n=i+2;$("#ichartPositionCancelCtrl").css({top:s,left:n}).show()}else $("#ichartPositionCancelCtrl").hide()},iChart.Charting.ChartPosition.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"}}(),function(){"use strict";iChart.Charting.ChartTradePanel=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="TradePanel",this.drawType="auto",this.hoverCursor=this.selected?"row-resize":"pointer",this.moveCursor=this.selected?"row-resize":"pointer",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!1,this.storageEnable=!1,this.settings={},this.positionAbsolute=!0},inheritPrototype(iChart.Charting.ChartTradePanel,iChart.Charting.ChartElement),iChart.Charting.ChartTradePanel.prototype.drawInternal=function(t,e){if(!(e.length<1)){this.hoverCursor=this.selected?"row-resize":"pointer",this.moveCursor=this.selected?"row-resize":"pointer",this.settings.autoInit&&(this.selected=!0,this.layer.selected=this,this.settings.autoInit=!1),this.layer.history.sort(function(t,e){return t&&"TradePanel"==t.elementType&&t.selected?1:-1}),(this.selected&&!this.layer.selected||this.selected&&this.id!=this.layer.selected.id)&&(this.selected=!1),e[0].x=this.layer.area.getXPositionByValue(r);var i=this.markers?this.markers[0].y:this.points[0].y;"limit"==this.settings.type?this.settings.fillStyle=jNTChartTrading.order.operation_type<3?"#7cb342":"#e53935":"sl"==this.settings.type?this.settings.fillStyle="#e53935":"tp"==this.settings.type&&(this.settings.fillStyle="#7cb342"),this.settings.fillStyle=this.selected?this.settings.fillStyle:"rgba(238, 238, 238, 0.3)",this.settings.fillStyle=!this.selected&&t.inHover?"rgba(238, 238, 238, 1)":this.settings.fillStyle,this.settings.textColor=this.selected?"#FFFFFF":this.layer.chart.chartOptions.labelColor,this.settings.text=jNTChartTrading.order.operation_type<3?this.settings.buyText:this.settings.sellText,this.settings.price=_s(i,_d(this.settings.min_step)),this.settings.quantity=_s(this.settings.quantity);var a=100*(this.settings.price/this.settings.ltp-1);a=(a>0?"+":"")+_s(a,2)+"%",this.settings.text=this.settings.text.replace("%quantity%",this.settings.quantity.trim()),this.settings.text=this.settings.text.replace("%price%",this.settings.price.trim()),this.settings.text=this.settings.text.replace("%percent%",a),this.settings.sendingOrder&&(this.settings.text=_t("15808","Выставляем новый приказ ..."),this.settings.fillStyle="rgba(119,119,119,1)",this.settings.textColor="#ffffff");var r=this.layer.chart.areas[0].xSeries[this.layer.chart.areas[0].xSeries.length-this.layer.chart.chartOptions.futureAmount-1];this.points[0].x=1e3*r,e[0].x=this.layer.area.getXPositionByValue(r)+50;var s=this.settings.fillStyle;(this.selected||t.inHover)&&(t.save(),t.beginPath(),t.strokeStyle=s,t.moveTo(0,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.stroke(),t.restore()),this.drawLable(t,s,this.settings.textColor,e[0].x,e[0].y,this.settings.text)}},iChart.Charting.ChartTradePanel.prototype.drawExtended=function(t){if(this.selected){var e=this.getCoordinates(t,this.points);if(e.length<1)return;var i=iChart.formatNumber(this.points[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0});if(this.layer.chart.renderer.drawLable(t,this.settings.fillStyle,0,this.layer.area.innerWidth,e[0].y,i),"undefined"!=typeof this.markers){var e=this.getCoordinates(t,this.markers),i=iChart.formatNumber(this.markers[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),a=t.inHover?"undefined"!=typeof this.settings.fillStyleHover?this.settings.fillStyleHover:iChart.Charting.ChartTradePanel.lightColor(this.settings.fillStyle):this.settings.fillStyle;this.layer.chart.renderer.drawLable(t,a,0,this.layer.area.innerWidth,e[0].y,i)}}},iChart.Charting.ChartTradePanel.prototype.drawLable=function(t,e,i,a,r,s){t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.settings.fillStyle,t.strokeStyle="#eeeeee",t.lineWidth="1";var n=t.measureText(s).width;a+=n,t.beginPath(),t.moveTo(a-n-5,r+5),t.lineTo(a-n-5,r-5),t.quadraticCurveTo(a-n-5,r-10,a-n,r-10),t.lineTo(a,r-10),t.lineTo(a+8,r),t.lineTo(a,r+10),t.lineTo(a-n,r+10),t.quadraticCurveTo(a-n-5,r+10,a-n-5,r+5),t.closePath(),t.save();var o=this.layer.chart.chartOptions.shadowColor;this.selected?(t.shadowColor=o,t.shadowBlur=10,t.shadowOffsetX=5,t.shadowOffsetY=5,t.fill(),t.lineWidth="3",t.strokeStyle=t.fillStyle,t.beginPath(),t.moveTo(a+10,r-10),t.lineTo(a+18,r),t.lineTo(a+10,r+10),t.moveTo(a+10,r-10),t.closePath(),t.stroke()):t.inHover?(t.shadowColor=o,t.shadowBlur=5,t.shadowOffsetX=2,t.shadowOffsetY=2,t.fill()):t.stroke(),t.restore(),t.fillStyle=this.settings.textColor,t.fillText(s,a-n,r),t.restore()},iChart.Charting.ChartTradePanel.prototype.drawPoints=function(t,e){},iChart.Charting.ChartTradePanel.prototype.drawTestSegments=function(t){if("undefined"!=typeof this.testContext){t.save(),t.beginPath(),t.fillStyle="rgba(0,0,0,0.75)";for(var e in this.testContext.segments){var i=this.testContext.segments[e];t.moveTo(i[0].x,i[0].y),t.lineTo(i[1].x,i[1].y),t.stroke()}t.closePath(),t.restore()}},iChart.Charting.ChartTradePanel.prototype.setTestSegments=function(){if(this.testContext){var t=this.layer.context;t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle";var e=t.measureText(this.settings.text).width,i=this.layer.area.getXPositionByValue(this.points[0].x/1e3)+e+50;this.testContext.segments=[[{x:i-e,y:this.testContext.points[0].y-4},{x:i,y:this.testContext.points[0].y-4}],[{x:i,y:this.testContext.points[0].y+4},{x:i-e,y:this.testContext.points[0].y+4}]]}},iChart.Charting.ChartTradePanel.prototype.onDrag=function(t){"function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t),"function"==typeof this.settings.onDrag&&this.settings.onDrag.call(this,t)},iChart.Charting.ChartTradePanel.prototype.onSelect=function(){},iChart.Charting.ChartTradePanel.prototype.onBlur=function(){},iChart.Charting.ChartTradePanel.prototype.onDrop=function(){"function"==typeof this.settings.onDrop&&this.settings.onDrop.call(this)},iChart.Charting.ChartTradePanel.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"},iChart.Charting.ChartTradePanel.prototype.onMouseDown=function(t){"function"==typeof this.settings.onSelect&&this.settings.onSelect.call(this,t)}}(),function(){"use strict";iChart.Charting.ChartTrendorder=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Trendorder",this.drawType="manually",this.hoverCursor="row-resize",this.moveCursor="row-resize",this.maxPointCount=2,this.hasSettings=!0,this.controlEnable=!0,this.storageEnable=!1,this.drawSingle=!0,this.settings={text:"",textHeight:13,fillStyle:"#f44336",textColor:"#FFFFFF",mode:"line"},this.positionAbsolute=!0},inheritPrototype(iChart.Charting.ChartTrendorder,iChart.Charting.ChartElement),iChart.Charting.ChartTrendorder.prototype.setSettings=function(t){this.settings=$.extend(this.settings,t),"undefined"==typeof t.price2?(this.points[0]={x:t.date,y:t.price},this.points[1]={x:t.date,y:t.price}):(this.points[0]={x:t.date,y:t.price},this.points[1]={x:t.date2,y:t.price2})},iChart.Charting.ChartTrendorder.prototype.normalizeCoords=function(t){if(this.settings.newOrderParams)var e=$.extend(!0,[],this.settings.newOrderParams.points);else var e=$.extend(!0,[],this.points);e[0].x/=1e3,e[1].x/=1e3;var i=[{x:this.layer.area.getXPositionByValue(e[0].x),y:e[0].y},{x:this.layer.area.getXPositionByValue(e[1].x),y:e[1].y}],a=Math.atan((i[0].y-i[1].y)/(i[0].x-i[1].x)),r=this.layer.context;r.font="normal 13px Arial,Helvetica,sans-serif",r.textAlign="left",r.textBaseline="middle";var s=r.measureText(this.settings.text).width+120,n=s*Math.cos(a),o=this.layer.area.getXPositionByValue((e[1].x+e[0].x)/2),h=iChart.getLineEquation(i[0],i[1],o-n/2),l=iChart.getLineEquation(i[0],i[1],o+n/2);this.points[0].x=1e3*this.layer.area.getXValue(h.x),this.points[0].y=h.y,this.points[1].x=1e3*this.layer.area.getXValue(l.x),this.points[1].y=l.y},iChart.Charting.ChartTrendorder.prototype.lineNormalizeCoords=function(t,e){e[1].x=t.canvas.width-80,this.points[1].x=1e3*this.layer.area.getXValue(e[1].x),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle";var i=t.measureText(this.settings.text).width;e[0].x=t.canvas.width-80-i-80,this.points[0].x=1e3*this.layer.area.getXValue(e[0].x)},iChart.Charting.ChartTrendorder.prototype.drawLineMode=function(t,e){this.settings.fillStyle=this.settings.fillStyle||"#3AAE3E";var i=this.settings.fillStyle;if(this.selected||t.inHover)t.save(),t.beginPath(),t.strokeStyle=i,t.moveTo(0,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.stroke(),t.restore(),this.drawLable(t,i,this.settings.textColor,e[0].x,e[0].y,this.settings.text),this.drawPoint(t,e[0].x,e[0].y,i,4),this.drawPoint(t,e[1].x,e[1].y,i,4);else{t.save(),t.strokeStyle=i,t.lineWidth=1,t.beginPath();for(var a=0;a<=t.canvas.width;a+=20)t.moveTo(a,e[0].y),t.lineTo(a+12,e[0].y);t.stroke(),t.restore()}},iChart.Charting.ChartTrendorder.prototype.drawTrendMode=function(t,e){if("undefined"!=typeof this.markers){this.markers}else{this.points}var i=iChart.getLineEquation(e[0],e[1],0);i.y<0?(i.y=0,i.x=(i.y-i.b)/i.k):i.y>t.canvas.height&&(i.y=t.canvas.height,i.x=(i.y-i.b)/i.k);var a=iChart.getLineEquation(e[0],e[1],t.canvas.width);a.y<0?(a.y=0,a.x=(a.y-a.b)/a.k):a.y>t.canvas.height&&(a.y=t.canvas.height,a.x=(a.y-a.b)/a.k),this.trendLineSettings={points:[i,a]};var r=this.layer.chart.areas[0].xSeries[this.layer.chart.areas[0].xSeries.length-this.layer.chart.chartOptions.futureAmount-1],s=this.layer.area.getXPositionByValue(r),n=new Date(1e3*r);n.setSeconds(0),n.setMinutes(0),n.setHours(0),n.setTime(n.getTime()+864e5);var o=this.layer.area.getXPositionByValue(n/1e3),h=iChart.getLineEquation(e[0],e[1],s),l=iChart.getLineEquation(e[0],e[1],o);t.save(),t.beginPath(),t.setLineDash([8,3]);var c=this.settings.fillStyle;t.strokeStyle=c,t.moveTo(h.x,h.y),t.lineTo(i.x,i.y),t.stroke(),t.moveTo(l.x,l.y),t.lineTo(a.x,a.y),t.stroke(),t.restore(),t.save(),t.lineWidth=4,t.strokeStyle=this.settings.fillStyle,t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(l.x,l.y),t.stroke(),t.restore(),this.settings.newOrderParams={points:[{x:1e3*this.layer.area.getXValue(h.x),y:this.layer.area.getYValue(h.y)},{x:1e3*this.layer.area.getXValue(l.x),y:this.layer.area.getYValue(l.y)}]},(this.selected||t.inHover)&&(this.drawPoint(t,e[0].x,e[0].y,c,4),this.drawPoint(t,e[1].x,e[1].y,c,4),this.drawLableTrend(t,e))},iChart.Charting.ChartTrendorder.prototype.pointsForward=function(t){for(var e=iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo(this.layer.chart.areas[0].xSeries,this.settings.date/1e3),i=this.layer.chart.areas[0].xSeries.length-1,a=60*this.layer.chart.env.dataSource.dataSettings.timeframe,r={x:this.settings.date,y:this.settings.price},s={x:this.settings.date2,y:this.settings.price2},n=e;n<=i;n++){var o=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[n]),h=this.layer.area.getXPositionByValue(o.x/1e3),l=this.layer.area.getYPosition(o.y);this.drawPoint(t,h,l,"#FF6666",4)}for(var c=0,n=e+1;n<=i;n++){var d=this.layer.chart.areas[0].xSeries[n]-this.layer.chart.areas[0].xSeries[n-1];if(d/a>1){var p=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[n-1]),u=iChart.getLineEquation(r,s,1e3*(this.layer.chart.areas[0].xSeries[n-1]+d-a));c+=p.y-u.y}var o=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[n]),h=this.layer.area.getXPositionByValue(o.x/1e3),l=this.layer.area.getYPosition(o.y+c);this.drawPoint(t,h,l,"#66FF66")}},iChart.Charting.ChartTrendorder.prototype.pointsForward2=function(t){var e=iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo(this.layer.chart.areas[0].xSeries,this.settings.date/1e3),i=this.layer.chart.areas[0].xSeries.length-1,a=60*this.layer.chart.env.dataSource.dataSettings.timeframe,r={x:this.settings.date,y:this.settings.price},s={x:this.settings.date2,y:this.settings.price2},n=this.layer.area.getXPositionByValue(r.x/1e3),o=this.layer.area.getYPosition(r.y);this.drawPoint(t,n,o,"#FFAA66",3);var n=this.layer.area.getXPositionByValue(s.x/1e3),o=this.layer.area.getYPosition(s.y);this.drawPoint(t,n,o,"#FFAA66",3);var n=this.layer.area.getXPositionByValue(r.x/1e3),o=this.layer.area.getYPosition(r.y);this.drawPoint(t,n,o,"#FF66AA",3);var n=this.layer.area.getXPositionByValue(s.x/1e3),o=this.layer.area.getYPosition(s.y);this.drawPoint(t,n,o,"#FF66AA",3);for(var h=0,l=e+1;l<=i;l++){var c=new Date(1e3*this.layer.chart.areas[0].xSeries[l-1]),d=new Date(1e3*this.layer.chart.areas[0].xSeries[l]);if(c.getDate()!=d.getDate()){var p=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[l-1]),u=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[l]),g={x:1e3*this.layer.chart.areas[0].xSeries[l],y:p.y},f=new Date(d);f.setSeconds(0),f.setMinutes(0),f.setHours(0),f.setTime(f.getTime()+864e5);var m=iChart.getLineEquation(r,s,f.getTime());m.y=m.y+(p.y-u.y);var v={x:f.getTime(),y:m.y};r=g,s=v;var y=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[l]),C=iChart.getLineEquation(r,s,1e3*(this.layer.chart.areas[0].xSeries[l]-a));h+=y.y-C.y}var x=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[l]),n=this.layer.area.getXPositionByValue(x.x/1e3),o=this.layer.area.getYPosition(x.y+h);this.drawPoint(t,n,o,"#6666FF",1.5)}},iChart.Charting.ChartTrendorder.prototype.pointsBack=function(t){for(var e=this.layer.chart.areas[0].xSeries.length-2,i=this.layer.chart.areas[0].viewport.x.min,a=60*this.layer.chart.env.dataSource.dataSettings.timeframe,r={x:this.settings.date,y:this.settings.price},s={x:this.settings.date2,y:this.settings.price2},n=0,o=e;o>i;o--){var h=this.layer.chart.areas[0].xSeries[o+1]-this.layer.chart.areas[0].xSeries[o];if(h/a>1){h/86400>1&&(h-=h%86400);var l=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[o-1]),c=iChart.getLineEquation(r,s,1e3*(this.layer.chart.areas[0].xSeries[o-1]+h-a));n+=c.y-l.y}var d=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[o]),p=this.layer.area.getXPositionByValue(d.x/1e3),u=this.layer.area.getYPosition(d.y+n);this.drawPoint(t,p,u,"#66FF66")}},iChart.Charting.ChartTrendorder.prototype.drawInternal=function(t,e){e.length<2||("line"==this.settings.mode?(this.lineNormalizeCoords(t,e),this.drawLineMode(t,e)):(this.settings.newOrderParams||this.normalizeCoords(e),this.drawTrendMode(t,e)))},iChart.Charting.ChartTrendorder.prototype.drawPoint=function(t,e,i,a,r){t.save(),t.beginPath(),t.lineWidth=1,t.strokeStyle=a,t.fillStyle=a,r=r||2,t.arc(e,i,r,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore()},iChart.Charting.ChartTrendorder.prototype.drawExtended=function(t){if(this.selected){var e=this.getCoordinates(t,this.points);if(e.length<1)return;var i=iChart.formatNumber(this.points[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0});if(this.layer.chart.renderer.drawLable(t,this.settings.fillStyle,0,this.layer.area.innerWidth,e[0].y,i),"undefined"!=typeof this.markers){var e=this.getCoordinates(t,this.markers),i=iChart.formatNumber(this.markers[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),a=t.inHover?"undefined"!=typeof this.settings.fillStyleHover?this.settings.fillStyleHover:iChart.Charting.ChartTrendorder.lightColor(this.settings.fillStyle):this.settings.fillStyle;this.layer.chart.renderer.drawLable(t,a,0,this.layer.area.innerWidth,e[0].y,i)}}},iChart.Charting.ChartTrendorder.prototype.drawLable=function(t,e,i,a,r,s){e=e?e:"#333333",i=i?i:"#FFFFFF",t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=e,t.lineWidth="2";var n=t.measureText(s).width,o=n+5,a=t.canvas.width-120;t.beginPath(),t.moveTo(a-o-5,r+5),t.lineTo(a-o-5,r-5),t.quadraticCurveTo(a-o-5,r-10,a-o,r-10),t.lineTo(a,r-10),t.quadraticCurveTo(a+5,r-10,a+5,r-5),t.lineTo(a+5,r+5),t.quadraticCurveTo(a+5,r+10,a,r+10),t.lineTo(a-o,r+10),t.quadraticCurveTo(a-o-5,r+10,a-o-5,r+5),t.closePath(),t.save();var h=this.layer.chart.chartOptions.shadowColor;this.selected?(t.shadowColor=h,t.shadowBlur=20,t.shadowOffsetX=15,t.shadowOffsetY=15):t.inHover&&(t.shadowColor=h,t.shadowBlur=10,t.shadowOffsetX=5,t.shadowOffsetY=5),t.restore(),t.fill(),this.drawCancelButton(t,a,r-10),t.fillStyle=i,t.fillText(s,a-o,r),t.restore()},iChart.Charting.ChartTrendorder.prototype.drawLableTrend=function(t,e){var i=this.settings.text,a=this.settings.textColor,r=this.settings.textHeight,s=1.2*r,n={x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2},o={center:{x:"",y:""},left:{x:"",y:""},right:{x:"",y:""}},h=Math.atan((e[0].y-e[1].y)/(e[0].x-e[1].x));t.save(),t.font="normal "+r+"px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.lineWidth="1";var l=t.measureText(i).width;t.restore(),o.center.x=n.x-s*Math.cos(Math.PI/2+h),o.center.y=n.y-s*Math.sin(Math.PI/2+h),o.left.x=o.center.x-l/2*Math.cos(h),o.left.y=o.center.y-l/2*Math.sin(h),o.right.x=o.center.x+(l/2+20)*Math.cos(h),o.right.y=o.center.y+(l/2+20)*Math.sin(h),this.trendLabelSettings={alpha:h,labelCoords:o},t.save(),t.font="normal "+r+"px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.lineWidth="1",t.strokeStyle=this.settings.fillStyle,t.fillStyle=this.settings.fillStyle;var c=Math.round(r/2),d=0,p=0,u=3;t.translate(o.left.x,o.left.y),t.rotate(h),t.beginPath(),t.moveTo(d-u,p+c),t.lineTo(d-u,p-c),t.quadraticCurveTo(d-u,p-c-u,d,p-c-u),t.lineTo(d+l,p-c-u),t.quadraticCurveTo(d+l+u,p-c-u,d+l+u,p-c),t.lineTo(d+l+u,p+c),t.quadraticCurveTo(d+l+u,p+c+u,d+l,p+c+u),t.lineTo(d,p+c+u),t.quadraticCurveTo(d-u,p+c+u,d-u,p+c),t.closePath(),t.fill(),t.fillStyle=a,t.fillText(i,d,p),this.drawCancelButton(t,d+l+3,p-c-u),t.restore()},iChart.Charting.ChartTrendorder.prototype.drawCancelButton=function(t,e,i){t.beginPath(),t.moveTo(e,i),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.lineTo(e,i+20),t.stroke(),t.lineTo(e+15,i+20),t.quadraticCurveTo(e+20,i+20,e+20,i+15),t.lineTo(e+20,i+5),t.quadraticCurveTo(e+20,i,e+15,i),t.closePath(),t.fillStyle="#e53935",t.fill(),t.beginPath(),t.moveTo(e+5,i+5),t.lineTo(e+15,i+15),t.moveTo(e+5,i+15),t.lineTo(e+15,i+5),t.stroke(),t.closePath()},iChart.Charting.ChartTrendorder.prototype.drawPoints=function(t,e){function i(t,e,i,a,r,s){var n,e=e+(s?-1:1)*a*Math.cos(r),i=i+(s?-1:1)*a*Math.sin(r),o=10;t.lineWidth=1;var h=s?-.2*Math.PI+r:.8*Math.PI+r,l=s?.2*Math.PI+r:1.2*Math.PI+r,c=s?0*Math.PI+r:1*Math.PI+r,d=e+(s?-1:1)*o*Math.cos(Math.PI/2+r),p=i+(s?-1:1)*o*Math.sin(Math.PI/2+r),u=e+(s?1:-1)*o*Math.cos(Math.PI/2+r),g=i+(s?1:-1)*o*Math.sin(Math.PI/2+r);t.beginPath(),t.arc(d,p,a,h,c),t.stroke(),t.beginPath(),t.arc(u,g,a,c,l),t.stroke();var f=d+a*Math.cos(h),m=p+a*Math.sin(h),n=h+Math.PI/16,v=d+.9*a*Math.cos(n),y=p+.9*a*Math.sin(n),C=d+1.1*a*Math.cos(n),x=p+1.1*a*Math.sin(n);t.beginPath(),t.moveTo(v,y),t.lineTo(f,m),t.lineTo(C,x);var f=u+a*Math.cos(l),m=g+a*Math.sin(l),n=l-Math.PI/16,v=u+.9*a*Math.cos(n),y=g+.9*a*Math.sin(n),C=u+1.1*a*Math.cos(n),x=g+1.1*a*Math.sin(n);t.moveTo(v,y),t.lineTo(f,m),t.lineTo(C,x),t.stroke()}if(!this.selected)return 0;var a=Math.atan((e[0].y-e[1].y)/(e[0].x-e[1].x)),r=30;t.save(),t.strokeStyle=this.settings.fillStyle,t.fillStyle=this.settings.fillStyle,i(t,e[0].x,e[0].y,r,a,!1),i(t,e[1].x,e[1].y,r,a,!0),t.restore()},iChart.Charting.ChartTrendorder.prototype.setTestSegments=function(){if("line"==this.settings.mode)if(this.selected){var t=this.layer.context;t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle";var e=t.measureText(this.settings.text).width,i=t.canvas.width-120;this.testContext.segments=[[{x:i-e,y:this.testContext.points[0].y-4},{x:i,y:this.testContext.points[0].y-4}],[{x:i-e,y:this.testContext.points[0].y+4},{x:i,y:this.testContext.points[0].y+4}],[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]]}else this.testContext&&(this.testContext.segments=[[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]]);else this.testContext.segments=[],this.selected||(this.testContext.segments=[[{x:this.trendLineSettings.points[0].x,y:this.trendLineSettings.points[0].y},{x:this.trendLineSettings.points[1].x,y:this.trendLineSettings.points[1].y}]]),this.trendLabelSettings&&this.testContext.segments.push([{x:this.trendLabelSettings.labelCoords.left.x,y:this.trendLabelSettings.labelCoords.left.y},{x:this.trendLabelSettings.labelCoords.right.x,y:this.trendLabelSettings.labelCoords.right.y}])},iChart.Charting.ChartTrendorder.prototype.onDrag=function(t){return!(!t[0]||!t[1])&&("line"==this.settings.mode&&(t[0].y!=this.points[0].y&&this.points[1].y==t[1].y||t[0].y==this.points[0].y&&this.points[1].y!=t[1].y)&&(this.settings.mode="trend"),this.points[0].x!=t[0].x&&t[0].x>=t[1].x-1e3?t[0].x=t[1].x-1e3:this.points[1].x!=t[1].x&&t[1].x<=t[0].x+1e3&&(t[1].x=t[0].x+1e3),void("function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t)))},iChart.Charting.ChartTrendorder.prototype.onSelect=function(){this.getTestContext(!0)},iChart.Charting.ChartTrendorder.prototype.onBlur=function(){"trend"==this.settings.mode&&this.normalizeCoords(this.getCoordinates(this.layer.context,this.points)),this.getTestContext(!0)},iChart.Charting.ChartTrendorder.prototype.onDrop=function(){"trend"==this.settings.mode&&console.log("newOrderParams",this.settings.newOrderParams),"function"==typeof this.settings.onDrop&&(console.log(this),this.settings.onDrop.call(this))},iChart.Charting.ChartTrendorder.prototype.onHover=function(){clearTimeout(this.layer.chart.env.timers.orderClose),this.cancelControl(1)},iChart.Charting.ChartTrendorder.prototype.onOut=function(){clearTimeout(this.layer.chart.env.timers.orderClose);var t=this;this.layer.chart.env.timers.orderClose=setTimeout(function(){t.cancelControl(0)},300)},iChart.Charting.ChartTrendorder.prototype.cancelControl=function(t){if("function"==typeof this.settings.onCancel)if(t){$("#ichartOrderCancelCtrl").hide();var e=this.layer.context,i=e.canvas.width-120,a=this.getCoordinates(e,this.points);$("#ichartOrderCancelCtrl").length||$("<span/>",{id:"ichartOrderCancelCtrl",style:"color:transparent",class:"m-chart-instrument-delete",text:"✕",title:_t("2958","Снять")}).hide().appendTo(this.layer.chart.container);var r=this;if($("#ichartOrderCancelCtrl").unbind("click").bind("click",function(t){"function"==typeof r.settings.onCancel&&r.settings.onCancel.call(r),$("#ichartOrderCancelCtrl").hide()}).bind("mouseover",function(){clearTimeout(r.layer.chart.env.timers.orderClose)}).bind("mouseleave",function(){clearTimeout(r.layer.chart.env.timers.orderClose),r.layer.chart.env.timers.orderClose=setTimeout(function(){r.cancelControl(0)},1e3)}),"line"==this.settings.mode)var s=a[0].y-8,n=i+2;else if(this.trendLabelSettings)var s=this.trendLabelSettings.labelCoords.right.y-10-10*Math.sin(this.trendLabelSettings.alpha),n=this.trendLabelSettings.labelCoords.right.x-10-10*Math.cos(this.trendLabelSettings.alpha);$("#ichartOrderCancelCtrl").css({top:s,left:n}).show()}else $("#ichartOrderCancelCtrl").hide()},iChart.Charting.ChartTrendorder.prototype.onMouseDown=function(t){"function"==typeof this.settings.onSelect&&this.settings.onSelect.call(this,t)},iChart.Charting.ChartTrendorder.lightColor=function(t){}}(),function(t){"use strict";iChart.Charting.Crosshair=function(t){this.$chart=t.$chart,this.container=null,this.areas=null,this.dots=null,this.hidden=!0,this.pageX=null,this.pageY=null,this.pointMap=void 0,this.yLabel=null},iChart.Charting.Crosshair.prototype.hide=function(){if(!this.hidden){for(var t=0;t<this.dots.length;++t)this.dots[t].style.display="none";null!==this.yLabel&&(this.yLabel.style.display="none");for(var t=0;t<this.areas.length;++t){var e=this.areas[t];e.enabled===!1||e.isLayer||e.isScroller||(e.horizontal.style.display="none",e.vertical.style.display="none",e.tooltip.innerHTML=e.tooltipInnerHtml||"")}this.hidden=!0}},iChart.Charting.Crosshair.prototype.render=function(e,i,a){if(a=void 0!==typeof a&&a,e!==this.pageX||i!==this.pageY||a){this.pageX=e,this.pageY=i;var r=this.$chart.offset(),r=this.areas[0].chart._containerSize.offset,s={};s.left=Math.round(this.pageX-r.left),s.top=Math.round(this.pageY-r.top);var n={};n.x=!1,n.y=!1;for(var o=0;o<this.areas.length;++o){var h=this.areas[o];if(h.enabled!==!1&&!h.isLayer&&!h.isScroller){if("top"==h.chart.chartOptions.tooltipPosition)var l=h.innerOffset.top-20;else if("bottom"==h.chart.chartOptions.tooltipPosition)var l=h.innerOffset.top-38+h.innerHeight;
t(h.tooltip).css({left:h.innerOffset.left+"px",top:l+"px"}),n[o]={},n.x=(n[o].x=s.left>=h.innerOffset.left&&s.left<=h.innerOffset.left+h.innerWidth)||n.x,n.y=(n[o].y=s.top>=h.innerOffset.top&&s.top<=h.innerOffset.top+h.innerHeight)||n.y}}if(!n.x||!n.y)return void this.hide();var c;if("undefined"==typeof this.pointMap){var h=this.areas[0];if(0===h.xSeries.length)return void this.hide();var d=h.getXIndex(s.left-h.innerOffset.left);if(d<h.viewport.x.bounded.min||d>h.viewport.x.bounded.max)return void this.hide();d=Math.max(h.viewport.x.bounded.min,Math.min(h.viewport.x.bounded.max,Math.round(d))),s.left=h.innerOffset.left+Math.round(h.getXPositionByIndex(d));for(var o=0;o<this.dots.length;++o){var p=this.dots[o],h=this.areas[p.areaIndex],u=h.ySeries[p.seriesIndex2],g=u.points[d];if(g){var f=g[p.yValueIndex];u.multiplier&&(f=u.multiplier*f-100);var m=h.getYPosition(f);m>=0&&m<=h.innerHeight?(p.style.display="",p.style.left=s.left-4+"px",p.style.top=h.innerOffset.top+m-4+"px"):p.style.display="none"}else p.style.display="none"}for(var o=0;o<this.areas.length;++o){var h=this.areas[o];if(h.enabled!==!1&&!h.isScroller){var v=[];if(!h.isLayer){var y=new Date(1e3*h.xSeries[d]);v.push(iChart.formatDateTime(y,"dd.MM.yyyy"+(this.showTime?" HH:mm":"")))}for(var C=0;C<h.ySeries.length;++C)for(var u=h.ySeries[C],x=0;x<u.labels.length;++x){var T=u.labels[x][0],S=u.labels[x][1],g=u.points[d];if(g){var f=g[T];u.multiplier?(f=u.multiplier*f-100,f=(f>0?"+":"")+iChart.formatNumber(f,u.formatProvider)+"%"):f=f<100?iChart.formatNumber(f,{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(f,{decimalPlaces:2,decimalPrecision:null,scale:0}),v.push(S+" <span class='m-chart-legend-value'>"+f+"</span>")}}h.isLayer?t.grep(this.areas,function(t){return t.name===h.parentName})[0].tooltip.innerHTML+=" &ensp; "+v.join(" &ensp; "):h.tooltip.innerHTML=v.join(" &ensp; ")}}}else{if(c=this.pointMap[s.left],"undefined"==typeof c)return void this.hide();s.left=c.offset;for(var o=0;o<this.dots.length;++o){var p=this.dots[o],g=c.y[p.seriesIndex];if(g){var m=g[p.yValueIndex].p,h=this.areas[p.areaIndex];if(h.enabled===!1||h.isScroller)continue;m>=h.innerOffset.top&&m<=h.innerOffset.top+h.innerHeight?(p.style.display="",p.style.left=s.left-4+"px",p.style.top=m-4+"px"):p.style.display="none"}else p.style.display="none"}for(var o=0;o<this.areas.length;++o){var h=this.areas[o];h.enabled===!1||h.isScroller||(h.tooltip.innerHTML=c.tooltips[o])}}for(var o=0;o<this.areas.length;++o){var h=this.areas[o];h.enabled===!1||h.isLayer||h.isScroller||(h.tooltip.style.display="",n[o].x?(h.vertical.style.display="",h.vertical.style.left=s.left+"px",n[o].y?(h.horizontal.style.display="",h.horizontal.style.top=s.top-0+"px",null===this.yLabel||h.chart.overlay.drag?this.yLabel.style.display="none":(this.yLabel.innerHTML=iChart.formatNumber(this._getYValue(h,s.top-h.innerOffset.top),{decimalPrecision:5}),this.yLabel.style.display="",this.yLabel.style.top=s.top-8+"px")):h.horizontal.style.display="none"):(h.horizontal.style.display="none",h.vertical.style.display="none"))}this.hidden=!1}},iChart.Charting.Crosshair.prototype.mouseMoveHandler=function(t){"undefined"==typeof t&&(t=window.event);var e,i;"undefined"!=typeof t.pageX?(e=t.pageX,i=t.pageY):(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),e=Math.round(e),i=Math.round(i),this.render(e,i)},iChart.Charting.Crosshair.prototype.update=function(t,e){if(this.container=e,this._clear(),!t||!t.areas)throw"No data available.";this.areas=t.areas,this.chartWidth=this.areas[0].chart._containerSize.width,this.showTime=t.showTime,this._initDots(),this._initYLabel(),this._initPointMap(t),this.addMouseMoveHandler(this)},iChart.Charting.Crosshair.prototype._clear=function(){this.removeMouseMoveHandler(),t(".m-chart-d, .m-chart-h, .m-chart-t, .m-chart-v, .m-chart-y",this.$chart.parent()).remove(),this.areas=[],this.dots=[],this.yLabel=null},iChart.Charting.Crosshair.prototype._getYValue=function(t,e){return 0===t.axisY.scale?t.axisY.max:t.axisY.max-e/t.axisY.scale},iChart.Charting.Crosshair.prototype._initDots=function(){this.dots=[];for(var e=0;e<this.areas.length;++e){var i=this.areas[e];if(i.enabled!==!1&&!i.isLayer&&!i.isScroller)for(var a=0;a<i.ySeries.length;++a){var r=i.ySeries[a],s=r.dotColor||r.color||"";if(""!==s){var n=t("<div/>",{class:"m-chart-d"}).css({"background-color":s,display:"none"}).insertAfter(this.$chart).get(0);n.areaIndex=e,n.seriesIndex=r.index,n.seriesIndex2=a,n.yValueIndex=r.dotIndex||0,this.dots.push(n)}}}},iChart.Charting.Crosshair.prototype._initPointMap=function(e){for(var i=0;i<this.areas.length;++i){var a=this.areas[i];if(a.enabled!==!1&&!a.isScroller){if(a.isLayer||(a.horizontal=t("<div/>",{class:"m-chart-h"}).css({display:"none",left:a.innerOffset.left+"px",width:a.innerWidth+"px"}).insertAfter(this.$chart).get(0),a.vertical=t("<div/>",{class:"m-chart-v"}).css({display:"none",top:a.innerOffset.top+"px",height:a.innerHeight+"px"}).insertAfter(this.$chart).get(0)),"undefined"==typeof e.pointMap){if(a.viewport.x.bounded.min<=a.viewport.x.bounded.max){var r=[],s=Math.min(a.viewport.x.bounded.max,a.xSeries.length-1-a.chart.chartOptions.futureAmount);if(!a.isLayer){var n=new Date(1e3*a.xSeries[s]);r.push(iChart.formatDateTime(n,"dd.MM.yyyy"+(this.showTime?" HH:mm":"")))}for(var o=0;o<a.ySeries.length;++o)for(var h=a.ySeries[o],l=0;l<h.labels.length;++l){var c=h.labels[l][0],d=h.labels[l][1],p=h.points[s];if(p){var u=p[c];h.multiplier?(u=h.multiplier*u-100,u=(u>0?"+":"")+iChart.formatNumber(u,h.formatProvider)+"%"):u=u<100?iChart.formatNumber(u,{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(u,{decimalPlaces:2,decimalPrecision:null,scale:0}),r.push(d+" <span class='m-chart-legend-value'>"+u+"</span>")}}a.isLayer?t.grep(this.areas,function(t){return t.name===a.parentName})[0].tooltipInnerHtml+=" &ensp; "+r.join(" &ensp; "):a.tooltipInnerHtml=r.join(" &ensp; ")}}else for(var g in e.pointMap)if(e.pointMap.hasOwnProperty(g)){var f=e.pointMap[g];"undefined"==typeof f.tooltips&&(f.tooltips=new Array(this.areas.length));var r=[];r.push(f.x);for(var o=0;o<a.ySeries.length;++o)for(var m=a.ySeries[o],l=0;l<m.labels.length;++l){var c=m.labels[l][0],d=m.labels[l][1],v=f.y[m.index];v&&r.push(d+" <span class='m-chart-legend-value'>"+v[c].v+"</span>")}a.tooltipInnerHtml=r.join(" &nbsp; "),f.offset=g,f.tooltips[i]=a.tooltipInnerHtml}if(a.isLayer){var y=t.grep(this.areas,function(t){return t.name===a.parentName})[0];t(y.tooltip).html(y.tooltipInnerHtml||"")}else{if("top"==a.chart.chartOptions.tooltipPosition)var C=a.innerOffset.top-20;else if("bottom"==a.chart.chartOptions.tooltipPosition)var C=a.innerOffset.top-38+a.innerHeight;a.tooltip=t("<div/>",{class:"m-chart-t"}).css({left:a.innerOffset.left+"px",top:C+"px",background:a.chart.chartOptions.backgroundColor}).html(a.tooltipInnerHtml||"").insertAfter(this.$chart).get(0)}}}if("undefined"!=typeof e.pointMap){this.pointMap=new Array(this.chartWidth);for(var i=0;i<this.chartWidth;++i){for(var o=0,f=e.pointMap[i];this._isEmptyPoint(f)&&(i-o>0||i+o<this.chartWidth);)++o,f=e.pointMap[i-o],this._isEmptyPoint(f)&&(f=e.pointMap[i+o]);this._isEmptyPoint(f)||(this.pointMap[i]=f)}}},iChart.Charting.Crosshair.prototype._initYLabel=function(){var e=this.areas[0];e&&e.enabled!==!1&&!e.isScroller&&(this.yLabel=t("<div/>",{class:"m-chart-y"}).css({background:e.chart.chartOptions.backgroundColor,display:"none",left:e.innerOffset.left+e.innerWidth-(e.chart.chartOptions.yLabelsOutside?0:50)+"px",position:"absolute",margin:"0 0 0 5px"}).insertAfter(this.$chart).get(0))},iChart.Charting.Crosshair.prototype._isEmptyPoint=function(t){if("undefined"==typeof t)return!0;for(var e=0;e<t.y.length;++e)if(null!==t.y[e])return!1;return!0},iChart.Charting.Crosshair.prototype.addMouseMoveHandler=function(e){this.mouseMoveHandler&&this.removeMouseMoveHandler(),this.mouseMoveHandler=e.mouseMoveHandler.bind(this),t(this.container).on("mousemove",this.mouseMoveHandler)},iChart.Charting.Crosshair.prototype.removeMouseMoveHandler=function(){"undefined"!=typeof this.mouseMoveHandler&&t(this.container).off("mousemove ",this.mouseMoveHandler)},t.fn.crosshair=function(t,e){if(!this.length)return this;var i=this.data("crosshair");return"undefined"==typeof i&&(i=new iChart.Charting.Crosshair({$chart:this}),this.data("crosshair",i)),i.update(t,e),this}}(jQuery),function(){"use strict";iChart.Charting.ChartDataSource=function(t,e){function i(t,e){console.log(e);var i=this.dataAdapter(this.data,e);this.chart.wrapper.trigger("iguanaChartEvents",["chartDataReceived",i]),t(i),this.chart.wrapper.trigger("iguanaChartEvents",["chartDataReady",i])}function a(t,e){t(e.chartOptions)}var r={useHash:!1,date_from:formatDate(-90),date_to:formatDate(0),graphicIndicators:"",hash:"",id:"",interval:"D1",timeframe:1440};e=e||{},this.chart=t,this.data=e.data||{},this.dataSettings=e.dataSettings||r,this.preInitCallback="function"==typeof e.preInitCallback?e.preInitCallback.bind(this):a.bind(this),this.onRequestCallback="function"==typeof e.onRequestCallback?e.onRequestCallback.bind(this):i.bind(this)},iChart.Charting.ChartDataSource.prototype.set=function(t){},iChart.Charting.ChartDataSource.prototype.preInit=function(t,e){if(this.dataSettings.date_from=e.date_from||this.dataSettings.date_from||formatDate(-90),this.dataSettings.date_to=e.date_to||this.dataSettings.date_to||formatDate(0),e.period){var i=this.chart.getPeriodDates(e.period);this.dataSettings.date_from=i.date_from,this.dataSettings.date_to=i.date_to}if(this.dataSettings.start=this.dataSettings.start||this.dataSettings.date_from,this.dataSettings.end=this.dataSettings.end||this.dataSettings.date_to,this.dataSettings.interval=e.interval||this.dataSettings.interval,this.dataSettings.timeframe=iChart.getChartTimeframe(this.dataSettings.interval),e.chartOptions=$.extend(!0,{},e.chartOptions),e.theme="undefined"!=typeof e.theme?e.theme:IGUANACHART_THEME,e.theme){var a=$.grep($iguanaChart.thems,function(t){return t.name==e.theme?t:null})[0];"undefined"!=typeof a?e.chartOptions=$.extend(!0,{},e.chartOptions,a.settings):"default"==e.theme&&(e.chartOptions=$.extend(!0,{},e.chartOptions,$iguanaChart.defaultTheme))}this.preInitCallback(t,e)},iChart.Charting.ChartDataSource.prototype.onRequest=function(t,e){this.onRequestCallback(t,e)},iChart.Charting.ChartDataSource.prototype.dataAdapter=function(t,e){var i={xSeries:[],ySeries:[],success:!0,warnings:[],message:""},a={chartType:"Column",enabled:!0,formatProvider:{decimalPlaces:"2",decimalPrecision:null},indicatorIndex:null,indicatorIndex2:null,kind:"HLOC",name:e.id,overlay:!1,points:[],valuesPerPoint:4},r={chartType:"Column",enabled:!0,formatProvider:{decimalPlaces:null,decimalPrecision:null},indicatorIndex:null,indicatorIndex2:null,kind:"Volume",name:e.id+" - V",overlay:!1,points:[],valuesPerPoint:1};if(t.hloc){var s=Object.keys(t.hloc);if(1==s.length){i.ySeries[0]=$.extend(!0,{},a),i.ySeries[1]=$.extend(!0,{},r),i.ySeries[0].name=s[0];for(var n=0;n<t.xSeries[s[0]].length;n++)i.xSeries.push(+t.xSeries[s[0]][n]+getTimeOffsetServer(tzOffsetMoscow)),i.ySeries[0].points.push(t.hloc[s[0]][n]),i.ySeries[1].points.push([t.vl[s[0]][n]])}else if(s.length>1){for(var o={},h=0;h<s.length;h++)for(var n=0;n<t.xSeries[s[h]].length;n++)"undefined"==typeof o[t.xSeries[s[h]][n]]&&(o[t.xSeries[s[h]][n]]={}),o[t.xSeries[s[h]][n]][s[h]]=t.hloc[s[h]][n];for(var h=0;h<s.length;h++)i.ySeries[h]=$.extend(!0,{},a),i.ySeries[h].name=s[h];for(var l in o){i.xSeries.push(+l+getTimeOffsetServer(tzOffsetMoscow));for(var h=0;h<s.length;h++)"undefined"==typeof o[l][s[h]]?i.ySeries[h].points.push([null,null,null,null]):i.ySeries[h].points.push(o[l][s[h]])}}}return i}}(),function(){"use strict";iChart.Charting.ChartOptions=function(){this.backgroundColor="#ffffff",this.axisColor="#999999",this.labelColor="#595959",this.labelFont="10px Arial",this.showLabels=!0,this.gridColor="#cccccc",this._gridStyle="dashed",this.watermarkShow=!0,this.watermarkColor="rgba(238,238,238,1)",this.watermarkFont="bold 40px Verdana",this.watermarkSubFont="bold 25px Verdana",this.watermarkText="",this.watermarkSubText="",this.candleUp="#66B85C",this.candleDown="#C75757",this.candleBorderUp="#66B85C",this.candleBorderDown="#C75757",this.candleWick=!0,this.candleWickStyle="#595959",this.stockUp="#66B85C",this.stockDown="#C75757",this.stockWidth=1,this.lineColor="#595959",this.lineWidth=1,this.areaColor="#eff6fb",this.areaLineColor="#cccccc",this.volumeStyle="rgba(119, 119, 119, 0.3)",this.scrollerOverlayColor="rgba(0,0,0, 0.1)",this.scrollerHandlerColor="rgba(255,255,255, 1)",this.areaPaddingBottom=30,this.areaPaddingLeft=0,this.areaPaddingRight=60,this.areaPaddingTop=0,this.paddingBottom=0,this.candleBorder=0,this.tooltipPosition="bottom",this.showAxes=0,this.shadowColor="#999999",this.indicatorColors=[["#3D96AE","#80699B","#DB843D"],["#A47D7C","#B5CA92","#e0400a"],["#ff8c00","#617db4","#999999"],["#3D96AE","#80699B","#DB843D"],["#A47D7C","#B5CA92","#e0400a"],["#ff8c00","#617db4","#999999"],["#3D96AE","#80699B","#DB843D"],["#A47D7C","#B5CA92","#e0400a"],["#ff8c00","#617db4","#999999"],["#3D96AE","#80699B","#DB843D"],["#A47D7C","#B5CA92","#e0400a"],["#ff8c00","#617db4","#999999"]],this.minAreaHeight=100,this.minHeight=0,this.seriesColors=["#4BA1B8","#FF8C00","#A47D7C","#3D96AE","#80699B","#DB843D"],this.mousewheelZoom=!0,this.maxZoom=20,this.panStep=.3,this.primaryAreaHeight=350,this.primaryAreaAxisYpaddingTop=30,this.primaryAreaAxisYpaddingBottom=30,this.primaryToSecondaryAreaHeightRatio=2,this.scrollerHeight=80,this.updateInterval=!0,this.yLabelsOutside=!0,this.percentMode=!1,this.futureAmount=100,this.crosshairEnable=!0,this._chartType="Candlestick",this._showVolume="hidden",this.showVolumeByPrice=!1,this.uiTools={top:!1}},iChart.Charting.ChartOptions.themesParams=["backgroundColor","axisColor","showAxes","labelColor","gridColor","gridStyle","watermarkColor","watermarkFont","watermarkSubFont","candleUp","candleDown","candleBorder","candleBorderUp","candleBorderDown","candleWick","candleWickStyle","stockUp","stockDown","stockWidth","lineColor","lineWidth","areaColor","areaLineColor","volumeStyle","scrollerOverlayColor","scrollerHandlerColor","shadowColor","chartType"],iChart.Charting.ChartOptions.getThemeOptions=function(t){var e={};return t&&$.each(this.themesParams,function(i,a){"object"==typeof t[a]?$.isArray(t[a])?e[a]=$.extend(!0,[],t[a]):e[a]=$.extend(!0,{},t[a]):t[a]&&(e[a]=t[a])}),e},Object.defineProperty(iChart.Charting.ChartOptions.prototype,"chartType",{get:function(){return this._chartType},set:function(t){var e=["Candlestick","Stock","Line"];e.indexOf(t)>=0?this._chartType=t:(this._chartType="Candlestick",console.warn("ChartOptions: Недопустимое значение chartType:'%s'. Установлен по умлчанию: 'Candlestick'",t))}}),Object.defineProperty(iChart.Charting.ChartOptions.prototype,"showVolume",{get:function(){return this._showVolume},set:function(t){var e=["inside","outside","hidden"];e.indexOf(t)>=0?this._showVolume=t:(this._showVolume="hidden",console.warn("ChartOptions: Недопустимое значение showVolume. Установлен по умлчанию: 'hidden'"))}}),Object.defineProperty(iChart.Charting.ChartOptions.prototype,"gridStyle",{get:function(){return this._gridStyle},set:function(t){var e=["dashed","solid"];e.indexOf(t)>=0?this._gridStyle=t:(this._gridStyle="dashed",console.warn("ChartOptions: Недопустимое значение gridStyle. Установлен по умлчанию: 'dashed'"))}})}(),function(){"use strict";var t=0;iChart.Charting.Chart=function(e){this.env=e.env,this._id=t++,this.chartOptions=new iChart.Charting.ChartOptions,this.dataCountMin=50,this.historyEnd=e.historyEnd,this.labelPrecision=5,this.dataCallback=e.dataCallback,this.onCreateAreas=e.onCreateAreas||$.noop,this.onDataSettingsChange=e.onDataSettingsChange||$.noop,this.onIntervalChange=e.onIntervalChange||$.noop,this.onPositionAreas=e.onPositionAreas||$.noop,this.onPostRender=e.onPostRender||$.noop,this.onPreRender=e.onPreRender||$.noop,this.contextmenuCallback=e.contextmenuCallback||$.noop,this._dataLoading=!1,this.areas=null,this.canvas=null,this.isComparison=!1,this.viewport={x:{min:null,max:null},y:{min:null,max:null}},this.container=e.container,$(this.container).unbind("selectstart"),$(this.container).attr("unselectable","on").css("user-select","none").on("selectstart",!1),this.overlay=new iChart.Charting.ChartDrawingLayer(this),this.widgetLay=new iChart.Charting.ChartWidgetLayer(this,e.widget),this.renderer=new iChart.Charting.ChartRenderer(this),this.selection=new iChart.Charting.ChartSelection(this.container),this.selection.movestart=$.proxy(this._selectionMoveStartCallback,this),this.selection.move=$.proxy(this._selectionMoveCallback,this),this.selection.moveend=$.proxy(this._selectionMoveEndCallback,this),this.setSelectionMode("pan");var i=this;if($(this.container).on("mousewheel",function(t){$.proxy(i._mousewheelCallback(t),i)}),this.touches=new iChart.Charting.ChartTouches(this),$(this.container).off("contextmenu").on("contextmenu",function(t){$.proxy(i.contextmenuCallback(t),i),i.env.wrapper.trigger("iguanaChartEvents",["contextmenuCallback",t])}),!$(this.env.container).height()){var a=this.calculateHeight();$(this.env.container).height(a.height)}this.chartOptions=$.extend(!0,this.chartOptions,e),this.crosshair=!1,this._resized=!0,this._containerSize={}},iChart.Charting.Chart.prototype.clearIndicators=function(t){for(var e=0;e<this.areas.length;++e){var i=this.areas[e];if(!t||i===t){for(var a=[],r=0;r<i.ySeries.length;++r)"TechnicalAnalysis"!==i.ySeries[r].kind&&"TA_LIB"!==i.ySeries[r].kind||(a.push(i.ySeries[r].indicatorIndex),i.ySeries.splice(r,1),--r);if(a.length){for(var s in this._dataSettings)for(var r=0;r<a.length;r++)this._dataSettings.hasOwnProperty(s)&&s.match(new RegExp("^i"+a[r],"i"))&&delete this._dataSettings[s];if(0===i.ySeries.length){var n=this.areas.splice(e,1);n[0].dispose(),--e}}}}this.onDataSettingsChange.call(this),this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}),this.env.wrapper.trigger("iguanaChartEvents",["clearIndicators"])},iChart.Charting.Chart.prototype.findAreaAtPosition=function(t,e){for(var i={},a=0;a<this.areas.length;++a)if(i.area=this.areas[a],i.area.enabled&&t>=i.area.offset.left&&t<=i.area.offset.left+i.area.outerWidth&&e>=i.area.offset.top&&e<=i.area.offset.top+i.area.outerHeight)return i.insideX=t>=i.area.innerOffset.left&&t<=i.area.innerOffset.left+i.area.innerWidth,i.insideY=e>=i.area.innerOffset.top&&e<=i.area.innerOffset.top+i.area.innerHeight,i.insideX||i.insideY?i:null;return null},iChart.Charting.Chart.prototype.getSeriesCollection=function(){for(var t=[],e=0;e<this.areas.length;++e)for(var i=this.areas[e].ySeries,a=0;a<i.length;++a)"TA_LIB"!=i[a].kind&&t.indexOf(i[a])===-1&&t.push(i[a]);return t},iChart.Charting.Chart.prototype.loadMissingData=function(){var t=this.areas[0];if(this._dataStart){var e=Math.round(t.xSeries.min-this.viewport.x.min);if(e>0){var i=$.extend(!0,{},this._dataSettings);i.count=-Math.max(this.dataCountAdapt(e),e),i.intervalMode="OpenRay",i.start=iChart.formatDateTime(this._dataStart),delete i.end;var a=iChart.parseDateTime(i.start),r=iChart.parseDateTime(i.start);return a.setHours(0),a.setMinutes(0),a.setSeconds(0),r.setHours(0),r.setMinutes(0),r.setSeconds(0),1440==i.timeframe?(a.setMonth(0),a.setDate(0),r.setFullYear(r.getFullYear()+1,0,0),i.count=-1):60==i.timeframe?(a.setMonth(a.getMonth()-1),a.setDate(0),r.setMonth(r.getMonth()+1),r.setDate(0),i.count=-1):15==i.timeframe?(a.setMonth(a.getMonth()-1),a.setDate(0),r.setMonth(r.getMonth()+1),r.setDate(0),i.count=-1):5==i.timeframe?(r.setDate(r.getDate()+(7-(0==r.getDay()?7:r.getDay()))),a.setDate(a.getDate()-(0==a.getDay()?7:a.getDay())),i.count=-1):1==i.timeframe&&(r.setDate(r.getDate()+1),a.setDate(a.getDate()-1),i.count=-100),i.date_from=iChart.formatDateTime(a,"dd.MM.yyyy HH:mm"),i.date_to=iChart.formatDateTime(r,"dd.MM.yyyy HH:mm"),i.start=i.date_to,void this.requestData(i,!1,!1)}}if(this._dataEnd){var s=Math.round(this.viewport.x.max-t.xSeries.max);if(s>0){var i=$.extend(!0,{},this._dataSettings);i.count=Math.max(this.dataCountAdapt(s),s)+this.chartOptions.futureAmount,i.intervalMode="OpenRay",i.start=iChart.formatDateTime(this._dataEnd),i.date_to=iChart.formatDateTime(this._dataEnd,"dd.MM.yyyy HH:mm"),delete i.end,this.requestData(i,!1,!1)}}},iChart.Charting.Chart.prototype.dataCountAdapt=function(t){var e=50;switch(this._dataSettings.timeframe){case 1:e=500;break;case 5:e=300;break;case 15:e=200;break;case 30:e=150;break;case 60:e=120;break;case 1440:e=100}return e+t},iChart.Charting.Chart.prototype.pan=function(t){for(var e,i=0;i<this.areas.length&&(e=this.areas[i],e.name!==this.viewport.areaName);++i)e=null;if(null===e&&(e=this.areas[0]),this.viewport.areaName=e.name,"left"===t||"right"===t){null===this.viewport.x.min&&(this.viewport.x.min=e.viewport.x.bounded.min),null===this.viewport.x.max&&(this.viewport.x.max=e.viewport.x.bounded.max);var a=Math.max(1,this.chartOptions.panStep*(this.viewport.x.max-this.viewport.x.min));"left"===t&&(a*=-1),this.viewport.x.min+=a,this.viewport.x.max+=a}else{if("top"!==t&&"bottom"!==t)return;null===this.viewport.y.min&&(this.viewport.y.min=e.viewport.y.min),null===this.viewport.y.max&&(this.viewport.y.max=e.viewport.x.max);var a=this.chartOptions.panStep*(this.viewport.y.max-this.viewport.y.min);"bottom"===t&&(a*=-1),this.viewport.y.min+=a,this.viewport.y.max+=a}this._fixViewportBounds(),this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),this.loadMissingData()},iChart.Charting.Chart.prototype.parseDataSettings=function(t){var e=$.extend(!0,{},t);return e.start=iChart.parseDateTime(e.start),e.end=iChart.parseDateTime(e.end),e.timeframe=parseInt(e.timeframe,10),isNaN(Date.parse(e.date_from))&&(e.date_from=new Date),isNaN(Date.parse(e.date_to))&&(e.date_to=new Date),e},iChart.Charting.Chart.prototype.render=function(t,e){if(!this.areas)return console.log("No ares to render. Abort"),!1;if(t.context&&t.forceRecalc)throw new Error("Parameters 'forceRecalc' and 'context' parameters cannot be specified at the same time.");t.resetViewport&&(this.viewport.x.min=null,this.viewport.x.max=null,this.viewport.y.min=null,this.viewport.y.max=null);var i,a,r=t.context;if(t.forceRecalc){if(this._positionAreas(),!this.canvas)return console.log("No canvas to render. Abort"),!1;r=this.canvas.getContext("2d"),a={},a.x={},a.x.min=this.viewport.x.min,a.x.max=this.viewport.x.max,a.y={};for(var s=0;s<this.areas.length;++s)i=this.areas[s],i.name===this.viewport.areaName?(a.y.min=this.viewport.y.min,a.y.max=this.viewport.y.max):(a.y.min=null,a.y.max=null),i.calculateInnerDimensions(a)}if(this.onPreRender.call(this,t,r),this.renderer.renderChart(r),this.onPostRender.call(this,t,r),t.forceRecalc&&(this.widgetLay&&this.widgetLay.update(),this.overlay&&this.overlay.update(),this.chartOptions.crosshairEnable)){this.crosshair=$(r.canvas).crosshair({areas:$.grep(this.areas,function(t){return!t.rotate}),showTime:this.showTime()},this.container),this.crosshair=this.crosshair.data("crosshair");var n=$(window).data();this.crosshair.render(n.mousePosX,n.mousePosY,!0)}return"undefined"!=typeof FlashCanvas&&r.e(),t.testForIntervalChange&&this._testForIntervalChange(e),!0},iChart.Charting.Chart.prototype.requestData=function(t,e,i,a){var r=new RegExp("^i[0-9]+$","i");for(var s in t)r.test(s)&&t[s]&&this.env.viewData.indicators[t[s]]&&"TA_LIB"==this.env.viewData.indicators[t[s]].type&&(t[s]="");if(!this._dataLoading){this._dataLoading=!0,this.touches.disabled=!0;var n=this,o=0,h=function(r){n.setWarnings(r.warnings),r.success&&(o=n.updateData(r,t,e),n.render({forceRecalc:!0,resetViewport:i,testForIntervalChange:!0},a)),setTimeout(function(){n.scheduleUpdate()},2e3),n._dataLoading=!1,n&&n.areas&&o&&n.areas[0].xSeries.min>n.viewport.x.min&&n.loadMissingData(),n.indicatorsApply()};this.env.dataSource.onRequest(h,t)}},iChart.Charting.Chart.prototype.indicatorsApply=function(){if("undefined"!=typeof this.env.TA){var t={};if(this.areas)for(var e=0;e<this.areas.length;++e)for(var i=this.areas[e],a=0;a<i.ySeries.length;++a)if("TA_LIB"===i.ySeries[a].kind){var r=i.ySeries[a].indicatorIndex,s=i.ySeries[a].name,n=$.extend(!0,{},i.ySeries[a].params);this.env.TA[s]&&(this.env.TA[s](0,r),this.env.TA[s](1,r,n),t[s+"/"+r]=!0)}var o=this,h=iChart.parseQueryString(this.env.dataSource.dataSettings.graphicIndicators);$.each(h,function(e,i){if(i&&e.match(/^i[0-9]+$/)&&o.env.viewData.indicators[i]&&"TA_LIB"==o.env.viewData.indicators[i].type){var a=e.match(/^i([0-9]+)$/)[1];if(!t[i+"/"+a]){for(var r={},s=0;s<o.env.viewData.indicators[i].parameters.length;s++){var n=o.env.viewData.indicators[i].parameters[s],l=o.env.TA.mapParam(n.Code);h[e+"_"+l]?r[n.Code]=+h[e+"_"+l]:r[n.Code]=+h[e+"_"+n.Code]||n.Value}o.env.TA[i](0,a),o.env.TA[i](1,a,r)}}})}},iChart.Charting.Chart.prototype.resetZoom=function(){this.render({forceRecalc:!0,resetViewport:!0,testForIntervalChange:!0})},iChart.Charting.Chart.prototype.resize=function(){this._resized=!0,this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}),this.selection.recalculateContainerPosition()},iChart.Charting.Chart.prototype.scheduleUpdate=function(){clearTimeout(this.env.timers.scheduleUpdate),this.chartOptions.updateInterval&&this._dataSettings.securityId==this.env.viewData.chart._dataSettings.securityId&&$(this.env.container).length&&(this.env.timers.scheduleUpdate=setTimeout($.proxy(this.update,this,!0),2e4*this.env.viewData.chart._dataSettings.timeframe))},iChart.Charting.Chart.prototype.setChartType=function(t){this.chartOptions.chartType===t||this.isComparison||(this.chartOptions.chartType=t,this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}))},iChart.Charting.Chart.prototype.setDataSettings=function(t,e){var i=this._dataSettings;this._dataSettings=this.parseDataSettings(t);var a=$.extend(!0,{},this._dataSettings);if("undefined"!=typeof i){var r={};i.interval!=this._dataSettings.interval&&(r.interval=this._dataSettings.interval,this.env.wrapper.trigger("iguanaChartEvents",["intervalChange",this._dataSettings.interval])),i.securityId!=this._dataSettings.securityId&&(r.securityId=this._dataSettings.securityId),i.type!=this._dataSettings.type&&(r.type=this._dataSettings.type),Object.keys(r).length&&this.env.wrapper.trigger("iguanaChartEvents",["settingsChange",r])}var s=new Date(1800,0,1),n=this.historyEnd||new Date,o=(a.start||s).getTime(),h=(a.end||n).getTime();if(i&&i.id===a.id&&i.timeframe===a.timeframe&&!e){var l=!0,c=new RegExp("^i[0-9]+(_.*)?$","i");for(var d in i)if(i.hasOwnProperty(d)&&c.test(d)&&(!a.hasOwnProperty(d)||i[d]!==a[d])){l=!1;break}if(l)for(var d in a)if(a.hasOwnProperty(d)&&c.test(d)&&(!i.hasOwnProperty(d)||i[d]!==a[d])){l=!1;break}if(l){var p=(i.start||s).getTime(),u=(i.end||n).getTime();if(p==o&&u===h)return!1;if(p=(this._dataStart||s).getTime(),u=(this._dataEnd||n).getTime(),p<=o&&h<=u)return this.env.wrapper.trigger("iguanaChartEvents",["clearLoader"]),this.render({forceRecalc:!0,resetViewport:!0,testForIntervalChange:!0}),!0;o<p&&u===h?(a.intervalMode="OpenRay",a.count=-Math.max(this.dataCountMin,Math.round((p-o)/(6e4*a.timeframe))+50),a.start=new Date(p)):p==o&&u<h&&(a.intervalMode="OpenRay",a.count=Math.max(this.dataCountMin,Math.round((h-u)/(6e4*a.timeframe))+50),a.start=new Date(u))}}var g=!a.intervalMode;if(g){a.intervalMode="ClosedRay",a.count=-Math.max(this.dataCountMin,Math.round((h-o)/(6e4*a.timeframe)/2)),a.start=a.end;var f=iChart.parseDateTime(a.date_to),m=iChart.parseDateTime(a.date_from);1440==a.timeframe?(f.setFullYear(f.getFullYear()-5),m=new Date(Math.max(m.getTime(),f.getTime())),m.setMonth(0),m.setDate(0),a.count=-1):60==a.timeframe?(f.setMonth(f.getMonth()-3),m=new Date(Math.max(m.getTime(),f.getTime())),m.setMonth(m.getMonth()-1),m.setDate(0),a.count=-10):15==a.timeframe?(f.setMonth(f.getMonth()-1),m=new Date(Math.max(m.getTime(),f.getTime())),m.setDate(0),a.count=-10):5==a.timeframe?(f.setDate(f.getDate()-14),m=new Date(Math.max(m.getTime(),f.getTime())),m.setHours(0),m.setMinutes(0),m.setSeconds(0),m.setDate(m.getDate()-m.getDay()),a.count=-100):1==a.timeframe&&(f.setDate(f.getDate()-5),m=new Date(Math.max(m.getTime(),f.getTime())),m.setHours(0),m.setMinutes(0),m.setSeconds(0),m.setDate(m.getDate()-1),a.count=-200),m.setHours(0),m.setMinutes(0),m.setSeconds(0),a.date_from=iChart.formatDateTime(m,"dd.MM.yyyy HH:mm")}return delete a.end,a.start=iChart.formatDateTime(iChart.parseDateTime(a.start),"dd.MM.yyyy HH:mm"),this.requestData(a,g,!0),!0},iChart.Charting.Chart.prototype.setSelectionMode=function(t){if(this.container){switch(t){case"pan":this.container.style.cursor=this.overlay.defaultCursor="url('"+this.env.lib_path+"/styles/cursors/grab.cur'), move";break;case"zoom":this.container.style.cursor=this.overlay.defaultCursor="crosshair";break;case"wait":this.container.style.cursor=this.overlay.defaultCursor="wait";break;default:throw new Error("Selection mode '"+t+"' is invalid.")}this.selection.mode=t}},iChart.Charting.Chart.prototype.setWarnings=function(t){var e=$(".m-chart-warnings",this.container);return t&&t.length?(0===e.length?e=$("<div/>",{class:"m-chart-warnings"}).appendTo(this.container):e.show(),void e.text(t.join("\r\n"))):void e.hide()},iChart.Charting.Chart.prototype.showTime=function(){return parseInt(this._dataSettings.timeframe,10)%1440!==0},iChart.Charting.Chart.prototype.toBase64=function(t){var e=document.createElement("canvas");if(e.id="iChart-chart",e.style.left=0,e.style.position="absolute",e.style.top=-this.canvas.height,document.body.appendChild(e),"undefined"==typeof e.getContext){if("undefined"==typeof FlashCanvas)return void alert("Ваш браузер не поддерживается.");FlashCanvas.initElement(e)}e.width=this.canvas.width,e.height=this.canvas.height;var i=e.getContext("2d");this.render({context:i,forceRecalc:!1,resetViewport:!1,testForIntervalChange:!1}),this.overlay.render(i),this.renderer.renderLegends(i);var a=e.toDataURL(t);$(e).remove();var r=";base64,";return a.substring(a.indexOf(r)+r.length)},iChart.Charting.Chart.prototype.update=function(t){var e=$.extend(!0,{},this._dataSettings);e.intervalMode="ClosedRay",t&&(e.intervalMode="OpenRay"),e.count=this.dataCountMin;var i=this.areas[0].xSeries;0!==i.length&&(e.date_from=iChart.formatDateTime(new Date(1e3*i[i.length-this.chartOptions.futureAmount-1]),"dd.MM.yyyy HH:mm"),e.date_to=e.date_from,e.start=e.date_from),delete e.end,this.requestData(e,!1,!1,t)},iChart.Charting.Chart.prototype.updateData=function(t,e,i){if("ClosedRay"!==e.intervalMode&&"OpenRay"!==e.intervalMode)throw new Error("Interval mode '"+e.intervalMode+"' is invalid.");if(e.count<0?(t.xSeries.length<-e.count?this._dataStart=null:this._dataStart=new Date(1e3*t.xSeries[0]),i&&(this._dataEnd=iChart.parseDateTime(e.start))):(i&&(this._dataStart=iChart.parseDateTime(e.start)),t.xSeries.length<e.count?this._dataEnd=null:this._dataEnd=new Date(1e3*t.xSeries[t.xSeries.length-1])),0!==t.xSeries.length){var a=new Date(1e3*t.xSeries[t.xSeries.length-1]);(!this.historyEnd||a.getTime()>this.historyEnd.getTime())&&(this.historyEnd=a)}if(i)return this._setData(t,e);if(0!==t.xSeries.length){var r=this._mergeData(t,e);return e.count<0&&!r?this._dataStart=null:e.count>0&&!r&&(this._dataEnd=null),r}},iChart.Charting.Chart.prototype.zoom=function(t){this._zoomInternal(null,t)},iChart.Charting.Chart.prototype.addFuture=function(){var t=this.areas[0].xSeries,e=this._dataSettings;if(this.chartOptions.futureAmount)for(var i=60*e.timeframe,a=0;a<this.chartOptions.futureAmount;a++)t.push(t[t.length-1]+i);for(var r=$.grep(this.getSeriesCollection(),function(t){return t.enableMerge}),a=0;a<r.length;++a){var s=r[a];if(this.chartOptions.futureAmount)if(1==s.valuesPerPoint)for(var n=0;n<this.chartOptions.futureAmount;n++)s.points.push([null]);else for(var n=0;n<this.chartOptions.futureAmount;n++)s.points.push([null,null,null,null])}for(var a=0;a<this.areas.length;++a)this.areas[a].setMinMax();this._setXLabelFormat();
},iChart.Charting.Chart.prototype.removeFuture=function(){var t=this.areas[0].xSeries;this.chartOptions.futureAmount&&t.splice(-this.chartOptions.futureAmount,this.chartOptions.futureAmount);var e=$.grep(this.getSeriesCollection(),function(t){return t.enableMerge});if(this.chartOptions.futureAmount)for(var i=0;i<e.length;i++)e[i].points.splice(-this.chartOptions.futureAmount,this.chartOptions.futureAmount);for(var i=0;i<this.areas.length;++i)this.areas[i].setMinMax();this._setXLabelFormat()},iChart.Charting.Chart.prototype._fixViewportBounds=function(){for(var t=null,e=0;e<this.areas.length;++e)this.areas[e].name===this.viewport.areaName&&(t=this.areas[e]);if(null!==t){var i,a;null!==this.viewport.x.min&&null!==this.viewport.x.max&&(i=.7*(this.viewport.x.max-this.viewport.x.min),a=this.viewport.x.max-(t.xSeries.max-t.chart.chartOptions.futureAmount)-i,a>0?(this.viewport.x.min-=a,this.viewport.x.max-=a):(a=t.xSeries.min-this.viewport.x.min-i,a>0&&(this.viewport.x.min+=a,this.viewport.x.max+=a))),null!==this.viewport.y.min&&null!==this.viewport.y.max&&(i=.7*(this.viewport.y.max-this.viewport.y.min),a=this.viewport.y.max-t.ySeries.bounds.max-i,a>0?(this.viewport.y.min-=a,this.viewport.y.max-=a):(a=t.ySeries.bounds.min-this.viewport.y.min-i,a>0&&(this.viewport.y.min+=a,this.viewport.y.max+=a)))}},iChart.Charting.Chart.prototype._mergeData=function(t,e){var i=!1,a=this.areas[0].xSeries,r=a.length;this.chartOptions.futureAmount&&a.splice(-this.chartOptions.futureAmount,this.chartOptions.futureAmount);var s=$.grep(this.getSeriesCollection(),function(t){return t.enableMerge});if(this.chartOptions.futureAmount)for(var n=0;n<s.length;n++)s[n].points.splice(-this.chartOptions.futureAmount,this.chartOptions.futureAmount);if(e.count<0){for(var n=t.xSeries.length-1,o=n;t.xSeries[n]>a[0]&&n>0;)n--;var h=n;t.xSeries.splice(h,o-h+1);for(var l=t.ySeries.length-1;l>=0;--l)t.ySeries[l].points.splice(h,o-h+1);var c=t.xSeries.length;t.xSeries[t.xSeries.length-1]===a[0]&&(a.splice(0,1),--c,i=!0),null!==this.viewport.x.min&&(this.viewport.x.min+=c),null!==this.viewport.x.max&&(this.viewport.x.max+=c),this.selection&&this.selection.shiftAnchor(c);for(var l=t.xSeries.length-1;l>=0;--l)a.splice(0,0,t.xSeries[l])}else{for(var d=a.length,p=d,u=0;a[p-1]>=t.xSeries[0];)p--;a[p]!=t.xSeries[0]&&p!=d&&(u=1),p-=u,a.splice(p,t.xSeries.length);for(var l=0;l<t.xSeries.length;++l)a.splice(p+l,0,t.xSeries[l]);for(var n=0;n<s.length;n++)s[n].points.splice(p,t.xSeries.length)}if(this.chartOptions.futureAmount)for(var g=e.timeframe||this.env.dataSource.dataSettings.timeframe,f=60*g,n=0;n<this.chartOptions.futureAmount;n++)a.push(a[a.length-1]+f);for(var m=[],v=[],y={},n=0;n<t.ySeries.length;++n){var C=t.ySeries[n];switch(C.kind){case"HLOC":m.push(C);break;case"TechnicalAnalysis":C.overlay?m.push(C):"undefined"==typeof y[C.indicatorIndex]?y[C.indicatorIndex]=[C]:y[C.indicatorIndex].push(C);break;case"Volume":v.push(C);break;default:continue}}for(var x=[],n=0;n<m.length;++n)x.push(m[n]);if(!this.isComparison)for(var n=0;n<v.length;++n)x.push(v[n]);for(var T in y)if(y.hasOwnProperty(T))for(var n=0;n<y[T].length;++n)x.push(y[T][n]);if(s.length>x.length)throw new Error("Y series count mismatch while merging chart data, expected "+s.length+", got "+x.length+".");for(var n=0;n<s.length;++n){var C=s[n],S=x[n];if(C.kind===S.kind){if(e.count<0){i&&C.points.splice(0,1);for(var l=S.points.length-1;l>=0;--l)C.points.splice(0,0,S.points[l])}else{i&&C.points.pop();for(var l=0;l<S.points.length;++l)C.points.splice(p+l,0,S.points[l])}if(this.chartOptions.futureAmount)if(1==C.valuesPerPoint)for(var l=0;l<this.chartOptions.futureAmount;l++)C.points.push([null]);else for(var l=0;l<this.chartOptions.futureAmount;l++)C.points.push([null,null,null,null])}}for(var n=0;n<this.areas.length;++n)this.areas[n].setMinMax();return this._setXLabelFormat(),a.length-r},iChart.Charting.Chart.prototype._mousewheelCallback=function(t){if(this.chartOptions.mousewheelZoom){var e=$(this.container).offset(),i=t.pageX-e.left,a=t.pageY-e.top,r=this.findAreaAtPosition(i,a),s=t.deltaY,n=t.deltaFactor;null!==r&&(this._zoomInternal(r.area,.2*s*n/53,"x",r.area.getXIndex(i-r.area.innerOffset.left),r.area.getYValue(a-r.area.innerOffset.top)),t.preventDefault())}},iChart.Charting.Chart.prototype.calculateHeight=function(){var t,e,i=this.areas?$.grep(this.areas,function(t){return t.enabled}):[],a=0,r=0;if(this.chartOptions.minHeight&&this.areas){var s=this.chartOptions.minHeight-this.chartOptions.scrollerHeight,n=$.grep(i,function(t){return!t.isLayer}).length;e=Math.max(this.chartOptions.minAreaHeight,Math.floor(s/(n+(0===this.chartOptions.scrollerHeight?0:-1)+this.chartOptions.primaryToSecondaryAreaHeightRatio-1))),t=Math.floor(this.chartOptions.primaryToSecondaryAreaHeightRatio*e)}else e=Math.round(this.chartOptions.primaryAreaHeight/this.chartOptions.primaryToSecondaryAreaHeightRatio),t=this.chartOptions.primaryAreaHeight;if(this.areas)for(var o=0;o<i.length;++o){var h=i[o];h.isLayer?(h.offset.left=0,h.outerWidth=r,h.outerHeight=e,h.offset.top=t-h.outerHeight):(h.offset.top=a,h.offset.left=0,h.outerWidth=r,h.outerHeight="Scroller"===h.name?this.chartOptions.scrollerHeight:"ChartArea1"===h.name?t:e,h.updateCloseButton(),a+=h.outerHeight+h.margin.bottom)}else a=t+=this.chartOptions.scrollerHeight;return{height:a,primaryHeight:t}},iChart.Charting.Chart.prototype._positionAreas=function(){if(this.container){var t=$(this.container);!t.length||!this._resized&&this._containerSize.height&&this._containerSize.width||(this._containerSize.height=t.height(),this._containerSize.width=t.width(),this._containerSize.offset=t.offset(),this._resized=!1);var e,i,a=this._containerSize.height,r=this._containerSize.width,s=$.grep(this.areas,function(t){return t.enabled}),n=0,o=r;if(this.chartOptions.minHeight){var h=this.chartOptions.minHeight-this.chartOptions.scrollerHeight,l=$.grep(s,function(t){return!t.isLayer}).length;i=Math.max(this.chartOptions.minAreaHeight,Math.floor(h/(l+(0===this.chartOptions.scrollerHeight?0:-1)+this.chartOptions.primaryToSecondaryAreaHeightRatio-1))),e=Math.floor(this.chartOptions.primaryToSecondaryAreaHeightRatio*i)}else i=Math.round(this.chartOptions.primaryAreaHeight/this.chartOptions.primaryToSecondaryAreaHeightRatio),e=this.chartOptions.primaryAreaHeight;for(var c=0;c<s.length;++c){var d=s[c];d.isLayer?(d.offset.left=0,d.outerWidth=o,d.outerHeight=i,d.offset.top=e-d.outerHeight):(d.offset.top=n,d.offset.left=0,d.outerWidth=o,d.outerHeight="Scroller"===d.name?this.chartOptions.scrollerHeight:"ChartArea1"===d.name?e:i,d.updateCloseButton(),n+=d.outerHeight+d.margin.bottom)}var p=this.areas[0];p.axisX.paddingLeft=10,p.axisX.paddingRight=10,p.axisY.paddingTop=this.chartOptions.primaryAreaAxisYpaddingTop,p.axisY.paddingBottom=this.chartOptions.primaryAreaAxisYpaddingBottom,p.padding.bottom=this.chartOptions.areaPaddingBottom,p.padding.left=this.chartOptions.areaPaddingLeft,p.padding.right=this.chartOptions.yLabelsOutside?this.chartOptions.areaPaddingRight:0,p.padding.top=this.chartOptions.areaPaddingTop;for(var c=1;c<this.areas.length;++c){var d=this.areas[c];switch(d.name){case"ChartArea1":break;case"ChartArea2":d.axisX.paddingLeft=p.axisX.paddingLeft,d.axisX.paddingRight=p.axisX.paddingRight,d.axisY.paddingTop=0,d.axisY.paddingBottom=0,d.isLayer?(d.padding.bottom=p.padding.bottom,d.padding.top=p.padding.top):(d.padding.bottom=8,d.padding.top=18),d.padding.left=p.padding.left,d.padding.right=p.padding.right;break;case"Scroller":d.axisX.paddingLeft=p.axisX.paddingLeft,d.axisX.paddingRight=p.axisX.paddingRight,d.axisY.paddingTop=10,d.axisY.paddingBottom=10,d.padding.bottom=32,d.padding.left=p.padding.left,d.padding.right=p.padding.right;break;default:d.axisX.paddingLeft=p.axisX.paddingLeft,d.axisX.paddingRight=p.axisX.paddingRight,d.axisY.paddingTop=10,d.axisY.paddingBottom=10,d.isLayer?(d.padding.bottom=p.padding.bottom,d.padding.top=p.padding.top):(d.padding.bottom=32,d.padding.top=0),d.padding.left=p.padding.left,d.padding.right=p.padding.right}}this.positionVolumeByPriceArea();var u=this.onPositionAreas.call(this);u&&(o=u.width||o,n=u.height||n),this.canvas=iChart.Charting.initCanvas(this.container,this.canvas,o,n),a!==n&&t.height(n),r!==o&&t.width(n)}},iChart.Charting.Chart.prototype._selectionMouseDownCallback=function(t){},iChart.Charting.Chart.prototype._selectionMoveStartCallback=function(t){switch(t.mode){case"pan":if(t.position1=this.findAreaAtPosition(t.x1,t.y1),null===t.position1)break;var e=t.position1.area;if(t.position1.insideX&&t.position1.insideY){t.resizeScrollerL=e.isScroller&&e.$scrollerOverlayCenterL.data("iChart-hover"),t.resizeScrollerR=e.isScroller&&!t.resizeScrollerL&&e.$scrollerOverlayCenterR.data("iChart-hover");var i=e.isScroller?e.scrollerViewport:e.viewport;t.resizeScrollerR?t.setAnchor(null===this.viewport.x.max||this.viewport.areaName!==e.name?i.x.max:this.viewport.x.max,null===this.viewport.y.min||this.viewport.areaName!==e.name?i.y.min:this.viewport.y.min):t.setAnchor(null===this.viewport.x.min||this.viewport.areaName!==e.name?i.x.min:this.viewport.x.min,null===this.viewport.y.min||this.viewport.areaName!==e.name?i.y.min:this.viewport.y.min)}else{if(e.isScroller){t.position1=null;break}t.position1.insideX?t.setAnchor(e.getXIndex(t.x1-e.innerOffset.left),null):t.position1.insideY&&t.setAnchor(null,e.getYValue(t.y1-e.innerOffset.top)),t.resizeScrollerL=!1,t.resizeScrollerR=!1}t.resizeScrollerL||t.resizeScrollerR?this.container.style.cursor=this.overlay.defaultCursor="ew-resize":this.container.style.cursor=this.overlay.defaultCursor="url('"+this.env.lib_path+"/styles/cursors/grabbing.cur'), move";break;case"zoom":t.setAnchor(null,null),this.container.style.cursor=this.overlay.defaultCursor="crosshair";break;case"wait":break;default:throw new Error("Selection mode '"+t.mode+"' is invalid.")}},iChart.Charting.Chart.prototype._selectionMouseMoveCallback=function(t){},iChart.Charting.Chart.prototype._selectionMoveCallback=function(t){switch(t.mode){case"pan":if(null===t.position1)break;if(t.position2=this.findAreaAtPosition(t.x2,t.y2),null===t.position2)break;if(t.position2.area!==t.position1.area||t.position2.insideX!==t.position1.insideX||t.position2.insideY!==t.position1.insideY)break;var e=t.position1.area;if(t.position1.insideX&&t.position1.insideY){var i=e.isScroller?e.scrollerViewport:e.viewport,a=(e.isScroller?-1:1)*(e.getXIndex(t.x2-e.innerOffset.left)-e.getXIndex(t.x1-e.innerOffset.left));a+=t.resizeScrollerR?(null===this.viewport.x.max||this.viewport.areaName!==e.name?i.x.max:this.viewport.x.max)-t.anchorX:(null===this.viewport.x.min||this.viewport.areaName!==e.name?i.x.min:this.viewport.x.min)-t.anchorX;var r=e.isScroller?0:e.getYValue(t.y2-e.innerOffset.top)-e.getYValue(t.y1-e.innerOffset.top)+((null===this.viewport.y.min||this.viewport.areaName!==e.name?i.y.min:this.viewport.y.min)-t.anchorY);t.resizeScrollerR||(this.viewport.x.max=null===this.viewport.x.max||this.viewport.areaName!==e.name?i.x.max:this.viewport.x.max,this.viewport.x.max-((null===this.viewport.x.min||this.viewport.areaName!==e.name?i.x.min:this.viewport.x.min)-a)>1&&(this.viewport.x.min=(null===this.viewport.x.min||this.viewport.areaName!==e.name?i.x.min:this.viewport.x.min)-a)),t.resizeScrollerL||(this.viewport.x.min=null===this.viewport.x.min||this.viewport.areaName!==e.name?i.x.min:this.viewport.x.min,(null===this.viewport.x.max||this.viewport.areaName!==e.name?i.x.max:this.viewport.x.max)-a-this.viewport.x.min>1&&(this.viewport.x.max=(null===this.viewport.x.max||this.viewport.areaName!==e.name?i.x.max:this.viewport.x.max)-a)),0!==r&&null!==this.viewport.y.min&&null!==this.viewport.y.max&&(this.viewport.y.min=(this.viewport.areaName===e.name?this.viewport.y.min:i.y.min)-r,this.viewport.y.max=(this.viewport.areaName===e.name?this.viewport.y.max:i.y.max)-r),this.viewport.areaName=e.name}else t.position1.insideX?this._zoomInternal(e,3*(t.x2-t.x1)/e.innerWidth,"x",t.anchorX,null):t.position1.insideY&&this._zoomInternal(e,3*(t.y2-t.y1)/e.innerHeight,"y",null,t.anchorY),t.x1=t.x2,t.y1=t.y2;return this._fixViewportBounds(),this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),this.loadMissingData(),!1;case"zoom":case"wait":return!0;default:throw new Error("Selection mode '"+t.mode+"' is invalid.")}},iChart.Charting.Chart.prototype._selectionMouseUpCallback=function(t){},iChart.Charting.Chart.prototype._selectionMoveEndCallback=function(t){"pan"===t.mode?this.container.style.cursor=this.overlay.defaultCursor="url('"+this.env.lib_path+"/styles/cursors/grab.cur'), move":this.container.style.cursor=this.overlay.defaultCursor="crosshair";var e="pan"===t.mode?1:20;if(!(Math.abs(t.x2-t.x1)<e&&Math.abs(t.y2-t.y1)<e)&&null!==t.position1&&(t.position2=this.findAreaAtPosition(t.x2,t.y2),null!==t.position2&&t.position2.area===t.position1.area&&t.position2.insideX===t.position1.insideX&&t.position2.insideY===t.position1.insideY)){var i=t.position1.area;switch(t.mode){case"pan":if(t.position1.insideX&&t.position1.insideY){var a=i.isScroller?i.scrollerViewport:i.viewport,r=(i.isScroller?-1:1)*(i.getXIndex(t.x2-i.innerOffset.left)-i.getXIndex(t.x1-i.innerOffset.left));r+=t.resizeScrollerR?(null===this.viewport.x.max||this.viewport.areaName!==i.name?a.x.max:this.viewport.x.max)-t.anchorX:(null===this.viewport.x.min||this.viewport.areaName!==i.name?a.x.min:this.viewport.x.min)-t.anchorX;var s=i.isScroller?0:i.getYValue(t.y2-i.innerOffset.top)-i.getYValue(t.y1-i.innerOffset.top)+((null===this.viewport.y.min||this.viewport.areaName!==i.name?a.y.min:this.viewport.y.min)-t.anchorY);if(t.resizeScrollerR||(this.viewport.x.max=null===this.viewport.x.max||this.viewport.areaName!==i.name?a.x.max:this.viewport.x.max,this.viewport.x.max-((null===this.viewport.x.min||this.viewport.areaName!==i.name?a.x.min:this.viewport.x.min)-r)>1&&(this.viewport.x.min=(null===this.viewport.x.min||this.viewport.areaName!==i.name?a.x.min:this.viewport.x.min)-r)),t.resizeScrollerL||(this.viewport.x.min=null===this.viewport.x.min||this.viewport.areaName!==i.name?a.x.min:this.viewport.x.min,(null===this.viewport.x.max||this.viewport.areaName!==i.name?a.x.max:this.viewport.x.max)-r-this.viewport.x.min>1&&(this.viewport.x.max=(null===this.viewport.x.max||this.viewport.areaName!==i.name?a.x.max:this.viewport.x.max)-r)),(t.resizeScrollerL||t.resizeScrollerR)&&null!==this.viewport.x.min&&null!==this.viewport.x.max&&this.viewport.x.min>this.viewport.x.max){var n=this.viewport.x.min;this.viewport.x.min=this.viewport.x.max,this.viewport.x.max=n}0!==s&&null!==this.viewport.y.min&&null!==this.viewport.y.max&&(this.viewport.y.min=(this.viewport.areaName===i.name?this.viewport.y.min:a.y.min)-s,this.viewport.y.max=(this.viewport.areaName===i.name?this.viewport.y.max:a.y.max)-s)}else t.position1.insideX?this._zoomInternal(i,(t.x2-t.x1)/i.innerWidth,"x",t.anchorX,null):t.position1.insideY&&this._zoomInternal(i,(t.y2-t.y1)/i.innerHeight,"y",null,t.anchorY);this._fixViewportBounds();break;case"zoom":var o=i.getXIndex((t.x1<t.x2?t.x1:t.x2)-i.innerOffset.left),h=i.getXIndex((t.x1<t.x2?t.x2:t.x1)-i.innerOffset.left);this.viewport.x.min=Math.max(i.xSeries.min,Math.min(o,i.xSeries.max)),this.viewport.x.max=Math.min(i.xSeries.max,h),this.viewport.y.min=i.getYValue((t.y1>t.y2?t.y1:t.y2)-i.innerOffset.top),this.viewport.y.max=i.getYValue((t.y1>t.y2?t.y2:t.y1)-i.innerOffset.top);break;case"wait":break;default:throw new Error("Selection mode '"+t.mode+"' is invalid.")}this.viewport.areaName=i.name,this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),this.loadMissingData()}},iChart.Charting.Chart.prototype._setData=function(t,e){if(this.areas)for(var i=0;i<this.areas.length;++i)this.areas[i].dispose();this.areas=[];var a=new iChart.Charting.ChartArea({chart:this,name:"ChartArea1",showLabels:this.showLabels}),r=new iChart.Charting.ChartArea({chart:this,isScroller:!0,name:"Scroller",showLegend:!1}),s=new iChart.Charting.ChartArea({chart:this,name:"ChartArea2",parentName:"outside"===this.chartOptions.showVolume?void 0:a.name,showAxes:"outside"==this.chartOptions.showVolume,showLabels:"outside"==this.chartOptions.showVolume,showLegend:"outside"==this.chartOptions.showVolume,showWatermark:"outside"==this.chartOptions.showVolume}),n=[],o=[],h=[],l={};if(this.chartOptions.futureAmount){for(var c=60*e.timeframe,i=0;i<this.chartOptions.futureAmount;i++)t.xSeries.push(t.xSeries[t.xSeries.length-1]+c);for(var i=0;i<t.ySeries.length;i++)if(1==t.ySeries[i].valuesPerPoint)for(var d=0;d<this.chartOptions.futureAmount;d++)t.ySeries[i].points.push([null]);else for(var d=0;d<this.chartOptions.futureAmount;d++)t.ySeries[i].points.push([null,null,null,null])}for(var p=0,u=0,i=0;i<t.ySeries.length;++i){var g=t.ySeries[i];switch(g.isStartedFromZero=!1,g.kind){case"HLOC":g.chartArea=a.name;var f=$.extend([],this.chartOptions.seriesColors);f.splice(0,0,this.chartOptions.lineColor),g.color=f[n.length%f.length],n.push(g),o.push(g);break;case"TechnicalAnalysis":for(var m=g.name.replace(/\s.*$/,""),d=u;d<3;d++)if(u++,e["i"+d]==m){var v=d;break}var y=this.chartOptions.indicatorColors[v],C=this.env.userSettings.chartSettings.indicatorsColor;if(C[m]&&"undefined"!=typeof C[m][v]){var x=C[m][v][g.indicatorIndex2%C[m][v].length];g.color=x||y[g.indicatorIndex2%y.length]}else g.color=y[g.indicatorIndex2%y.length];var T=this.env.userSettings.chartSettings.indicatorsWidth;T[m]&&"undefined"!=typeof T[m][v][g.indicatorIndex2%T[m][v].length]?g.width=T[m][v][g.indicatorIndex2%T[m][v].length]||2:g.width=2,g.overlay?(g.chartArea=a.name,n.push(g)):(g.chartArea="ChartAreaI"+g.indicatorIndex,"undefined"==typeof l[g.indicatorIndex]?l[g.indicatorIndex]=[g]:l[g.indicatorIndex].push(g));break;case"Volume":g.chartType="Column",g.color=this.chartOptions.volumeStyle,g.isStartedFromZero=!0,g.chartArea=a.name,g.chartArea=s.name,h.push(g);break;default:continue}g.enableMerge=!0,g.index=p++,4===g.valuesPerPoint?(g.closeValueIndex=3,g.lowValueIndex=1):(g.closeValueIndex=0,g.lowValueIndex=0),g.highValueIndex=0}this.isComparison=o.length>1||this.chartOptions.percentMode;for(var i=0;i<t.ySeries.length;++i){var g=t.ySeries[i],S=g.color?g.color.replace(/rgba\((.+),[^,]+\)/,"rgb($1)"):"",A=$("<span/>",{class:"m-chart-legend-color"}).css({"background-color":S}).html("&nbsp;");A=A.add($("<span/>",{class:"m-chart-legend-name"}).css({color:S}).text(g.name));var w=$("<div/>").append(A).html();4===g.valuesPerPoint?(g.dotIndex=3,this.isComparison?g.labels=[[3,w]]:g.labels=[[2,w+"O:"],[0,"H:"],[1,"L:"],[3,"C:"]]):2==g.valuesPerPoint?g.labels=[[1,w+_t("2589","Мин:")],[0,_t("2590","Макс:")]]:g.labels=[[0,w]]}if(a.axisX.showLabels=!0,a.enabled=!0,a.xSeries=t.xSeries,a.ySeries=n,this.areas.push(a),r.axisX.showLabels=!0,r.enabled=0!==this.chartOptions.scrollerHeight,r.xSeries=t.xSeries,r.ySeries=o,r.enabled&&this.areas.push(r),!this.isComparison){if(s.enabled=!0,s.enabled){s.enabled=!1;for(var i=0;i<h.length;++i)if(h[i].enabled){s.enabled=!0;break}}s.enabled&&(s.axisX.showLabels=!1,s.xSeries=a.xSeries,s.ySeries=h,this.areas.push(s)),s.enabled="inside"===this.chartOptions.showVolume||"outside"===this.chartOptions.showVolume}for(var P in l)if(l.hasOwnProperty(P)){var _=new iChart.Charting.ChartArea({chart:this});_.axisX.showLabels=!1,_.enabled=!0,_.xSeries=a.xSeries,_.ySeries=l[P],_.name=_.ySeries[0].chartArea;var b=this;_.onClose=function(){b.clearIndicators(this)},this.areas.push(_)}this.createValueByPriceArea(),this.onCreateAreas.call(this,t,e);for(var i=0;i<this.areas.length;++i)this.areas[i].setMinMax();return this._setXLabelFormat(),t.xSeries.length},iChart.Charting.Chart.prototype.createValueByPriceArea=function(){var t=this,e=new iChart.Charting.ChartArea({chart:this,ignoreViewport:!0,name:"VolumeByPriceArea",onCalculateViewport:function(e){var i=function(t,e){return t.min+(t.max-t.min)*(t[t.min]-e)/(t[t.min]-t[t.max])},a=t.areas[0].viewport;return e.x.min=i(this.xSeries,a.y.max),e.x.max=i(this.xSeries,a.y.min),e.x.bounded.min=Math.max(this.xSeries.min,Math.floor(e.x.min)),e.x.bounded.max=Math.min(this.xSeries.max,Math.ceil(e.x.max)),e},parentName:"ChartArea1",showAxes:!1,showLabels:!1,showLegend:!1,showWatermark:!1});e.axisX.showLabels=!0,e.enabled=this.chartOptions.showVolumeByPrice,e.rotate=!0,e.ySeries=[{chartType:"Column",closeValueIndex:0,color:this.chartOptions.volumeStyle,enabled:!0,enableMerge:!1,formatProvider:{decimalPlaces:"2",decimalPrecision:null},highValueIndex:0,isStartedFromZero:!0,kind:"Other",lowValueIndex:0,name:"V(Price)",valuesPerPoint:1}],e.xSeries=[],e.ySeries[0].points=[],this.chartOptions.showVolumeByPrice&&this.updateVolumeByPrice();var i=$.grep(this.areas,function(t){return"VolumeByPriceArea"===t.name})[0];i&&e.enabled&&(i.enabled=!1),this.areas.push(e)},iChart.Charting.Chart.prototype.updateVolumeByPrice=function(){if(this.chartOptions.showVolumeByPrice){for(var t=0,e=this.areas[0].viewport.y.max,i=Math.floor(this.areas[0].viewport.x.min);i<=Math.ceil(this.areas[0].viewport.x.max);i++)this.areas[0]&&this.areas[0].ySeries[0]&&this.areas[0].ySeries[0].points[i]&&(t<this.areas[0].ySeries[0].points[i][0]&&(t=this.areas[0].ySeries[0].points[i][0]),e>this.areas[0].ySeries[0].points[i][1]&&(e=this.areas[0].ySeries[0].points[i][1]));for(var a=(t-e)/50,r={},i=Math.floor(this.areas[0].viewport.x.min);i<=Math.ceil(this.areas[0].viewport.x.max);i++)r[i]=0,"undefined"!=typeof this.areas[2].ySeries&&(this.areas[2].ySeries[0].points[i]&&this.areas[0].ySeries[0].points[i]&&this.areas[0].ySeries[0].points[i][0]-this.areas[0].ySeries[0].points[i][1]!=0?r[i]=this.areas[2].ySeries[0].points[i][0]/(this.areas[0].ySeries[0].points[i][0]-this.areas[0].ySeries[0].points[i][1])*a:this.areas[2].ySeries[0].points[i]&&this.areas[0].ySeries[0].points[i]&&this.areas[0].ySeries[0].points[i][0]-this.areas[0].ySeries[0].points[i][1]==0&&(r[i]=this.areas[2].ySeries[0].points[i][0]));for(var s=[],n=[],o=t;o>e;o-=a){s.push(o);for(var h=0,i=Math.floor(this.areas[0].viewport.x.min);i<=Math.ceil(this.areas[0].viewport.x.max);i++)if(this.areas[0].ySeries[0].points[i]){var l=this.areas[0].ySeries[0].points[i][0],c=this.areas[0].ySeries[0].points[i][1];(o>l&&o-a<l||o>c&&o-a<c||o<l&&o-a>c)&&(h+=r[i])}n.push([h])}var d=$.grep(this.areas,function(t){return"VolumeByPriceArea"===t.name})[0];d&&(d.enabled=!0,d.xSeries=s,d.ySeries[0].points=n,d.setMinMax(),this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}))}},iChart.Charting.Chart.prototype.positionVolumeByPriceArea=function(){var t=$.grep(this.areas,function(t){return"VolumeByPriceArea"===t.name})[0];if(t){var e=this.areas[0];t.axisX.paddingLeft=e.axisY.paddingTop,t.axisX.paddingRight=e.axisY.paddingBottom,t.axisX.pointPadding=0,t.axisY.paddingTop=0,t.axisY.paddingBottom=0,t.enabled=this.chartOptions.showVolumeByPrice,t.outerHeight=e.outerHeight,t.outerWidth=Math.round(e.outerWidth/5),t.offset.top=e.offset.top}},iChart.Charting.Chart.prototype._setXLabelFormat=function(){var t=this.areas[0];if(!(t.xSeries.min>t.xSeries.max)){new Date,new Date(1e3*t.xSeries[t.xSeries.min]);this.showTime()?this.dateFormat="HH:mm\r\nd MMM":this.dateFormat="d MMM\r\nyyyy"}},iChart.Charting.Chart.prototype._testForIntervalChange=function(t){if(this._dataSettings){var e=this.areas[0],i=this._dataSettings.start,a=this._dataSettings.end,r=e.xSeries[e.viewport.x.bounded.min],s=e.xSeries[e.viewport.x.bounded.max];this._dataSettings.start=r&&(e.viewport.x.bounded.min!==e.xSeries.min||this._dataStart)?new Date(1e3*r):null,this._dataSettings.end=s&&(e.viewport.x.bounded.max!==e.xSeries.max||this._dataEnd)?new Date(1e3*s):null,"undefined"!=typeof i&&(!this._dataSettings.start!=!i||!this._dataSettings.end!=!a||this._dataSettings.start&&this._dataSettings.start.getTime()!==i.getTime()||this._dataSettings.end&&this._dataSettings.end.getTime()!==a.getTime())&&(this.onDataSettingsChange.call(this,t),this.onIntervalChange.call(this,this._dataSettings.start,this._dataSettings.end))}},iChart.Charting.Chart.prototype._zoomInternal=function(t,e,i,a,r){if(!t){for(var s=0;s<this.areas.length;++s)this.areas[s].name===this.viewport.areaName&&(t=this.areas[s]);t||(t=this.areas[0])}if("Scroller"!==t.name){if(this.viewport.areaName!==t.name&&(this.viewport.y.min=null,this.viewport.y.max=null),this.viewport.areaName=t.name,"y"!==i&&(null===this.viewport.x.min&&(this.viewport.x.min=t.viewport.x.bounded.min),null===this.viewport.x.max&&(this.viewport.x.max=t.viewport.x.bounded.max),$.isNumeric(a)||(a=(this.viewport.x.min+this.viewport.x.max)/2),t.xSeries.min<t.xSeries.max&&this.viewport.x.min<this.viewport.x.max&&(e<0?e=Math.max(e,1-(t.xSeries.max-t.xSeries.min)/(.3*(this.viewport.x.max-this.viewport.x.min))):e>0&&(e=Math.min(e,1-(t.xSeries.max-t.xSeries.min)/(1e3*(this.viewport.x.max-this.viewport.x.min)))))),"x"!==i&&(null===this.viewport.y.min&&(this.viewport.y.min=t.viewport.y.min),null===this.viewport.y.max&&(this.viewport.y.max=t.viewport.y.max),$.isNumeric(r)||(r=(this.viewport.y.min+this.viewport.y.max)/2),t.ySeries.bounds.min<t.ySeries.bounds.max&&(e<0?e=Math.max(e,1-(t.ySeries.bounds.max-t.ySeries.bounds.min)/(.3*(this.viewport.y.max-this.viewport.y.min))):e>0&&(e=Math.min(e,1-(t.ySeries.bounds.max-t.ySeries.bounds.min)/(1e3*(this.viewport.y.max-this.viewport.y.min)))))),"y"!==i){var n=this.viewport.x.max-e*(this.viewport.x.max-a)-(this.viewport.x.min+e*(a-this.viewport.x.min));(this.chartOptions.maxZoom>0&&n>=this.chartOptions.maxZoom||e<0||0==this.chartOptions.maxZoom)&&(this.viewport.x.min+=e*(a-this.viewport.x.min))}"x"!==i&&(this.viewport.y.min+=e*(r-this.viewport.y.min),this.viewport.y.max-=e*(this.viewport.y.max-r))}else{this.viewport.areaName!==t.name&&(this.viewport.y.min=null,this.viewport.y.max=null),this.viewport.areaName=t.name,null===this.viewport.x.min&&(this.viewport.x.min=t.scrollerViewport.x.bounded.min),null===this.viewport.x.max&&(this.viewport.x.max=t.scrollerViewport.x.bounded.max);var o=(this.viewport.x.max-this.viewport.x.min)/10,h=e>0?1:-1,l=t.viewport.x.bounded.max-t.chart.chartOptions.futureAmount+5*(this.viewport.x.max-this.viewport.x.min)/10,c=t.viewport.x.bounded.min-5*(this.viewport.x.max-this.viewport.x.min)/10;(this.viewport.x.max<l||h==-1)&&(this.viewport.x.min>c||1==h)&&(this.viewport.x.min+=h*o,this.viewport.x.max+=h*o)}this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),this.loadMissingData()}}(),function(){"use strict";iChart.Charting.ChartArea=function(t){if(this.axisX={},this.axisX.paddingLeft=0,this.axisX.paddingRight=0,this.axisX.pointPadding=.5,this.axisY={},this.axisY.PaddingTop=0,this.axisY.PaddingBottom=0,this.chart=t.chart,this.ignoreViewport=!!t.ignoreViewport,this.innerHeight=0,this.innerWidth=0,this.innerOffset={},this.innerOffset.left=0,this.innerOffset.top=0,this.isLayer=!!t.parentName,this.isScroller=!!t.isScroller,this.margin={},this.margin.bottom=0,this.name=t.name,this.offset={},this.offset.left=0,this.offset.top=0,this.onCalculateViewport=t.onCalculateViewport||$.noop,this.outerHeight=0,this.outerWidth=0,this.padding={},this.padding.top=0,this.padding.right=0,this.padding.bottom=0,this.padding.left=0,this.parentName=t.parentName,this.rotate=!!t.rotate,this.scrollerViewport=null,this.showAxes="undefined"==typeof t.showAxes||!!t.showAxes,this.showLabels="undefined"==typeof t.showLabels||!!t.showLabels,this.showLegend="undefined"==typeof t.showLegend||!!t.showLegend,this.showWatermark="undefined"==typeof t.showWatermark||!!t.showWatermark,this.viewport={},this.viewport.x={},this.viewport.x.bounded={},this.viewport.y={},this.xSeries=null,this.ySeries=[],this.isScroller){$(this.chart.container).find("div.m-chart-scrollerOverlay").remove(),this.$scrollerOverlay=$("<div class='m-chart-scrollerOverlay'/>").css({position:"absolute","z-index":1}).appendTo(this.chart.container),this.$scrollerOverlayRight=$("<div class='js-scrollerOverlay m-chart-scrollerOverlayRight'/>").hide().css({}).appendTo(this.$scrollerOverlay),this.$scrollerOverlayCenter=$("<div/>").hide().css({position:"absolute","z-index":1}).appendTo(this.$scrollerOverlay),this.$scrollerOverlayCenterR=$("<div/>",{text:"|",class:"js-scrollerHandler m-chart-scrollerOverlayHandle"}).hide().css({}).appendTo(this.$scrollerOverlay),this.$scrollerOverlayCenterR.hover(function(){$(this).data("iChart-hover",!0)},function(){$(this).removeData("iChart-hover")}).attr("unselectable","on").css("user-select","none").on("selectstart",!1),this.$scrollerOverlayCenterL=$("<div />",{text:"|",class:"js-scrollerHandler m-chart-scrollerOverlayHandle"}).hide().css({}).appendTo(this.$scrollerOverlay),this.$scrollerOverlayCenterL.hover(function(){$(this).data("iChart-hover",!0)},function(){$(this).removeData("iChart-hover")}).attr("unselectable","on").css("user-select","none").on("selectstart",!1),this.$scrollerOverlayLeft=$("<div class='js-scrollerOverlay m-chart-scrollerOverlayLeft'/>").hide().css({}).appendTo(this.$scrollerOverlay),$(this.chart.container).find("div.m-chart-scrollforward").remove();var e=this;this.$scrollForward=$("<div class='m-chart-scrollforward md-btn md-btn-primary' style='min-width: 40px; width:40px; background: #777777; transition: all 0ms'; ><span class='uk-icon-step-forward'></span></div>").hide().appendTo(this.$scrollerOverlay).click(function(){e.chart.env.scrollForward()})}},iChart.Charting.ChartArea.prototype.calculateInnerDimensions=function(t){if(this.isScroller?(this.scrollerViewport=this._calculateViewport(t),this.viewport=this._calculateViewport()):this.viewport=this._calculateViewport(t),this.viewport){this.innerOffset.left=this.offset.left+this.padding.left,this.innerOffset.top=this.offset.top+this.padding.top,this.innerWidth=this.outerWidth-this.padding.left-this.padding.right,this.innerHeight=this.outerHeight-this.padding.top-this.padding.bottom,this.rotate?(this.axisX.length=this.innerHeight,this.axisY.length=this.innerWidth):(this.axisX.length=this.innerWidth,this.axisY.length=this.innerHeight);var e=this.axisX.paddingLeft*(this.viewport.x.max-this.viewport.x.min+2*this.axisX.pointPadding)/(this.axisX.length-2*this.axisX.paddingLeft),i=this.axisX.paddingRight*(this.viewport.x.max-this.viewport.x.min+2*this.axisX.pointPadding)/(this.axisX.length-2*this.axisX.paddingRight);this.axisX.min=this.viewport.x.min-this.axisX.pointPadding-e,this.axisX.max=this.viewport.x.max+this.axisX.pointPadding+i,this.axisX.pointWidth=Math.min(Math.max(0,Math.floor(.4*this.axisX.length/(this.viewport.x.max-this.viewport.x.min+1))),50);var a=this.axisY.paddingTop*(this.viewport.y.max-this.viewport.y.min)/(this.axisY.length-2*this.axisY.paddingTop),r=this.axisY.paddingBottom*(this.viewport.y.max-this.viewport.y.min)/(this.axisY.length-2*this.axisY.paddingBottom);if(this.axisY.min=this.viewport.y.min-r,this.axisY.max=this.viewport.y.max+a,this.axisX.scale=this.axisX.length/(this.axisX.max-this.axisX.min),this.axisY.scale=this.axisY.min===this.axisY.max?0:this.axisY.length/(this.axisY.max-this.axisY.min),this.axisY.zeroPosition=Math.round(this.getYPosition(0,!1)),this.isScroller){var s=Math.round(this.getXPositionByIndex(this.scrollerViewport.x.bounded.min)),n=Math.round(this.getXPositionByIndex(this.scrollerViewport.x.bounded.max));this.$scrollerOverlayLeft.show().width(s).height(this.innerHeight).css({left:this.innerOffset.left+"px",top:this.innerOffset.top+"px"}),this.$scrollerOverlayCenter.show().width(n-s).height(this.innerHeight).css({left:this.innerOffset.left+s+"px",top:this.innerOffset.top+"px"}),this.$scrollerOverlayCenterL.show().css({left:this.innerOffset.left+s-5+"px",top:this.innerOffset.top+this.innerHeight/2-11+"px"}),this.$scrollerOverlayCenterR.show().css({left:this.innerOffset.left+n-5+"px",top:this.innerOffset.top+this.innerHeight/2-11+"px"}),this.$scrollerOverlayRight.show().width(this.innerWidth-n).height(this.innerHeight).css({left:this.innerOffset.left+n+"px",top:this.innerOffset.top+"px"}),this.scrollerViewport.x.bounded.max<this.xSeries.length-1-this.chart.chartOptions.futureAmount?(this.$scrollForward.width(this.innerHeight),this.$scrollForward.fadeIn().css({width:"40px","min-width":"40px",left:this.innerWidth+this.innerOffset.left-this.$scrollForward.width()-10+"px",
top:this.innerOffset.top+"px"})):this.$scrollForward.fadeOut()}}},iChart.Charting.ChartArea.prototype.dispose=function(){this.isScroller&&(this.$scrollerOverlayLeft.remove(),delete this.$scrollerOverlayLeft,this.$scrollerOverlayCenter.remove(),delete this.$scrollerOverlayCenter,this.$scrollerOverlayCenterL.remove(),delete this.$scrollerOverlayCenterL,this.$scrollerOverlayCenterR.remove(),delete this.$scrollerOverlayCenterR,this.$scrollerOverlayRight.remove(),delete this.$scrollerOverlayRight),this.$closeButton&&(this.$closeButton.remove(),delete this.$closeButton)},iChart.Charting.ChartArea.prototype.getXIndex=function(t){return this.axisX.min+t/this.axisX.scale},iChart.Charting.ChartArea.prototype.getXPositionByIndex=function(t){return this.axisX.scale*(t-this.axisX.min)},iChart.Charting.ChartArea.prototype.getXIndexByValue=function(t){if(!$.isNumeric(t))return NaN;if(this.xSeries.min>this.xSeries.max)return NaN;if(t<this.xSeries[this.xSeries.min]||t>this.xSeries[this.xSeries.max])return t>this.xSeries[this.xSeries.max]?this.xSeries.max+(t-this.xSeries[this.xSeries.max])/(this.xSeries[this.xSeries.max]-this.xSeries[this.xSeries.max-1]):NaN;var e=iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo(this.xSeries,t);return e===-1?NaN:(e!==this.xSeries.min&&(e-=(this.xSeries[e]-t)/(this.xSeries[e]-this.xSeries[e-1])),e)},iChart.Charting.ChartArea.prototype.getXIndexByValue2=function(t){if(!$.isNumeric(t))return NaN;if(this.xSeries.min>this.xSeries.max)return NaN;if(t<this.xSeries[this.xSeries.min])return this.xSeries.min;if(t>this.xSeries[this.xSeries.max])return this.xSeries.max;var e=iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo(this.xSeries,t);return e===-1?NaN:(e!==this.xSeries.min&&(e-=(this.xSeries[e]-t)/(this.xSeries[e]-this.xSeries[e-1])),e)},iChart.Charting.ChartArea.prototype.getXPositionByValue=function(t){var e=this.getXIndexByValue(t);return isNaN(e)?NaN:this.getXPositionByIndex(e)},iChart.Charting.ChartArea.prototype.getXValue=function(t){var e=this.getXIndex(t),i=Math.floor(e),a=Math.ceil(e);if(!(a<this.xSeries.min))return i<this.xSeries.min?this.xSeries[a]:a>this.xSeries.max?this.xSeries[this.xSeries.max]+(e-this.xSeries.max)*(this.xSeries[this.xSeries.max]-this.xSeries[this.xSeries.max-1]):i===a?this.xSeries[i]:this.xSeries[i]+(e-i)*(this.xSeries[a]-this.xSeries[i])},iChart.Charting.ChartArea.prototype.getYMinMax=function(t,e){var i={};i.isStartedFromZero=!1,i.min=null,i.max=null;for(var a=0;a<this.ySeries.length;++a){var r=this.ySeries[a],s=r.points;if(i.isStartedFromZero=i.isStartedFromZero||r.isStartedFromZero,this.chart.isComparison&&"TA_LIB"!=r.kind){r.multiplier=0;for(var n=t;n<=e;++n){var o=s[n];if("undefined"!=typeof o&&null!==o){var h=o[r.closeValueIndex];null!==h&&(r.multiplier?h=r.multiplier*h-100:(r.multiplier=100/h,h=0),null===i.min?i.min=h:i.min=Math.min(i.min,h),null===i.max?i.max=h:i.max=Math.max(i.max,h))}}}else for(var n=t;n<=e;++n){var o=s[n];null!==o&&"undefined"!=typeof o&&(null===i.min?i.min=o[r.lowValueIndex]:null!==o[r.lowValueIndex]&&(i.min=Math.min(i.min,o[r.lowValueIndex])),null===i.max?i.max=o[r.highValueIndex]:i.max=Math.max(i.max,o[r.highValueIndex]))}}if("ChartArea1"==this.name)for(var l=this.chart.overlay.history,a=0;a<l.length;a++){for(var c=!1,n=0;n<l[a].points.length;n++)if(l[a].points[n].x>=1e3*this.xSeries[t]&&l[a].points[n].x<=1e3*this.xSeries[e]||l[a].positionAbsolute)c=!0;else if(l[a].points[n].x<this.xSeries[0]||l[a].points[n].x>this.xSeries[this.xSeries.length-1]){c=!1;break}if(c)for(var n=0;n<l[a].points.length;n++)if(l[a].points[n].y){if(this.chart.isComparison&&"TA_LIB"!=r.kind&&this.ySeries[0].points.length)var d=100*(l[a].points[n].y/this.ySeries[0].points[t][3]-1);else var d=l[a].points[n].y;i.max=Math.max(i.max,d),i.min=Math.min(i.min,d)}}var p=function(t){t.isStartedFromZero&&(null!==t.min&&t.min>0?t.min=0:null!==t.max&&t.max<0&&(t.max=0))};return p(i),i},iChart.Charting.ChartArea.prototype.getYPosition=function(t){return 0===this.axisY.scale?.5*this.axisY.length:this.axisY.scale*(this.axisY.max-t)},iChart.Charting.ChartArea.prototype.getYValue=function(t){return 0===this.axisY.scale?this.axisY.max:this.axisY.max-t/this.axisY.scale},iChart.Charting.ChartArea.prototype.setMinMax=function(){this.xSeries.min=0,this.xSeries.max=this.xSeries.length-1,this.ySeries.bounds=this.getYMinMax(this.xSeries.min,this.xSeries.max)},iChart.Charting.ChartArea.prototype.updateCloseButton=function(){this.onClose&&(this.$closeButton||(this.$closeButton=$("<button/>",{class:"m-chart-area-close",text:"×",title:"Скрыть"}).appendTo(this.chart.container),this.$closeButton.on("click",$.proxy(this.onClose,this))),this.$closeButton.css({top:this.offset.top+"px"}))},iChart.Charting.ChartArea.prototype._calculateViewport=function(t){if(0===this.xSeries.length)return null;var e={};if(e.x={},e.x.bounded={},e.y={},this.ignoreViewport||!t)e.x.min=this.xSeries.min,e.x.bounded.min=this.xSeries.min;else if(null===t.x.min){var i=this.chart._dataSettings.start,a=i?iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo(this.xSeries,Math.round(i.getTime()/1e3)):0;a===-1&&(console.warn("Start date/time '"+i.toString()+"' is outside the bounds of the data."),a=0),e.x.min=a,e.x.bounded.min=a}else e.x.min=t.x.min,e.x.bounded.min=Math.max(this.xSeries.min,Math.floor(t.x.min));if(this.ignoreViewport||!t)e.x.max=this.xSeries.max,e.x.bounded.max=this.xSeries.max;else if(null===t.x.max)if(this.chart._dataSettings.end){var r=this.chart._dataSettings.end,s=iChart.Charting.indexOfLastElementLessThanOrEqualTo(this.xSeries,Math.round(r.getTime()/1e3));s===-1&&(console.error("End date/time '"+r.toString()+"' is outside the bounds of the data."),s=this.xSeries.length-1),e.x.max=s,e.x.bounded.max=s}else e.x.max=this.xSeries.max,e.x.bounded.max=this.xSeries.max;else e.x.max=t.x.max,e.x.bounded.max=Math.min(this.xSeries.max,Math.ceil(t.x.max));if(this.ignoreViewport||!t)e.y.min=this.ySeries.bounds.min,e.y.max=this.ySeries.bounds.max;else if(e.y.min=t.y.min,e.y.max=t.y.max,null===e.y.min||null===e.y.max)if(e.x.bounded.min===this.xSeries.min&&e.x.bounded.max===this.xSeries.max)null===t.y.min&&(e.y.min=this.ySeries.bounds.min),null===t.y.max&&(e.y.max=this.ySeries.bounds.max);else{var n=this.getYMinMax(e.x.bounded.min,e.x.bounded.max);null===t.y.min&&(e.y.min=n.min),null===t.y.max&&(e.y.max=n.max)}return this.ySeries.bounds.isStartedFromZero&&(null!==e.y.min&&e.y.min>0?null===t.y.min&&(e.y.min=0):null!==e.y.max&&e.y.max<0&&null===t.y.max&&(e.y.max=0)),e=this.onCalculateViewport.call(this,e)||e}}(),function(){"use strict";iChart.Charting.ChartRenderer=function(t){this.chart=t},iChart.Charting.ChartRenderer.prototype.formatDateTime=function(t){var e=new Date(1e3*t);return iChart.formatDateTime(e,this.chart.dateFormat)},iChart.Charting.ChartRenderer.prototype.formatNumber=function(t,e){var i=iChart.formatNumber(t,e);return this.chart.isComparison&&(t>0&&(i="+"+i),i+="%"),i},iChart.Charting.ChartRenderer.prototype.renderArea=function(t,e){if(t.enabled){if(e.save(),e.translate(t.innerOffset.left,t.innerOffset.top),t.rotate&&e.transform(0,1,-1,0,t.innerWidth,0),t.showAxes&&this.chart.chartOptions.showAxes&&this.renderAxes(t,e),"ChartArea1"==t.name&&(e.fillStyle=this.chart.chartOptions.watermarkColor,e.font=this.chart.chartOptions.watermarkFont,e.textAlign="left",e.textBaseline="bottom",this.chart.chartOptions.watermarkShow)){var i=(t.innerWidth-e.measureText(this.chart.chartOptions.watermarkText).width)/2;e.fillText(this.chart.chartOptions.watermarkText,i,t.innerHeight/2-5),e.font=this.chart.chartOptions.watermarkSubFont,i=(t.innerWidth-e.measureText(this.chart.chartOptions.watermarkSubText).width)/2,e.fillText(this.chart.chartOptions.watermarkSubText,i,t.innerHeight/2+45)}if(t.title&&(e.fillStyle=this.chart.chartOptions.watermarkColor,e.font=this.chart.chartOptions.watermarkFont,e.textAlign="left",e.textBaseline="bottom",this.chart.chartOptions.watermarkShow)){var i=(t.innerWidth-e.measureText(t.title).width)/2;e.fillText(t.title,i,t.innerHeight/2-5)}0!==t.xSeries.length&&0!==t.ySeries.length&&(t.showLabels&&(this.renderXLabels(t,e),this.renderYLabels(t,e)),this.renderSeriesCollection(t,e),"ChartArea1"==t.name&&t.chart.chartOptions.updateInterval&&this.renderCurrentLable(t,e)),e.restore()}},iChart.Charting.ChartRenderer.prototype.renderCurrentLable=function(t,e){var i,a,r=t.innerWidth,s=!1,n=!1;if(this.chart.isComparison){var o=iChart.Charting.getNearestNotNullIndex(t.ySeries[0].points,t.viewport.x.bounded.min),h=iChart.Charting.getNearestNotNullIndex(t.ySeries[0].points,t.ySeries[0].points.length-t.chart.chartOptions.futureAmount-1);i=t.ySeries[0].points[h]&&t.ySeries[0].points[o]?100*(t.ySeries[0].points[h][3]/t.ySeries[0].points[o][3]-1):0}else a=t.ySeries[0].points[t.ySeries[0].points.length-t.chart.chartOptions.futureAmount-1],i=a&&a[3]?a[3]:0,a&&a[4]&&a[5]&&(n=Math.round(t.getYPosition(a[4],!1)),s=Math.round(t.getYPosition(a[5],!1)));var l=Math.round(t.getYPosition(i,!1)),c=this.formatNumber(i,{decimalPrecision:this.chart.labelPrecision,scale:0}),d=parseFloat(c.replace(/ /g,""));if(null!=this.labelValue&&d<this.labelValue){var p="#f44336";this.labelColor="#f44336"}else if(null!=this.labelValue&&d>this.labelValue){var p="#7cb342";this.labelColor="#7cb342"}else if(this.labelColor)var p=this.labelColor;else var p="#333";this.labelValue=d,s&&n?this.drawLable(e,p,"#FFFFFF",r,l,c,{bidY:s,offerY:n}):this.drawLable(e,p,"#FFFFFF",r,l,c)},iChart.Charting.ChartRenderer.prototype.drawLable=function(t,e,i,a,r,s,n){e=e?e:"#333333",i=i?i:"#FFFFFF",t.save(),t.font="normal 11px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=e,t.fillRect(a+8,r-8,t.measureText(s).width+10,15),t.beginPath(),t.moveTo(a+8,r-8),t.lineTo(a+8,r+7),t.lineTo(a,r),t.lineTo(a+8,r-8),t.lineTo(a+8,r+7),t.closePath(),t.fill(),t.fillStyle=i,t.fillText(s,a+8,r),n&&(t.beginPath(),t.fillStyle="#f44336",t.moveTo(a-4,n.bidY-4),t.lineTo(a-4,n.bidY+3),t.lineTo(a,n.bidY),t.lineTo(a-4,n.bidY-4),t.lineTo(a-4,n.bidY+3),t.fill(),t.closePath(),t.beginPath(),t.fillStyle="#7cb342",t.moveTo(a-4,n.offerY-4),t.lineTo(a-4,n.offerY+3),t.lineTo(a,n.offerY),t.lineTo(a-4,n.offerY-4),t.lineTo(a-4,n.offerY+3),t.fill(),t.closePath()),t.restore()},iChart.Charting.ChartRenderer.prototype.renderAxes=function(t,e){e.save(),e.translate(.5,.5),e.strokeStyle=this.chart.chartOptions.axisColor,e.beginPath(),e.moveTo(0,0),e.lineTo(t.axisX.length,0),e.lineTo(t.axisX.length,t.axisY.length),e.lineTo(0,t.axisY.length),e.closePath(),e.stroke(),e.restore()},iChart.Charting.ChartRenderer.prototype.renderChart=function(t){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=this.chart.chartOptions.backgroundColor,t.fillRect(0,0,t.canvas.width,t.canvas.height);for(var e=0;e<this.chart.areas.length;++e){this.chart.areas[e];this.renderArea(this.chart.areas[e],t)}},iChart.Charting.ChartRenderer.prototype.renderLegends=function(t){for(var e=0;e<this.chart.areas.length;++e){var i=this.chart.areas[e];if(i.showLegend&&!i.rotate&&!(i.viewport.x.bounded.min>i.viewport.x.bounded.max)){t.save(),t.translate(i.innerOffset.left,i.innerOffset.top-3),t.fillStyle="#000000",t.font="11px Tahoma",t.textAlign="left",t.textBaseline="bottom";var a=new Date(1e3*i.xSeries[i.viewport.x.bounded.max]),r=iChart.formatDateTime(a,this.chart.showTime()?"dd.MM.yyyy HH:mm":"dd.MM.yyyy");t.fillText(r,0,0);var s=7,n=t.measureText(r);t.translate(n.width+s,0);for(var o=i.ySeries.slice(0),h=0;h<this.chart.areas.length;++h)this.chart.areas[h].parentName!==i.name||this.chart.areas[h].rotate||(o=o.concat(this.chart.areas[h].ySeries));for(var h=0;h<o.length;++h){var l=o[h];t.fillStyle=l.color.replace(/rgba\((.+),[^,]+\)/,"rgb($1)"),t.beginPath(),t.arc(6,-6,6,0,2*Math.PI,!0),t.closePath(),t.fill(),t.translate(12+s,0),t.font="bold 11px Tahoma",t.fillText(l.name,0,0),n=t.measureText(l.name),t.translate(n.width+s,0);var c;c=4===l.valuesPerPoint?[[2,"O: "],[0,"H: "],[1,"L: "],[3,"C: "]]:2==l.valuesPerPoint?[[1,"Мин: "],[0,"Макс: "]]:[[0,""]],t.fillStyle="#000000",t.font="11px Tahoma";for(var d=0;d<c.length;++d){var p=c[d][0],u=c[d][1],g=l.points[i.viewport.x.bounded.max];g&&(u+=iChart.formatNumber(g[p],l.formatProvider),t.fillText(u,0,0),n=t.measureText(u),t.translate(n.width+s,0))}}t.restore()}}},iChart.Charting.ChartRenderer.prototype.renderPoint=function(t,e,i,a,r){var s=e.points[i];if(s)switch(e.chartType){case"Candlestick":case"Stock":if(!(s[0]||s[1]||s[2]||s[3]))return;var n=Math.round(t.getXPositionByIndex(i)),o=Math.round(t.getYPosition(s[0],e.inline)),h=Math.round(t.getYPosition(s[1],e.inline));if(0===t.axisX.pointWidth){a.moveTo(n,h),a.lineTo(n,o);break}var l=Math.round(t.getYPosition(s[2],e.inline)),c=Math.round(t.getYPosition(s[3],e.inline));if("Candlestick"===e.chartType){a.save();var d,p;s[2]<s[3]?(d=l,p=c,t.chart.chartOptions.candleUp&&(a.fillStyle=t.chart.chartOptions.candleUp),t.chart.chartOptions.candleBorder?a.strokeStyle=t.chart.chartOptions.candleBorderUp:a.strokeStyle=a.fillStyle,a.fillRect(n-t.axisX.pointWidth,p,2*t.axisX.pointWidth,d-p)):(d=c,p=l,t.chart.chartOptions.candleDown&&(a.fillStyle=t.chart.chartOptions.candleDown),a.fillRect(n-t.axisX.pointWidth,p,2*t.axisX.pointWidth,d-p),t.chart.chartOptions.candleBorder?a.strokeStyle=t.chart.chartOptions.candleBorderDown:a.strokeStyle=a.fillStyle),a.strokeRect(n-t.axisX.pointWidth,p,2*t.axisX.pointWidth,d-p),a.restore(),t.chart.chartOptions.candleWick&&(a.strokeStyle=t.chart.chartOptions.candleWickStyle,a.moveTo(n,o),a.lineTo(n,p),a.moveTo(n,d),a.lineTo(n,h))}else s[2]<s[3]?t.chart.chartOptions.stockUp?a.strokeStyle=t.chart.chartOptions.stockUp:e.upStyle&&(a.strokeStyle=e.color):t.chart.chartOptions.stockDown?a.strokeStyle=t.chart.chartOptions.stockDown:e.upStyle&&(a.strokeStyle=e.color),t.chart.chartOptions.stockWidth&&(a.lineWidth=t.chart.chartOptions.stockWidth),a.beginPath(),a.moveTo(n,h),a.lineTo(n,o),a.moveTo(n,l),a.lineTo(n-t.axisX.pointWidth,l),a.moveTo(n,c),a.lineTo(n+t.axisX.pointWidth,c),a.stroke();break;case"Column":if(s[e.closeValueIndex]){var n=Math.round(t.getXPositionByIndex(i)),c=Math.round(t.getYPosition(s[e.closeValueIndex],e.inline));if(0===t.axisX.pointWidth){a.moveTo(n,t.axisY.zeroPosition),a.lineTo(n,c);break}a.fillRect(n-t.axisX.pointWidth,Math.min(t.axisY.zeroPosition,c),2*t.axisX.pointWidth,Math.abs(c-t.axisY.zeroPosition)),a.strokeRect(n-t.axisX.pointWidth,Math.min(t.axisY.zeroPosition,c),2*t.axisX.pointWidth,Math.abs(c-t.axisY.zeroPosition))}break;case"Area":var n=t.getXPositionByIndex(i),u=s[e.closeValueIndex];if(t.chart.chartOptions.areaLineColor&&(a.strokeStyle=t.chart.chartOptions.areaLineColor),null!==u){this.chart.isComparison&&"TA_LIB"!=e.kind&&(r.multiplier?u=u*r.multiplier-100:(r.multiplier=100/u,u=0));var c=t.getYPosition(u,e.inline);r.lineStarted?a.lineTo(n,c):(r.lineStarted=!0,a.moveTo(n,c))}break;case"Line":var n=t.getXPositionByIndex(i),u=s[e.closeValueIndex];if(null!==u){this.chart.isComparison&&"TA_LIB"!=e.kind&&(r.multiplier?u=u*r.multiplier-100:(r.multiplier=100/u,u=0));var c=t.getYPosition(u,e.inline);r.lineStarted?a.lineTo(n,c):(r.lineStarted=!0,a.moveTo(n,c))}break;case"Point":var n=Math.round(t.getXPositionByIndex(i)),c=Math.round(t.getYPosition(s[e.closeValueIndex],e.inline));a.beginPath(),a.arc(n,c,2.5,0,2*Math.PI,!0),a.closePath(),a.fill();break;default:throw new Error("Chart type '"+e.chartType+"' is invalid.")}},iChart.Charting.ChartRenderer.prototype.renderSeries=function(t,e,i,a){if(!(t.viewport.x.bounded.min>t.viewport.x.bounded.max)){if("HLOC"===e.kind&&(this.chart.isComparison?e.chartType="Line":t.isScroller?e.chartType="Area":e.chartType=this.chart.chartOptions.chartType),i.fillStyle=e.color,i.strokeStyle=e.color,"HLOC"===e.kind){if("Line"===e.chartType){i.lineWidth=this.chart.chartOptions.lineWidth;var r=$.extend([],this.chart.chartOptions.seriesColors);r.splice(0,0,this.chart.chartOptions.lineColor),i.fillStyle=i.strokeStyle=r[a%r.length]}else e.width?i.lineWidth=e.width:i.lineWidth=1;"Column"===e.chartType&&(i.fillStyle=t.chart.chartOptions.volumeStyle,i.strokeStyle=t.chart.chartOptions.volumeStyle)}else"Volume"===e.kind?"Column"===e.chartType&&(i.fillStyle=t.chart.chartOptions.volumeStyle,i.strokeStyle=t.chart.chartOptions.volumeStyle):e.width&&"Column"!==e.chartType?i.lineWidth=e.width:"Area"===e.chartType||"Line"===e.chartType?i.lineWidth=2:i.lineWidth=1;var s="Area"===e.chartType||"Candlestick"===e.chartType||"Column"===e.chartType&&0===t.axisX.pointWidth||"Line"===e.chartType||"Stock"===e.chartType;s&&i.beginPath();for(var n={},o=t.viewport.x.bounded.min;o<=t.viewport.x.bounded.max;++o)this.renderPoint(t,e,o,i,n);s&&i.stroke(),"Area"===e.chartType&&(i.fillStyle=this.chart.chartOptions.areaColor,i.lineTo(Math.round(t.getXPositionByIndex(t.viewport.x.max-this.chart.chartOptions.futureAmount)),Math.round(t.getYPosition(t.viewport.y.min))),i.lineTo(Math.round(t.getXPositionByIndex(t.viewport.x.min)),Math.round(t.getYPosition(t.viewport.y.min))),i.closePath(),i.fill())}},iChart.Charting.ChartRenderer.prototype.renderSeriesCollection=function(t,e){e.save(),e.translate(.5,.5),e.beginPath(),e.moveTo(1,1),e.lineTo(1,t.axisY.length-1),e.lineTo(t.axisX.length-1,t.axisY.length-1),e.lineTo(t.axisX.length-1,1),e.closePath(),e.clip();for(var i=0;i<t.ySeries.length;++i)this.renderSeries(t,t.ySeries[i],e,i);e.restore()},iChart.Charting.ChartRenderer.prototype.renderXLabels=function(t,e){e.save(),e.translate(.5,t.axisY.length),e.fillStyle=this.chart.chartOptions.labelColor,e.font=this.chart.chartOptions.labelFont,e.textAlign="center",e.textBaseline="bottom";for(var i,a=Math.max(1,Math.floor((t.axisX.max-t.axisX.min+1)/(t.axisX.length/75))),r=t.xSeries.min+Math.ceil((t.axisX.min-t.xSeries.min)/a)*a;r<=Math.floor(t.axisX.max);r+=a){var s=t.xSeries[r];if("undefined"!=typeof s){var n=this.formatDateTime(s),o=Math.round(t.getXPositionByIndex(r));if(this.chart.chartOptions.showLabels){this.chart.chartOptions.showAxes&&(e.strokeStyle=this.chart.chartOptions.axisColor,e.beginPath(),e.moveTo(o,0),e.lineTo(o,5),e.stroke());var h=n.split("\r\n");2===h.length&&(h[1]===i?h.length=1:i=h[1]);for(var l=0;l<h.length;++l)e.fillText(h[l],o,15+11*l)}if(e.strokeStyle=this.chart.chartOptions.gridColor,e.beginPath(),"dashed"===this.chart.chartOptions.gridStyle)for(var c=-4;c>=-t.axisY.length;c-=4)e.moveTo(o,c),e.lineTo(o,c+3);else"solid"===this.chart.chartOptions.gridStyle&&(e.moveTo(o,0),e.lineTo(o,-t.axisY.length));e.stroke()}}e.restore()},iChart.Charting.ChartRenderer.prototype.renderYLabel=function(t,e,i,a){var r=this.formatNumber(e,{decimalPrecision:this.chart.labelPrecision,scale:i}),s=Math.round(t.getYPosition(e,!1));if(this.chart.chartOptions.showAxes&&(a.strokeStyle=this.chart.chartOptions.axisColor,a.beginPath(),a.moveTo(0,s),a.lineTo(5,s),a.stroke()),this.chart.chartOptions.showLabels&&(a.fillStyle=this.chart.chartOptions.labelColor,this.chart.chartOptions.yLabelsOutside?a.fillText(r,8,s):a.fillText(r,10*-Math.ceil(a.measureText(r).width/10),s-5)),a.beginPath(),0===e)a.strokeStyle=this.chart.chartOptions.axisColor,a.moveTo(0,s),a.lineTo(-t.axisX.length,s);else if(a.strokeStyle=this.chart.chartOptions.gridColor,"dashed"===this.chart.chartOptions.gridStyle)for(var n=-4;n>=-t.axisX.length;n-=4)a.moveTo(n,s),a.lineTo(n+3,s);else"solid"===this.chart.chartOptions.gridStyle&&(a.moveTo(0,s),a.lineTo(-t.axisX.length,s));a.stroke()},iChart.Charting.ChartRenderer.prototype.renderYLabels=function(t,e){if(e.save(),e.translate(t.axisX.length,.5),e.font=this.chart.chartOptions.labelFont,e.textAlign="left",e.textBaseline="middle",this.chart.chartOptions.yLabelsOutside)var i=(t.axisY.max-t.axisY.min)/(t.axisY.length/20);else var i=(t.axisY.max-t.axisY.min)/(t.axisY.length/(t.axisY.length/4));if(i>0){for(var a=0;i<1;)--a,i*=10;for(;i>=10;)++a,i/=10;for(var r=[1,1.5,2,2.5,3,4,5,7.5],s=0;i>r[s]&&s<r.length;)++s;i=(s===r.length?10:r[s])*Math.pow(10,a)}var n=0,o=Math.max(Math.abs(t.axisY.min),Math.abs(t.axisY.max));o>=1e7&&(n=Math.floor(Math.log(o)/Math.log(1e3)));var h=i/o;(!$.isNumeric(h)||h<1e-4)&&(i=parseFloat((o/Math.pow(10,this.chart.labelPrecision-1)).toPrecision(1)));var l=!1,c=Math.floor(t.axisY.max/i)*i;if($.isNumeric(c))for(;c>=t.axisY.min;)this.renderYLabel(t,c,n,e),c-=i,l=!0;l||this.renderYLabel(t,(t.axisY.max+t.axisY.min)/2,n,e),e.restore()}}(),function(){"use strict";iChart.Charting.ChartSelection=function(t){this.$container=$(t),this.$selection=$("<div/>",{class:"m-chart-selection"}).appendTo(this.$container),this.$container.off("mouseup.selection").off("mousedown.selection").off("mousemove.selection"),$(this.$container).on("mouseup.selection",this,function(t){t.data.disabled||t.data.selection&&(t.data.selection=!1,t.data.$selection.hide(),t.data.recalculateContainerPosition(),t.data.x2=t.pageX-t.data.containerOffset.left,t.data.y2=t.pageY-t.data.containerOffset.top,t.data.x2>=0&&t.data.x2<=t.data.containerWidth&&t.data.y2>=0&&t.data.y2<=t.data.containerHeight&&t.data.moveend&&t.data.moveend(t.data))}),this.$container.on("mousedown.selection",this,function(t){t.data.disabled||1!=t.which||(t.data.selection=!0,t.data.recalculateContainerPosition(),t.data.x1=t.pageX-t.data.containerOffset.left,t.data.y1=t.pageY-t.data.containerOffset.top,t.data.movestart&&t.data.movestart(t.data))}),this.$container.on("mousemove.selection",this,function(t){if(!t.data.disabled&&t.data.selection){var e=t.pageX,i=t.pageY;"undefined"==typeof e&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop);var a=Math.round(e-t.data.containerOffset.left),r=Math.round(i-t.data.containerOffset.top);if((t.data.x2!==a||t.data.y2!==r)&&(t.data.x2=a,t.data.y2=r,t.data.x2>=0&&t.data.x2<=t.data.containerWidth&&t.data.y2>=0&&t.data.y2<=t.data.containerHeight)){var s=!0;t.data.move&&(s=t.data.move(t.data)),s&&t.data.$selection.css({display:"",left:self.x1<self.x2?self.x1:self.x2,top:self.y1<self.y2?self.y1:self.y2,width:self.x1<self.x2?self.x2-self.x1:self.x1-self.x2,height:self.y1<self.y2?self.y2-self.y1:self.y1-self.y2})}}})},iChart.Charting.ChartSelection.prototype.disabled=!1,iChart.Charting.ChartSelection.prototype.movestart=null,iChart.Charting.ChartSelection.prototype.move=null,iChart.Charting.ChartSelection.prototype.moveend=null,iChart.Charting.ChartSelection.prototype.selection=!1,iChart.Charting.ChartSelection.prototype.x1=null,iChart.Charting.ChartSelection.prototype.y1=null,iChart.Charting.ChartSelection.prototype.x2=null,iChart.Charting.ChartSelection.prototype.y2=null,iChart.Charting.ChartSelection.prototype.shiftAnchor=function(t,e){null!==this.anchorX&&t&&(this.anchorX+=t),null!==this.anchorY&&e&&(this.anchorY+=e)},iChart.Charting.ChartSelection.prototype.setAnchor=function(t,e){this.anchorX=t,this.anchorY=e},iChart.Charting.ChartSelection.prototype.disable=function(){this.disabled=!0,this.selection=!1,this.x1=null,this.y1=null,this.x2=null,this.y2=null},iChart.Charting.ChartSelection.prototype.enable=function(){this.disabled=!1,this.selection=!1,this.x1=null,this.y1=null,this.x2=null,this.y2=null},iChart.Charting.ChartSelection.prototype.recalculateContainerPosition=function(){this.containerOffset=this.$container.offset(),this.containerWidth=this.$container.width(),this.containerHeight=this.$container.height()}}(),function(){"use strict";iChart.Charting.ChartTouches=function(t){this.chart=t,this.$container=$(t.container);var e=this;this.$container.hammer({recognizers:[[Hammer.Pan],[Hammer.Pinch,{enable:!0}]]}).on("pinchstart pinchmove pinchend panstart panmove panend",function(t){if("touch"===t.gesture.pointerType){var i=e.chart.areas[0],a=e.$container.offset();switch(t.type){case"panstart":var r=t.gesture.pointers[0].pageX-t.gesture.deltaX-a.left;e.startTouchIndexes.push(i.getXIndex(r)),e.lastGesture=t.gesture;break;case"panend":e.startTouchIndexes=[],e.lastGesture=null;break;case"panmove":t.gesture.pointers[0].pageX-a.left;null===e.chart.viewport.x.min&&(e.chart.viewport.x.min=i.viewport.x.bounded.min),null===e.chart.viewport.x.max&&(e.chart.viewport.x.max=i.viewport.x.bounded.max),e.chart.viewport.areaName=i.name;var s=t.gesture.deltaX-e.lastGesture.deltaX,n=s/(i.innerWidth/(i.viewport.x.max-i.viewport.x.min));e.chart.viewport.x.min+=-n,e.chart.viewport.x.max+=-n,e.chart._fixViewportBounds(),e.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),e.chart.loadMissingData(),e.lastGesture=t.gesture;break;case"pinchstart":e.disabled=!1,$.each(t.gesture.pointers,function(t,r){var s=r.pageX-a.left;e.startTouchIndexes.push(i.getXIndex(s))});break;case"pinchend":e.startTouchIndexes=[];break;case"pinchmove":if(e.disabled)return;var o=e.startTouchIndexes.indexOf(Math.min.apply(null,e.startTouchIndexes)),h=e.startTouchIndexes.indexOf(Math.max.apply(null,e.startTouchIndexes)),l=t.gesture.pointers[o].pageX-a.left,c=t.gesture.pointers[h].pageX-a.left;null===e.chart.viewport.x.min&&(e.chart.viewport.x.min=i.viewport.x.bounded.min),null===e.chart.viewport.x.max&&(e.chart.viewport.x.max=i.viewport.x.bounded.max);var d=e.startTouchIndexes[o]-l*(e.startTouchIndexes[h]-e.startTouchIndexes[o])/(c-l),p=e.startTouchIndexes[h]+(i.innerWidth-c)*(e.startTouchIndexes[h]-e.startTouchIndexes[o])/(c-l),u=p-d;e.chart.chartOptions.maxZoom>0&&u>=e.chart.chartOptions.maxZoom&&(e.chart.viewport.x.min=d,e.chart.viewport.x.max=p,e.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),e.chart.loadMissingData())}}})},iChart.Charting.ChartTouches.prototype.disabled=!1,iChart.Charting.ChartTouches.prototype.startTouchIndexes=[],iChart.Charting.ChartTouches.prototype.lastGesture=null}(),function(){"use strict";iChart.Charting.Prediction=function(t,e){return this.data=t,this.chart=e,this.style={patternend:{strokeStyle:"rgb(153,153,153)",lineWidth:1,lineDash:[7,2]},rectangle:{up:{strokeStyle:"rgb(0,137,0)",lineWidth:1,lineDash:[5,2],fillStyle:"rgba(0,137,0,.3)"},down:{strokeStyle:"rgb(255,2,27)",lineWidth:1,lineDash:[5,2],fillStyle:"rgba(255,2,27,.3)"}},polygon:{strokeStyle:"rgb(102,178,139)",strokeStyle2:"rgb(72,118,177)",lineWidth:3,fillStyle:"rgba(82,175,201,.2)"},fibonacci:{correction:{strokeStyle:"rgb(119,119,119)"},arrow:{strokeStyle:"rgb(251,0,251)",lineWidth:1},line:{strokeStyle:"rgb(204,204,204)",lineWidth:1}},arrow:{down:{strokeStyle:"rgb(219,132,61)",lineWidth:3},up:{strokeStyle:"rgb(15,156,0)",lineWidth:3}},line:{simple:{strokeStyle:"rgb(153,153,153)"},resistance:{strokeStyle:"rgb(102,178,139)",lineWidth:2},support:{strokeStyle:"rgb(72,118,177)",lineWidth:2},patternend:{strokeStyle:"rgb(153,153,153)",lineWidth:1,lineDash:[7,2]}},label:{size:15}},this},iChart.Charting.Prediction.prototype.draw=function(){switch(this.data.patterntype){case"ChartPattern":this.ChartPattern();break;case"FibonacciPattern":this.FibonacciPattern();break;case"KeyLevelsPattern":this.KeyLevelsPattern();break;default:return}this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})},iChart.Charting.Prediction.prototype.getTimeRange=function(){switch(this.data.patterntype){case"ChartPattern":var t=Math.min(this.data.resistancex0,this.data.supportx0);if(void 0!=this.data.predictiontimefrom)var e=this.data.predictiontimeto;else var e=parseInt(this.data.patternendtime)+60*this.data.interval*7;return[1e3*t,1e3*e];case"FibonacciPattern":var i=this.data.timeA;this.data.timeX>0&&(i=Math.min(i,this.data.timeX));var t=i;if(this.data.timeD>0&&this.data.priceD>0)var e=this.data.timeD;else if(this.data.priceD>0)var e=parseFloat(this.data.timeC)+60*parseFloat(this.data.interval)*parseInt(this.data.length);if(this.data.target0>0&&this.data.target10>0){var a=parseInt(i)+this.data.interval*this.data.length*(this.data.interval<1440?3:1);e=a}return[1e3*t,1e3*e];case"KeyLevelsPattern":var t=this.data.point1;if(this.data.predictionpricefrom)var r=parseFloat(this.data.predictiontimefrom)+60*parseFloat(this.data.interval)*parseInt(this.data.predictiontimebars),e=r;else var e=parseInt(this.data.patternendtime)+60*parseFloat(this.data.interval)*7;return[1e3*t,1e3*e];default:return!1}},iChart.Charting.Prediction.prototype.ChartPattern=function(){var t=this.chart.areas[0].getXPositionByValue(this.data.patternendtime),e=this.chart.areas[0].getXPositionByValue(this.data.resistancex0),i=this.chart.areas[0].getXPositionByValue(this.data.resistancex1),a=this.chart.areas[0].getXPositionByValue(this.data.supportx0),r=this.chart.areas[0].getXPositionByValue(this.data.supportx1),s=this.chart.areas[0].getYPosition(this.data.resistancey0),n=this.chart.areas[0].getYPosition(this.data.resistancey1),o=this.chart.areas[0].getYPosition(this.data.supporty0),h=this.chart.areas[0].getYPosition(this.data.supporty1),l=Math.min(this.data.resistancex0,this.data.supportx0),c=Math.max(this.data.resistancex1,this.data.supportx1),d=this.chart.areas[0].getXPositionByValue(l),p=(this.chart.areas[0].getXPositionByValue(c),(d-e)*(n-s)/(i-e)+parseFloat(s)),u=(d-a)*(h-o)/(r-a)+parseFloat(o),g=(t-e)*(n-s)/(i-e)+parseFloat(s),f=(t-a)*(h-o)/(r-a)+parseFloat(o),m=this.chart.overlay.createElement("Polygon");m.points=[{x:1e3*this.chart.areas[0].getXValue(d),y:this.chart.areas[0].getYValue(p)},{x:1e3*this.chart.areas[0].getXValue(t),y:this.chart.areas[0].getYValue(g)},{x:1e3*this.chart.areas[0].getXValue(t),y:this.chart.areas[0].getYValue(f)},{x:1e3*this.chart.areas[0].getXValue(d),y:this.chart.areas[0].getYValue(u)}],m.settings=this.style.polygon,this.chart.overlay.history.push(m);var m=this.chart.overlay.createElement("VerticalLine");if(m.hasSettings=!0,m.settings=this.style.line.patternend,m.points=[{x:1e3*this.chart.areas[0].getXValue(t),y:this.chart.areas[0].getYValue(u)}],this.chart.overlay.history.push(m),void 0!=this.data.predictiontimefrom){var v=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1],y=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1),C=this.chart.areas[0].ySeries[0].points[y][3],x=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))+7],x=Math.min(x,parseFloat(this.data.predictiontimefrom)+Math.round((this.data.predictiontimeto-this.data.predictiontimefrom)/2)),m=this.chart.overlay.createElement("Arrow");m.hasSettings=!0,1==this.data.direction?(m.points=[{x:1e3*v,y:C},{x:1e3*x,y:this.data.predictionpricefrom}],m.settings=this.style.arrow.up):(m.points=[{x:1e3*v,y:C},{x:1e3*x,y:this.data.predictionpriceto}],m.settings=this.style.arrow.down),this.chart.overlay.history.push(m);var m=this.chart.overlay.createElement("Rectangle");m.hasSettings=!0,1==this.data.direction?m.settings=this.style.rectangle.up:m.settings=this.style.rectangle.down;var T=this.chart.areas[0].getXValue(this.chart.areas[0].getXPositionByIndex(this.chart.areas[0].getXIndexByValue2(this.data.predictiontimeto)));m.points=[{x:1e3*this.data.patternendtime,y:this.data.predictionpricefrom},{x:1e3*T,y:this.data.predictionpriceto}],this.chart.overlay.history.push(m)}else{var v=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1],y=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1),C=this.chart.areas[0].ySeries[0].points[y][3],x=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))+7],S=this.chart.areas[0].getXPositionByValue(x),m=this.chart.overlay.createElement("Arrow");if(m.hasSettings=!0,1==this.data.direction){var A=(S-e)*(n-s)/(i-e)+parseFloat(s);m.settings=this.style.arrow.up}else{var A=(S-a)*(h-o)/(r-a)+parseFloat(o);m.settings=this.style.arrow.down}m.points=[{x:1e3*v,y:C},{x:1e3*x,y:this.chart.areas[0].getYValue(A)}],this.chart.overlay.history.push(m)}this.chart.overlay.render(),this.chart.overlay.syncHash()},iChart.Charting.Prediction.prototype.FibonacciPattern=function(){if(this.data.priceX>0){var t=this.chart.overlay.createElement("Line");t.hasSettings=!0,t.settings=this.style.line.support,
t.points=[{x:1e3*this.data.timeX,y:this.data.priceX},{x:1e3*this.data.timeA,y:this.data.priceA}],this.chart.overlay.history.push(t)}if(this.data.priceA>0){var t=this.chart.overlay.createElement("Line");t.hasSettings=!0,t.settings=this.style.line.support,t.points=[{x:1e3*this.data.timeA,y:this.data.priceA},{x:1e3*this.data.timeB,y:this.data.priceB}],this.chart.overlay.history.push(t)}var t=this.chart.overlay.createElement("Line");t.hasSettings=!0,t.settings=this.style.line.support,t.points=[{x:1e3*this.data.timeB,y:this.data.priceB},{x:1e3*this.data.timeC,y:this.data.priceC}],this.chart.overlay.history.push(t);var e=this.data.timeA;this.data.timeX>0&&(e=Math.min(e,this.data.timeX));var i=this.chart.areas[0].getXIndexByValue2(e),a=i+parseInt(this.data.interval/this.chart._dataSettings.timeframe*this.data.length*1.6);if(this.data.timeD>0&&this.data.priceD>0){var t=this.chart.overlay.createElement("Line");t.hasSettings=!0,t.settings=this.style.line.support,t.points=[{x:1e3*this.data.timeC,y:this.data.priceC},{x:1e3*this.data.timeD,y:this.data.priceD}],this.chart.overlay.history.push(t)}else if(this.data.priceD>0){var t=this.chart.overlay.createElement("Arrow");if(t.hasSettings=!0,t.settings=this.style.fibonacci.arrow,t.points=[{x:1e3*this.data.timeC,y:this.data.priceC},{x:1e3*this.chart.areas[0].xSeries[a],y:this.data.priceD}],this.chart.overlay.history.push(t),this.data.priceX>0){var t=this.chart.overlay.createElement("Line");t.hasSettings=!0,t.settings=this.style.fibonacci.line,t.points=[{x:1e3*this.data.timeX,y:this.data.priceX},{x:1e3*this.chart.areas[0].xSeries[a],y:this.data.priceD}],this.chart.overlay.history.push(t)}}if(this.data.target0>0&&this.data.target10>0){var t=this.chart.overlay.createElement("FibonacciCorrection");t.hasSettings=!0,t.settings=this.style.fibonacci.correction,t.points=[{x:1e3*this.chart.areas[0].xSeries[a],y:this.data.target0},{x:1e3*this.chart.areas[0].xSeries[a],y:this.data.target10}],this.chart.overlay.history.push(t)}if(this.data.target0>0&&this.data.target3>0){var t=this.chart.overlay.createElement("Arrow"),r=this.chart.areas[0].xSeries[a+4];t.points=[{x:1e3*this.chart.areas[0].xSeries[a],y:this.data.target0},{x:1e3*r,y:this.data.target3}],t.hasSettings=!0,t.settings=this.style.fibonacci.correction,this.chart.overlay.history.push(t)}var t=this.chart.overlay.createElement("VerticalLine");if(t.points=[{x:1e3*this.data.patternendtime,y:this.data.price}],t.hasSettings=!0,t.settings=this.style.line.simple,this.chart.overlay.history.push(t),this.data.timeX>0){var t=this.chart.overlay.createElement("Label");if(t.settings={text:"X",size:this.style.label.size},"down"==this.data.directionX){var s=this.chart.areas[0].getYPosition(this.data.priceX)+this.style.label.size;s=this.chart.areas[0].getYValue(s)}else var s=this.data.priceX;t.points=[{x:1e3*this.data.timeX,y:s}],this.chart.overlay.history.push(t)}if(this.data.timeA>0){var t=this.chart.overlay.createElement("Label");if(t.settings={text:"A",size:this.style.label.size},"down"==this.data.directionA){var s=this.chart.areas[0].getYPosition(this.data.priceA)+this.style.label.size;s=this.chart.areas[0].getYValue(s)}else var s=this.data.priceA;t.points=[{x:1e3*this.data.timeA,y:s}],this.chart.overlay.history.push(t)}if(this.data.timeB>0){var t=this.chart.overlay.createElement("Label");if(t.settings={text:"B",size:this.style.label.size},"down"==this.data.directionB){var s=this.chart.areas[0].getYPosition(this.data.priceB)+this.style.label.size;s=this.chart.areas[0].getYValue(s)}else var s=this.data.priceB;t.points=[{x:1e3*this.data.timeB,y:s}],this.chart.overlay.history.push(t)}if(this.data.timeC>0){var t=this.chart.overlay.createElement("Label");if(t.settings={text:"C",size:this.style.label.size},"down"==this.data.directionC){var s=this.chart.areas[0].getYPosition(this.data.priceC)+this.style.label.size;s=this.chart.areas[0].getYValue(s)}else var s=this.data.priceC;t.points=[{x:1e3*this.data.timeC,y:s}],this.chart.overlay.history.push(t)}if(this.data.timeD>0){var t=this.chart.overlay.createElement("Label");if(t.settings={text:"D",size:this.style.label.size},"down"==this.data.directionD){var s=this.chart.areas[0].getYPosition(this.data.priceD)+this.style.label.size;s=this.chart.areas[0].getYValue(s)}else var s=this.data.priceD;t.points=[{x:1e3*this.data.timeD,y:s}],this.chart.overlay.history.push(t)}this.chart.overlay.render(),this.chart.overlay.syncHash()},iChart.Charting.Prediction.prototype.KeyLevelsPattern=function(){var t=this.chart.overlay.createElement("HorizontalLine");t.points=[{x:1e3*this.data.patternendtime,y:this.data.price}],t.hasSettings=!0,t.settings=this.style.line.simple,this.chart.overlay.history.push(t);var t=this.chart.overlay.createElement("VerticalLine");t.points=[{x:1e3*this.data.patternendtime,y:this.data.price}],t.hasSettings=!0,t.settings=this.style.line.simple,this.chart.overlay.history.push(t);var t=this.chart.overlay.createElement("Line");if(t.points=[{x:1e3*this.data.point1,y:this.data.price},{x:1e3*this.data.patternendtime,y:this.data.price}],t.hasSettings=!0,"Support"==this.data.pattern?t.settings=this.style.line.support:t.settings=this.style.line.resistance,this.chart.overlay.history.push(t),this.data.predictionpricefrom){var e=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1],i=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1),a=this.chart.areas[0].ySeries[0].points[i][3],r=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))+7],t=this.chart.overlay.createElement("Arrow");if(t.hasSettings=!0,1==this.data.direction){var s=this.data.predictionpricefrom;t.settings=this.style.arrow.up}else{t.settings=this.style.arrow.down;var s=this.data.predictionpriceto}t.points=[{x:1e3*e,y:a},{x:1e3*r,y:s}],this.chart.overlay.history.push(t);var t=this.chart.overlay.createElement("Rectangle");t.hasSettings=!0,1==this.data.direction?t.settings=this.style.rectangle.up:t.settings=this.style.rectangle.down;var n=parseFloat(this.data.predictiontimefrom)+60*parseFloat(this.data.interval)*parseInt(this.data.predictiontimebars);n=this.chart.areas[0].getXValue(this.chart.areas[0].getXPositionByIndex(this.chart.areas[0].getXIndexByValue2(n))),t.points=[{x:1e3*this.data.patternendtime,y:this.data.predictionpricefrom},{x:1e3*n,y:this.data.predictionpriceto}],this.chart.overlay.history.push(t)}else{var e=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1],i=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1),a=this.chart.areas[0].ySeries[0].points[i][3],r=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))+7],t=this.chart.overlay.createElement("Arrow");t.points=[{x:1e3*e,y:a},{x:1e3*r,y:this.data.price}],t.hasSettings=!0,1==this.data.direction?t.settings=this.style.arrow.up:t.settings=this.style.arrow.down,this.chart.overlay.history.push(t)}this.chart.overlay.render(),this.chart.overlay.syncHash()},iChart.Charting.Prediction.prototype.getThirdPoint=function(t,e,i){var a=(parseFloat(i)-parseFloat(t.x))*(parseFloat(e.y)-parseFloat(t.y))/(parseFloat(e.x)-parseFloat(t.x))+parseFloat(t.y);return{x:parseFloat(i),y:a}},iChart.Charting.Prediction.prototype.getIntersection=function(t,e,i,a){if((t.y-e.y)*(a.x-i.x)-(i.y-a.y)*(e.x-t.x)!=0&&a.x-i.x!=0){var r=-((t.x*e.y-e.x*t.y)*(a.x-i.x)-(i.x*a.y-a.x*i.y)*(e.x-t.x))/((t.y-e.y)*(a.x-i.x)-(i.y-a.y)*(e.x-t.x)),s=((i.y-a.y)*-r-(i.x*a.y-a.x*i.y))/(a.x-i.x);return{x:r,y:s}}return!1}}(),iChart.indicators={AD:{type:"TA_LIB",output:1,name:_t("428","AD (Распределение накопления)"),value:"AD",outputRegion:"self",description:_t("4789","Формула распределения накопления использует отношение между объемом и ценами, чтобы оценить интенсивность изменения цен; если объем увеличивается, весьма вероятно, что цены поднимутся.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5400">'+_t("15833","Подробнее.")+"</a>",parameters:[]},ADOSC:{type:"TA_LIB",output:1,name:_t("429","ADOSC (Осциллятор Чайкина)"),value:"ADOSC",outputRegion:"self",description:_t("4790","Индикатор осциллятора Чайкина – это разница между трехдневным экспоненциальным скользящим средним и десятидневным экспоненциальным скользящим средним, примененная к распределению накопления.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5425">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"FastPeriod",Name:_t("4791","Краткосрочный интервал"),Value:3},{Code:"SlowPeriod",Name:_t("4792","Долгосрочный интервал"),Value:10}]},ADX:{type:"TA_LIB",output:1,name:_t("430","ADX (Индекс направленного движения)"),value:"ADX",outputRegion:"self",description:_t("4793","Индикатор среднего направленного движения служит для определения вероятного направления основного тренда."),parameters:[{Code:"TimePeriod",Name:_t("5421","Интервал"),Value:14}]},ADXDI:{type:"TA_LIB",output:3,outputNames:["ADX","PLUS_DI","MINUS_DI"],name:_t("431","ADXDI (Индекс направленного движения (с индикаторами направления))"),value:"ADXDI",outputRegion:"self",description:_t("4793","Индикатор среднего направленного движения служит для определения вероятного направления основного тренда.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5421">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("5421","Интервал"),Value:14}]},AROON:{type:"TA_LIB",output:2,outputNames:["AroonDown","AroonUp"],name:_t("432","AROON (Арун)"),value:"AROON",outputRegion:"self",description:_t("4797","Индикатор Арун применяется для изучения силы и направления трендов."),parameters:[{Code:"TimePeriod",Name:_t("5421","Интервал"),Value:25}]},ATR:{type:"TA_LIB",output:1,name:_t("433","ATR (Средний истинный диапазон)"),value:"ATR",outputRegion:"self",description:_t("4799","Индикатор среднего истинного диапазона измеряет фиксацию и сравнивает диапазоны между высокими и низкими ценами и ценами закрытия."),parameters:[{Code:"TimePeriod",Name:_t("5421","Интервал"),Value:14}]},BBANDS:{type:"TA_LIB",output:3,outputNames:["UpperBand","MiddleBand","LowerBand"],name:_t("434","BBANDS (Уровни Боллинджера)"),value:"BBANDS",outputRegion:"price",description:_t("4801","Индикаторы с линиями Боллинджера наносятся на график как уровни стандартного отклонения выше и ниже скользящего среднего.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5397">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("5421","Интервал"),Value:7},{Code:"DeviationsUp",Name:_t("4803","Верхнее число станд. отклонения"),Value:2},{Code:"DeviationsDown",Name:_t("4804","Нижнее число станд. отклонения"),Value:2}]},CCI:{type:"TA_LIB",output:1,name:_t("435","CCI (Индекс товарного канала)"),value:"CCI",outputRegion:"self",description:_t("4805","Индикатор ценовых моментов сравнивает цены с их скользящими средними.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5424">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:10}]},CHV:{type:"TA_LIB",output:1,name:_t("436","CHV (Волатильность Чайкина)"),value:"CHV",outputRegion:"self",description:_t("4807","Индикатор волатильности Чайкина показывает разницу между максимальными и минимальными ценами и используется для обозначения верхних и нижних частей рынка."),parameters:[{Code:"TimePeriod",Name:_t("4808","Период EMA"),Value:10},{Code:"PeriodROC",Name:_t("4809","Период ROC"),Value:10}]},DPO:{type:"TA_LIB",output:1,name:_t("437","DPO (Осциллятор цен с исключенным трендом)"),value:"DPO",outputRegion:"self",description:_t("4810","Осциллятор цен с исключенным трендом пытается исключить из цен тренды.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5432">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:20}]},EMA:{type:"TA_LIB",output:1,name:_t("438","EMA (Экспоненциальное скользящее среднее)"),value:"EMA",outputRegion:"price",description:_t("4812","Экспоненциальное скользящее среднее – это среднее значение данных, рассчитанное за некий период времени, причем последние дни имеют в вычислении больший вес.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5396">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:12}]},ENV:{type:"TA_LIB",output:2,outputNames:["Upper","Lower"],name:_t("439","ENV (Конверты)"),value:"ENV",outputRegion:"price",description:_t("4815","Конверты наносятся над и под скользящим средним; смещение определяется указанным процентом.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5431">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:20},{Code:"shift",Name:_t("4817","Сдвиг, %"),Value:1}]},MACD:{type:"TA_LIB",output:3,outputNames:["MACD","MACDSignal","MACDHist"],name:_t("441","MACD (Конвергенция и дивергенция скользящих средних)"),value:"MACD",outputRegion:"self",description:_t("4818","Индикатор конвергенции и дивергенции скользящих средних сравнивает два скользящих средних цен и используется вместе с девятидневным экспоненциальным скользящим средним в качестве сигнала для моментов покупки и продажи.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5428">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"FastPeriod",Name:_t("4819","Краткосрочный период"),Value:12},{Code:"SlowPeriod",Name:_t("4820","Долгосрочный период"),Value:26},{Code:"SignalPeriod",Name:_t("4821","Период сигнальной линии"),Value:9}]},MEDPRICE:{type:"TA_LIB",output:1,name:_t("443","MEDPRICE (Медианная цена)"),value:"MEDPRICE",outputRegion:"price",description:_t("4822","Медианные цены – это средние значения цен за день, которые могут использоваться как фильтр для индикаторов трендов."),parameters:[]},MFI:{type:"TA_LIB",output:1,name:_t("444","MFI (Денежный поток)"),value:"MFI",outputRegion:"self",description:_t("4823","Индикатор денежных потоков сравнивает восходящие и нисходящие изменения типичных цен, приведенных к объему."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:14}]},OBV:{type:"TA_LIB",output:1,name:_t("445","OBV (Балансовый объём)"),value:"OBV",outputRegion:"self",description:_t("4828","Индикатор балансового объема измеряет положительный и отрицательный поток объема.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5434">'+_t("15833","Подробнее.")+"</a>",parameters:[]},PSAR:{type:"TA_LIB",output:1,name:_t("447","PSAR (Параболик)"),value:"PSAR",outputRegion:"price",description:_t("4833","Индикатор Параболик помогает определять точки разворота тренда.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5399">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"Acceleration",Name:_t("860","Шаг"),Value:.02},{Code:"Maximum",Name:_t("4835","Максимальный шаг"),Value:.2}]},ROC:{type:"TA_LIB",output:1,name:_t("449","ROC (Темп изменения)"),value:"ROC",outputRegion:"self",description:_t("4840","Индикатор темпов изменений сравнивает указанную цену закрытия с текущей ценой.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5430">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:10}]},RSI:{type:"TA_LIB",output:1,name:_t("450","RSI (Индекс относительной силы)"),value:"RSI",outputRegion:"self",description:_t("4842","Индекс относительной силы – это осциллятор момента, сравнивающий восходящие изменения цены закрытия с нисходящими изменениями и выдающий значения в диапазоне от 0 до 100.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5411">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:10}]},SMA:{type:"TA_LIB",output:1,name:_t("451","SMA (Простое скользящее среднее)"),value:"SMA",outputRegion:"price",description:_t("4844","Простое скользящее среднее – это среднее значение данных, рассчитанное за некий период времени. Скользящее среднее – самый распространенный индикатор цен в техническом анализе, который можно использовать с любой ценой, например высокой, низкой, ценами открытия и закрытия, а также применять к другим индикаторам."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:10}]},STDDEV:{type:"TA_LIB",output:1,name:_t("452","STDDEV (Стандартное отклонение)"),value:"STDDEV",outputRegion:"self",description:_t("4846","Стандартное отклонение используется для обозначения волатильности и показывает, например, разницу между значениями цены закрытия и ее скользящего среднего."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:10}]},TEMA:{type:"TA_LIB",output:1,name:_t("454","TEMA (Тройное экспоненциальное скользящее среднее)"),value:"TEMA",outputRegion:"price",description:_t("4852","Тройное экспоненциальное скользящее среднее основано на тройном скользящем среднем цены закрытия. Его назначение – исключить короткие циклы. Этот индикатор сохраняет цену закрытия в трендах, которые короче указанного периода."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:12}]},TRIMA:{type:"TA_LIB",output:1,name:_t("455","TRIMA (Треугольное скользящее среднее)"),value:"TRIMA",outputRegion:"price",description:_t("4854","Треугольное скользящее среднее – это среднее значение данных, рассчитанное за некий период времени, причем средняя часть данных имеет в вычислении больший вес."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:20}]},TYPPRICE:{type:"TA_LIB",output:1,name:_t("456","TYPPRICE (Типичная цена)"),value:"TYPPRICE",outputRegion:"price",description:_t("4856","Типичная цена – это среднее значение цен за день, которое может использоваться как фильтр для индикаторов трендов."),parameters:[]},VPT:{type:"TA_LIB",output:1,name:_t("457","VPT (Тренд объёма цен)"),value:"VPT",outputRegion:"self",description:_t("4857","Тренд объема цен – это совокупное значение объема, рассчитываемое на основе относительных изменений цены закрытия; его следует использовать с другими индикаторами."),parameters:[]},WCLPRICE:{type:"TA_LIB",output:1,name:_t("458","WCLPRICE (Взвешенная цена закрытия)"),value:"WCLPRICE",outputRegion:"price",description:_t("4858","Формула взвешенной цены закрытия вычисляет среднее значение цен за день. Единственное отличие взвешенной цены закрытия и типичной цены в том, что у цены закрытия больший вес и она считается самой важной ценой.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5433">'+_t("15833","Подробнее.")+"</a>",parameters:[]},WILLR:{type:"TA_LIB",output:1,name:_t("459","WILLR (Процентный диапазон Уильямса)"),value:"WILLR",outputRegion:"self",description:_t("4859","Процентный диапазон Уильямса – это индикатор момента, который показывает уровни перекупленности и перепроданности.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5410">'+_t("15833","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:14}]},WMA:{type:"TA_LIB",output:1,name:_t("460","WMA (Взвешенное скользящее среднее)"),value:"WMA",outputRegion:"price",description:_t("4861","Взвешенное скользящее среднее – это среднее значение данных, рассчитанное за некий период времени, причем последние данные имеют в вычислении больший вес."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:9}]},TRPLN:{type:"TA_LIB",output:0,name:_t("13838","TRPLN (Тенденциальная планиметрия)"),value:"TRPLN",outputRegion:"price",description:_t("13843","Тенденциальная планиметрия"),parameters:[]}},$.views.settings.allowCode(!0),$.templates("iChart_mainTmpl",'<div class="iChart-control-form" style="min-height: 200px"><div class="js-chartContainerWrapper"><div class="iChartToolsContainer"><div class="iChartToolsTop" style="display: none;"></div></div><div id="{{:id}}" class="m-chart-container" style="height: 100%;"></div></div><div data-uk-modal="{center:true}" class="uk-modal iChart-form-simple-v js-chartTADialog uk-padding-remove {{:name}}" id="iChart-tech-analysis-dialog" style="display: none;"><div class="uk-modal-dialog"><a class="uk-modal-close uk-close"></a><div class="uk-modal-header">'+_t("3101","Индикаторы")+'</div><div class="js-chartTADialogContainer"></div><div class="uk-modal-footer"><div class="uk-flex uk-flex-middle uk-flex-space-between tm-pad-large"><div class="js-indicator-add md-btn md-btn-small md-btn-success">'+_t("15460","Добавить индикатор")+'</div><div class="md-btn-group"><a class="md-btn md-btn-small md-btn-primary indicators-set" href="#">'+_t("532","Применить")+'</a><a class="md-btn md-btn-small indicators-default" href="#">'+_t("15461","Для всех")+'</a><a class="md-btn md-btn-small indicators-close" href="#">'+_t("1403","Отмена")+'</a></div></div></div></div></div><div class="chart-loader-wrapper" style="top: 0; width: 100%; height: 100%;"><div class="chart-loader"></div></div></div>'),$.templates("indicatorsCurrentTmpl",'{{for userData}}<div><span>{{:name}}</span> <span>{{if params}}{{* window.i=0;}}({{props params}}{{* if (i>0) { }}, {{* } }}{{>prop}}{{* i++;}}{{/props}}){{/if}}</span><span><a href="javascript:void(0);" onclick="return false;" data-index="{{:#index}}" class="js-edit-indicator uk-icon-cog uk-margin-left"></a><a href="javascript:void(0);" onclick="return false;" data-index="{{:#index}}" class="js-remove-indicator uk-icon-close uk-margin-left"></a></span></div>{{/for}}'),$.templates("indicatorsListTmpl",'<ul class="uk-nav uk-nav-dropdown"><li class="uk-nav-divider"></li>{{for indicators}}<li><a href="javascript:void(0);" onclick="return false;" class="js-add-indicator" data-value="{{:value}}">{{:value}}</a></li>{{/for}}</ul>'),$.templates("indicatorsDropdownTmpl",'<div class="js-iChartTools-indicators uk-button-dropdown" data-uk-dropdown="{mode:\'click\'}"><button class="uk-button">'+_t("3101","Индикаторы")+'<i class="uk-icon-caret-down"></i></button><div class="uk-dropdown uk-dropdown-bottom uk-dropdown-scrollable" style="top: 30px; left: 0px;"><div class="uk-grid uk-dropdown-grid"><div class="uk-width-1-1"><div class="uk-panel js-iChartTools-indicators-current">{{include tmpl="indicatorsCurrentTmpl"/}}</div><div class="js-iChartTools-indicators-list">{{include tmpl="indicatorsListTmpl"/}}</div></div></div></div></div>'),$.templates("indicatorDialogTmpl",'<div class="iChartDialog" style="display: none; width: 300px;"><div> {{:name}} </div><div class="js-iChartTools-indicators-params">{{for parameters}}<div>{{:Name}} <input type="text" name="{{:Code}}" value="{{:Value}}" /></div>{{/for}}</div><div class="js-iChartTools-indicators-colorContainer"></div><div class="js-iChartTools-indicators-widthContainer"></div><div><a  href="javascript:void(0);" onclick="return false;" class="uk-button js-set-params-indicator">Ok</a><a  href="javascript:void(0);" onclick="$.modal.impl.close(); return false;" class="uk-button">Cancel</a></div></div>'),$.templates("themeConfigSelectorTmpl",'<div class="uk-button-dropdown" data-uk-dropdown="{mode:\'click\'}" aria-haspopup="true" aria-expanded="false"><button class="uk-button uk-button-success">'+_t("13663","Темы")+' <i class="uk-icon-caret-down"></i></button><div class="uk-dropdown uk-dropdown-up uk-dropdown-small uk-dropdown-scrollable"><ul class="uk-nav uk-nav-dropdown">{{for themes}}<li><a href="#" class="js-themeSelect" data-theme="{{: name }}">{{: name }}{{if custom}}<span class="js-themeDelete uk-icon-trash-o uk-margin-small-left uk-badge uk-badge-warning uk-panel-hover uk-float-right" data-name="{{: name }}" title="'+_t("4023","Удалить")+'"></span>{{/if}}</a></li>{{/for}}<li class="uk-nav-divider"></li><li><a href="#" class="js-themeSaveAs">'+_t("13664","Сохранить как")+"</a></li></ul></div></div>"),$.templates("themeConfigTmpl",'<div class="js-themeConfig" style="display: none"><div class="js-themeConfigOptions"></div><div class="uk-grid uk-grid-small"><div class="uk-width-1-1"><div class="js-themeConfigSelector"></div></div></div><hr class="uk-grid-divider" style="margin: 15px 0"><div class="uk-grid uk-grid-small"><div class="uk-width-7-10 js-themeAdditionButtons"></div><div class="uk-width-3-10 uk-text-right"><button class="uk-button js-chartOptions" data-value="cancel">'+_t("1403","Отмена")+'</button> <button class="uk-button  uk-button-primary js-chartOptions" data-value="ok">'+_t("3920","OK")+"</button></div></div></div>"),$.templates("themeConfigOptionsTmpl",'<div class="uk-grid"><div class="uk-width-1-2"><div class="uk-grid"><div class="uk-width-3-4">'+_t("13643","Фон")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="backgroundColor" style="background-color: {{: chartOptions.backgroundColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="backgroundColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="backgroundColor" data-element="canvas" value="{{: chartOptions.backgroundColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13644","Линии осей")+'</div><div class="uk-width-1-4"><div class="js-checkbox" data-option="showAxes"><input type="checkbox" class="js-flag" data-option="showAxes" {{if chartOptions.showAxes}}checked="checked"{{/if}}/></div></div><div class="uk-width-3-4">'+_t("13645","Цвет осей")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="axisColor" style="background-color: {{: chartOptions.axisColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="axisColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="axisColor" data-element="canvas" value="{{: chartOptions.axisColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13646","Цвет меток")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="labelColor" style="background-color: {{: chartOptions.labelColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="labelColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="labelColor" data-element="canvas" value="{{: chartOptions.labelColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13647","Цвет сетки")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="gridColor" style="background-color: {{: chartOptions.gridColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="gridColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="gridColor" data-element="canvas" value="{{: chartOptions.gridColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13648","Цвет текста подложки")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="watermarkColor" style="background-color: {{: chartOptions.watermarkColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="watermarkColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="watermarkColor" data-element="canvas" value="{{: chartOptions.watermarkColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13649","Цвет области")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="areaColor" style="background-color: {{: chartOptions.areaColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="areaColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="areaColor" data-element="canvas" value="{{: chartOptions.areaColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13650","Цвет границы области")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="areaLineColor" style="background-color: {{: chartOptions.areaLineColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="areaLineColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="areaLineColor" data-element="canvas" value="{{: chartOptions.areaLineColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13651","Цвет объемов")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="volumeStyle" style="background-color: {{: chartOptions.volumeStyle }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="volumeStyle"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="volumeStyle" data-element="canvas" value="{{: chartOptions.volumeStyle }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13652","Цвет фона скроллера")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="scrollerOverlayColor" style="background-color: {{: chartOptions.scrollerOverlayColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="scrollerOverlayColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="scrollerOverlayColor" data-element="canvas" value="{{: chartOptions.scrollerOverlayColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13653","Цвет скроллера")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="scrollerHandlerColor" style="background-color: {{: chartOptions.scrollerHandlerColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="scrollerHandlerColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="scrollerHandlerColor" data-element="canvas" value="{{: chartOptions.scrollerHandlerColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("15810","Цвет теней")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="shadowColor" style="background-color: {{: chartOptions.shadowColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="shadowColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="shadowColor" data-element="canvas" value="{{: chartOptions.shadowColor }}" size="10"/></div></div></div></div></div><div class="uk-width-1-2"><div class="uk-grid"><div class="uk-width-3-4">'+_t("3103","Свеча вверх")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="candleUp" style="background-color: {{: chartOptions.candleUp }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="candleUp"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="candleUp" data-element="canvas" value="{{: chartOptions.candleUp }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("3104","Свеча вниз")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="candleDown" style="background-color: {{: chartOptions.candleDown }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="candleDown"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="candleDown" data-element="canvas" value="{{: chartOptions.candleDown }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13654","Обводка свечи")+'</div><div class="uk-width-1-4"><div class="js-checkbox" data-option="candleBorder"><input type="checkbox" class="js-flag" data-option="candleBorder" {{if chartOptions.candleBorder}}checked="checked"{{/if}}/></div></div><div class="uk-width-3-4">'+_t("13655","Обводка свечи вверх")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="candleBorderUp" style="background-color: {{: chartOptions.candleBorderUp }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="candleBorderUp"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="candleBorderUp" data-element="canvas" value="{{: chartOptions.candleBorderUp }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13656","Обводка свечи вниз")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="candleBorderDown" style="background-color: {{: chartOptions.candleBorderDown }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="candleBorderDown"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="candleBorderDown" data-element="canvas" value="{{: chartOptions.candleBorderDown }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13657","Тень свечи")+'</div><div class="uk-width-1-4"><div class="js-checkbox" data-option="candleWick"><input type="checkbox" class="js-flag" data-option="candleWick" {{if chartOptions.candleWick}}checked="checked"{{/if}}/></div></div><div class="uk-width-3-4">'+_t("13658","Цвет тени свечи")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="candleWickStyle" style="background-color: {{: chartOptions.candleWickStyle }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="candleWickStyle"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="candleWickStyle" data-element="canvas" value="{{: chartOptions.candleWickStyle }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13659","Бар вверх")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="stockUp" style="background-color: {{: chartOptions.stockUp }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="stockUp"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="stockUp" data-element="canvas" value="{{: chartOptions.stockUp }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13660","Бар вниз")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="stockDown" style="background-color: {{: chartOptions.stockDown }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="stockDown"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="stockDown" data-element="canvas" value="{{: chartOptions.stockDown }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13661","Толщина бара")+'</div><div class="uk-width-1-4"><div class="js-widthSlector" data-option="stockWidth"><div class="js-widthSlectorValue lineWidth" data-option="stockWidth" data-style="{{: chartOptions.stockWidth }}"></div><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-widthSlectorWrapper" data-option="stockWidth" value="{{: chartOptions.stockWidth }}"><span class="lineWidth js-lineWidth" data-style="1"></span><span class="lineWidth js-lineWidth" data-style="2"></span><span class="lineWidth js-lineWidth" data-style="3"></span><span class="lineWidth js-lineWidth" data-style="4"></span></div></div></div></div><div class="uk-width-3-4">'+_t("1365","Линия")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="lineColor" style="background-color: {{: chartOptions.lineColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="lineColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="lineColor" data-element="canvas" value="{{: chartOptions.lineColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13662","Толщина линии")+'</div><div class="uk-width-1-4"><div class="js-widthSlector" data-option="lineWidth"><div class="js-widthSlectorValue lineWidth" data-option="lineWidth" data-style="{{: chartOptions.lineWidth }}"></div><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-widthSlectorWrapper" data-option="lineWidth" value="{{: chartOptions.lineWidth }}"><span class="lineWidth js-lineWidth" data-style="1"></span><span class="lineWidth js-lineWidth" data-style="2"></span><span class="lineWidth js-lineWidth" data-style="3"></span><span class="lineWidth js-lineWidth" data-style="4"></span><span class="lineWidth js-lineWidth" data-style="5"></span><span class="lineWidth js-lineWidth" data-style="8"></span><span class="lineWidth js-lineWidth" data-style="10"></span></div></div></div></div></div></div></div>'),
$.templates("iChart_optionsTmpl",'<div class="js-iChartTools-options uk-button-dropdown" data-uk-dropdown="{mode:\'click\'}"><button class="uk-button">'+_t("","Настройки")+'<i class="uk-icon-caret-down"></i></button><div class="uk-dropdown uk-dropdown-bottom" style="top: 30px; left: 0px;"><div class="js-iChartTools-optionsList"><ul class="uk-nav uk-nav-dropdown"><li><a href="javascript:void(0);" onclick="return false;" class="js-iChartTools-chartType" data-value="Candlestick">'+_t("1366","Свечи")+' <i class="uk-float-right {{if chartType == "Candlestick"}}uk-icon-circle{{else}}uk-icon-circle-o{{/if}}"></i></a></li><li><a href="javascript:void(0);" onclick="return false;" class="js-iChartTools-chartType" data-value="Line">'+_t("1365","Линия")+' <i class="uk-float-right  {{if chartType == "Line"}}uk-icon-circle{{else}}uk-icon-circle-o{{/if}}"></i></a></li><li><a href="javascript:void(0);" onclick="return false;" class="js-iChartTools-chartType" data-value="Stock">'+_t("1367","Бары")+' <i class="uk-float-right  {{if chartType == "Stock"}}uk-icon-circle{{else}}uk-icon-circle-o{{/if}}"></i></a></li><li class="uk-nav-divider"></li><li><a href="javascript:void(0);" onclick="return false;" class="js-iChartTools-percentMode">'+_t("2995","Относительная цена")+' <i class="uk-float-right  {{if percentMode}}uk-icon-toggle-on{{else}}uk-icon-toggle-off{{/if}}"></i></a></li><li><a href="javascript:void(0);" onclick="return false;" class="js-iChartTools-volumeByPrice">'+_t("","V по горизонтали")+' <i class="uk-float-right  {{if showVolumeByPrice}}uk-icon-toggle-on{{else}}uk-icon-toggle-off{{/if}}"></i></a></li><li><a href="javascript:void(0);" onclick="return false;" class="js-iChartTools-volumeByDate">'+_t("","V по вертикали")+' <i class="uk-float-right  {{if showVolume=="inside" || showVolume == "outside"}}uk-icon-toggle-on{{else}}uk-icon-toggle-off{{/if}}"></i></a></li><li class="uk-nav-divider"></li><li class="uk-dropdown-close"><a href="javascript:void(0);" onclick="return false;" class="js-iChartTools-themeDialog" data-value="">'+_t("","Визуальные настройки")+"</a></li></ul></div></div></div>"),$.templates("iChart_instrumentsTmpl",'<div class="js-iChartTools-instruments uk-button-dropdown" data-uk-dropdown="{mode:\'click\'}"><button class="uk-button">'+_t("","Рисование")+'<i class="uk-icon-caret-down"></i></button><div class="uk-dropdown uk-dropdown-bottom" style="top: 30px; left: 0px;"><div class="js-iChartTools-instrumentsList"><div class="js-colorSelector" data-option="fillStyle" style="background-color: #778899" data-title="'+_t("3014","Цвет заливки")+'"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="fillStyle"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="fillStyle" data-element="canvas" value="#778899" size="10"/></div></div> <div class="js-colorSelector" data-option="strokeStyle" style="background-color: #778899" data-title="'+_t("3016","Цвет линий")+'"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="strokeStyle"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="strokeStyle" data-element="canvas" value="#778899" size="10"/></div></div> <div class="js-colorSelector" data-option="fontSettingsColor" style="background-color: #778899" data-title="'+_t("","Цвет текста")+'"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="fontSettingsColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="fontSettingsColor" data-element="canvas" value="#778899" size="10"/></div></div> <div class="js-lineWidthSelector" data-option="fontSettingsColor" data-title="'+_t("3017","Толщина линий")+'"><span class="lineWidth js-currentLineWidth" data-style="1"></span><div class="menuHolder" style="display: none"><span class="lineWidth" data-option="fontSettingsColor" data-style="1" title="'+_t("3901","1px")+'"></span><span class="lineWidth" data-option="fontSettingsColor" data-style="2" title="'+_t("3902","2px")+'"></span><span class="lineWidth" data-option="fontSettingsColor" data-style="3" title="'+_t("3903","3px")+'"></span><span class="lineWidth" data-option="fontSettingsColor" data-style="4" title="'+_t("3904","4px")+'"></span><span class="lineWidth" data-option="fontSettingsColor" data-style="5" title="'+_t("3905","5px")+'"></span><span class="lineWidth" data-option="fontSettingsColor" data-style="8" title="'+_t("3906","8px")+'"></span><span class="lineWidth" data-option="fontSettingsColor" data-style="10" title="'+_t("3907","10px")+'"></span></div></div><div><ul class="uk-nav uk-nav-dropdown"><li class="uk-nav-divider"></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="Line">'+_t("51","Свободная линия")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="HorizontalLine">'+_t("52","Горизонтальная линия")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="VerticalLine">'+_t("53","Вертикальная линия")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="Channel">'+_t("54","Канал")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="Trend">'+_t("55","Угловой тренд")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="Arrow">'+_t("62","Стрелка")+' <i class="uk-float-right"></i></a></li><li class="uk-nav-divider"></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="Polygon">'+_t("3012","Полигон")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="Rectangle">'+_t("3013","Прямоугольник")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="Triangle">'+_t("56","Треугольник")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="Ellipse">'+_t("58","Эллипс")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="FibonacciArc">'+_t("59","Арки Фибоначчи")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="FibonacciFan">'+_t("60","Веер Фибоначчи")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="FibonacciCorrection">'+_t("61","Коррекция Фибоначчи")+' <i class="uk-float-right"></i></a></li><li class="uk-nav-divider"></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="Text">'+_t("64","Вставить текст")+' <i class="uk-float-right"></i></a></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-instrument" data-instrument="Bubble">'+_t("3008","Текст c указателем")+' <i class="uk-float-right"></i></a></li><li class="uk-nav-divider"></li><li class="uk-dropdown-close"><a href="javascript:void(0);" class="js-iChartTools-removeInstrument">'+_t("15227","Очистить график")+' <i class="uk-float-right"></i></a></li></ul></div></div></div></div>');var iChartDataSource={data:{},dataSettings:{useHash:!1,date_from:formatDate(-90),date_to:formatDate(0),graphicIndicators:"",timeframe:1440,hash:"",id:"MICEX:SBER",interval:"D1",compareIds:"",compareStocks:"",compareTickets:"",securityId:"",start:"",end:""},host:"",url:"/api/get-hloc?",getUrl:function(t){var e={securityId:t.securityId,id:t.id,compareIds:t.compareIds,compareStocks:t.compareStocks,compareTickets:t.compareTickets,count:t.count,timeframe:iChart.getChartTimeframe(t.interval),date_from:t.date_from,date_to:t.date_to,interval:t.interval,intervalMode:t.intervalMode,type:t.type,demo:t.demo};return e.hash=e.securityId.toString()+Date.parse(e.date_from).toString()+Date.parse(e.date_to).toString()+JSON.stringify(e).hashCode(),iChartDataSource.host+iChartDataSource.url+iChart.toQueryString(e)},onRequestCallback:function(t,e){if(!e.id)return 0;e.demo="undefined"!=typeof jNTUserinfo&&jNTUserinfo.isDemo?1:0;var i=e,a=this,r=this.chart;this.chart.wrapper.trigger("iguanaChartEvents",["chartDataRequest",iChartDataSource.getUrl(e)]),this.chart.ajaxDataRequest=$.ajax({dataType:"text json",error:function(e,i,a){clearTimeout(r.timers.loading),r.wrapper.trigger("iguanaChartEvents",["clearLoader"]),r.viewData.chart.setSelectionMode("pan"),t({warnings:["Ошибка: "+i+"."],success:!1})},success:function(e,s,n){r.wrapper.trigger("iguanaChartEvents",["chartDataReceived",e]),e=a.dataAdapter(e,i),clearTimeout(r.timers.loading),r.wrapper.trigger("iguanaChartEvents",["clearLoader"]),r.viewData.chart.setSelectionMode("pan"),0==e.success&&console.log("ERROR:",e.d.Message),t(e?e:{warnings:[_t("2125","Ошибка: пустой ответ.")],success:!1}),r.response=e.d,r.wrapper.trigger("iguanaChartEvents",["chartDataReady",e]),r.fixViewport(),r.updateUnlocked=!0},url:iChartDataSource.getUrl(e)})},preInitCallback:function(t,e){var i=this;if("undefined"==typeof e&&(e={}),e.ticker=e.ticker||this.chart.dataSource.dataSettings.id||"SBER",e.f_history="undefined"==typeof e.f_history?0:e.f_history,this.chart.userSettings=$.extend(!0,{},$iguanaChart.defaultSettings,e.userSettings),e.hash){this.chart.dataSource.dataSettings.hash=e.hash;var a=iChart.parseQueryString(e.hash.substr(1));for(var r in this.chart.dataSource.dataSettings)a[r]&&(this.chart.dataSource.dataSettings[r]=a[r]);var s=[];for(var n in a)if(n.match(new RegExp("^i[0-9]","i"))){var o=n.charAt(0)+n.substr(1);s[o]=a[n]}s.length&&(this.chart.dataSource.dataSettings.graphicIndicators=iChart.toQueryString(s)),e.ticker=a.ticker,e.securityId=a.securityId,e.interval=a.interval}$.getJSON(iChartDataSource.host+"/api/get-security-info-json",{id:e.securityId,ticker:e.ticker,f_history:e.f_history},function(a){i.chart.userSettings.currentSecurity=a,i.chart.dataSource.dataSettings.useHash=!1,i.chart.dataSource.dataSettings.id=a.nt_ticker,i.chart.dataSource.dataSettings.securityId=a.id,i.chart.dataSource.dataSettings.intervalRestriction="",e.chartOptions.watermarkText=a.nt_ticker,e.chartOptions.watermarkSubText=a.short_name,"undefined"!=typeof e.type&&(e.chartOptions.chartType=e.type),t(e.chartOptions)})}};if(IguanaChart=function(t){"use strict";var e=this;this.name=t.name||"chart",this.container=t.container||"#iChart-chart-container",this.wrapper=t.wrapper,this.lib_path=t.lib_path||"/iguanachart/",this.toQueryString=function(t){var e=[];for(var i in t){var a=t[i];if("undefined"!=typeof a&&""!==a)if($.isArray(a))for(var r=0;r<a.length;++r)e.push(encodeURIComponent(i)+"="+encodeURIComponent(a[r]));else e.push(encodeURIComponent(i)+"="+encodeURIComponent(a))}return e.join("&")},this.dataSource=new iChart.Charting.ChartDataSource(this,t.dataSource),this.userSettings={chartSettings:{contextSettings:{fillStyle:"rgba(82,175,201,.2)",strokeStyle:"rgba(82,175,201,1)",lineWidth:1},fontSettings:{famaly:"Arial,Helvetica,sans-serif",color:"#444444",size:"14"},indicatorsColor:{},indicatorsWidth:{},showTransactionsMode:0,tradingToolsEnable:1,autochartistEnable:0,showVolume:"inside",showVolumeByPrice:!1,defaultTheme:1},currentSecurity:{id:"",short_name:"",default_ticker:"",nt_ticker:"",firstDate:"",currency:"",min_step:""}},this.viewData={},this.viewData.indicators=iChart.indicators,this.timers={},this.ajaxDataRequest=null,this.orders={},this.userTransactionAmount=-1,this.updateUnlocked=!0,this.initChart=function(t){if(this.uiGraphIndicatorsWindow2={element:$(this.wrapper).find(".js-chartTADialog."+this.name)},this.loadHash(),"object"!=typeof t&&(t={}),this.settings={},this.settings.paddingBottom="undefined"!=typeof t.paddingBottom?t.paddingBottom:50,"undefined"==typeof this.viewData.chart){var i={onPostRender:function(){e.checkDateInterval(new Date(1e3*this.areas[0].xSeries[this.areas[0].viewport.x.bounded.min]),new Date(1e3*this.areas[0].xSeries[this.areas[0].viewport.x.bounded.max])),$("#chartLoading").remove(),e.wrapper.trigger("iguanaChartEvents",["RenderChartSuccess"])},onCreateAreas:this.chart_onCreateAreas,onDataSettingsChange:this.chart_onDataSettingsChange,onIntervalChange:this.chart_onIntervalChange,contextmenuCallback:t.contextmenuCallback,container:$(this.container).get(0),dataSettings:this.getChartDataUserSettings(),widget:t.widget,env:this};i=$.extend(!0,i,t),this.viewData.chart=new iChart.Charting.Chart(i),this.TA=new iChart.Charting.TA({chart:this.viewData.chart}),this.viewData.chart.setDataSettings(this.dataSource.dataSettings),this.ui=new iChart.ui(this)}else this.viewData.chart.chartOptions=$.extend(!0,this.viewData.chart.chartOptions,t),this.viewData.chart.setDataSettings(this.getChartDataUserSettings());this.ui.render(),$(window).off("mousemove").on("mousemove",function(t){$(window).data("mousePosX",t.pageX),$(window).data("mousePosY",t.pageY)})},this.chart_dataAdapter=function(t,e){var i={d:{xSeries:[],ySeries:[],success:!0,warnings:[],message:""}},a={chartType:"Column",enabled:!0,formatProvider:{decimalPlaces:"2",decimalPrecision:null},indicatorIndex:null,indicatorIndex2:null,kind:"HLOC",name:e.id,overlay:!1,points:[],valuesPerPoint:4},r={chartType:"Column",enabled:!0,formatProvider:{decimalPlaces:null,decimalPrecision:null},indicatorIndex:null,indicatorIndex2:null,kind:"Volume",name:e.id+" - V",overlay:!1,points:[],valuesPerPoint:1};if(t.hloc){var s=Object.keys(t.hloc);if(1==s.length){i.d.ySeries[0]=$.extend(!0,{},a),i.d.ySeries[1]=$.extend(!0,{},r),i.d.ySeries[0].name=s[0];for(var n=0;n<t.xSeries[s[0]].length;n++)i.d.xSeries.push(+t.xSeries[s[0]][n]+getTimeOffsetServer(tzOffsetMoscow)),i.d.ySeries[0].points.push(t.hloc[s[0]][n]),i.d.ySeries[1].points.push([t.vl[s[0]][n]])}else if(s.length>1){for(var o={},h=0;h<s.length;h++)for(var n=0;n<t.xSeries[s[h]].length;n++)"undefined"==typeof o[t.xSeries[s[h]][n]]&&(o[t.xSeries[s[h]][n]]={}),o[t.xSeries[s[h]][n]][s[h]]=t.hloc[s[h]][n];for(var h=0;h<s.length;h++)i.d.ySeries[h]=$.extend(!0,{},a),i.d.ySeries[h].name=s[h];for(var l in o){i.d.xSeries.push(+l+getTimeOffsetServer(tzOffsetMoscow));for(var h=0;h<s.length;h++)"undefined"==typeof o[l][s[h]]?i.d.ySeries[h].points.push([null,null,null,null]):i.d.ySeries[h].points.push(o[l][s[h]])}}}return i},this.chart_onCreateAreas=function(){},this.chart_onDataSettingsChange=function(t){var i=0==e.dataSource.dataSettings.useHash?e.dataSource.dataSettings.hash:document.location.hash,a=iChart.parseQueryString(i.substr(1)),r={};for(var s in a)(s.match(/^L$/)||s.match(/^L[0-9]{1,2}_/))&&(r[s]=a[s]);delete this._dataSettings.hash;var n="#"+iChart.toQueryString($.extend(this._dataSettings,r));e.viewData.hash=n,0==e.dataSource.dataSettings.useHash?e.dataSource.dataSettings.hash!=n&&(e.dataSource.dataSettings.hash=n,$(this.container).trigger("iguanaChartEvents",["hashChanged",n])):document.location.hash!=n&&(document.location.hash=n,$(this.container).trigger("iguanaChartEvents",["hashChanged",n]))},this.chart_onIntervalChange=function(t){e.viewData.chart&&e.viewData.chart.updateVolumeByPrice()},this.toggleVolumeByPrice_onClick=function(){if(this.viewData.chart.chartOptions.showVolumeByPrice=!this.viewData.chart.chartOptions.showVolumeByPrice,this.viewData.chart&&this.viewData.chart.areas){var t=$.grep(this.viewData.chart.areas,function(t){return"ChartArea2"===t.name})[0];t&&(this.viewData.chart.updateVolumeByPrice(),t.enabled=this.viewData.chart.chartOptions.showVolumeByPrice),this.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}},this.VolumeByPrice_onClick=function(t){if(e.viewData.chart.chartOptions.showVolumeByPrice="undefined"!=typeof t?t:!e.viewData.chart.chartOptions.showVolumeByPrice,e.viewData.chart&&e.viewData.chart.areas){var i=$.grep(e.viewData.chart.areas,function(t){return"VolumeByPriceArea"===t.name})[0];i&&e.viewData.chart.updateVolumeByPrice(),e.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}},this.VolumeByDate_onClick=function(t){if(t===!0||t===!1?e.viewData.chart.chartOptions.showVolume=t?"inside":"hidden":e.viewData.chart.chartOptions.showVolume="inside"==t||"outside"==t?t:"inside"===e.viewData.chart.chartOptions.showVolume||"outside"===e.viewData.chart.chartOptions.showVolume?"hidden":"inside",e.viewData.chart&&e.viewData.chart.areas){var i=$.grep(e.viewData.chart.areas,function(t){return"ChartArea2"===t.name})[0];i&&(i.enabled="inside"===e.viewData.chart.chartOptions.showVolume||"outside"===e.viewData.chart.chartOptions.showVolume),e.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}},this.addInstrument_onClick=function(){$("#iChart-chart-instruments").show()},this.apply_onClick=function(){e.update()},this.chartType_onChange=function(){var t=$(this).val();e.viewData.chart&&(e.viewData.chart.setChartType(t),e.chartType_elementControl(t)),e.setHashValue("type",t),e.viewData.chart.setChartType(t)},this.chartType_elementControl=function(t){$("div.chartType").removeClass("active"),$("div.chartType div.isMenu").hide(),$('div[value="'+t+'"]').addClass("active"),$('div[value="'+t+'"] div.isMenu').show()},this.clearIndicators_onClick=function(){for(var t=0;t<30;++t)$("[name='i"+t+"']").val("").trigger("change"),e.updateIndicatorDetails("i"+t,!1);e.viewData.chart&&e.viewData.chart.clearIndicators()},this.getChartDataUserSettings=function(){var t={};return t.id=this.dataSource.dataSettings.id,t.date_from=this.dataSource.dataSettings.date_from,t.date_to=this.dataSource.dataSettings.date_to,t.start=this.dataSource.dataSettings.date_from,t.end=this.dataSource.dataSettings.date_to,t.interval=this.dataSource.dataSettings.interval,t.timeframe=iChart.getChartTimeframe(this.dataSource.dataSettings.interval),t.securityId=this.dataSource.dataSettings.securityId,t.type=this.dataSource.dataSettings.type,t.compareIds=this.dataSource.dataSettings.compareIds,t.compareTickets=this.dataSource.dataSettings.compareTickets,t.compareStocks=this.dataSource.dataSettings.compareStocks,$.extend(t,iChart.parseQueryString(this.dataSource.dataSettings.graphicIndicators)),t},this.getMinChartHeight=function(){var t=$(this.container);return 0!=t.length?$(window).height()-t.offset().top-(this.settings&&this.settings.paddingBottom?this.settings.paddingBottom:0):$(window).height()},this.indicator_onChange=function(){e.updateIndicatorDetails($(this).attr("name").substr(1),{name:$(this).val()})},this.loadHash=function(t){var e=$("[name=graphicIndicators]").val(),i=this.dataSource.dataSettings.hash||"#"+e||"#&i0=SMA&i0_Period=10&i1=PSAR&i1_Acceleration=0.02&i1_Maximum=0.2",a=iChart.parseQueryString(i.substr(1));if("undefined"!=typeof this.viewData.chart){var r=iChart.parseQueryString(localStorage.userSettingsGraphicIndicators);"object"!=typeof r||$.isEmptyObject(r)||$.extend(a,r)}return a},this.pan_onClick=function(){e.viewData.chart&&e.viewData.chart.pan($(this).attr("data-direction"))},this.timeframe_onChange=function(){this.update()},this.removeSelectedInstrument_onClick=function(){return e.viewData.chart.overlay&&e.viewData.chart.overlay.removeSelected(),$("#iChart-chart-instruments").hide(),!1},this.removeAllInstruments_onClick=function(){return e.viewData.chart.overlay&&e.viewData.chart.overlay.clear(),$("#iChart-chart-instruments").hide(),$(".m-chart-instrument-delete, .m-chart-instrument-settings").hide(),!1},this.resetZoom_onClick=function(){e.viewData.chart&&e.viewData.chart.resetZoom()},this.selectInstrument_onClick=function(){var t=$(this);if(t.addClass("active"),e.viewData.chart.overlay){e.viewData.chart.overlay.start(t.attr("data-instrument"));var i=t.find("i").attr("class");$("."+i).eq(0).parents(".isMenu").children("i").attr("class",t.find("i").attr("class"))}return $("#iChart-chart-instruments").hide(),!1},this.update=function(){var t=this.getChartDataUserSettings();0!=this.dataSource.dataSettings.useHash&&this.setHashValues(t),this.viewData.chart&&this.viewData.chart.setDataSettings(t)},this.updateForce=function(){var t=this.getChartDataUserSettings();0!=this.dataSource.dataSettings.useHash&&this.setHashValues(t),this.viewData.chart&&this.viewData.chart.setDataSettings(t,!0)},this.updateChart_onClick=function(){this.update()},this.removeIndicator_onClick=function(){$(this).parents(".js-chart-indiacator-block").remove()},this.addIndicator_onClick=function(){if(e.uiGraphIndicatorsWindow2.element.is(":visible")){var t=e.deserializeIndicators(e.uiGraphIndicatorsWindow2.element.find(":input").serialize(),!1);e.updateIndicatorDetails(t.length,"")}},this.serializeIndicators=function(t){for(var e="",i=0;i<t.length;i++)if(e+="i"+i+"="+t[i].name+"&",t[i].params)for(var a in t[i].params)e+="i"+i+"_"+a+"="+t[i].params[a]+"&";return e},this.deserializeIndicators=function(t,e){e="undefined"==typeof e||!!e;var i=iChart.parseQueryString(t),a=[];for(var r in i)if("fs"===r||r.match(new RegExp("^i[0-9]+","i"))){var s=r.match(new RegExp("^i([0-9])+_","i")),n=r.match(new RegExp("^i([0-9])+$","i"));n?(a[+n[1]]||(a[+n[1]]={}),a[+n[1]].name=i[r]):s&&(a[+s[1]]||(a[+s[1]]={}),a[+s[1]].params||(a[+s[1]].params={}),a[+s[1]].params[r.replace(/i[0-9]+_/i,"")]=+i[r])}return e&&(a=a.filter(function(t){return void 0!=t})),a},this.updateIndicatorDetails=function(t,e,i){i=!!i;var a=this.uiGraphIndicatorsWindow2.element.find(".js-chartTADialog-i"+t+"-settings");if(!a.length){var r='<option value="">'+_t("14773","Выберите индикатор")+"</option>";for(var s in this.viewData.indicators)"TA_LIB"==this.viewData.indicators[s].type&&(r+='<option value="'+s+'" '+(s==e.name?"selected":"")+">"+this.viewData.indicators[s].name+"</option>");var n='<div style="border-bottom: 1px solid rgba(0, 0, 0, 0.12)" class="js-chart-indiacator-block tm-pad-large js-chartTADialog-i'+t+'-settings" id="iChart-i'+t+'-settings"><div class="uk-panel"><div class="uk-flex uk-flex-middle uk-flex-space-between uk-margin-small-bottom"><div class="uk-h4">'+_t("12834","Индикатор")+" "+(t+1)+'</div><div class="js-indicator-remove uk-icon-close uk-panel-hover uk-badge uk-button uk-button-mini"></div></div><div class="uk-form"><select name="i'+t+'" class="indicatorsSelect">'+r+"</select></div></div></div>";this.uiGraphIndicatorsWindow2.element.find(".js-chartTADialogContainer").append(n),a=this.uiGraphIndicatorsWindow2.element.find(".js-chartTADialog-i"+t+"-settings")}$(".iChart-indicator-description, .iChart-indicator-parameters, .iChart-indicator-colors, .iChart-indicator-width",a).remove();var o=this.viewData.indicators[e.name]||{description:"",parameters:[]};$("<div/>",{class:"iChart-indicator-description"}).html(o.description).appendTo(a);for(var h=o.parameters,l=0;l<h.length;++l){var c="i"+t+"_"+h[l].Code,d=$("<div/>",{class:"iChart-indicator-parameters uk-form",text:h[l].Name+": "}).appendTo(a);$("<input/>",{name:c,type:"text",value:h[l].Value}).css({width:"50px"}).appendTo(d)}var p=$("<div/>",{class:"iChart-indicator-colors",id:"iChart-indicator-colors"}).appendTo(a),u=$("<div/>",{class:"iChart-indicator-width",id:"iChart-indicator-width"}).appendTo(a),g=t;if(this.viewData.indicators[e.name])for(var f=0;f<this.viewData.indicators[e.name].output;f++)if("undefined"!=typeof this.viewData.chart){var m=this.viewData.chart.chartOptions.indicatorColors[g][f];this.userSettings.chartSettings.indicatorsColor[e.name]&&this.userSettings.chartSettings.indicatorsColor[e.name][g]&&this.userSettings.chartSettings.indicatorsColor[e.name][g][f]&&(m=this.userSettings.chartSettings.indicatorsColor[e.name][g][f]),$("<input/>",{type:"hidden",class:"iChart-indicator-color iChart-indicator-color-"+g+f,id:"iChart-indicator-color-"+g+f,indicator:e.name,colorIndex:g+"-"+f,"ui-pos":g<2?"bottom":"top"}).val(m).appendTo(p),this.initInsrMinicolors($(".iChart-indicator-color-"+g+f));var v=2;this.userSettings.chartSettings.indicatorsWidth[e.name]&&this.userSettings.chartSettings.indicatorsWidth[e.name][g]&&this.userSettings.chartSettings.indicatorsWidth[e.name][g][f]&&(v=this.userSettings.chartSettings.indicatorsWidth[e.name][g][f]);var y=$('<span class="lineWidth indicatorWidthSelector-'+g+f+'" data-chartName="'+this.name+'" data-style="'+v+'"></span>').appendTo(u);$('<div class="indicatorMenuHolder-'+g+f+'" data-chartName="'+this.name+'" style="display: none" widthIndex="'+g+"-"+f+'"><div widthIndex="'+g+"-"+f+'" indicator="'+e.name+'"><span class="lineWidth js-lineWidth '+this.name+'" data-style="1"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="2"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="3"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="4"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="5"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="8"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="10"></span></div></div>').appendTo(u),this.initIndicatorWidthMenu(y,$(".indicatorMenuHolder-"+g+f+"[data-chartName='"+this.name+"']").html())}i&&this.update()},this.setIndicators=function(t){if(window.localStorage.setItem("userSettingsGraphicIndicators",t),this.dataSource.dataSettings.graphicIndicators=t,this.setScheduleUpdateState(0),this.TA.removeIndicator(),"undefined"!=typeof e.TA){var i=iChart.parseQueryString(this.dataSource.dataSettings.graphicIndicators);$.each(i,function(t,a){var r={};if(a&&t.match(/^i[0-9]+$/)&&e.viewData.indicators[a]&&"TA_LIB"==e.viewData.indicators[a].type){for(var s=t.match(/^i([0-9]+)$/)[1],n=0;n<e.viewData.indicators[a].parameters.length;n++){var o=e.viewData.indicators[a].parameters[n];r[o.Code]=i[t+"_"+o.Code]}e.TA[a](0,s),e.TA[a](1,s,r)}})}this.wrapper.trigger("iguanaChartEvents",["hashChanged"]),this.wrapper.trigger("iguanaChartEvents",["indicatorsChanged",this.deserializeIndicators(this.dataSource.dataSettings.graphicIndicators)]),this.timers.updateInterval&&this.setScheduleUpdateState(1,this.timers.updateInterval)},this.showIndicators=function(t){t=t||{},this.timers.updateInterval=this.viewData.chart.chartOptions.updateInterval,this.setScheduleUpdateState(0);var i=this.deserializeIndicators(this.dataSource.dataSettings.graphicIndicators);this.uiGraphIndicatorsWindow2.element.find(".js-chartTADialogContainer").empty();for(var a=0;a<i.length;a++){this.updateIndicatorDetails(a,i[a],!1);for(var r in i[a].params){var s="i"+a+"_"+r;this.uiGraphIndicatorsWindow2.element.find("[name='"+s+"']").val(i[a].params[r])}}t.forAll||this.uiGraphIndicatorsWindow2.element.find(".indicators-default").hide(),this.uiGraphIndicatorsWindow2.UIkit||($(this.wrapper).find(".js-chartTADialog."+this.name).appendTo("body"),this.uiGraphIndicatorsWindow2=UIkit.modal($(".js-chartTADialog."+this.name))),this.uiGraphIndicatorsWindow2.show(),$(".indicators-set").off("click touchend"),$(".indicators-close").off("click touchend"),$(".indicators-set").on("click touchend",function(){return window.localStorage.setItem("userSettingsIndicatorsColor",JSON.stringify(e.userSettings.chartSettings.indicatorsColor)),window.localStorage.setItem("userSettingsIndicatorsWidth",JSON.stringify(e.userSettings.chartSettings.indicatorsWidth)),e.setIndicators(e.uiGraphIndicatorsWindow2.element.find(":input").serialize()),e.uiGraphIndicatorsWindow2.hide(),!1}),$(".indicators-close").on("click touchend",function(){return e.uiGraphIndicatorsWindow2.hide(),e.timers.updateInterval&&e.setScheduleUpdateState(1,e.timers.updateInterval),!1})},this.window_onHashChange=function(){if("undefined"!=typeof e){if(0==e.dataSource.dataSettings.useHash)var t=e.dataSource.dataSettings.hash;else var t=document.location.hash;if(decodeURIComponent(t)!==decodeURIComponent(e.viewData.hash)){if(e.loadHash(),e.update(),"undefined"==typeof e.viewData.chart)return;e.viewData.chart.overlay&&e.viewData.chart.overlay.update()}}},this.zoom_onClick=function(){e.viewData.chart&&e.viewData.chart.zoom($(this).attr("data-zoom"))},this.percentMode_onClick=function(){return e.viewData.chart.chartOptions.percentMode?$("#percentMode").removeClass("active"):$("#percentMode").addClass("active"),e.viewData.chart.chartOptions.percentMode=!e.viewData.chart.chartOptions.percentMode,e.updateForce(),e.viewData.chart.chartOptions.percentMode},this.iconsLoad=function(){$(["/i/admin/add.png","/iguanachart/images/buy.png","/iguanachart/images/down.png","/iguanachart/images/icon-exclamation.png","/iguanachart/images/icon-left.png","/iguanachart/images/icon-leftDown.png","/iguanachart/images/icon-leftUp.png","/iguanachart/images/icon-question.png","/iguanachart/images/icon-right.png","/iguanachart/images/icon-rightDown.png","/iguanachart/images/icon-rightUp.png","/iguanachart/images/icon-sell.png","/iguanachart/images/icon-smileDown.png","/iguanachart/images/icon-smileUp.png","/iguanachart/images/icon-up.png","/i/logo_tradernet_min.png"]).preload()},this.drawLables=function(t,e,i,a){i="undefined"==typeof i?0:i,a="undefined"==typeof a?0:a;var r=$(t).clone();$(r).children("span").remove();var s=$(r).html().split(/ &nbsp; /),n=i,o="";o=s[0].replace(/&nbsp;/g,""),e.font="normal 9px Arial,Helvetica,sans-serif",e.fillStyle="#636669",e.fillText(o,n,a),n+=e.measureText(o).width+10,$(t).children("span:odd").each(function(t,i){o=$(i).text(),e.font="bold 9px Arial,Helvetica,sans-serif",e.fillStyle=$(i).css("color"),e.fillText(o,n,a),n+=e.measureText(o).width,o=s[t+1].replace(/&nbsp;/g,""),e.font="normal 9px Arial,Helvetica,sans-serif",e.fillStyle="#636669",e.fillText(o,n,a),n+=e.measureText(o).width+10})},this.setMousewheelZoomState=function(t){t?this.viewData.chart.chartOptions.mousewheelZoom=!0:this.viewData.chart.chartOptions.mousewheelZoom=!1},this.setScheduleUpdateState=function(t){t?(this.viewData.chart.chartOptions.updateInterval=!0,this.viewData.chart.scheduleUpdate()):(this.viewData.chart.chartOptions.updateInterval=!1,this.viewData.chart.scheduleUpdate())},this.scrollBack=function(){this.viewData.chart.viewport.x.min=this.viewData.chart.areas[0].viewport.x.min,this.viewData.chart.viewport.x.max=this.viewData.chart.areas[0].viewport.x.max;var t=this.viewData.chart.viewport.x.max-this.viewData.chart.viewport.x.min,i=this.viewData.chart.viewport.x.min,a=1500+i;$("<p>").animate({width:i},{duration:a,step:function(a,r){e.viewData.chart.viewport.x.min=i-a,e.viewData.chart.viewport.x.max=e.viewData.chart.viewport.x.min+t,e.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0})}})},this.scrollForward=function(){this.viewData.chart.viewport.x.min=this.viewData.chart.areas[0].viewport.x.min,this.viewData.chart.viewport.x.max=this.viewData.chart.areas[0].viewport.x.max;var t=this.viewData.chart.viewport.x.max-this.viewData.chart.viewport.x.min,i=this.viewData.chart.areas[0].xSeries.length-1-this.viewData.chart.chartOptions.futureAmount,a=$("<p>").css({width:this.viewData.chart.viewport.x.max}),r=1500+(i-this.viewData.chart.viewport.x.max);a.animate({width:i},{duration:r,step:function(i,a){e.viewData.chart.viewport.x.max=i,e.viewData.chart.viewport.x.min=i-t,e.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0})},complete:function(){e.viewData.chart.onDataSettingsChange.call(e.viewData.chart),e.wrapper.trigger("iguanaChartEvents",["hashChanged"])}})},this.updateLastCandle=function(t){if(t){var e=t;if("undefined"!=typeof this.viewData.chart&&this.viewData.chart.areas&&this.viewData.chart.canvas&&this.viewData.chart.chartOptions.updateInterval&&e.ltp){var i=new Date(1e3*this.viewData.chart.areas[0].xSeries[this.viewData.chart.areas[0].xSeries.length-1]),a=new Date,r=new Date(a.getFullYear(),a.getMonth(),a.getDate())-6e4*this.viewData.chart._dataSettings.timeframe;
if(r<=i){var s=this.viewData.chart.areas[0].ySeries[0].points[this.viewData.chart.areas[0].ySeries[0].points.length-this.viewData.chart.chartOptions.futureAmount-1];s[3]=e.ltp,s[0]=Math.max(s[0],s[3]),s[1]=Math.min(s[1],s[3]),s[4]=e.bap,s[5]=e.bbp;var n=this.viewData.chart.canvas.getContext("2d");this.viewData.chart.render({context:n,forceRecalc:!1,resetViewport:!1,testForIntervalChange:!1})}}}},this.getLastPoint=function(){if("undefined"!=typeof this.viewData.chart&&this.viewData.chart.areas&&this.viewData.chart.canvas){var t=this.viewData.chart.areas[0].ySeries[0].points.length-this.viewData.chart.chartOptions.futureAmount-1,e=this.viewData.chart.areas[0].ySeries[0].name,i={},a={},r={};r[e]=[this.viewData.chart.areas[0].xSeries[t]],$.each(this.viewData.chart.areas,function(r,s){$.each(s.ySeries,function(r,s){$.inArray(s.kind,["HLOC","Volume"])>=0&&("HLOC"==s.kind&&(i[e]=[s.points[t]]),"Volume"==s.kind&&(a[e]=[s.points[t]]))})});var s={hloc:i,vl:a,xSeries:r};return s}},this.addTransactions=function(t,e){if("undefined"!=typeof this.viewData.chart){t:for(var i=0;i<t.length;i++){for(var a=this.viewData.chart.overlay.history,r=0;r<a.length;r++){var s=a[r];if("Trade"==s.elementType&&s.id==t[i].id)continue t}var s=this.viewData.chart.overlay.createElement("Trade");s.hasSettings=!0,s.settings=t[i],s.settings.mode=e,s.points=[{x:iChart.parseDateTime(t[i].date_time,"yyyy-MM-dd HH:mm:ss").getTime(),y:t[i].splitPrice}],s.id=t[i].id,this.viewData.chart.overlay.history.push(s),this.userTransactionAmount++}this.viewData.chart.overlay.render()}},this.removeTransactions=function(){if("undefined"!=typeof this.viewData.chart){for(var t=this.viewData.chart.overlay.history,e=0;e<t.length;e++){var i=t[e];"Trade"==i.elementType&&(t.splice(e,1),e--)}this.userTransactionAmount=-1,this.viewData.chart.overlay.render()}},this.setButton=function(t){if("undefined"!=typeof this.viewData.chart){var e=this.viewData.chart.overlay.createElement("Button");e.hasSettings=!0,e.setSettings(t),e.points=[{x:t.point,y:t.price}],this.viewData.chart.overlay.history.push(e)}},this.updateNewOrderButton=function(){var t=this.viewData.chart.areas[0].getXPositionByIndex(this.viewData.chart.areas[0].xSeries.length-1-this.viewData.chart.chartOptions.futureAmount)+50;t=Math.min(t,this.viewData.chart.areas[0].getXPositionByIndex(this.viewData.chart.areas[0].xSeries.length-1));var i=1e3*this.viewData.chart.areas[0].getXValue(t),a=this.viewData.chart.areas[0].ySeries[0].points[this.viewData.chart.areas[0].ySeries[0].points.length-this.viewData.chart.chartOptions.futureAmount-1],r=this.getNewOrderButton();if(r)r.points[0].x=i,r.points[0].y=a[3];else{var s=function(){var t=e.viewData.chart.areas[0].ySeries[0].points[e.viewData.chart.areas[0].ySeries[0].points.length-e.viewData.chart.chartOptions.futureAmount-1],i=function(){e.addVisualTradeUI()};jNTChartTrading.show(e.userSettings.currentSecurity.nt_ticker,2,iChart.roundToPrecision(t[3],e.userSettings.currentSecurity.min_step),null,null,i),e.removeNewOrderButton()};this.setButton({point:i,price:a[3],click:s})}},this.getNewOrderButton=function(){if("undefined"!=typeof this.viewData.chart)for(var t=this.viewData.chart.overlay.history,e=0;e<t.length;e++){var i=t[e];if("Button"==i.elementType)return i}return!1},this.removeNewOrderButton=function(){if("undefined"!=typeof this.viewData.chart)for(var t=this.viewData.chart.overlay.history,e=0;e<t.length;e++){var i=t[e];"Button"==i.elementType&&(t.splice(e,1),e--)}},this.removeLevel=function(){if("undefined"!=typeof this.viewData.chart)for(var t=this.viewData.chart.overlay.history,e=0;e<t.length;e++){var i=t[e];"Level"==i.elementType&&(t.splice(e,1),e--)}},this.addLevel=function(t){if("undefined"!=typeof this.viewData.chart){this.removeLevel();var e=this.viewData.chart.overlay.createElement("Level");return e.hasSettings=!0,e.points=[{x:new Date,y:t.price}],e.setSettings(t),this.viewData.chart.overlay.history.push(e),this.viewData.chart.render({forceRecalc:!0,resetViewport:!0,testForIntervalChange:!1}),e}return!1},this.fixViewport=function(){"undefined"!=typeof this.viewData.chart&&this.viewData.chart.areas&&this.viewData.chart.areas[0].viewport.x.max==this.viewData.chart.areas[0].viewport.x.min&&(this.viewData.chart.viewport.x.max=this.viewData.chart.areas[0].viewport.x.max-this.viewData.chart.chartOptions.futureAmount,this.viewData.chart.viewport.x.min=Math.max(this.viewData.chart.areas[0].viewport.x.max-this.viewData.chart.chartOptions.futureAmount-30,0),this.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}))},this.switchTrading=function(){this.userSettings.chartSettings.tradingToolsEnable=this.userSettings.chartSettings.tradingToolsEnable?0:1,window.localStorage.setItem("userSettingsTradingToolsEnable",this.userSettings.chartSettings.tradingToolsEnable),$(this.container).trigger("iguanaChartEvents",["chartTradingTools",this.userSettings.chartSettings.tradingToolsEnable])},this.tradingToolsControl=function(){this.userSettings.chartSettings.tradingToolsEnable},this.addEvents=function(t){t=t||[];for(var e=0;e<t.length;e++){var i=this.viewData.chart.overlay.createElement("Event");i.hasSettings=!0;var a=$.extend({},t[e]);i.setSettings(a),i.points=[{x:a.x,y:a.y}],i.id="Event",this.viewData.chart.overlay.history.push(i)}this.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})},this.clearEvents=function(){if("undefined"!=typeof this.viewData.chart){for(var t=this.viewData.chart.overlay.history,e=0;e<t.length;e++){var i=t[e];"Event"==i.elementType&&(t.splice(e,1),e--)}this.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}},this.checkDateInterval=function(t,e){var i=iChart.formatDateTime(new Date(t),"dd.MM.yyyy HH:mm"),a=iChart.formatDateTime(new Date(e),"dd.MM.yyyy HH:mm"),r=!1;this.dataSource.dataSettings.date_from==i&&this.dataSource.dataSettings.date_to==a||(r=!0),this.dataSource.dataSettings.date_from=i,this.dataSource.dataSettings.date_to=a,this.dataSource.dataSettings.start=i,this.dataSource.dataSettings.end=a;var s=this.dataSource.dataSettings.interval,n=((new Date).getTime()-t)/864e5,o=new Array;o.push("I1"),o.push("I5"),o.push("I15"),o.push("H1"),o.push("D1"),o.push("D7");var h={};n>93?h={I1:"D1",I5:"D3",I15:"D7",H1:"M1"}:n<93&&n>=32?h={I1:"D1",I5:"D3",I15:"D7"}:n<32&&n>=10?h={I1:"D1",I5:"D3"}:n<10&&n>=3&&(h={I1:"D1"});for(var l=new Array,c=0;c<o.length;c++){var d=intervalNames(o[c])+("undefined"!=typeof h[o[c]]?" > "+intervalShortNames(h[o[c]]):"");l.push({text:d,value:o[c],restriction:h[o[c]]})}this.dataSource.dataSettings.interval=s;var p={restriction:h,dataSource:l,value:s,text:intervalNames(s)};return JSON.stringify(this.dataSource.dataSettings.intervalRestriction)!=JSON.stringify(h)&&s==this.dataSource.dataSettings.interval&&(this.dataSource.dataSettings.intervalRestriction=h,$(this.container).trigger("iguanaChartEvents",["intervalRestriction",p])),p},this.checkPeriodInterval=function(t,e){void 0===e&&(e=!0);var i,a=new Date,r=new Date;switch(i=$(t).val()){case"D1":break;case"D7":r.setDate(a.getDate()-7);break;case"M1":r.setMonth(a.getMonth()-1);break;case"M3":r.setMonth(a.getMonth()-3);break;case"M6":r.setMonth(a.getMonth()-6);break;case"Y1":r.setFullYear(a.getFullYear()-1);break;case"Y5":r.setFullYear(a.getFullYear()-5);break;default:r.setMonth(a.getMonth()-3)}if(i)$("#date_to").val(iChart.formatDateTime(a,"dd.MM.yyyy")),$("#date_from").val(iChart.formatDateTime(r,"dd.MM.yyyy"));else{var s=(Date.parse($("#date_to").val())-Date.parse($("#date_from").val()))/1e3;"D1"==$("#interval").val()&&s<86400?$("#date_from").val(iChart.formatDateTime(new Date(Date.parse($("#date_from").val()).getTime()-6048e5),"dd.MM.yyyy")):"D7"==$("#interval").val()&&s<604800&&$("#date_from").val(iChart.formatDateTime(new Date(Date.parse($("#date_from").val()).getTime()-12096e5),"dd.MM.yyyy"))}},this.checkPeriod=function(t){var e=iChart.parseDateTime(this.dataSource.dataSettings.date_to),i=iChart.parseDateTime(this.dataSource.dataSettings.date_to);switch(t){case"D1":break;case"D7":i.setDate(e.getDate()-7);break;case"M1":i.setMonth(e.getMonth()-1);break;case"M3":i.setMonth(e.getMonth()-3);break;case"M6":i.setMonth(e.getMonth()-6);break;case"Y1":i.setFullYear(e.getFullYear()-1);break;case"Y5":i.setFullYear(e.getFullYear()-5);break;default:i.setMonth(e.getMonth()-3)}if(t)this.dataSource.dataSettings.date_from=iChart.formatDateTime(i,"dd.MM.yyyy"),this.dataSource.dataSettings.date_to=iChart.formatDateTime(e,"dd.MM.yyyy");else{var a=(iChart.parseDateTime(this.dataSource.dataSettings.date_from).getTime()-iChart.parseDateTime(this.dataSource.dataSettings.date_to).getTime())/1e3;"D1"==this.dataSource.dataSettings.interval&&a<86400?this.dataSource.dataSettings.date_from=iChart.formatDateTime(new Date(iChart.parseDateTime(this.dataSource.dataSettings.date_from).getTime()-6048e5),"dd.MM.yyyy"):"D7"==this.dataSource.dataSettings.interval&&a<604800&&(this.dataSource.dataSettings.date_from=iChart.formatDateTime(new Date(iChart.parseDateTime(this.dataSource.dataSettings.date_from).getTime()-12096e5),"dd.MM.yyyy"))}this.checkDateInterval(iChart.parseDateTime(this.dataSource.dataSettings.date_from),iChart.parseDateTime(this.dataSource.dataSettings.date_to))},this.setHashValue=function(t,e){if(0==this.dataSource.dataSettings.useHash)var i=this.dataSource.dataSettings.hash;else var i=document.location.hash;var a=iChart.parseQueryString(i.substr(1));a[t]=e;var r="#"+iChart.toQueryString(a);r!==i&&(0==this.dataSource.dataSettings.useHash?this.dataSource.dataSettings.hash=r:document.location.hash=r,$(this.container).trigger("iguanaChartEvents",["hashChanged",r]))},this.setHashValues=function(t){if(0==this.dataSource.dataSettings.useHash)var e=this.dataSource.dataSettings.hash;else var e=document.location.hash;var i=iChart.parseQueryString(e.substr(1));for(var a in t)t.hasOwnProperty(a)&&(i[a]=t[a]);var r="#"+iChart.toQueryString(i);r===e||$.isEmptyObject(i)||(0==this.dataSource.dataSettings.useHash?this.dataSource.dataSettings.hash=r:document.location.hash=r,$(this.container).trigger("iguanaChartEvents",["hashChanged",r]))},this.initInsrMinicolors=function(t){var i=t.val();$(t).minicolors({animationSpeed:50,animationEasing:"swing",change:null,changeDelay:0,control:"hue",defaultValue:i,hide:null,hideSpeed:100,inline:!1,letterCase:"lowercase",opacity:!1,position:t.attr("ui-pos")+" left",show:null,showSpeed:100,theme:"default"}).change(function(){var t=$(this).attr("colorIndex").split("-")[0],i=$(this).attr("colorIndex").split("-")[1],a=$(this).attr("indicator");$.isArray(e.userSettings.chartSettings.indicatorsColor)&&(e.userSettings.chartSettings.indicatorsColor={}),e.userSettings.chartSettings.indicatorsColor[a]||(e.userSettings.chartSettings.indicatorsColor[a]=[]),e.userSettings.chartSettings.indicatorsColor[a][t]||(e.userSettings.chartSettings.indicatorsColor[a][t]=Array(e.viewData.indicators[a].output)),e.userSettings.chartSettings.indicatorsColor[a][t][i]=$(this).val()})},this.initIndicatorWidthMenu=function(t,e){$(t).qtip({style:{classes:"qtip-light"},position:{at:"left bottom",my:"top left",effect:!1},content:{text:e},hide:{fixed:!0,delay:300,effect:function(){$(this).slideUp(500)}},show:{solo:!0,effect:function(){$(this).slideDown(500)}},events:{show:function(t,e){}}})},this.setIndicatorWidth=function(t){var e=$(t).parent().attr("widthIndex").split("-")[0],i=$(t).parent().attr("widthIndex").split("-")[1],a=$(t).parent().attr("indicator");$.isArray(this.userSettings.chartSettings.indicatorsWidth)&&(this.userSettings.chartSettings.indicatorsWidth={}),this.userSettings.chartSettings.indicatorsWidth[a]||(this.userSettings.chartSettings.indicatorsWidth[a]=[]),this.userSettings.chartSettings.indicatorsWidth[a][e]||(this.userSettings.chartSettings.indicatorsWidth[a][e]=Array(this.viewData.indicators[a].output)),$(".indicatorWidthSelector-"+e+i+"[data-chartName='"+this.name+"']").attr("data-style",$(t).attr("data-style")),this.userSettings.chartSettings.indicatorsWidth[a][e][i]=$(t).attr("data-style")},this.getIndicatorParameters=function(t){var e={};if("undefined"!=typeof this.viewData.indicators[t])for(var i=0;i<this.viewData.indicators[t].parameters.length;i++)e[this.viewData.indicators[t].parameters[i].Code]=this.viewData.indicators[t].parameters[i].Value;return e},this.setIndicator=function(t,e,i){if(i=i||0,"undefined"==typeof this.viewData.indicators[t])throw new Error("Indicator '"+t+"' is not supported.");e=e||this.getIndicatorParameters(t);var a={};a["i"+i]=t;for(var r in e)a["i"+i+"_"+r]=e[r];var s=iChart.parseQueryString(this.dataSource.dataSettings.graphicIndicators);for(var n in s)n.match(new RegExp("^i"+i+"_","i"))&&delete s[n];s["i"+i]="",this.dataSource.dataSettings.graphicIndicators=iChart.toQueryString($.extend({},s,a)),this.updateForce()},this.getPeriodDates=function(t){var e=new Date,i=new Date;e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setDate(e.getDate()+1),i.setHours(0),i.setMinutes(0),i.setSeconds(0);var a=t.match(/([D,M,Y])(\d+)/);if(a)switch(a[1]){case"D":i.setDate(e.getDate()-+a[2]);break;case"M":i.setMonth(e.getMonth()-+a[2]);break;case"Y":i.setFullYear(e.getFullYear()-+a[2])}else i.setMonth(e.getMonth()-3);return{date_from:iChart.formatDateTime(i,"dd.MM.yyyy"),date_to:iChart.formatDateTime(e,"dd.MM.yyyy")}},this.addPoint=function(t){var e=this.dataSource.dataAdapter(t,{});this.viewData.chart._mergeData(e,{}),this.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})},this.setStyleToCanvas=function(t,e){var i=this.viewData.chart.overlay.selected;if(null!=i&&i.hasSettings){var a=i.settings;a[e]=t,i.setSettings(a)}this.userSettings.chartSettings.contextSettings[e]=t},this.setLineWidthToCanvas=function(t){var e=this.viewData.chart.overlay.selected;null!=e&&e.hasSettings&&(e.settings.lineWidth=t,e.setSettings(e.settings)),this.userSettings.chartSettings.contextSettings.lineWidth=t},"undefined"!=typeof jNTChartTrading&&("undefined"!=typeof jNTUserinfo&&jNTUserinfo.isDemo&&$iguanaChart.optionsRestore("devmode")?"function"==typeof extendIChartWithTrandorders&&extendIChartWithTrandorders.call(this):"function"==typeof extendIChartWithOrders&&extendIChartWithOrders.call(this),"function"==typeof extendIChartWithPositions&&extendIChartWithPositions.call(this),"function"==typeof extendIChartWithTradePanels&&extendIChartWithTradePanels.call(this)),this.setTrendorder=function(t){if("undefined"!=typeof this.viewData.chart){var e=this.viewData.chart.overlay.createElement("Trendorder");e.hasSettings=!0,e.setSettings(t),this.viewData.chart.overlay.history.push(e)}},this.drawTrendorder=function(){var t={date:14635809e5,price:2691,date2:14636052e5,price2:2683.5,tf:900,fillStyle:"#7cb342",strokeStyle:"#36BDF4",textColor:"#ffffff",text:"Трендовый приказ",mode:"trend",onCancel:function(){console.log(this)}};this.setTrendorder(t),this.viewData.chart.render({forceRecalc:!0,resetViewport:!0,testForIntervalChange:!1})},$(document).on("change",".indicatorsSelect",this.indicator_onChange),$(document).on("click touchend",".js-indicator-remove",this.removeIndicator_onClick),$(document).on("click touchend",".js-indicator-add",this.addIndicator_onClick),$(document).on("change","[name='timeframe']",this.timeframe_onChange),$(document).on("click touchend","[name='addInstrument']",this.addInstrument_onClick),$(document).on("click touchend","[name='apply']",this.apply_onClick),$(document).on("click touchend","[name='clearIndicators']",this.clearIndicators_onClick),$(document).on("click","[name='pan']",this.pan_onClick),$(document).on("click touchend",".js-lineWidth."+this.name,function(){e.setIndicatorWidth(this)}),$(document).on("click touchend","[name='resetZoom']",this.resetZoom_onClick),$(document).on("click touchend","[name='updateChart']",this.updateChart_onClick),$(document).on("click touchend","[name='zoom']",this.zoom_onClick),$(e.wrapper).on("iguanaChartEvents",function(t,i,a){"chartDataReady"===i&&e.viewData.chart&&e.viewData.chart.updateVolumeByPrice()}),$(e.wrapper).on("click touchend",".iChart-indicator-description a",function(t){return t.stopPropagation(),t.stopImmediatePropagation(),!1}),$(window).on("resize",function(){e.wrapper.trigger("iguanaChartEvents",["chartResize"])}),$(document).on("click touchend","[name='toggleVolumeByPrice']",this.toggleVolumeByPrice_onClick)},function(){"use strict";iChart.ui=function(t){this.chart=t;var e=this;this.$topToolsBarContainer=this.chart.wrapper.find(".iChartToolsTop"),this.render=function(){var t=this.chart.viewData.chart.chartOptions.uiTools;t.top&&this.renderTopBar()},this.renderTopBar=function(){this.$topToolsBarContainer.empty(),this.renderIndicators(),this.renderOptionsList(),this.renderInstrumentsList(),this.$topToolsBarContainer.show()},this.renderIndicators=function(){var t={indicators:Object.keys(iChart.indicators).map(function(t){return iChart.indicators[t]}),userData:this.chart.deserializeIndicators(this.chart.dataSource.dataSettings.graphicIndicators)},i=$.render.indicatorsDropdownTmpl(t);this.$topToolsBarContainer.append(i),$(this.chart.wrapper).off("click touchend",".js-add-indicator").on("click touchend",".js-add-indicator",function(){var t=$(this).data("value"),i={};iChart.indicators[t].parameters.forEach(function(t){i[t.Code]=t.Value});var a=e.chart.deserializeIndicators(e.chart.dataSource.dataSettings.graphicIndicators);a.push({name:t,params:i}),e.chart.dataSource.dataSettings.graphicIndicators=e.chart.serializeIndicators(a),e.chart.setIndicators(e.chart.dataSource.dataSettings.graphicIndicators),e.renderIndicatorsCurrent()}),$(this.chart.wrapper).off("click touchend",".js-remove-indicator").on("click touchend",".js-remove-indicator",function(t){var i=e.chart.deserializeIndicators(e.chart.dataSource.dataSettings.graphicIndicators);i.splice($(this).data("index"),1),e.chart.dataSource.dataSettings.graphicIndicators=e.chart.serializeIndicators(i),e.chart.setIndicators(e.chart.dataSource.dataSettings.graphicIndicators),e.renderIndicatorsCurrent(),t.stopPropagation(),t.preventDefault()}),$(this.chart.wrapper).off("click touchend",".js-edit-indicator").on("click touchend",".js-edit-indicator",function(t){var i=e.chart.deserializeIndicators(e.chart.dataSource.dataSettings.graphicIndicators),a=$(this).data("index"),r=$.extend({},iChart.indicators[i[a].name]);r.parameters.forEach(function(t){t.Value=i[a].params[t.Code]}),e.renderIndicatorDialog(r,a)})},this.renderIndicatorsList=function(){var t={indicators:Object.keys(iChart.indicators).map(function(t){return iChart.indicators[t]})},e=$.render.indicatorsListTmpl(t);this.$topToolsBarContainer.find(".js-iChartTools-indicators-list").html(e)},this.renderIndicatorsCurrent=function(){var t={userData:this.chart.deserializeIndicators(this.chart.dataSource.dataSettings.graphicIndicators)},e=$.render.indicatorsCurrentTmpl(t);this.$topToolsBarContainer.find(".js-iChartTools-indicators-current").html(e)},this.renderIndicatorDialog=function(t,i){$.modal.impl.d.data&&$.modal.impl.close(),$(".iChartDialog").remove();var a=$($.render.indicatorDialogTmpl(t)),r=a.find(".js-iChartTools-indicators-colorContainer"),s=a.find(".js-iChartTools-indicators-widthContainer"),n=i;if(iChart.indicators[t.value])for(var o=0;o<iChart.indicators[t.value].output;o++)if("undefined"!=typeof this.chart.viewData.chart){var h=this.chart.viewData.chart.chartOptions.indicatorColors[n][o];this.chart.userSettings.chartSettings.indicatorsColor[t.value]&&this.chart.userSettings.chartSettings.indicatorsColor[t.value][n]&&this.chart.userSettings.chartSettings.indicatorsColor[t.value][n][o]&&(h=this.chart.userSettings.chartSettings.indicatorsColor[t.value][n][o]),$("<input/>",{type:"hidden",class:"iChart-indicator-color iChart-indicator-color-"+n+o,id:"iChart-indicator-color-"+n+o,indicator:t.value,colorIndex:n+"-"+o,"ui-pos":n<2?"bottom":"top"}).val(h).appendTo(r),this.chart.initInsrMinicolors(r.find(".iChart-indicator-color-"+n+o));var l=2;this.chart.userSettings.chartSettings.indicatorsWidth[t.value]&&this.chart.userSettings.chartSettings.indicatorsWidth[t.value][n]&&this.chart.userSettings.chartSettings.indicatorsWidth[t.value][n][o]&&(l=this.chart.userSettings.chartSettings.indicatorsWidth[t.value][n][o]);var c=$('<span class="lineWidth indicatorWidthSelector-'+n+o+'" data-chartName="'+this.chart.name+'" data-style="'+l+'"></span>').appendTo(s);$('<div class="indicatorMenuHolder-'+n+o+'" data-chartName="'+this.chart.name+'" style="display: none" widthIndex="'+n+"-"+o+'"><div widthIndex="'+n+"-"+o+'" indicator="'+t.value+'"><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="1"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="2"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="3"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="4"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="5"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="8"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="10"></span></div></div>').appendTo(s),this.chart.initIndicatorWidthMenu(c,s.find(".indicatorMenuHolder-"+n+o+"[data-chartName='"+this.chart.name+"']").html())}$(document).off("click touchend",".js-set-params-indicator").on("click touchend",".js-set-params-indicator",function(t){var a=e.chart.deserializeIndicators(e.chart.dataSource.dataSettings.graphicIndicators),r=$(".js-iChartTools-indicators-params input").serializeArray();r.forEach(function(t){a[i].params[t.name]=t.value}),a=e.chart.serializeIndicators(a),e.chart.setIndicators(a),$.modal.impl.close()}),this.chart.wrapper.append(a),$(".iChartDialog").modal({modal:!1,zIndex:1500,title:_t("","Настройки индикатора")})},this.renderThemeConfigDialog=function(t){t=t||[];var i=$($.render.themeConfigTmpl());if(t){var a=i.find(".js-themeAdditionButtons");a.empty(),t.forEach(function(t){var e=$("<button/>",{class:"uk-button "+t.class,text:t.title});a.append(e)})}i.find(".js-themeConfigOptions").empty().append(this.renderThemeConfigOptions()),i.find(".js-themeConfigSelector").empty().append(this.renderThemeConfigSelector()),i.data("chartOptions",$.extend(!0,{},this.chart.wrapper.iguanaChart("chartOptions"))),this.chart.wrapper.find(".js-themeConfig").remove(),this.chart.wrapper.append(i);var r=this.chart.wrapper.find(".js-themeConfig"),s=function(){e.chart.wrapper.iguanaChart("chartOptions",i.data("chartOptions")),$.modal.impl.d.data&&$.modal.impl.close()};return r.modal({modal:!1,draggable:!0,maxWidth:600,zIndex:1500,title:_t("13754","Настройки вида"),onClose:s}),r.on("click touchend",".js-chartOptions",function(){switch($(this).attr("data-value")){case"ok":e.chart.wrapper.trigger("iguanaChartEvents",["hashChanged"]),e.chart.userSettings.chartSettings.defaultTheme=0,$.modal.impl.d.data&&$.modal.impl.close(!1);break;case"cancel":s()}}),r.on("click touchend",".js-themeSelect",function(){return e.chart.wrapper.iguanaChart("setTheme",$(this).data("theme")),i.find(".js-themeConfigOptions").empty().append(e.renderThemeConfigOptions()),!1}),r.on("click touchend",".js-themeSaveAs",function(){return UIkit.modal.prompt(_t("5228","Название")+":","",function(t){if(t){var a={name:t,settings:iChart.Charting.ChartOptions.getThemeOptions(e.chart.viewData.chart.chartOptions)};$iguanaChart.thems.push($.extend({custom:!0},a)),a=JSON.stringify(a),e.chart.wrapper.trigger("iguanaChartEvents",["themeSave",a]),i.find(".js-themeConfigSelector").empty().append(e.renderThemeConfigSelector())}}),!1}),r.on("click touchend",".js-themeDelete",function(t){var i=$(this).data("name"),a=$.grep($iguanaChart.thems,function(t,e){return t.name==i?t.i=e:null})[0];return $iguanaChart.thems.splice(a,1),r.find('.js-themeSelect[data-theme="'+i+'"]').remove(),e.chart.wrapper.trigger("iguanaChartEvents",["themeDelete",i]),t.stopPropagation(),!1}),r},this.renderThemeConfigSelector=function(){var t=$($.render.themeConfigSelectorTmpl({themes:$iguanaChart.thems}));return t},this.renderThemeConfigOptions=function(){var t=$($.render.themeConfigOptionsTmpl({chartOptions:e.chart.viewData.chart.chartOptions}));t.find(".js-widthSlector").each(function(){var t=$(this),i=t.find(".menuHolder").html();t.qtip({style:{classes:"qtip-light"},position:{at:"center right",my:"left center",effect:!1},content:{text:i},hide:{fixed:!0,delay:300,effect:function(){$(this).slideUp(500)}},show:{solo:!0,effect:function(){$(this).slideDown(500)}},events:{show:function(i,a){$(this).find(".js-widthSlectorWrapper").each(function(){var i=$(this);i.off().on("click touchend",".js-lineWidth",function(){var a=$(this).attr("data-style");e.chart.wrapper.iguanaChart("chartOptions",i.attr("data-option"),a),t.find(".js-widthSlectorValue").attr("data-style",a)})})}}})});var i=function(){var t=$(this).val(),i=$(this).attr("data-opacity"),a=iChart.hexToRGB(t,i),r=$(this).attr("data-option");e.chart.wrapper.iguanaChart("chartOptions",r,a),$(".js-colorSelector[data-option='"+r+"']").css({"background-color":a}),$(this).minicolors("value",t),$(this).minicolors("opacity",i)},a=function(){var t=this.value,i=iChart.hexToRGB(t,1),a=this.element.attr("data-option");e.chart.wrapper.iguanaChart("chartOptions",a,i),$(".js-colorSelector[data-option='"+a+"']").css({"background-color":i}),this.element.parent().find(".js-colorPicker").minicolors("value",t)};return t.find(".js-colorSelector").each(function(){var t=$(this),r=t.find(".menuHolder").html();t.qtip({style:{classes:"qtip-light"},position:{at:"center right",my:"left center",effect:!1,viewport:$(window),adjust:{method:"shift none"}},content:{text:r},hide:{fixed:!0,delay:300},show:{solo:!0},events:{show:function(t,r){$(t.currentTarget).find(".js-colorPicker").each(function(){e.addMinicolors(this,t.currentTarget,i,a)})}}})}),t.find(".js-checkbox").on("click touchend",".js-flag",function(){e.chart.wrapper.iguanaChart("chartOptions",$(this).attr("data-option"),$(this).prop("checked"))}),t},this.initMinicolors=function(t,e){e="function"==typeof e?e:function(){};var i=$(t),a=(!!i.first().attr("data-opacity"),i.first().attr("data-opacity")),r=i.first().val();$(t).minicolors({animationSpeed:50,animationEasing:"swing",change:null,changeDelay:0,control:"hue",defaultValue:r,hide:null,hideSpeed:100,inline:!0,letterCase:"lowercase",opacity:!0,position:"bottom left",show:null,showSpeed:100,theme:"default"}).change(e),r.match(/^rgb.*/)&&(a=iChart.rgbaGetAlfa(r),r=iChart.rgbToHex(r)),$(t).minicolors("value",r),$(t).minicolors("opacity",a)},this.initColorPalette=function(t,e){e="function"==typeof e?e:function(){},$(t).find(".js-colorPalette").each(function(){void 0==$(this).data("palette")&&$(this).palette({palette:"basic",columns:2,size:13,change:e})})},this.addMinicolors=function(t,e,i,a){if($(t).hasClass("minicolors-input")){var r=$(t).val(),s=$(t).attr("data-opacity");return r.match(/^rgb.*/)&&(s=iChart.rgbaGetAlfa(r),r=iChart.rgbToHex(r)),$(t).minicolors("value",r),void $(t).minicolors("opacity",s)}this.initMinicolors(t,i),this.initColorPalette(e,a)},this.renderOptionsList=function(){var t=this.chart.viewData.chart.chartOptions,i={chartType:t.chartType,percentMode:t.percentMode,showVolume:t.showVolume,showVolumeByPrice:t.showVolumeByPrice},a=$($.render.iChart_optionsTmpl(i));a.on("click touchend",".js-iChartTools-themeDialog",function(){e.renderThemeConfigDialog()}).on("click touchend",".js-iChartTools-chartType",function(){var t=$(this);a.find(".js-iChartTools-chartType i").removeClass("uk-icon-circle").addClass("uk-icon-circle-o"),t.find("i").addClass("uk-icon-circle"),e.chart.viewData.chart.setChartType(t.data("value"))}).on("click touchend",".js-iChartTools-percentMode",function(){e.chart.percentMode_onClick()?a.find(".js-iChartTools-percentMode i").removeClass("uk-icon-toggle-off").addClass("uk-icon-toggle-on"):a.find(".js-iChartTools-percentMode i").removeClass("uk-icon-toggle-on").addClass("uk-icon-toggle-off")}).on("click touchend",".js-iChartTools-volumeByPrice",function(){e.chart.VolumeByPrice_onClick(),e.chart.viewData.chart.chartOptions.showVolumeByPrice?a.find(".js-iChartTools-volumeByPrice i").removeClass("uk-icon-toggle-off").addClass("uk-icon-toggle-on"):a.find(".js-iChartTools-volumeByPrice i").removeClass("uk-icon-toggle-on").addClass("uk-icon-toggle-off")}).on("click touchend",".js-iChartTools-volumeByDate",function(){e.chart.VolumeByDate_onClick();var t=e.chart.viewData.chart.chartOptions.showVolume;"inside"==t||"outside"==t?a.find(".js-iChartTools-volumeByDate i").removeClass("uk-icon-toggle-off").addClass("uk-icon-toggle-on"):a.find(".js-iChartTools-volumeByDate i").removeClass("uk-icon-toggle-on").addClass("uk-icon-toggle-off")}),this.$topToolsBarContainer.append(a)},this.renderInstrumentsList=function(){var t=$($.render.iChart_instrumentsTmpl()),i=function(){var t=$(this).val(),i=$(this).attr("data-opacity"),a=iChart.hexToRGB(t,i),r=$(this).attr("data-option");e.chart.userSettings.chartSettings.contextSettings[r]=a,$(".js-colorSelector[data-option='"+r+"']").css({"background-color":a}),$(this).minicolors("value",t),$(this).minicolors("opacity",i),e.chart.setStyleToCanvas(a,r)},a=function(){var t=this.value,i=iChart.hexToRGB(t,1),a=this.element.attr("data-option");e.chart.userSettings.chartSettings.contextSettings[a]=i,$(".js-colorSelector[data-option='"+a+"']").css({"background-color":i}),this.element.parent().find(".js-colorPicker").minicolors("value",t),e.chart.setStyleToCanvas(i,a)};t.find('.js-colorSelector[data-option="strokeStyle"]').css("background-color",e.chart.userSettings.chartSettings.contextSettings.strokeStyle),e.chart.userSettings.chartSettings.contextSettings.strokeStyle&&t.find('.js-colorPicker[data-option="strokeStyle"]').val(e.chart.userSettings.chartSettings.contextSettings.strokeStyle),t.find('.js-colorSelector[data-option="fillStyle"]').css("background-color",e.chart.userSettings.chartSettings.contextSettings.fillStyle),e.chart.userSettings.chartSettings.contextSettings.fillStyle&&t.find('.js-colorPicker[data-option="fillStyle"]').val(e.chart.userSettings.chartSettings.contextSettings.fillStyle),t.find('.js-colorSelector[data-option="fontSettingsColor"]').css("background-color",e.chart.userSettings.chartSettings.fontSettings.color),e.chart.userSettings.chartSettings.fontSettings.color&&t.find('.js-colorPicker[data-option="fontSettingsColor"]').val(e.chart.userSettings.chartSettings.fontSettings.color),t.find(".js-colorSelector").each(function(){var r=$(this),s=r.find(".menuHolder").html();r.qtip({style:{classes:"qtip-light"},position:{at:"center right",my:"left top",effect:!1,viewport:t,adjust:{method:"shift none"}},content:{title:r.data("title"),text:s},hide:{fixed:!0,delay:300},show:{solo:!0},events:{show:function(t,r){$(t.currentTarget).find(".js-colorPicker").each(function(){e.addMinicolors(this,t.currentTarget,i,a)})}}})}),t.find(".js-lineWidthSelector").each(function(){var i=$(this),a=i.find(".menuHolder").html();i.qtip({style:{classes:"qtip-light"},position:{at:"center right",my:"left top",effect:!1,viewport:t,adjust:{method:"shift none"}},content:{title:i.data("title"),text:a},hide:{fixed:!0,delay:300},show:{solo:!0},events:{show:function(t,i){$(t.currentTarget).find('[data-option="fontSettingsColor"]').each(function(){var t=$(this);t.off().on("click touchend",function(){var t=$(this).attr("data-style"),i=$(this).data("option");$(".js-lineWidthSelector[data-option='"+i+"'] .js-currentLineWidth").attr("data-style",t),e.chart.setLineWidthToCanvas(t)})})}}})}),t.on("click touchend",".js-iChartTools-instrument",function(){var t=$(this),i={fillStyle:e.chart.userSettings.chartSettings.contextSettings.fillStyle,strokeStyle:e.chart.userSettings.chartSettings.contextSettings.strokeStyle};e.chart.wrapper.iguanaChart("toolStart",t.data("instrument"),i)}).on("click touchend",".js-iChartTools-removeInstrument",function(){e.chart.removeAllInstruments_onClick()}),this.$topToolsBarContainer.append(t)}}}(),function(t){$iguanaChart={},$iguanaChart.defaultTheme={},$iguanaChart.thems=[{name:"White",settings:{backgroundColor:"#ffffff",
axisColor:"#999999",showAxes:!1,labelColor:"#595959",gridColor:"#cccccc",gridStyle:"dashed",watermarkColor:"rgba(238,238,238,1)",watermarkFont:"bold 40px Verdana",watermarkSubFont:"bold 25px Verdana",candleUp:"#66B85C",candleDown:"#C75757",candleBorder:!0,candleBorderUp:"#66B85C",candleBorderDown:"#C75757",candleWick:!0,candleWickStyle:"#595959",stockUp:"#66B85C",stockDown:"#C75757",stockWidth:1,lineColor:"#595959",lineWidth:1,areaColor:"#eff6fb",areaLineColor:"#cccccc",volumeStyle:"rgba(119, 119, 119, 0.3)",scrollerOverlayColor:"rgba(0,0,0, 0.1)",scrollerHandlerColor:"rgba(255,255,255, 1)",shadowColor:"#999999"}},{name:"Dark",settings:{backgroundColor:"#202020",axisColor:"#656565",showAxes:!1,showLabels:!0,labelColor:"#595959",gridColor:"#333333",gridStyle:"dashed",watermarkColor:"rgba(238,238,238, 0.2)",watermarkFont:"bold 40px Verdana",watermarkSubFont:"bold 25px Verdana",candleUp:"#66B85C",candleDown:"#C75757",candleBorder:!0,candleBorderUp:"#66B85C",candleBorderDown:"#C75757",candleWick:!0,candleWickStyle:"#878787",stockUp:"#66B85C",stockDown:"#C75757",stockWidth:1,lineColor:"#A4A4A4",lineWidth:1,areaColor:"#232323",areaLineColor:"#A4A4A4",volumeStyle:"rgba(119, 119, 119, 0.3)",scrollerOverlayColor:"rgba(255,255,255, 0.1)",scrollerHandlerColor:"rgba(130,130,130, 1)",shadowColor:"#000000"}}],$iguanaChart.defaultSettings={chartSettings:{contextSettings:{fillStyle:"rgba(82,175,201,.2)",strokeStyle:"rgba(82,175,201,1)",lineWidth:1},fontSettings:{famaly:"Arial,Helvetica,sans-serif",color:"#444444",size:"14"},indicatorsColor:{},indicatorsWidth:{},showTransactionsMode:0,tradingToolsEnable:0,autochartistEnable:0,defaultTheme:1},currentSecurity:{id:"",short_name:"",default_ticker:"",nt_ticker:"",firstDate:"",currency:"",min_step:""}},$iguanaChart.init=function(t,e){function i(i){t.initChart(i),"undefined"!=typeof e.events&&t.addEvents(e.events)}t.dataSource.preInit(i,e)},$iguanaChart.optionsStore=function(){var e=JSON.parse(window.localStorage.getItem("chartsStore")||"{}");t.isPlainObject(arguments[0])&&!t.isEmptyObject(arguments[0])?e=t.extend(e,data):"string"==typeof arguments[0]&&(e[arguments[0]]=arguments[1]),window.localStorage.setItem("chartsStore",JSON.stringify(e))},$iguanaChart.optionsRestore=function(t){var e=JSON.parse(window.localStorage.getItem("chartsStore")||"{}");return t?e[t]:e};var e={init:function(e,i){var a=this;if(a.data("iguanaChart"))$iguanaChart.init(a.data("iguanaChart"),e);else{var r="chart"+i+"_"+(new Date).getTime(),s=r+"_container",n=t.render.iChart_mainTmpl({id:s,name:r}),o=e.lib_path||"",h=new IguanaChart({name:r,container:"#"+s,wrapper:a,lib_path:o,dataSource:t.extend(!0,{},e.dataSource)});a.html(n).data("iguanaChart",h).on("iguanaChartEvents",function(t,e,i){switch(e){case"chartDataReceived":var r=a.data("tmLoader");clearTimeout(r),a.find(".chart-loader-wrapper").css({opacity:"0.0",height:0,left:"-2000px",transition:"opacity .75s ease-in-out, height 0s ease-in-out .75s, left 0s ease-in-out .75s"});break;case"chartDataRequest":var r=a.data("tmLoader");clearTimeout(r),r=setTimeout(function(){a.find(".chart-loader-wrapper").css({opacity:"1.0",height:"100%",left:0,transition:"opacity .0s ease-in-out, height 0s ease-in-out .0s"})},750),a.data("tmLoader",r)}}),$iguanaChart.init(a.data("iguanaChart"),e)}this.trigger("iguanaChartEvents",["initComplete",e])},setType:function(t){var e=this.data("iguanaChart");e.viewData.chart&&e.viewData.chart.setChartType(t),e.setHashValue("type",t),this.trigger("iguanaChartEvents",["setType",t])},setTheme:function(i){var a=i[0],r=t.grep($iguanaChart.thems,function(t){return t.name==a?t:null})[0];if("undefined"==typeof r)throw new Error('Theme "'+a+'" is not exist.');var s=this.data("iguanaChart"),n=s.viewData.chart;t.extend(n.chartOptions,r.settings),e.render.call(this),this.trigger("iguanaChartEvents",["setTheme",a])},render:function(e){t.isArray(e)||(e=[]);var i=this.data("iguanaChart"),a="undefined"==typeof e[0]||!!e[0],r="undefined"!=typeof e[1]&&!!e[1],s="undefined"!=typeof e[2]&&!!e[2];if(i.viewData.chart){var n=i.viewData.chart;n.render({forceRecalc:a,resetViewport:r,testForIntervalChange:s}),t(i.container).find(".js-scrollerOverlay").css({background:n.chartOptions.scrollerOverlayColor}),t(i.container).find(".js-scrollerHandler").css({background:n.chartOptions.scrollerHandlerColor})}},chartOptions:function(i){var a=this.data("iguanaChart"),r=a.viewData.chart;return"undefined"==typeof i[0]?r.chartOptions:("object"==typeof i[0]?t.extend(!0,r.chartOptions,i[0]):"string"==typeof i[0]&&"undefined"!=typeof i[1]&&(r.chartOptions[i[0]]=i[1]),void e.render.call(this))},events:function(t){var i=this.data("iguanaChart");i.clearEvents(),"undefined"!=typeof t[0]&&i.addEvents(t[0]),e.render.call(this)},toolStart:function(t){var e=this.data("iguanaChart"),i=e.viewData.chart;i.overlay&&i.overlay.start(t[0])},addPoint:function(t){var e=this.data("iguanaChart");e.addPoint(t[0])},destroy:function(){if(this.data("iguanaChart")){var t=this.data("iguanaChart");for(var e in t.timers)clearTimeout(t.timers[e]),t.ajaxDataRequest.abort()}}};t.fn.iguanaChart=function(i){if("undefined"==typeof i||"object"==typeof i)return this.each(function(a){var r=t(this);return e.init.call(r,i,a),r});if("string"==typeof i){var a=Array.prototype.slice.call(arguments,1);if(e[i]&&"function"==typeof e[i]){if(a.length)return this.each(function(r){var s=t(this);return e[i].call(s,a),s});var r=t(this).eq(0);return e[i].call(r,a)}return console.error("Method should be function")}return console.error("Options should be object, string or undefined")}}(jQuery),TA={TICKER:0,PER:1,DATE:2,TIME:3,OPEN:4,HIGH:5,LOW:6,CLOSE:7,VOL:8,FULLDATE:9,FULLTIME:10,DATESTRING:11},TA.TA_COMPATIBILITY_DEFAULT=0,TA.TA_GLOBALS_COMPATIBILITY=TA.TA_COMPATIBILITY_DEFAULT,TA.MATypes={SMA:0,EMA:1,WMA:2,DEMA:3,TEMA:4,TRIMA:5,KAMA:6,MAMA:7,T3:8},TA.TA_IS_ZERO=function(t){return-1e-8<t&&t<1e-8},TA.PER_TO_K=function(t){return 2/(t+1)},TA.TA_FUNC_UNST_EMA=0,TA.TA_FUNC_UNST_ADX=1,TA.TA_Globals={unstablePeriod:[0,0]},TA.TA_GLOBALS_UNSTABLE_PERIOD=function(t,e){return TA.TA_Globals.unstablePeriod[t]},TA.BASE_TEMPLATE={__TICKER__:void 0,DefaultSettings:{},CheckStandartValue:function(t,e){return t?t:this.Settings[e]?this.DefaultSettings[e]:this.Settings[e]},SetSettings:function(t){var e;if(t){t!=this.DefaultSettings&&this.SetSettings(this.DefaultSettings);for(e in t)this.Settings[e]=+t[e]}return this},GetSettings:function(){var t,e=this.DefaultSettings;for(t in e)e[t]=this.Settings[t];return e},IndividualSettings:{},SetIndividualSettings:function(t){return t=MainController.RatesController.getTicker(t),this.SetSettings(this.DefaultSettings),this.IndividualSettings[t]&&this.SetSettings(this.IndividualSettings[t]),this},checkTicker:function(t){return t=MainController.RatesController.getTicker(t),this.__TICKER__==t||(this.__TICKER__=t,this.SetIndividualSettings(t),!1)},getSettingsParameters:function(t){var e=[];for(var i in this.Settings)(!t||t.indexOf(i)+1)&&("number"==typeof this.Settings[i]?e.push({name:i,values:""+this.Settings[i]+"-"+this.Settings[i]+":1"}):"boolean"==typeof this.Settings[i]?e.push({name:i,values:[!0,!1]}):e.push({name:i,values:[this.Settings[i]]}));return e},Create:function(){function t(e,i){for(var a in i){"object"==typeof i[a]&&i[a]&&i[a]!={}&&t(e[a],i[a]);var r=i.__lookupSetter__(a),s=i.__lookupGetter__(a);(r||s)&&(e[a]||delete e[a],r&&e.__defineSetter__(a,r),s&&e.__defineGetter__(a,s))}}var e=$.extend(!0,{},this);return t(e,this),e}},TA.INDICATOR_TEMPLATE=TA.BASE_TEMPLATE.Create(),TA.INDICATOR_TEMPLATE.Create=function(t){var e=TA.BASE_TEMPLATE.Create.apply(this);return e.justifyCalculate=function(){var t=this.calculate.apply(this,arguments);if($.isArray(t))for(var e=this._lookback(this.Settings.TimePeriod),i=0;i<e;i++)t.unshift(0);else{var e=this._lookback(this.Settings.TimePeriod);for(var a in t)for(var i=0;i<e;i++)t[a].unshift(0)}return t},t&&this.SetSettings(t),e},TA.INDICATOR_TEMPLATE.initChart=function(t,e,i){return this.checkTicker(i),this},TA.INDICATOR_TEMPLATE.filterSignalsArray=function(t,e){return[]},TA.INDICATOR_TEMPLATE.filterSignal=function(t,e,i){return{clear:!0}},TA.INDICATOR_TEMPLATE.getOpenSignal=function(t,e){return this.checkTicker(e),null},TA.INDICATOR_TEMPLATE.getCloseSignal=function(t,e){return this.checkTicker(e),!1},TA.INDICATOR_TEMPLATE.getGraphicSettingsParameters=function(t){var e=this.getSettingsParameters.apply(this,arguments);return e},TA.INDICATOR_TEMPLATE.getTradeSettingsParameters=function(t){var e=this.getSettingsParameters.apply(this,arguments);return e},TA.CONTROLLER_TEMPLATE=TA.BASE_TEMPLATE.Create(),TA.CONTROLLER_TEMPLATE.getByFilter=function(t){return[]},TA.CONTROLLER_TEMPLATE.init=function(){return this.checkTicker(),this},TA.CONTROLLER_TEMPLATE.initChart=function(t,e,i){return this.checkTicker(i),this},TA.CONTROLLER_TEMPLATE._data=null,TA.CONTROLLER_TEMPLATE.__defineGetter__("data",function(){return this._data}),TA.CONTROLLER_TEMPLATE.__defineSetter__("data",function(t){return this.update(t)}),TA.CONTROLLER_TEMPLATE.update=function(t){return this},TA.CONTROLLER_TEMPLATE.isEmpty=function(){return!this._data.length},TA.INDICATOR_TEMPLATE?TA.SMA=TA.INDICATOR_TEMPLATE.Create():TA.SMA={},TA.SMA.name="SMA",TA.SMA.type="line",TA.SMA.DefaultSettings={TimePeriod:30,CandleValueIdx:TA.CLOSE},TA.SMA.Settings={},TA.SMA.calculate=function(t,e,i,a,r){var s,n,o,h,l,c,d=[];if(this.SetSettings(a),t||(t=0),e||(e=i.length-1),c=this.Settings.TimePeriod-1,t<c&&(t=c),t>e)return d;if(s=0,l=t-c,o=l,this.Settings.TimePeriod>1)for(;o<t;)s+=i[o++][this.Settings.CandleValueIdx];h=0;do s+=i[o++][this.Settings.CandleValueIdx],n=s,s-=i[l++][this.Settings.CandleValueIdx],d[h++]=n/this.Settings.TimePeriod;while(o<=e);return d},TA.SMA.getValue=function(t,e,i){},TA.SMA._lookback=function(t){if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return t-1},TA.SMA._S=function(t,e,i,a){},TA.SMA.initChart=function(t,e,i){INDICATOR_TEMPLATE&&INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.SMA.SetSettings(TA.SMA.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.EMA=TA.INDICATOR_TEMPLATE.Create():TA.EMA={},TA.EMA.name="EMA",TA.EMA.type="line",TA.EMA.DefaultSettings={TimePeriod:30,CandleValueIdx:TA.CLOSE},TA.EMA.Settings={},TA.EMA.calculate=function(t,e,i,a){var r=[];if(this.SetSettings(a),t||(t=0),e||(e=i.length-1),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=30;return this._int_ema(t,e,i,this.Settings.TimePeriod,TA.PER_TO_K(this.Settings.TimePeriod),r)},TA.EMA._int_ema=function(t,e,i,a,r,s){var n,o,h,l,c,d;if(d=this._lookback(a),t<d&&(t=d),t>e)return s;if(TA.TA_GLOBALS_COMPATIBILITY==TA.TA_COMPATIBILITY_DEFAULT){for(l=t-d,h=a,n=0;h-- >0;)n+=i[l++][this.Settings.CandleValueIdx];o=n/a}else o=i[0][this.Settings.CandleValueIdx],l=1;for(;l<=t;)o=(i[l++][this.Settings.CandleValueIdx]-o)*r+o;for(s[0]=o,c=1;l<=e;)o=(i[l++][this.Settings.CandleValueIdx]-o)*r+o,s[c++]=o;return s},TA.EMA.getValue=function(t,e,i){},TA.EMA._lookback=function(t){if(t){if(t<2||t>1e5)return-1}else t=this.Settings.TimePeriod||this.DefaultSettings.TimePeriod;return t-1},TA.EMA._S=function(t,e,i,a){var r,s,n,o,h,l;if(l=this._lookback(this.Settings.TimePeriod),t<l&&(t=l),t>e)return outReal;if(TA_GLOBALS_COMPATIBILITY==TA_COMPATIBILITY_DEFAULT){for(o=t-l,n=this.Settings.TimePeriod,r=0;n-- >0;)r+=i[o++][this.Settings.CandleValueIdx];s=r/this.Settings.TimePeriod}else s=i[0][this.Settings.CandleValueIdx],o=1;for(;o<=t;)s=(i[o++][this.Settings.CandleValueIdx]-s)*optInK_1+s;for(outReal[0]=s,h=1;o<=e;)s=(inReal[o++]-s)*optInK_1+s,outReal[h++]=s;return outReal},TA.EMA.initChart=function(t,e,i){INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.EMA.SetSettings(TA.EMA.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.RSI=TA.INDICATOR_TEMPLATE.Create():TA.RSI={},TA.RSI.name="RSI",TA.RSI.type="line",TA.RSI.DefaultSettings={TimePeriod:14,CandleValueIdx:TA.CLOSE},TA.RSI.Settings={},TA.RSI.calculate=function(t,e,i,a){this.SetSettings(a);var r,s,n,o,h,l,c,d,p,u,g=[];if(t||(t=0),e||(e=i.length-1),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(n=this._lookback(this.Settings.TimePeriod),t<n&&(t=n),t>e)return g;if(r=0,1==this.Settings.TimePeriod)return g=i.slice(t);for(s=t-n,d=i[s][this.Settings.CandleValueIdx],o=0,l=0,c=0,s++,h=this.Settings.TimePeriod;h>0;h--)p=i[s++][this.Settings.CandleValueIdx],u=p-d,d=p,u<0?c-=u:l+=u;if(c/=this.Settings.TimePeriod,l/=this.Settings.TimePeriod,s>t)p=l+c,TA.TA_IS_ZERO(p)?g[r++]=0:g[r++]=100*(l/p);else for(;s<t;)p=i[s][this.Settings.CandleValueIdx],u=p-d,d=p,c*=this.Settings.TimePeriod-1,l*=this.Settings.TimePeriod-1,u<0?c-=u:l+=u,c/=this.Settings.TimePeriod,l/=this.Settings.TimePeriod,s++;for(;s<=e;)p=i[s++][this.Settings.CandleValueIdx],u=p-d,d=p,c*=this.Settings.TimePeriod-1,l*=this.Settings.TimePeriod-1,u<0?c-=u:l+=u,c/=this.Settings.TimePeriod,l/=this.Settings.TimePeriod,p=l+c,TA.TA_IS_ZERO(p)?g[r++]=0:g[r++]=100*(l/p);return g},TA.RSI.getValue=function(t,e,i){},TA.RSI._lookback=function(t){if(t){if(t<2||t>1e5)return-1}else t=this.Settings.TimePeriod||this.DefaultSettings.TimePeriod;return t},TA.RSI._S=function(t,e,i,a){},TA.RSI.initChart=function(t,e,i){TA.INDICATOR_TEMPLATE&&TA.INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.RSI.SetSettings(TA.RSI.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.MA=TA.INDICATOR_TEMPLATE.Create():TA.MA={},TA.MA.name="MA",TA.MA.type="line",TA.MA.DefaultSettings={TimePeriod:30,CandleValueIdx:TA.CLOSE,MAType:TA.MATypes.SMA},TA.MA.Settings={},TA.MA.calculate=function(t,e,i,a){this.SetSettings(a);var r,s,n=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=30;if(this.Settings.MAType){if(this.Settings.MAType<0||this.Settings.MAType>8)throw"TA_BAD_PARAM"}else this.Settings.MAType=TA.MATypes.SMA;if(1==this.Settings.TimePeriod){for(nbElement=e-t+1,s=t,r=0;r<nbElement;r++,s++)n[r]=i[s][this.Settings.CandleValueIdx];return n}switch(this.Settings.MAType){case TA.MATypes.SMA:n=TA.SMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.EMA:n=TA.EMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.WMA:n=TA.WMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.DEMA:n=DEMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.TEMA:n=TEMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.TRIMA:n=TRIMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.KAMA:n=KAMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.MAMA:n=MAMA.calculate(t,e,i,{FastLimit:.5,SlowLimit:.05});break;case TA.MATypes.T3:n=T3.calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,VFactor:.7});break;default:throw"TA_BAD_PARAM"}return n},TA.MA.getValue=function(t,e,i){},TA.MA._lookback=function(t,e){var i;if(t){if(t<1||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;if(e){if(e<0||e>8)return-1}else e=this.DefaultSettings.MAType;if(t<=1)return 0;switch(e){case TA.MATypes.SMA:i=TA.SMA._lookback(t);break;case TA.MATypes.EMA:i=TA.EMA._lookback(t);break;case TA.MATypes.WMA:i=TA.WMA._lookback(t);break;case TA.MATypes.DEMA:i=DEMA._lookback(t);break;case TA.MATypes.TEMA:i=TEMA._lookback(t);break;case TA.MATypes.TRIMA:i=TRIMA._lookback(t);break;case TA.MATypes.KAMA:i=KAMA._lookback(t);break;case TA.MATypes.MAMA:i=MAMA._lookback(.5,.05);break;case TA.MATypes.T3:i=T3._lookback(t,.7);break;default:i=0}return i},TA.MA._S=function(t,e,i,a){},TA.MA.initChart=function(t,e,i){INDICATOR_TEMPLATE&&INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.MA.SetSettings(TA.MA.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.STDDEV=TA.INDICATOR_TEMPLATE.Create():TA.STDDEV={},TA.STDDEV.name="STDDEV",TA.STDDEV.type="line",TA.STDDEV.DefaultSettings={TimePeriod:10,Deviations:1,CandleValueIdx:TA.CLOSE},TA.STDDEV.Settings={},TA.STDDEV.calculate=function(t,e,i,a){var r,s,n,o=[];if(this.SetSettings(a),t||(t=0),e||(e=i.length-1),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(this.Settings.Deviations){if(this.Settings.Deviations<-3e37||this.Settings.Deviations>3e37)throw"TA_BAD_PARAM"}else this.Settings.Deviations=this.DefaultSettings.Deviations;var h=TA.INT_VAR.Create({TimePeriod:this.Settings.TimePeriod,CandleValueIdx:this.Settings.CandleValueIdx});if(o=h.calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,CandleValueIdx:this.Settings.CandleValueIdx}),!o||!o.length)return o;if(1!=this.Settings.Deviations)for(r=0;r<n;r++)s=o[r],s?o[r]=Math.sqrt(s)*this.Settings.Deviations:o[r]=0;else for(r=0;r<o.length;r++)s=o[r],s?o[r]=Math.sqrt(s):o[r]=0;return o},TA.STDDEV.getValue=function(t,e,i){},TA.STDDEV._lookback=function(t,e){if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;if(e){if(e<-3e37||e>3e37)return-1}else e=this.DefaultSettings.Deviations;return TA.VAR._lookback(t,e)},TA.STDDEV._S=function(t,e,i,a){},TA.STDDEV.initChart=function(t,e,i){TA.INDICATOR_TEMPLATE&&TA.INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.STDDEV.SetSettings(TA.STDDEV.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.VAR=TA.INDICATOR_TEMPLATE.Create():TA.VAR={},TA.VAR.name="VAR",TA.VAR.type="line",TA.VAR.DefaultSettings={TimePeriod:2,Deviations:1,CandleValueIdx:TA.CLOSE},TA.VAR.Settings={},TA.VAR.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u=[];if(this.SetSettings(a),t||(t=0),e||(e=i.length-1),p=this.Settings.TimePeriod-1,t<p&&(t=p),t>e)return u;if(s=0,n=0,d=t-p,l=d,this.Settings.TimePeriod>1)for(;l<t;)r=i[l++][this.Settings.CandleValueIdx],s+=r,r*=r,n+=r;c=0;do r=i[l++][this.Settings.CandleValueIdx],s+=r,r*=r,n+=r,o=s/this.Settings.CandleValueIdx,h=n/this.Settings.CandleValueIdx,r=i[d++][this.Settings.CandleValueIdx],s-=r,r*=r,n-=r,u[c++]=h-o*o;while(l<=e);return u},TA.VAR.getValue=function(t,e,i){},TA.VAR._lookback=function(t,e){if(t){if(t<1||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;if(e){if(e<-3e37||e>3e37)return-1}else e=this.DefaultSettings.Deviations;return t-1},TA.VAR._S=function(t,e,i,a){},TA.VAR.initChart=function(t,e,i){INDICATOR_TEMPLATE&&INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.VAR.SetSettings(TA.VAR.DefaultSettings),TA.INT_VAR=TA.VAR.Create(),TA.INT_VAR.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u=[];if(this.SetSettings(a),t||(t=0),e||(e=i.length-1),p=this.Settings.TimePeriod-1,t<p&&(t=p),t>e)return u;if(s=0,n=0,d=t-p,l=d,this.Settings.TimePeriod>1)for(;l<t;)r=i[l++][this.Settings.CandleValueIdx],s+=r,r*=r,n+=r;c=0;do r=i[l++][this.Settings.CandleValueIdx],s+=r,r*=r,n+=r,o=s/this.Settings.TimePeriod,h=n/this.Settings.TimePeriod,r=i[d++][this.Settings.CandleValueIdx],s-=r,r*=r,n-=r,u[c++]=h-o*o;while(l<=e);return u},TA.INDICATOR_TEMPLATE?TA.BBANDS=TA.INDICATOR_TEMPLATE.Create():TA.BBANDS={},TA.BBANDS.name="BBANDS",TA.BBANDS.type="line",TA.BBANDS.DefaultSettings={TimePeriod:7,DeviationsUp:2,DeviationsDown:2,MAType:TA.MATypes.SMA,CandleValueIdx:TA.CLOSE},TA.BBANDS.Settings={},TA.BBANDS.calculate=function(t,e,i,a){var r,s,n,o,h=[],l=[],c=[],d=[],p=[];if(this.SetSettings(a),t||(t=0),e||(e=i.length-1),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(this.Settings.DeviationsUp){if(this.Settings.DeviationsUp<-3e37||this.Settings.DeviationsUp>3e37)throw"TA_BAD_PARAM"}else this.Settings.DeviationsUp=this.DefaultSettings.DeviationsUp;if(this.Settings.DeviationsDown){if(this.Settings.DeviationsDown<-3e37||this.Settings.DeviationsDown>3e37)throw"TA_BAD_PARAM"}else this.Settings.DeviationsDown=this.DefaultSettings.DeviationsDown;if(this.Settings.MAType)this.Settings.MAType=this.DefaultSettings.MAType;else if(this.Settings.MAType<0||this.Settings.MAType>8)throw"TA_BAD_PARAM";if(!c)throw"TA_BAD_PARAM";if(!d)throw"TA_BAD_PARAM";if(!p)throw"TA_BAD_PARAM";h=d,l=c;var u=TA.MA.Create({TimePeriod:this.Settings.TimePeriod,MAType:this.Settings.MAType});if(h=u.calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,MAType:this.Settings.MAType}),!h||!h.length)return{UpperBand:[],LowerBand:[],MiddleBand:[]};var g=TA.STDDEV.Create({TimePeriod:this.Settings.TimePeriod,Deviations:1});if(l=g.calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,Deviations:1}),!l||!l.length)return{UpperBand:[],LowerBand:[],MiddleBand:[]};if(d=h.slice(),o=d.length,this.Settings.DeviationsUp==this.Settings.DeviationsDown)if(1==this.Settings.DeviationsUp)for(r=0;r<o;r++)s=l[r],n=d[r],c[r]=n+s,p[r]=n-s;else for(r=0;r<o;r++)s=l[r]*this.Settings.DeviationsUp,n=d[r],c[r]=n+s,p[r]=n-s;else if(1==this.Settings.DeviationsUp)for(r=0;r<o;r++)s=l[r],n=d[r],c[r]=n+s,p[r]=n-s*this.Settings.DeviationsDown;else if(1==this.Settings.DeviationsDown)for(r=0;r<o;r++)s=l[r],n=d[r],p[r]=n-s,c[r]=n+s*this.Settings.DeviationsUp;else for(r=0;r<o;r++)s=l[r],n=d[r],c[r]=n+s*this.Settings.DeviationsUp,p[r]=n-s*this.Settings.DeviationsDown;return{UpperBand:c,LowerBand:p,MiddleBand:d}},TA.BBANDS.getValue=function(t,e,i){},TA.BBANDS._lookback=function(t,e,i,a){if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;if(e){if(e<-3e37||e>3e37)return-1}else e=this.DefaultSettings.DeviationsUp;if(i){if(i<-3e37||i>3e37)return-1}else i=this.DefaultSettings.DeviationsDown;if(a){if(a<0||a>8)return-1}else a=this.DefaultSettings.MAType;return TA.MA._lookback(t,a)},TA.BBANDS.SetSettings(TA.BBANDS.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.WMA=TA.INDICATOR_TEMPLATE.Create():TA.WMA={},TA.WMA.name="WMA",TA.WMA.type="line",TA.WMA.DefaultSettings={TimePeriod:30,CandleValueIdx:TA.CLOSE},TA.WMA.Settings={},TA.WMA.calculate=function(t,e,i,a,r){var s,n,o,h,l,c,d,p,u,g,f=[];if(this.SetSettings(a),t||(t=0),e||(e=i.length-1),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(!f)throw"TA_BAD_PARAM";if(g=this.Settings.TimePeriod-1,t<g&&(t=g),t>e)return f;if(1==this.Settings.TimePeriod)return f;for(l=this.Settings.TimePeriod*(+this.Settings.TimePeriod+1)/2,n=0,h=t-g,c=d=0,s=h,o=1;s<t;)p=i[s++][this.Settings.CandleValueIdx],d+=p,c+=p*o,o++;for(u=0;s<=e;)p=i[s++][this.Settings.CandleValueIdx],d+=p,d-=u,c+=p*this.Settings.TimePeriod,u=i[h++][this.Settings.CandleValueIdx],f[n++]=c/l,c-=d;return f},TA.WMA.getValue=function(t,e,i){},TA.WMA._lookback=function(t){if(t){if(t<2||t>1e5)return-1}else t=30;return t-1},TA.WMA._S=function(t,e,i,a){},TA.WMA.initChart=function(t,e,i){INDICATOR_TEMPLATE&&INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.WMA.SetSettings(TA.WMA.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.AD=TA.INDICATOR_TEMPLATE.Create():TA.AD={},TA.AD.name="AD",TA.AD.type="line",TA.AD.DefaultSettings={},TA.AD.Settings={},TA.AD.calculate=function(t,e,i){var a,r,s,n,o,h,l,c,d=[];if(t||(t=0),e||(e=i.length-1),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(!d)throw"TA_BAD_PARAM";for(a=e-t+1,r=t,s=0,c=0;0!=a;)n=i[r][TA.HIGH],o=i[r][TA.LOW],l=n-o,h=i[r][TA.CLOSE],l>0&&(c+=(h-o-(n-h))/l*i[r][TA.VOL]),d[s++]=c,r++,a--;return d},TA.AD.getValue=function(t,e){var i,a,r,s,n=0;return i=t[e][TA.HIGH],a=t[e][TA.LOW],s=i-a,r=t[e][TA.CLOSE],s>0&&(n+=(r-a-(i-r))/s*t[e][TA.VOL]),n},TA.AD._lookback=function(){return 0},TA.AD._S=function(t,e,i){var a,r,s,n,o,h,l,c,d=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(!d)throw"TA_BAD_PARAM";for(a=e-t+1,r=t,s=0,c=0;0!=a;)n=i[r][TA.HIGH],o=i[r][TA.LOW],l=n-o,h=i[r][TA.CLOSE],l>0&&(c+=(h-o-(n-h))/l*i[r][TA.VOL]),d[s++]=c,r++,a--;return d},TA.INDICATOR_TEMPLATE)var APO=TA.INDICATOR_TEMPLATE.Create();else var APO={};if(APO.name="APO",APO.type="line",APO.DefaultSettings={FastPeriod:12,SlowPeriod:26,MAType:TA.MATypes.SMA,CandleValueIdx:TA.CLOSE},APO.Settings={},APO._S=function(t,e,i,a){},APO.initChart=function(t,e,i){INDICATOR_TEMPLATE&&INDICATOR_TEMPLATE.initChart.apply(this,arguments)},APO.SetSettings(APO.DefaultSettings),APO._lookback=function(t,e,i){if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.FastPeriod;if(e){if(e<2||e>1e5)return-1}else e=this.DefaultSettings.SlowPeriod;if(i){if(i<0||i>8)return-1}else i=this.DefaultSettings.MAType;return MA._lookback(Math.max(e,t),i)},APO.calculate=function(t,e,i,a){var r=[],s=[];if(a&&this.SetSettings(a),t||(t=0),e||(e=i.length-1),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.FastPeriod){if(this.Settings.FastPeriod<2||this.Settings.FastPeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.FastPeriod=this.DefaultSettings.FastPeriod;if(this.Settings.SlowPeriod){if(this.Settings.SlowPeriod<2||this.Settings.SlowPeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.SlowPeriod=this.DefaultSettings.SlowPeriod;if(this.Settings.MAType)this.Settings.MAType=this.DefaultSettings.MAType;else if(this.Settings.MAType<0||this.Settings.MAType>8)throw"TA_BAD_PARAM";if(!s)throw"TA_BAD_PARAM";return s=this.INT_PO(t,e,i,this.Settings.FastPeriod,this.Settings.SlowPeriod,this.Settings.MAType,s,r,0)},APO.INT_PO=function(t,e,i,a,r,s,n,o,h){var l,c,d=0,p=0;r<a&&(c=r,r=a,a=c);var u=MA.Create({TimePeriod:a,MAType:s,CandleValueIdx:this.Settings.CandleValueIdx});if(o=u.calculate(t,e,i),o&&o.length&&(n=u.calculate(t,e,i,{TimePeriod:r}),n&&n.length))if(c=o.length-1-(n.length-1),0!=h)for(d=0,p=c;d<o.length-1;d++,p++)l=n[d],TA.TA_IS_ZERO(l)?n[d]=0:n[d]=(o[p]-l)/l*100;else for(d=0,p=c;d<o.length-1;d++,p++)n[d]=o[p]-n[d];return n},TA.INDICATOR_TEMPLATE)var PPO=TA.INDICATOR_TEMPLATE.Create();else var PPO={};PPO.DefaultSettings={CandleValueIdx:TA.CLOSE,FastPeriod:12,SlowPeriod:26,MAType:TA.MATypes.SMA},PPO.Settings={},PPO.name="PPO",PPO.type="line",PPO._lookback=function(t,e,i){if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.FastPeriod;if(e){if(e<2||e>1e5)return-1}else e=this.DefaultSettings.SlowPeriod;if(i){if(i<0||i>8)return-1}else i=this.DefaultSettings.MAType;return MA._lookback(Math.max(e,t),i)},PPO.calculate=function(t,e,i,a){var r=[],s=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.FastPeriod){if(this.Settings.FastPeriod<2||this.Settings.FastPeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.FastPeriod=this.DefaultSettings.FastPeriod;if(this.Settings.SlowPeriod){if(this.Settings.SlowPeriod<2||this.Settings.SlowPeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.SlowPeriod=this.DefaultSettings.SlowPeriod;if(this.Settings.MAType){if(this.Settings.MAType<0||this.Settings.MAType>8)throw"TA_BAD_PARAM"}else this.Settings.MAType=this.DefaultSettings.MAType;if(!s)throw"TA_BAD_PARAM";return s=APO.INT_PO(t,e,i,this.Settings.FastPeriod,this.Settings.SlowPeriod,this.Settings.MAType,s,r,1)},PPO.SetSettings(PPO.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.ADOSC=TA.INDICATOR_TEMPLATE.Create():TA.ADOSC={},TA.ADOSC.name="ADOSC",TA.ADOSC.type="line",TA.ADOSC.DefaultSettings={FastPeriod:3,SlowPeriod:10},TA.ADOSC.Settings={},TA.ADOSC.calculate=function(startIdx,endIdx,dataShape,settings){var today,outIdx,lookbackTotal,slowestPeriod,high,low,close,tmp,slowEMA,slowk,one_minus_slowk,fastEMA,fastk,one_minus_fastk,ad,outReal=[];if(this.SetSettings(settings),startIdx||(startIdx=0),endIdx||(endIdx=dataShape.length-1),startIdx<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(endIdx<0||endIdx<startIdx)throw"TA_OUT_OF_RANGE_END_INDEX";if(!dataShape||!dataShape.length)throw"TA_BAD_PARAM";if(this.Settings.FastPeriod){if(this.Settings.FastPeriod<2||this.Settings.FastPeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.FastPeriod=3;if(this.Settings.SlowPeriod){if(this.Settings.SlowPeriod<2||this.Settings.SlowPeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.SlowPeriod=10;if(slowestPeriod=this.Settings.FastPeriod<this.Settings.SlowPeriod?this.Settings.SlowPeriod:this.Settings.FastPeriod,lookbackTotal=TA.EMA._lookback(slowestPeriod),startIdx<lookbackTotal&&(startIdx=lookbackTotal),startIdx>endIdx)return outReal;today=startIdx-lookbackTotal,ad=0;var CALCULATE_AD="   {       high  = dataShape[today][TA.HIGH];       low   = dataShape[today][TA.LOW];       tmp   = high-low;       close = dataShape[today][TA.CLOSE];       if( tmp > 0.0 )          ad += (((close-low)-(high-close))/tmp)*(dataShape[today][TA.VOL]);       today++;    }";for(fastk=TA.PER_TO_K(this.Settings.FastPeriod),one_minus_fastk=1-fastk,slowk=TA.PER_TO_K(this.Settings.SlowPeriod),one_minus_slowk=1-slowk,eval(CALCULATE_AD),fastEMA=ad,slowEMA=ad;today<startIdx;)eval(CALCULATE_AD),fastEMA=fastk*ad+one_minus_fastk*fastEMA,slowEMA=slowk*ad+one_minus_slowk*slowEMA;for(outIdx=0;today<=endIdx;)eval(CALCULATE_AD),fastEMA=fastk*ad+one_minus_fastk*fastEMA,slowEMA=slowk*ad+one_minus_slowk*slowEMA,outReal[outIdx++]=fastEMA-slowEMA;return outReal},TA.ADOSC.getValue=function(t,e,i){return NaN},TA.ADOSC._lookback=function(){var t;if(this.Settings.FastPeriod)this.Settings.FastPeriod=3;else if(this.Settings.FastPeriod<2||this.Settings.FastPeriod>1e5)return-1;if(this.Settings.SlowPeriod){if(this.Settings.SlowPeriod<2||this.Settings.SlowPeriod>1e5)return-1}else this.Settings.SlowPeriod=10;return t=this.Settings.FastPeriod<this.Settings.SlowPeriod?this.Settings.SlowPeriod:this.Settings.FastPeriod,TA.EMA._lookback(t)},TA.ADOSC._S=function(t,e,i,a){return NaN},TA.ADOSC.initChart=function(t,e,i){INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.ADOSC.SetSettings(TA.ADOSC.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.ADX=TA.INDICATOR_TEMPLATE.Create():TA.ADX={},TA.ADX.name="ADX",TA.ADX.type="line",TA.ADX.DefaultSettings={TimePeriod:14},TA.ADX.Settings={},TA.ADX.calculate=function(startIdx,endIdx,dataShape,settings,dontFillTotalArray){function TRUE_RANGE(t,e,i,a){return"      "+a+" = "+t+"-"+e+";       tempReal2 = Math.abs("+t+"-"+i+");       if( tempReal2 > "+a+" )          "+a+" = tempReal2;       tempReal2 = Math.abs("+e+"-"+i+");       if( tempReal2 > "+a+" )          "+a+" = tempReal2;"}function round_pos(t){return t}var today,lookbackTotal,outIdx,prevHigh,prevLow,prevClose,prevMinusDM,prevPlusDM,prevTR,tempReal,tempReal2,diffP,diffM,minusDI,plusDI,sumDX,prevADX,i,outReal=[];if(this.SetSettings(settings),startIdx||(startIdx=0),endIdx||(endIdx=dataShape.length-1),startIdx<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(endIdx<0||endIdx<startIdx)throw"TA_OUT_OF_RANGE_END_INDEX";if(!dataShape||!dataShape.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=14;if(lookbackTotal=2*this.Settings.TimePeriod-1,startIdx<lookbackTotal&&(startIdx=lookbackTotal),startIdx>endIdx)return outReal;for(outIdx=0,prevMinusDM=0,prevPlusDM=0,prevTR=0,today=startIdx-lookbackTotal,prevHigh=dataShape[today][TA.HIGH],prevLow=dataShape[today][TA.LOW],prevClose=dataShape[today][TA.CLOSE],i=this.Settings.TimePeriod-1;i-- >0;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,diffM>0&&diffP<diffM?prevMinusDM+=diffM:diffP>0&&diffP>diffM&&(prevPlusDM+=diffP),
eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR+=tempReal,prevClose=dataShape[today][TA.CLOSE];for(sumDX=0,i=this.Settings.TimePeriod;i-- >0;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,prevMinusDM-=prevMinusDM/this.Settings.TimePeriod,prevPlusDM-=prevPlusDM/this.Settings.TimePeriod,diffM>0&&diffP<diffM?prevMinusDM+=diffM:diffP>0&&diffP>diffM&&(prevPlusDM+=diffP),eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE],TA.TA_IS_ZERO(prevTR)||(minusDI=round_pos(100*(prevMinusDM/prevTR)),plusDI=round_pos(100*(prevPlusDM/prevTR)),tempReal=minusDI+plusDI,TA.TA_IS_ZERO(tempReal)||(sumDX+=round_pos(100*(Math.abs(minusDI-plusDI)/tempReal))));for(prevADX=round_pos(sumDX/this.Settings.TimePeriod),i=TA.TA_GLOBALS_UNSTABLE_PERIOD(TA.TA_FUNC_UNST_ADX);i-- >0;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,prevMinusDM-=prevMinusDM/this.Settings.TimePeriod,prevPlusDM-=prevPlusDM/this.Settings.TimePeriod,diffM>0&&diffP<diffM?prevMinusDM+=diffM:diffP>0&&diffP>diffM&&(prevPlusDM+=diffP),eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE],TA.TA_IS_ZERO(prevTR)||(minusDI=round_pos(100*(prevMinusDM/prevTR)),plusDI=round_pos(100*(prevPlusDM/prevTR)),tempReal=minusDI+plusDI,TA.TA_IS_ZERO(tempReal)||(tempReal=round_pos(100*(Math.abs(minusDI-plusDI)/tempReal)),prevADX=round_pos((prevADX*(this.Settings.TimePeriod-1)+tempReal)/this.Settings.TimePeriod)));for(outReal[0]=prevADX,outIdx=1;today<endIdx;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,prevMinusDM-=prevMinusDM/this.Settings.TimePeriod,prevPlusDM-=prevPlusDM/this.Settings.TimePeriod,diffM>0&&diffP<diffM?prevMinusDM+=diffM:diffP>0&&diffP>diffM&&(prevPlusDM+=diffP),eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE],TA.TA_IS_ZERO(prevTR)||(minusDI=round_pos(100*(prevMinusDM/prevTR)),plusDI=round_pos(100*(prevPlusDM/prevTR)),tempReal=minusDI+plusDI,TA.TA_IS_ZERO(tempReal)||(tempReal=round_pos(100*(Math.abs(minusDI-plusDI)/tempReal)),prevADX=round_pos((prevADX*(this.Settings.TimePeriod-1)+tempReal)/this.Settings.TimePeriod))),outReal[outIdx++]=prevADX;if(!dontFillTotalArray){if(outReal.length>=dataShape.length)throw"Ошибка расчета ADX";if(outReal.length<=dataShape.length)for(;outReal.length!=dataShape.length;)outReal.unshift(0)}return outReal},TA.ADX.getValue=function(t,e,i){},TA.ADX._lookback=function(){return 2*this.Settings.TimePeriod-1},TA.ADX._S=function(t,e,i,a){},TA.ADX.initChart=function(t,e,i){TA.INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.ADX.SetSettings(TA.ADX.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.AROON=TA.INDICATOR_TEMPLATE.Create():TA.AROON={},TA.AROON.name="AROON",TA.AROON.type="line",TA.AROON.DefaultSettings={TimePeriod:14},TA.AROON.Settings={},TA.AROON._S=function(t,e,i,a){},TA.AROON.initChart=function(t,e,i){TA.INDICATOR_TEMPLATE&&TA.INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.AROON.SetSettings(TA.AROON.DefaultSettings),TA.AROON.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u,g=[],f=[];if(this.SetSettings(a),t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(t<this.Settings.TimePeriod&&(t=this.Settings.TimePeriod),t>e)return{AroonDown:g,AroonUp:f};for(h=0,p=t,l=t-this.Settings.TimePeriod,c=-1,d=-1,r=0,s=0,o=100/this.Settings.TimePeriod;p<=e;){if(n=i[p][TA.LOW],c<l)for(c=l,r=i[c][TA.LOW],u=c;++u<=p;)n=i[u][TA.LOW],n<=r&&(c=u,r=n);else n<=r&&(c=p,r=n);if(n=i[p][TA.HIGH],d<l)for(d=l,s=i[d][TA.HIGH],u=d;++u<=p;)n=i[u][TA.HIGH],n>=s&&(d=u,s=n);else n>=s&&(d=p,s=n);f[h]=o*(this.Settings.TimePeriod-(p-d)),g[h]=o*(this.Settings.TimePeriod-(p-c)),h++,l++,p++}return{AroonDown:g,AroonUp:f}},TA.AROON.getValue=function(t,e,i){},TA.AROON._lookback=function(t){if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return t},TA.INDICATOR_TEMPLATE?TA.CCI=TA.INDICATOR_TEMPLATE.Create():TA.CCI={},TA.CCI.name="CCI",TA.CCI.type="line",TA.CCI.DefaultSettings={TimePeriod:14},TA.CCI.Settings={},TA.CCI.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d;this.SetSettings(a);var p,u,g,f=(new Array(30),[]);if(t||(t=0),e||(e=i.length-1),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(!f)throw"TA_BAD_PARAM";if(d=this.Settings.TimePeriod-1,t<d&&(t=d),t>e)return f;if(u=[],g=this.Settings.TimePeriod-1,p=0,h=t-d,this.Settings.TimePeriod>1)for(;h<t;)u[p]=(i[h][TA.HIGH]+i[h][TA.LOW]+i[h][TA.CLOSE])/3,h++,p++,p>g&&(p=0);c=0;do{for(o=(i[h][TA.HIGH]+i[h][TA.LOW]+i[h][TA.CLOSE])/3,u[p]=o,n=0,l=0;l<this.Settings.TimePeriod;l++)n+=u[l];for(n/=this.Settings.TimePeriod,s=0,l=0;l<this.Settings.TimePeriod;l++)s+=Math.abs(u[l]-n);r=o-n,0!=r&&0!=s?f[c++]=r/(.015*(s/this.Settings.TimePeriod)):f[c++]=0,p++,p>g&&(p=0),h++}while(h<=e);return f},TA.CCI.getValue=function(t,e,i){},TA.CCI._lookback=function(t){if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return t-1},TA.CCI._S=function(t,e,i,a){},TA.CCI.initChart=function(t,e,i){TA.INDICATOR_TEMPLATE&&TA.INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.CCI.SetSettings(TA.CCI.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.PLUS_DI=TA.INDICATOR_TEMPLATE.Create():TA.PLUS_DI={},TA.PLUS_DI.name="PLUS_DI",TA.PLUS_DI.type="line",TA.PLUS_DI.DefaultSettings={TimePeriod:14},TA.PLUS_DI.Settings={},TA.PLUS_DI._lookback=function(t){if(t){if(t<1||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return t>1?t:1},TA.PLUS_DI.calculate=function(startIdx,endIdx,dataShape,settings){function TRUE_RANGE(t,e,i,a){return"              "+a+" = "+t+"-"+e+";               tempReal2 = Math.abs("+t+"-"+i+");               if( tempReal2 > "+a+" )                  "+a+" = tempReal2;               tempReal2 = Math.abs("+e+"-"+i+");               if( tempReal2 > "+a+" )                  "+a+" = tempReal2;"}function round_pos(t){return t}var today,lookbackTotal,outIdx,prevHigh,prevLow,prevClose,prevPlusDM,prevTR,tempReal,tempReal2,diffP,diffM,i,outReal=[];if(this.SetSettings(settings),startIdx<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(endIdx<0||endIdx<startIdx)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(lookbackTotal=this.Settings.TimePeriod>1?this.Settings.TimePeriod:1,startIdx<lookbackTotal&&(startIdx=lookbackTotal),startIdx>endIdx){var outBegIdx=0,outNBElement=0;return outReal}if(outIdx=0,this.Settings.TimePeriod<=1){var outBegIdx=startIdx;for(today=startIdx-1,prevHigh=dataShape[today][TA.HIGH],prevLow=dataShape[today][TA.LOW],prevClose=dataShape[today][TA.CLOSE];today<endIdx;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,diffP>0&&diffP>diffM?(eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),TA.TA_IS_ZERO(tempReal)?outReal[outIdx++]=0:outReal[outIdx++]=diffP/tempReal):outReal[outIdx++]=0,prevClose=dataShape[today][TA.CLOSE];return outNBElement=outIdx,outReal}for(outBegIdx=today=startIdx,prevPlusDM=0,prevTR=0,today=startIdx-lookbackTotal,prevHigh=dataShape[today][TA.HIGH],prevLow=dataShape[today][TA.LOW],prevClose=dataShape[today][TA.CLOSE],i=this.Settings.TimePeriod-1;i-- >0;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,diffP>0&&diffP>diffM&&(prevPlusDM+=diffP),eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR+=tempReal,prevClose=dataShape[today][TA.CLOSE];for(i=1;0!=i--;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,diffP>0&&diffP>diffM?prevPlusDM=prevPlusDM-prevPlusDM/this.Settings.TimePeriod+diffP:prevPlusDM-=prevPlusDM/this.Settings.TimePeriod,eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE];for(TA.TA_IS_ZERO(prevTR)?outReal[0]=0:outReal[0]=round_pos(100*(prevPlusDM/prevTR)),outIdx=1;today<endIdx;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,diffP>0&&diffP>diffM?prevPlusDM=prevPlusDM-prevPlusDM/this.Settings.TimePeriod+diffP:prevPlusDM-=prevPlusDM/this.Settings.TimePeriod,eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE],TA.TA_IS_ZERO(prevTR)?outReal[outIdx++]=0:outReal[outIdx++]=round_pos(100*(prevPlusDM/prevTR));return outNBElement=outIdx,outReal},TA.INDICATOR_TEMPLATE?TA.MINUS_DI=TA.INDICATOR_TEMPLATE.Create():TA.MINUS_DI={},TA.MINUS_DI.name="MINUS_DI",TA.MINUS_DI.type="line",TA.MINUS_DI.DefaultSettings={TimePeriod:14},TA.MINUS_DI.Settings={},TA.MINUS_DI._lookback=function(t){if(t){if(t<1||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return t>1?t:1},TA.MINUS_DI.calculate=function(startIdx,endIdx,dataShape,settings){function TRUE_RANGE(t,e,i,a){return"              "+a+" = "+t+"-"+e+";               tempReal2 = Math.abs("+t+"-"+i+");               if( tempReal2 > "+a+" )                  "+a+" = tempReal2;               tempReal2 = Math.abs("+e+"-"+i+");               if( tempReal2 > "+a+" )                  "+a+" = tempReal2;"}function round_pos(t){return t}var today,lookbackTotal,outIdx,prevHigh,prevLow,prevClose,prevMinusDM,prevTR,tempReal,tempReal2,diffP,diffM,i,outReal=[];if(this.SetSettings(settings),startIdx<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(endIdx<0||endIdx<startIdx)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(lookbackTotal=this.Settings.TimePeriod>1?this.Settings.TimePeriod:1,startIdx<lookbackTotal&&(startIdx=lookbackTotal),startIdx>endIdx){var outBegIdx,outNBElement;return outReal}if(outIdx=0,this.Settings.TimePeriod<=1){var outBegIdx=startIdx;for(today=startIdx-1,prevHigh=dataShape[today][TA.HIGH],prevLow=dataShape[today][TA.LOW],prevClose=dataShape[today][TA.CLOSE];today<endIdx;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,diffM>0&&diffP<diffM?(eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),TA.TA_IS_ZERO(tempReal)?outReal[outIdx++]=0:outReal[outIdx++]=diffM/tempReal):outReal[outIdx++]=0,prevClose=dataShape[today][TA.CLOSE];return outNBElement=outIdx,outReal}for(outBegIdx=today=startIdx,prevMinusDM=0,prevTR=0,today=startIdx-lookbackTotal,prevHigh=dataShape[today][TA.HIGH],prevLow=dataShape[today][TA.LOW],prevClose=dataShape[today][TA.CLOSE],i=this.Settings.TimePeriod-1;i-- >0;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,diffM>0&&diffP<diffM&&(prevMinusDM+=diffM),eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR+=tempReal,prevClose=dataShape[today][TA.CLOSE];for(i=1;0!=i--;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,diffM>0&&diffP<diffM?prevMinusDM=prevMinusDM-prevMinusDM/this.Settings.TimePeriod+diffM:prevMinusDM-=prevMinusDM/this.Settings.TimePeriod,eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE];for(TA.TA_IS_ZERO(prevTR)?outReal[0]=0:outReal[0]=round_pos(100*(prevMinusDM/prevTR)),outIdx=1;today<endIdx;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,diffM>0&&diffP<diffM?prevMinusDM=prevMinusDM-prevMinusDM/this.Settings.TimePeriod+diffM:prevMinusDM-=prevMinusDM/this.Settings.TimePeriod,eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE],TA.TA_IS_ZERO(prevTR)?outReal[outIdx++]=0:outReal[outIdx++]=round_pos(100*(prevMinusDM/prevTR));return outNBElement=outIdx,outReal},TA.INDICATOR_TEMPLATE?TA.TRANGE=TA.INDICATOR_TEMPLATE.Create():TA.TRANGE={},TA.TRANGE.name="AROON",TA.TRANGE.type="line",TA.TRANGE.DefaultSettings={},TA.TRANGE.Settings={},TA.TRANGE._lookback=function(){return 1},TA.TRANGE.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u,g=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(t<1&&(t=1),t>e)return g;for(o=0,n=t;n<=e;)p=i[n][TA.LOW],u=i[n][TA.HIGH],d=i[n][TA.CLOSE],c=u-p,h=Math.abs(d-u),h>c&&(c=h),l=Math.abs(d-p),l>c&&(c=l),g[o++]=c,n++;return s=o,r=t,g},TA.INDICATOR_TEMPLATE?TA.ATR=TA.INDICATOR_TEMPLATE.Create():TA.ATR={},TA.ATR.name="ATR",TA.ATR.type="line",TA.ATR.DefaultSettings={TimePeriod:14},TA.ATR.Settings={},TA.ATR._lookback=function(t){if(t){if(t<1||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return t>1?t:1},TA.ATR.calculate=function(t,e,i,a){var r,s,n,o,h,l,c=[],d=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(n=this._lookback(this.Settings.TimePeriod),t<n&&(t=n),t>e)return d;if(this.Settings.TimePeriod<=1)return TA.TRANGE.calculate(t,e,i,{});if(c=TA.TRANGE.calculate(t-n+1,e,i,{}),!c||!c.length)return d;for(var p=[],u=0;u<c.length-1;u++)p.push([c[u]]);var l=TA.SMA.calculate(this.Settings.TimePeriod-1,this.Settings.TimePeriod-1,p,{TimePeriod:this.Settings.TimePeriod,CandleValueIdx:0});if(!l||!l.length)return d;for(h=l[0],s=this.Settings.TimePeriod,r=0;0!=r;)h*=this.Settings.TimePeriod-1,h+=c[s++],h/=this.Settings.TimePeriod,r--;for(r=1,d[0]=h,o=e-t+1;0!=--o;)h*=this.Settings.TimePeriod-1,h+=c[s++],h/=this.Settings.TimePeriod,d[r++]=h;return d},TA.INDICATOR_TEMPLATE?TA.CHV=TA.INDICATOR_TEMPLATE.Create():TA.CHV={},TA.CHV.name="CHV",TA.CHV.type="line",TA.CHV.DefaultSettings={TimePeriod:10,TimePeriodRoc:10,CandleValueIdx:TA.CLOSE},TA.CHV.Settings={},TA.CHV.calculate=function(t,e,i,a){var r=[],s=[];this.SetSettings(a);for(var n=t;n<=e;++n)s[n]=[i[n][TA.HIGH]-i[n][TA.LOW]];for(var o=TA.EMA.Create({TimePeriod:this.Settings.TimePeriod,CandleValueIdx:0}),h=o.calculate(t,e,s,{TimePeriod:this.Settings.TimePeriod,CandleValueIdx:0}),l=h.length-this.Settings.TimePeriodRoc,n=0;n<l;n++)r[n]=100*(h[n+this.Settings.TimePeriodRoc]-h[n])/h[n];return r},TA.CHV._lookback=function(t){return TA.EMA._lookback(t)+this.Settings.TimePeriodRoc},TA.INDICATOR_TEMPLATE?TA.DPO=TA.INDICATOR_TEMPLATE.Create():TA.DPO={},TA.DPO.name="DPO",TA.DPO.type="line",TA.DPO.DefaultSettings={TimePeriod:20,CandleValueIdx:TA.CLOSE},TA.DPO.Settings={},TA.DPO.calculate=function(t,e,i,a){var r=[];this.SetSettings(a);var s=TA.SMA.Create({TimePeriod:this.Settings.TimePeriod}),n=s.calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,CandleValueIdx:TA.CLOSE}),o=this.Settings.TimePeriod,h=TA.SMA._lookback(o),l=(o/2|0)+1;h+=l;for(var c=e-h;c>=0;--c)r[c]=i[c+h][TA.CLOSE]-n[c];return r},TA.DPO._lookback=function(t){return TA.SMA._lookback(t)+(t/2|0)+1},TA.INDICATOR_TEMPLATE?TA.ENV=TA.INDICATOR_TEMPLATE.Create():TA.ENV={},TA.ENV.name="ENV",TA.ENV.type="line",TA.ENV.DefaultSettings={TimePeriod:20,shift:1,CandleValueIdx:TA.CLOSE},TA.ENV.Settings={},TA.ENV.calculate=function(t,e,i,a){var r=[],s=[];this.SetSettings(a);for(var n=TA.SMA.Create({TimePeriod:this.Settings.TimePeriod}),o=n.calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,CandleValueIdx:TA.CLOSE}),h=1+this.Settings.shift/100,l=1-this.Settings.shift/100,c=0;c<o.length;c++)r[c]=o[c]*l,s[c]=o[c]*h;return{Lower:r,Upper:s}},TA.ENV._lookback=function(t){return TA.SMA._lookback(t)},TA.INDICATOR_TEMPLATE?TA.MACD=TA.INDICATOR_TEMPLATE.Create():TA.MACD={},TA.MACD.name="MACD",TA.MACD.type="line",TA.MACD.DefaultSettings={FastPeriod:12,SlowPeriod:26,SignalPeriod:9,CandleValueIdx:TA.CLOSE},TA.MACD.Settings={},TA.MACD.calculate=function(t,e,i,a){if(a&&this.SetSettings(a),t||(t=0),e||(e=i.length-1),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.FastPeriod){if(this.Settings.FastPeriod<2||this.Settings.FastPeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.FastPeriod=this.DefaultSettings.FastPeriod;if(this.Settings.SlowPeriod){if(this.Settings.SlowPeriod<2||this.Settings.SlowPeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.SlowPeriod=this.DefaultSettings.SlowPeriod;if(this.Settings.SignalPeriod){if(this.Settings.SignalPeriod<1||this.Settings.SignalPeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.SignalPeriod=this.DefaultSettings.SignalPeriod;var r=$.extend(!0,{},this.Settings);return r.SignalPeriod_2=r.SignalPeriod,delete r.SignalPeriod,TA.INT_MACD.calculate(t,e,i,r)},TA.MACD._lookback=function(t,e,i){if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.FastPeriod;if(e){if(e<2||e>1e5)return-1}else e=this.DefaultSettings.SlowPeriod;if(i){if(i<1||i>1e5)return-1}else i=this.DefaultSettings.SignalPeriod;var a;return e<t&&(a=e,e=t,t=a),TA.EMA._lookback(e)+TA.EMA._lookback(i)},TA.MACD.SetSettings(TA.MACD.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.INT_MACD=TA.INDICATOR_TEMPLATE.Create():TA.INT_MACD={},TA.INT_MACD.name="INT_MACD",TA.INT_MACD.type="line",TA.INT_MACD.DefaultSettings={FastPeriod:12,SlowPeriod:26,SignalPeriod_2:9,CandleValueIdx:TA.CLOSE},TA.INT_MACD.Settings={},TA.INT_MACD.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d=[],p=[],u=[],g=[],f=[];if(this.Settings&&this.SetSettings(a),this.Settings.SlowPeriod<this.Settings.FastPeriod&&(n=this.Settings.SlowPeriod,this.Settings.SlowPeriod=this.Settings.FastPeriod,this.Settings.FastPeriod=n),0!=this.Settings.SlowPeriod?r=TA.PER_TO_K(this.Settings.SlowPeriod):(this.Settings.SlowPeriod=this.DefaultSettings.SlowPeriod,r=TA.PER_TO_K(this.Settings.SlowPeriod)),0!=this.Settings.FastPeriod?s=TA.PER_TO_K(this.Settings.FastPeriod):(this.Settings.FastPeriod=this.DefaultSettings.FastPeriod,s=TA.PER_TO_K(this.Settings.FastPeriod)),h=TA.EMA._lookback(this.Settings.SignalPeriod_2),o=h,o+=TA.EMA._lookback(this.Settings.SlowPeriod),t<o&&(t=o),t>e)return{MACD:u,MACDSignal:g,MACDHist:f};if(n=e-t+1+h,n=t-h,TA.EMA._int_ema(n,e,i,this.Settings.SlowPeriod,r,d),!d||!d.length)return{MACD:u,MACDSignal:g,MACDHist:f};if(TA.EMA._int_ema(n,e,i,this.Settings.FastPeriod,s,p),!p||!p.length)return{MACD:u,MACDSignal:g,MACDHist:f};for(l=0,c=p.length;l<c;l++)p[l]=p[l]-d[l];u=p.slice(-p.length+this.Settings.SignalPeriod_2-1);for(var m=[],l=0;l<p.length;l++)m.push({7:p[l]});if(TA.EMA._int_ema(0,p.length-1,m,this.Settings.SignalPeriod_2,TA.PER_TO_K(this.Settings.SignalPeriod_2),g),!g||!g.length)return{MACD:u,MACDSignal:g,MACDHist:f};for(l=0,c=g.length;l<c;l++)f[l]=u[l]-g[l];return{MACD:u,MACDSignal:g,MACDHist:f}},TA.INT_MACD._lookback=function(t){TA.EMA._lookback(t)},TA.INT_MACD.SetSettings(TA.INT_MACD.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.MEDPRICE=TA.INDICATOR_TEMPLATE.Create():TA.MEDPRICE={},TA.MEDPRICE.name="MEDPRICE",TA.MEDPRICE.type="line",TA.MEDPRICE.DefaultSettings={},TA.MEDPRICE.Settings={},TA.MEDPRICE._lookback=function(){return 0},TA.MEDPRICE.calculate=function(t,e,i,a){var r,s,n=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";for(r=0,s=t;s<=e;s++)n[r++]=(i[s][TA.HIGH]+i[s][TA.LOW])/2;return n},TA.INDICATOR_TEMPLATE?TA.MFI=TA.INDICATOR_TEMPLATE.Create():TA.MFI={},TA.MFI.name="MFI",TA.MFI.type="line",TA.MFI.DefaultSettings={TimePeriod:14},TA.MFI.Settings={},TA.MFI._lookback=function(t){if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return t},TA.MFI.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u=[];this.SetSettings(a);var g=0,f=[],m=49;if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(this.Settings.TimePeriod<=0)return u;f=new Array(this.Settings.TimePeriod);for(var d=0;d<f.length;d++)f[d]={};if(!f)return u;if(m=f.length-1,l=this.Settings.TimePeriod,t<l&&(t=l),t>e)return u;for(c=0,p=t-l,n=(i[p][TA.HIGH]+i[p][TA.LOW]+i[p][TA.CLOSE])/3,r=0,s=0,p++,d=this.Settings.TimePeriod;d>0;d--)o=(i[p][TA.HIGH]+i[p][TA.LOW]+i[p][TA.CLOSE])/3,h=o-n,n=o,o*=i[p++][TA.VOL],h<0?(f[g].negative=o,s+=o,f[g].positive=0):h>0?(f[g].positive=o,r+=o,f[g].negative=0):(f[g].positive=0,f[g].negative=0),g++,g>m&&(g=0);if(p>t)o=r+s,o<1?u[c++]=0:u[c++]=100*(r/o);else for(;p<t;)r-=f[g].positive,s-=f[g].negative,o=(i[p][TA.HIGH]+i[p][TA.LOW]+i[p][TA.CLOSE])/3,h=o-n,n=o,o*=i[p++][TA.VOL],h<0?(f[g].negative=o,s+=o,f[g].positive=0):h>0?(f[g].positive=o,r+=o,f[g].negative=0):(f[g].positive=0,f[g].negative=0),g++,g>m&&(g=0);for(;p<=e;)r-=f[g].positive,s-=f[g].negative,o=(i[p][TA.HIGH]+i[p][TA.LOW]+i[p][TA.CLOSE])/3,h=o-n,n=o,o*=i[p++][TA.VOL],h<0?(f[g].negative=o,s+=o,f[g].positive=0):h>0?(f[g].positive=o,r+=o,f[g].negative=0):(f[g].positive=0,f[g].negative=0),o=r+s,o<1?u[c++]=0:u[c++]=100*(r/o),g++,g>m&&(g=0);return u},TA.INDICATOR_TEMPLATE?TA.OBV=TA.INDICATOR_TEMPLATE.Create():TA.OBV={},TA.OBV.name="OBV",TA.OBV.type="line",TA.OBV.DefaultSettings={CandleValueIdx:TA.CLOSE},TA.OBV.Settings={},TA.OBV._lookback=function(){return 0},TA.OBV.calculate=function(t,e,i,a){var r,s,n,o,h,l=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";for(h=i[t][TA.VOL],n=i[t][this.Settings.CandleValueIdx],s=0,r=t;r<=e;r++)o=i[r][this.Settings.CandleValueIdx],o>n?h+=i[r][TA.VOL]:o<n&&(h-=i[r][TA.VOL]),l[s++]=h,n=o;return l},TA.INDICATOR_TEMPLATE?TA.MINUS_DM=TA.INDICATOR_TEMPLATE.Create():TA.MINUS_DM={},TA.MINUS_DM.name="MINUS_DM",TA.MINUS_DM.type="line",TA.MINUS_DM.DefaultSettings={TimePeriod:14},TA.MINUS_DM.Settings={},TA.MINUS_DM._lookback=function(t){if(t){if(t<1||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return t>1?t-1:1},TA.MINUS_DM.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u,g=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(s=this.Settings.TimePeriod>1?this.Settings.TimePeriod-1:1,t<s&&(t=s),t>e)return g;if(n=0,this.Settings.TimePeriod<=1){for(r=t-1,o=i[r][TA.HIGH],h=i[r][TA.LOW];r<e;)r++,l=i[r][TA.HIGH],d=l-o,o=l,l=i[r][TA.LOW],p=h-l,h=l,p>0&&d<p?g[n++]=p:g[n++]=0;return g}for(c=0,r=t-s,o=i[r][TA.HIGH],h=i[r][TA.LOW],u=this.Settings.TimePeriod-1;u-- >0;)r++,l=i[r][TA.HIGH],d=l-o,o=l,l=i[r][TA.LOW],p=h-l,h=l,p>0&&d<p&&(c+=p);for(u=0;0!=u--;)r++,l=i[r][TA.HIGH],d=l-o,o=l,l=i[r][TA.LOW],p=h-l,h=l,p>0&&d<p?c=c-c/this.Settings.TimePeriod+p:c-=c/this.Settings.TimePeriod;for(g[0]=c,n=1;r<e;)r++,l=i[r][TA.HIGH],d=l-o,o=l,l=i[r][TA.LOW],p=h-l,h=l,p>0&&d<p?c=c-c/this.Settings.TimePeriod+p:c-=c/this.Settings.TimePeriod,g[n++]=c;return g},TA.INDICATOR_TEMPLATE?TA.SAR=TA.INDICATOR_TEMPLATE.Create():TA.SAR={},TA.SAR.name="SAR",TA.SAR.type="line",TA.SAR.DefaultSettings={Acceleration:.02,Maximum:.2},TA.SAR.Settings={},TA.SAR._lookback=function(t,e){if(t){if(t<0||t>3e37)return-1}else t=this.DefaultSettings.Acceleration;if(e){if(e<0||e>3e37)return-1}else e=this.DefaultSettings.Maximum;return 1},TA.SAR.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u,g=[];this.SetSettings(a);var f;if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.Acceleration){if(this.Settings.Acceleration<0||this.Settings.Acceleration>3e37)throw"TA_BAD_PARAM"}else this.Settings.Acceleration=this.DefaultSettings.Acceleration;if(this.Settings.Maximum){if(this.Settings.Maximum<0||this.Settings.Maximum>3e37)throw"TA_BAD_PARAM"}else this.Settings.Maximum=this.DefaultSettings.Maximum;if(t<1&&(t=1),t>e)return g;for(d=this.Settings.Acceleration,d>this.Settings.Maximum&&(d=this.Settings.Acceleration=this.Settings.Maximum),f=TA.MINUS_DM.calculate(t,t,i,{TimePeriod:1}),r=f[0]>0?0:1,n=0,s=t,o=i[s-1][TA.HIGH],h=i[s-1][TA.LOW],1==r?(p=i[s][TA.HIGH],u=h):(p=i[s][TA.LOW],u=o),h=i[s][TA.LOW],o=i[s][TA.HIGH];s<=e;)c=h,l=o,h=i[s][TA.LOW],o=i[s][TA.HIGH],s++,1==r?h<=u?(r=0,u=p,u<l&&(u=l),u<o&&(u=o),g[n++]=u,d=this.Settings.Acceleration,p=h,u+=d*(p-u),u<l&&(u=l),u<o&&(u=o)):(g[n++]=u,o>p&&(p=o,d+=this.Settings.Acceleration,d>this.Settings.Maximum&&(d=this.Settings.Maximum)),u+=d*(p-u),u>c&&(u=c),u>h&&(u=h)):o>=u?(r=1,u=p,u>c&&(u=c),u>h&&(u=h),g[n++]=u,d=this.Settings.Acceleration,p=o,u+=d*(p-u),u>c&&(u=c),u>h&&(u=h)):(g[n++]=u,h<p&&(p=h,d+=this.Settings.Acceleration,d>this.Settings.Maximum&&(d=this.Settings.Maximum)),u+=d*(p-u),u<l&&(u=l),u<o&&(u=o));return g},TA.INDICATOR_TEMPLATE?TA.ROC=TA.INDICATOR_TEMPLATE.Create():TA.ROC={},TA.ROC.name="ROC",TA.ROC.type="line",TA.ROC.DefaultSettings={CandleValueIdx:TA.CLOSE,TimePeriod:10},TA.ROC.Settings={},TA.ROC._lookback=function(t){if(t){if(t<1||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return t},TA.ROC.calculate=function(t,e,i,a){var r,s,n,o,h=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(!h)throw"TA_BAD_PARAM";if(t<this.Settings.TimePeriod&&(t=this.Settings.TimePeriod),t>e)return h;for(s=0,r=t,n=t-this.Settings.TimePeriod;r<=e;)o=i[n++][TA.CLOSE],0!=o?h[s++]=100*(i[r][TA.CLOSE]/o-1):h[s++]=0,r++;return h},TA.INDICATOR_TEMPLATE?TA.TEMA=TA.INDICATOR_TEMPLATE.Create():TA.TEMA={},TA.TEMA.name="TEMA",TA.TEMA.type="line",TA.TEMA.DefaultSettings={CandleValueIdx:TA.CLOSE,TimePeriod:12},TA.TEMA.Settings={},TA.TEMA._lookback=function(t){var e;if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return e=TA.EMA._lookback(t),3*e},TA.TEMA.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d=[],p=[],u=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(h=TA.EMA._lookback(this.Settings.TimePeriod),o=3*h,t<o&&(t=o),t>e)return u;s=o+(e-t)+1,r=TA.PER_TO_K(this.Settings.TimePeriod);var g=TA.EMA.Create({TimePeriod:this.Settings.TimePeriod});if(g._int_ema(t-3*h,e,i,this.Settings.TimePeriod,r,d),!d.length)return u;for(var f=[],m=0;m<d.length;m++)f.push([d[m]]);if(g.SetSettings({CandleValueIdx:0}),g._int_ema(0,f.length-1,f,this.Settings.TimePeriod,r,p),!p.length)return u;for(var v=[],m=0;m<p.length;m++)v.push([p[m]]);if(g.SetSettings({CandleValueIdx:0}),g._int_ema(0,v.length-1,v,this.Settings.TimePeriod,r,u),!u.length)return u;for(l=2*h,c=h,n=0;n<u.length;)u[n]+=3*d[l++]-3*p[c++],n++;return u},TA.INDICATOR_TEMPLATE?TA.TRIMA=TA.INDICATOR_TEMPLATE.Create():TA.TRIMA={},TA.TRIMA.name="TRIMA",TA.TRIMA.type="line",TA.TRIMA.DefaultSettings={CandleValueIdx:TA.CLOSE,TimePeriod:20},TA.TRIMA.Settings={},TA.TRIMA._lookback=function(t){if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return t-1},TA.TRIMA.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u,g,f=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(r=this.Settings.TimePeriod-1,t<r&&(t=r),t>e)return f;if(l=0,this.Settings.TimePeriod%2==1){for(h=this.Settings.TimePeriod>>1,u=(h+1)*(h+1),u=1/u,d=t-r,p=d+h,c=p+h,s=0,n=0,h=p;h>=d;h--)g=i[h][this.Settings.CandleValueIdx],n+=g,s+=n;for(o=0,p++,h=p;h<=c;h++)g=i[h][this.Settings.CandleValueIdx],o+=g,s+=o;for(l=0,g=i[d++][this.Settings.CandleValueIdx],f[l++]=s*u,c++;c<=e;)s-=n,n-=g,g=i[p++][this.Settings.CandleValueIdx],n+=g,s+=o,o-=g,g=i[c++][this.Settings.CandleValueIdx],o+=g,s+=g,g=i[d++][this.Settings.CandleValueIdx],f[l++]=s*u}else{for(h=this.Settings.TimePeriod>>1,u=h*(h+1),u=1/u,d=t-r,p=d+h-1,c=p+h,s=0,n=0,h=p;h>=d;h--)g=i[h][this.Settings.CandleValueIdx],n+=g,s+=n;for(o=0,p++,h=p;h<=c;h++)g=i[h][this.Settings.CandleValueIdx],o+=g,s+=o;for(l=0,g=i[d++][this.Settings.CandleValueIdx],f[l++]=s*u,c++;c<=e;)s-=n,n-=g,g=i[p++][this.Settings.CandleValueIdx],n+=g,o-=g,s+=o,g=i[c++][this.Settings.CandleValueIdx],o+=g,s+=g,g=i[d++][this.Settings.CandleValueIdx],f[l++]=s*u}return f},TA.INDICATOR_TEMPLATE?TA.TYPPRICE=TA.INDICATOR_TEMPLATE.Create():TA.TYPPRICE={},TA.TYPPRICE.name="TYPPRICE",TA.TYPPRICE.type="line",TA.TYPPRICE.DefaultSettings={},TA.TYPPRICE.Settings={},TA.TYPPRICE._lookback=function(){return 0},TA.TYPPRICE.calculate=function(t,e,i,a){var r,s,n=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";for(r=0,s=t;s<=e;s++)n[r++]=(i[s][TA.HIGH]+i[s][TA.LOW]+i[s][TA.CLOSE])/3;return n},TA.INDICATOR_TEMPLATE?TA.VPT=TA.INDICATOR_TEMPLATE.Create():TA.VPT={},TA.VPT.name="VPT",TA.VPT.type="line",TA.VPT.DefaultSettings={},TA.VPT.Settings={},TA.VPT._lookback=function(){return 0},TA.VPT.calculate=function(t,e,i,a){var r=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";var s=i[t][TA.CLOSE];r[0]=0;for(var n=t+1;n<=e;++n)r[n-t]=r[n-t-1]+i[n][TA.VOL]*(i[n][TA.CLOSE]-s)/s,s=i[n][TA.CLOSE];return r},TA.INDICATOR_TEMPLATE?TA.WCLPRICE=TA.INDICATOR_TEMPLATE.Create():TA.WCLPRICE={},TA.WCLPRICE.name="WCLPRICE",TA.WCLPRICE.type="line",TA.WCLPRICE.DefaultSettings={},TA.WCLPRICE.Settings={},TA.WCLPRICE._lookback=function(){return 0},TA.WCLPRICE.calculate=function(t,e,i,a){var r,s,n=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";for(r=0,s=t;s<=e;s++)n[r++]=(i[s][TA.HIGH]+i[s][TA.LOW]+2*i[s][TA.CLOSE])/4;return n},TA.INDICATOR_TEMPLATE?TA.WILLR=TA.INDICATOR_TEMPLATE.Create():TA.WILLR={},TA.WILLR.name="WILLR",TA.WILLR.type="line",TA.WILLR.DefaultSettings={TimePeriod:14},TA.WILLR.Settings={},TA.WILLR._lookback=function(t){if(t){if(t<2||t>1e5)return-1}else t=this.DefaultSettings.TimePeriod;return t-1},TA.WILLR.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u,g,f=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||this.Settings.TimePeriod>1e5)throw"TA_BAD_PARAM";
}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(l=this.Settings.TimePeriod-1,t<l&&(t=l),t>e)return f;for(o=0,h=0,u=t,c=t-l,d=p=-1,o=s=r=0;u<=e;){if(n=i[u][TA.LOW],d<c){for(d=c,r=i[d][TA.LOW],g=d;++g<=u;)n=i[g][TA.LOW],n<r&&(d=g,r=n);o=(s-r)/-100}else n<=r&&(d=u,r=n,o=(s-r)/-100);if(n=i[u][TA.HIGH],p<c){for(p=c,s=i[p][TA.HIGH],g=p;++g<=u;)n=i[g][TA.HIGH],n>s&&(p=g,s=n);o=(s-r)/-100}else n>=s&&(p=u,s=n,o=(s-r)/-100);0!=o?f[h++]=(s-i[u][TA.CLOSE])/o:f[h++]=0,c++,u++}return f};!function(){"use strict";var t={chartType:"Line",enabled:!0,formatProvider:{decimalPlaces:"2",decimalPrecision:null},indicatorIndex:0,indicatorIndex2:0,kind:"TA_LIB",name:"",overlay:!0,points:[],valuesPerPoint:1,isStartedFromZero:!1,color:"",width:2,chartArea:"ChartArea1",enableMerge:!0,index:2,closeValueIndex:0,lowValueIndex:0,highValueIndex:0,labels:[]};iChart.Charting.TA=function(t){this.chart=t.chart},iChart.Charting.TA.prototype.addCustomIndicatorSerie=function(e,i,a){if(arguments.length<3)throw _t("14949","Неверные параметры для вывода пользовательской серии.");if(e){this.removeIndicator(i);var r=new iChart.Charting.ChartArea({chart:this.chart}),s="ChartAreaI"+i,n=a.title||indocatorName,o=a.data,h=o.length;r.axisX.showLabels=!1,r.enabled=!0,r.xSeries=this.chart.areas[0].xSeries,r.ySeries=[],r.name=s,r.title=n,r.onClose=function(){this.chart.clearIndicators(this)};var l=[];l[0]=$.extend(!0,{},t),l[0].indicatorIndex=i||0,l[0].color=a.color||this.chart.chartOptions.indicatorColors[i][0],l[0].width=a.width||2,l[0].name=n,l[0].labels=this.getLabels(l[0],[]);for(var c=(this.getData(),0);c<h;c++)l[0].points.push([0===o[c]?null:o[c]]);r.ySeries.push(l[0]),this.chart.areas.push(r);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:r.title,params:null,data:o}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(i)},iChart.Charting.TA.prototype.getDefaultParams=function(t){var e={};return $.each(iChart.indicators[t].parameters,function(t,i){e[i.Code]=i.Value}),e},iChart.Charting.TA.prototype.getSeries=function(t,e){t=t||"Volume",e=e||"";for(var i=this.chart.areas,a=0;a<i.length;a++){for(var r=-1,s=0;s<i[a].ySeries.length;s++)if("TechnicalAnalysis"===i[a].ySeries[s].kind){var n=i[a].ySeries[s].name.match(/(.+)\s\((.*)\)/);if(n&&n[1]===t&&n[2]==e){r=s;break}}else if(i[a].ySeries[s].kind===t){r=s;break}if(r>=0)break}return r>=0&&{xSeries:this.chart.areas[a].xSeries.slice(0,this.chart.areas[a].xSeries.length-this.chart.chartOptions.futureAmount),ySeries:this.chart.areas[a].ySeries[s].points.slice(0,this.chart.areas[a].xSeries.length-this.chart.chartOptions.futureAmount)}},iChart.Charting.TA.prototype.getData=function(){var t=this.chart.areas[0].xSeries,e=this.chart.areas[0].ySeries[0],i=this.getSeries("Volume");i||(i={},i.ySeries=[]);for(var a=[],r=0;r<t.length-this.chart.chartOptions.futureAmount;r++){var s=new Date(1e3*t[r]);iChart.formatDateTime(s);var n=["",this.chart._dataSettings.timeframe,iChart.formatDateTime(s,"yyyyMMdd"),iChart.formatDateTime(s,"HHmmss"),null!=e.points[r]?e.points[r][2]:a[r-1][4],null!=e.points[r]?e.points[r][0]:a[r-1][5],null!=e.points[r]?e.points[r][1]:a[r-1][6],null!=e.points[r]?e.points[r][3]:a[r-1][7],null!=i.ySeries[r]?i.ySeries[r][0]:0,iChart.formatDateTime(s,"yyyy-MM-ddTHH:mm:ss"),s.getTime(),iChart.formatDateTime(s,"yyyy-MM-ddTHH:mm:ss")];a[r]=n}return a},iChart.Charting.TA.prototype.mapParam=function(t){var e={TimePeriod:"Period",PeriodROC:"PeriodROC",shift:"Shift",DeviationsUp:"StdDevUp",DeviationsDown:"StdDevDown"},i=e[t]||"";return i},iChart.Charting.TA.prototype.test=function(){var t=parseInt(this.chart._dataSettings.i0_Period),e=this.getData(),i=EMA.calculate(null,null,e,{TimePeriod:t}),a=Array(t-1);i=a.concat(i);for(var r=this.getSeries("EMA",t).ySeries,s=0;s<r.length;s++)console.log(s,r[s],i[s],"cl="+e[s][CLOSE],"dt="+(100-r[s]/i[s]*100))},iChart.Charting.TA.prototype.removeIndicator=function(t){if("undefined"!=typeof this.chart&&!$.isEmptyObject(this.chart.areas)){for(var e=0;e<this.chart.areas.length;++e){for(var i=this.chart.areas[e],a=[],r=0;r<i.ySeries.length;++r)"TA_LIB"!==i.ySeries[r].kind||i.ySeries[r].indicatorIndex!=t&&"undefined"!=typeof t||(a.push(i.ySeries[r].indicatorIndex),i.ySeries.splice(r,1),--r);if(a.length)if(0===i.ySeries.length){var s=this.chart.areas.splice(e,1);s[0].dispose(),--e}else i.title&&(i.title="",$.each(i.ySeries,function(t,e){if("TA_LIB"===e.kind){var a=Object.keys(e.params).map(function(t){return e.params[t]});i.title+=(i.title?", ":"")+(e.name+(a.length?"("+a.join(",")+")":""))}}))}this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}},iChart.Charting.TA.prototype.findArea=function(t){if("undefined"!=typeof this.chart&&!$.isEmptyObject(this.chart.areas))for(var e=0;e<this.chart.areas.length;++e){var i=this.chart.areas[e];if(i.name==t)return i}return!1},iChart.Charting.TA.prototype.TRPLN=function(e,i){if(e){var a=80,r=$("<canvas>").get(0),s=r.getContext("2d"),n=s.createLinearGradient(0,0,a,0);n.addColorStop(1,"#016D06"),n.addColorStop(.5,"#FF9B08"),n.addColorStop(0,"#FF1608"),s.fillStyle=n,s.fillRect(0,0,a,1);for(var o=s.getImageData(0,0,a,1),h=[],l=0;l<o.data.length;l+=4){var c="rgb("+o.data[l]+","+o.data[l+1]+","+o.data[l+2]+")";h.push(c)}for(var d=this.getData(),p=2,u=Array(a),l=0;l<a;l++){u[l]=TA.SMA.justifyCalculate(0,d.length-1,d,{TimePeriod:p},1);var g=$.extend(!0,{},t);g.name="TRPLN"+(l<a-1?"_"+l:""),g.indicatorIndex=i,g.color=h[l],g.width=1;for(var f=0;f<u[l].length;f++)g.points.push([0===u[l][f]?null:u[l][f]]);this.chart.areas[0].ySeries.push(g),p+=p<100?2:3}$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:"TRPLN",params:null,data:u}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(i)},iChart.Charting.TA.prototype.createSeries=function(e,i){var a=[];i=i||0;for(var r=0;r<this.chart.env.viewData.indicators[e].output;r++){a[r]=$.extend(!0,{},t),a[r].indicatorIndex=i;var s=i%(this.chart.chartOptions.indicatorColors.length-1),n=this.chart.chartOptions.indicatorColors[s][r];this.chart.env.userSettings.chartSettings.indicatorsColor[e]&&this.chart.env.userSettings.chartSettings.indicatorsColor[e][i]&&this.chart.env.userSettings.chartSettings.indicatorsColor[e][i][r]&&(n=this.chart.env.userSettings.chartSettings.indicatorsColor[e][i][r]);var o=2;this.chart.env.userSettings.chartSettings.indicatorsWidth[e]&&this.chart.env.userSettings.chartSettings.indicatorsWidth[e][i]&&this.chart.env.userSettings.chartSettings.indicatorsWidth[e][i][r]&&(o=this.chart.env.userSettings.chartSettings.indicatorsWidth[e][i][r]),a[r].color=n,a[r].width=o,a[r].name=e}return a},iChart.Charting.TA.prototype.getLabels=function(t,e,i){var a=[];i=i||"";for(var r in e)a.push(e[r]);a=a.length?"("+a.join(",")+")":"";var s=t.color.replace(/rgba\((.+),[^,]+\)/,"rgb($1)"),n=$("<span/>",{class:"m-chart-legend-color"}).css({"background-color":s}).html("&nbsp;");n=n.add($("<span/>",{class:"m-chart-legend-name"}).css({color:s}).text(t.name+a+i));var o=$("<div/>").append(n).html();return[[0,o]]},iChart.Charting.TA.prototype.BBANDS=function(t,e,i){if(t){var a="BBANDS",i=i||this.getDefaultParams(a),r=this.getData(),s=TA.BBANDS.justifyCalculate(0,r.length-1,r,i),n=this.createSeries(a,e);n[0].labels=this.getLabels(n[0],i," Upper"),n[0].params=i;for(var o=0;o<s.UpperBand.length;o++)n[0].points.push([0===s.UpperBand[o]?null:s.UpperBand[o]]);this.chart.areas[0].ySeries.push(n[0]),n[1].labels=this.getLabels(n[1],i," Middle"),n[1].params=i;for(var o=0;o<s.MiddleBand.length;o++)n[1].points.push([0===s.MiddleBand[o]?null:s.MiddleBand[o]]);this.chart.areas[0].ySeries.push(n[1]),n[2].labels=this.getLabels(n[2],i," Lower"),n[2].params=i;for(var o=0;o<s.LowerBand.length;o++)n[2].points.push([0===s.LowerBand[o]?null:s.LowerBand[o]]);this.chart.areas[0].ySeries.push(n[2]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.AD=function(t,e,i){if(t){var a="AD",r="ChartAreaI_"+a;i=i||this.getDefaultParams(a);var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title=a,s.onClose=function(){this.chart.clearIndicators(this)};var n=this.createSeries(a,e);n[0].labels=this.getLabels(n[0],i);for(var o=this.getData(),h=TA.AD.justifyCalculate(0,o.length-1,o),l=0;l<h.length;l++)n[0].points.push([0===h[l]?null:h[l]]);s.ySeries.push(n[0]),this.chart.areas.push(s);for(var c=0;c<this.chart.areas.length;++c)this.chart.areas[c].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:h}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ADOSC=function(t,e,i){if(t){var a="ADOSC",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].labels=this.getLabels(o[0],i);for(var h=this.getData(),l=TA.ADOSC.justifyCalculate(0,h.length-1,h,i),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ADX=function(t,e,i){if(t){var a="ADX",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].labels=this.getLabels(o[0],i);for(var h=this.getData(),l=TA.ADX.justifyCalculate(0,h.length-1,h,i,1),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ADXDI=function(t,e,i){if(t){var a="ADXDI",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].chartArea=s.name,o[0].labels=this.getLabels(o[0],i);var h={},l=this.getData();h.ADX=TA.ADX.justifyCalculate(0,l.length-1,l,i,1);for(var c=0;c<h.ADX.length;c++)o[0].points.push([0===h.ADX[c]?null:h.ADX[c]]);s.ySeries.push(o[0]),o[1].name="ADXDI",o[1].params=i,o[1].chartArea=s.name,o[1].labels=this.getLabels(o[1],i," +DI");var l=this.getData();h.PLUS_DI=TA.PLUS_DI.justifyCalculate(0,l.length-1,l,i,1);for(var c=0;c<h.PLUS_DI.length;c++)o[1].points.push([0===h.PLUS_DI[c]?null:h.PLUS_DI[c]]);s.ySeries.push(o[1]),o[2].name="ADXDI",o[2].params=i,o[2].chartArea=s.name,o[2].labels=this.getLabels(o[2],i," -DI");var l=this.getData();h.MINUS_DI=TA.MINUS_DI.justifyCalculate(0,l.length-1,l,i,1);for(var c=0;c<h.MINUS_DI.length;c++)o[2].points.push([0===h.MINUS_DI[c]?null:h.MINUS_DI[c]]);s.ySeries.push(o[2]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:h}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.AROON=function(t,e,i){if(t){var a="AROON",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.getData(),h=TA.AROON.justifyCalculate(0,o.length-1,o,i),l=this.createSeries(a,e);l[0].chartArea=s.name,l[0].params=i,l[0].labels=this.getLabels(l[0],i," Down");for(var c=0;c<h.AroonDown.length;c++)l[0].points.push([0===h.AroonDown[c]?null:h.AroonDown[c]]);s.ySeries.push(l[0]),l[1].chartArea=s.name,l[1].params=i,l[1].labels=this.getLabels(l[1],i," Up");for(var c=0;c<h.AroonUp.length;c++)l[1].points.push([0===h.AroonUp[c]?null:h.AroonUp[c]]);s.ySeries.push(l[1]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:h}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ATR=function(t,e,i){if(t){var a="ATR",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].labels=this.getLabels(o[0],i);for(var h=this.getData(),l=TA.ATR.justifyCalculate(0,h.length-1,h,i,1),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.CCI=function(t,e,i){if(t){var a="CCI",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].labels=this.getLabels(o[0],i);for(var h=this.getData(),l=TA.CCI.justifyCalculate(0,h.length-1,h,i),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.CHV=function(t,e,i){if(t){var a="CHV",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].labels=this.getLabels(o[0],i);for(var h=this.getData(),l=TA.CHV.justifyCalculate(0,h.length-1,h,i,1),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.DPO=function(t,e,i){if(t){var a="DPO",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].labels=this.getLabels(o[0],i);for(var h=this.getData(),l=TA.DPO.justifyCalculate(0,h.length-1,h,i,1),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.EMA=function(t,e,i){if(t){var a="EMA";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var s=this.getData(),n=TA.EMA.justifyCalculate(0,s.length-1,s,i),o=0;o<n.length;o++)r[0].points.push([0===n[o]?null:n[o]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ENV=function(t,e,i){if(t){var a="ENV";i=i||this.getDefaultParams(a);var r=this.getData(),s=TA.ENV.justifyCalculate(0,r.length-1,r,i,1),n=this.createSeries(a,e);n[0].params=i,n[0].labels=this.getLabels(n[1],i," Upper");for(var o=0;o<s.Upper.length;o++)n[0].points.push([0===s.Upper[o]?null:s.Upper[o]]);this.chart.areas[0].ySeries.push(n[0]),n[1].labels=this.getLabels(n[0],i," Lower");for(var o=0;o<s.Lower.length;o++)n[1].points.push([0===s.Lower[o]?null:s.Lower[o]]);this.chart.areas[0].ySeries.push(n[1]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.MACD=function(t,e,i){if(t){var a="MACD",r="ChartAreaI_"+a;i=i||this.getDefaultParams(a);var s=this.getData(),n=TA.MACD.justifyCalculate(0,s.length-1,s,i),o=new iChart.Charting.ChartArea({chart:this.chart});o.axisX.showLabels=!1,o.enabled=!0,o.xSeries=this.chart.areas[0].xSeries,o.ySeries=[],o.name=r,o.title="";var h=Object.keys(i).map(function(t){return i[t]});o.title+=(o.title?", ":"")+(a+(h.length?"("+h.join(",")+")":"")),o.onClose=function(){this.chart.clearIndicators(this)};var l=this.createSeries(a,e);l[0].params=i,l[0].indicatorIndex=e,l[0].labels=this.getLabels(l[0],i);for(var c=0;c<n.MACD.length;c++)l[0].points.push([0===n.MACD[c]?null:n.MACD[c]]);o.ySeries.push(l[0]),l[1].params=i,l[1].indicatorIndex=e,l[1].labels=this.getLabels(l[1],i);for(var c=0;c<n.MACDSignal.length;c++)l[1].points.push([0===n.MACDSignal[c]?null:n.MACDSignal[c]]);o.ySeries.push(l[1]),l[2].params=i,l[2].indicatorIndex=e,l[2].chartType="Column",l[2].labels=this.getLabels(l[2],i);for(var c=0;c<n.MACDHist.length;c++)l[2].points.push([0===n.MACDHist[c]?null:n.MACDHist[c]]);o.ySeries.push(l[2]),this.chart.areas.push(o);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.MEDPRICE=function(t,e,i){if(t){var a="MEDPRICE";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var s=this.getData(),n=TA.MEDPRICE.justifyCalculate(0,s.length-1,s,i),o=0;o<n.length;o++)r[0].points.push([0===n[o]?null:n[o]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.MFI=function(t,e,i){if(t){var a="MFI",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].labels=this.getLabels(o[0],i);for(var h=this.getData(),l=TA.MFI.justifyCalculate(0,h.length-1,h,i,1),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.OBV=function(t,e,i){if(t){var a="OBV",r="ChartAreaI_"+a;i=i||this.getDefaultParams(a);var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s);var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].labels=this.getLabels(o[0],i);for(var h=this.getData(),l=TA.OBV.justifyCalculate(0,h.length-1,h,i,1),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.PSAR=function(t,e,i){if(t){var a="PSAR";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i),r[0].chartType="Point";for(var s=this.getData(),n=TA.SAR.justifyCalculate(0,s.length-1,s,i),o=0;o<n.length;o++)r[0].points.push([0===n[o]?null:n[o]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ROC=function(t,e,i){if(t){var a="ROC",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].labels=this.getLabels(o[0],i),o[0].chartArea=s.name;for(var h=this.getData(),l=TA.ROC.justifyCalculate(0,h.length-1,h,i,1),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.RSI=function(t,e,i){if(t){var a="RSI",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].labels=this.getLabels(o[0],i);for(var h=this.getData(),l=TA.RSI.justifyCalculate(0,h.length-1,h,i),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:"RSI",params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.SMA=function(t,e,i){if(t){var a="SMA";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var s=this.getData(),n=TA.SMA.justifyCalculate(0,s.length-1,s,i,1),o=0;o<n.length;o++)r[0].points.push([0===n[o]?null:n[o]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.STDDEV=function(t,e,i){if(t){var a="STDDEV",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].labels=this.getLabels(o[0],i),o[0].chartArea=s.name;for(var h=this.getData(),l=TA.STDDEV.justifyCalculate(0,h.length-1,h,i,1),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.TEMA=function(t,e,i){if(t){var a="TEMA";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var s=this.getData(),n=TA.TEMA.justifyCalculate(0,s.length-1,s,i,1),o=0;o<n.length;o++)r[0].points.push([0===n[o]?null:n[o]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.TRIMA=function(t,e,i){if(t){var a="TRIMA";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var s=this.getData(),n=TA.TRIMA.justifyCalculate(0,s.length-1,s,i),o=0;o<n.length;o++)r[0].points.push([0===n[o]?null:n[o]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.TYPPRICE=function(t,e,i){if(t){var a="TYPPRICE";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var s=this.getData(),n=TA.TYPPRICE.justifyCalculate(0,s.length-1,s,i),o=0;o<n.length;o++)r[0].points.push([0===n[o]?null:n[o]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.VPT=function(t,e,i){if(t){var a="VPT",r="ChartAreaI_"+a;i=i||this.getDefaultParams(a);var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s);var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].labels=this.getLabels(o[0],i),o[0].indicatorIndex=e;for(var h=this.getData(),l=TA.VPT.justifyCalculate(0,h.length-1,h,i,1),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.WCLPRICE=function(t,e,i){if(t){var a="RSI";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var s=this.getData(),n=TA.WCLPRICE.justifyCalculate(0,s.length-1,s,i),o=0;o<n.length;o++)r[0].points.push([0===n[o]?null:n[o]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.WILLR=function(t,e,i){if(t){var a="WILLR",r="ChartAreaI_"+a;if(i=i||this.getDefaultParams(a),s=this.findArea(r),!s){var s=new iChart.Charting.ChartArea({chart:this.chart});s.axisX.showLabels=!1,s.enabled=!0,s.xSeries=this.chart.areas[0].xSeries,s.ySeries=[],s.name=r,s.title="",this.chart.areas.push(s)}var n=Object.keys(i).map(function(t){return i[t]});s.title+=(s.title?", ":"")+(a+(n.length?"("+n.join(",")+")":"")),s.onClose=function(){this.chart.clearIndicators(this)};var o=this.createSeries(a,e);o[0].params=i,o[0].labels=this.getLabels(o[0],i),o[0].indicatorIndex=e;for(var h=this.getData(),l=TA.WILLR.justifyCalculate(0,h.length-1,h,i,1),c=0;c<l.length;c++)o[0].points.push([0===l[c]?null:l[c]]);s.ySeries.push(o[0]);for(var d=0;d<this.chart.areas.length;++d)this.chart.areas[d].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.WMA=function(t,e,i){if(t){var a="WMA";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,
r[0].labels=this.getLabels(r[0],i);for(var s=this.getData(),n=TA.WMA.justifyCalculate(0,s.length-1,s,i,1),o=0;o<n.length;o++)r[0].points.push([0===n[o]?null:n[o]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.analyseResistSupport=function(t){function e(t,e,i,a,r){for(var s=[],n=[],o=[],h=i.length-1;h>=0;h--)o.push(i[h][TA.LOW]),n.push(i[h][TA.HIGH]),s.push(a[h]);for(var l=-1,c=!1,d=!0,p=!0,u=1e8,g=0,h=0;h<i.length;h++){var f=s[h],m=n[h],v=o[h];if(0==c){if(f<=t||f>=e)continue;c=!0}if(f<t){if(1!=p)break;1==d&&(d=!1,r>=0&&(e-=r)),v<u&&(u=v,l=h)}if(f>e){if(1!=d)break;1==p&&(p=!1,r>=0&&(t+=r)),m>g&&(g=m,l=h)}}return l}function i(t,e,i,a,r,s,n,o){for(var h=[],l=[],c=[],d=[],p=i.length-1;p>=0;p--)d.push(i[p]);i=d;for(var p=0;p<i.length;p++)c.push(i[p][TA.LOW]),l.push(i[p][TA.HIGH]),h.push(a[a.length-1-p]);var u,g,f,m,v,y=-1,C=-1,x=!1,T=!1,S=!1;switch(g=1e8,f=0,3!=s?1==o?(T=!0,n>=0&&(t+=n)):(x=!0,n>=0&&(e-=n)):0==o?(T=!0,n>=0&&(e-=n)):(x=!0,n>=0&&(t+=n)),s){case 2:C=r.p_1;break;case 3:C=r.p_2;break;case 4:C=r.p_3}for(var p=C;p<i.length&&(u=h[p],m=l[p],v=c[p],1!=S||!(1==T&&u>=e||1==x&&u<=t));p++)1==T?u<=t&&(0==S&&(S=!0),v<g&&(g=v,y=p)):u>=e&&(0==S&&(S=!0),m>=f&&(f=m,y=p));return y}function a(t,e,i){for(var a=[],r=e.length-1;r>=0;r--)"undefined"!=typeof e[r]&&a.push(e[r]);var s=a[t.p_1];return!(s<=i)}function r(){return m.p_1=e(g,f,o,h,p,u),m.p_1<0?(console.log("analyseResistSupport: В истории недостаточно баров для анализа 1"),0):(m.p_1>0&&(d=a(m,h,g,u)),m.p_2=i(g,f,o,h,m,2,p,d,u),m.p_2<0?(console.log("analyseResistSupport: В истории недостаточно баров для анализа 2"),0):(m.p_3=i(g,f,o,h,m,3,p,d,u),m.p_3<0?(console.log("analyseResistSupport: В истории недостаточно баров для анализа 3"),0):(m.p_4=i(g,f,o,h,m,4,p,d,u),m.p_4<0?(console.log("analyseResistSupport: В истории недостаточно баров для анализа 4"),0):1)))}function s(t,e){for(var i=0,a=e[0].x;a<=Math.min(e[1].x,t.length-1);a++){var r=iChart.getThirdPoint({x:e[0].x,y:e[0].y},{x:e[1].x,y:e[1].y},a);i=Math.max(i,Math.abs(r.y-(t[a][TA.OPEN]+t[a][TA.CLOSE])/2))}return i}function n(t,e,i,a,r){a=a||"d";for(var n="d"+a,o={},h={},l=[],c=!1,d=s(t,e),p=t.length-1;p>=e[0].x;p--){h={index:p,time:t[p][TA.FULLTIME],h:t[p][TA.HIGH],l:t[p][TA.LOW],o:t[p][TA.OPEN],c:t[p][TA.CLOSE],av1:(t[p][TA.OPEN]+t[p][TA.CLOSE])/2,av2:(t[p][TA.HIGH]+t[p][TA.LOW])/2};var u=iChart.getThirdPoint({x:e[0].x,y:e[0].y},{x:e[1].x,y:e[1].y},p);if(h.dh=Math.abs(u.y-h.h),h.dl=Math.abs(u.y-h.l),h.do=Math.abs(u.y-h.o),h.dc=Math.abs(u.y-h.c),h.dav1=Math.abs(u.y-h.av1),h.dav2=Math.abs(u.y-h.av2),p==e[2].x||p==e[3].x)l.push(h),o=$.extend({},h),c=!0,p--;else{if($.isEmptyObject(o)){o=$.extend({},h),h[n]/d<r&&(l.push(h),c=!0);continue}h[n]>o[n]&&!c&&o[n]/d<r&&(l.push(o),c=!0),"support"==i?h[n]<o[n]&&c&&Math.abs(l[l.length-1][a]-o[a])/d>.15&&(c=!1):"resist"==i&&h[n]>o[n]&&c&&Math.abs(l[l.length-1][a]-o[a])/d>.15&&(c=!1),o=$.extend({},h)}}if("support"==i)for(var p=0;p<l.length;p++)("undefined"!=typeof t[l[p].index-1]&&Math.abs(t[l[p].index-1][TA.HIGH]-l[p].l)/d<.005||"undefined"!=typeof t[l[p].index+1]&&Math.abs(t[l[p].index+1][TA.HIGH]-l[p].l)/d<.005)&&(l.splice(p,1),--p);else if("resist"==i)for(var p=0;p<l.length;p++)("undefined"!=typeof t[l[p].index-1]&&Math.abs(t[l[p].index-1][TA.HIGH]-l[p].l)/d<.005||"undefined"!=typeof t[l[p].index+1]&&Math.abs(t[l[p].index+1][TA.HIGH]-l[p].l)/d<.005)&&(l.splice(p,1),--p);return l}t=t||8;var o=this.getData(),h=TA.RSI.justifyCalculate(0,o.length-1,o,{TimePeriod:t}),l=[],c=[];$.each(o,function(t,e){l.push(e[TA.LOW]),c.push(e[TA.HIGH])});var d,p=13,u=1,g=35,f=65,m={p_1:!1,p_2:!1,p_3:!1,p_4:!1};if(r()){var v=[];d?(v[0]=[o[o.length-1-m.p_1][TA.FULLTIME],o[o.length-1-m.p_1][TA.HIGH],o.length-1-m.p_1],v[1]=[o[o.length-1-m.p_2][TA.FULLTIME],o[o.length-1-m.p_2][TA.LOW],o.length-1-m.p_2],v[2]=[o[o.length-1-m.p_3][TA.FULLTIME],o[o.length-1-m.p_3][TA.HIGH],o.length-1-m.p_3],v[3]=[o[o.length-1-m.p_4][TA.FULLTIME],o[o.length-1-m.p_4][TA.LOW],o.length-1-m.p_4]):(v[0]=[o[o.length-1-m.p_1][TA.FULLTIME],o[o.length-1-m.p_1][TA.LOW],o.length-1-m.p_1],v[1]=[o[o.length-1-m.p_2][TA.FULLTIME],o[o.length-1-m.p_2][TA.HIGH],o.length-1-m.p_2],v[2]=[o[o.length-1-m.p_3][TA.FULLTIME],o[o.length-1-m.p_3][TA.LOW],o.length-1-m.p_3],v[3]=[o[o.length-1-m.p_4][TA.FULLTIME],o[o.length-1-m.p_4][TA.HIGH],o.length-1-m.p_4]);var y=iChart.getIntersection({x:v[0][2],y:v[0][1]},{x:v[2][2],y:v[2][1]},{x:v[1][2],y:v[1][1]},{x:v[3][2],y:v[3][1]}),C=v[3][2]-(v[0][2]-v[3][2]);C=Math.max(C,0);var x=v[0][2]+(v[0][2]-v[3][2]);x=Math.min(x,this.chart.areas[0].xSeries.length-1);var T=0,S=this.chart.areas[0].xSeries.length-1;y.x<v[3][2]&&(T=y.x),y.x>v[0][2]&&(S=y.x),C=Math.floor(Math.max(C,T)),x=Math.ceil(Math.min(x,S,this.chart.areas[0].xSeries.length-1,T?o.length+15:o.length+30));var A=!1,w=[],P=!1,_=[];if(d){for(var b=v[3][2];b>=C;b--){var D=iChart.getThirdPoint({x:v[1][2],y:v[1][1]},{x:v[3][2],y:v[3][1]},b);Math.max(o[b][TA.OPEN],o[b][TA.CLOSE])<D.y&&(A=!0),A||(D.time=o[b][TA.FULLTIME],w[0]=D);var I=iChart.getThirdPoint({x:v[0][2],y:v[0][1]},{x:v[2][2],y:v[2][1]},b);P||(I.time=o[b][TA.FULLTIME],_[0]=I),Math.min(o[b][TA.OPEN],o[b][TA.CLOSE])>I.y&&(P=!0)}w[1]=iChart.getThirdPoint({x:v[1][2],y:v[1][1]},{x:v[3][2],y:v[3][1]},x),w[1].time=1e3*this.chart.areas[0].xSeries[x],w[2]={x:v[1][2],y:v[1][1],time:v[1][0]},w[3]={x:v[3][2],y:v[3][1],time:v[3][0]},_[1]=iChart.getThirdPoint({x:v[0][2],y:v[0][1]},{x:v[2][2],y:v[2][1]},x),_[1].time=1e3*this.chart.areas[0].xSeries[x],_[2]={x:v[0][2],y:v[0][1],time:v[0][0]},_[3]={x:v[2][2],y:v[2][1],time:v[2][0]}}else{for(var b=v[3][2];b>=C;b--){var D=iChart.getThirdPoint({x:v[0][2],y:v[0][1]},{x:v[2][2],y:v[2][1]},b);A||(D.time=o[b][TA.FULLTIME],w[0]=D),(Math.max(o[b][TA.OPEN],o[b][TA.CLOSE])<D.y||D.y<0)&&(A=!0);var I=iChart.getThirdPoint({x:v[1][2],y:v[1][1]},{x:v[3][2],y:v[3][1]},b);Math.min(o[b][TA.OPEN],o[b][TA.CLOSE])>I.y&&(P=!0),P||(I.time=o[b][TA.FULLTIME],_[0]=I)}w[1]=iChart.getThirdPoint({x:v[0][2],y:v[0][1]},{x:v[2][2],y:v[2][1]},x),w[1].time=1e3*this.chart.areas[0].xSeries[x],w[2]={x:v[0][2],y:v[0][1],time:v[0][0]},w[3]={x:v[2][2],y:v[2][1],time:v[2][0]},_[1]=iChart.getThirdPoint({x:v[1][2],y:v[1][1]},{x:v[3][2],y:v[3][1]},x),_[1].time=1e3*this.chart.areas[0].xSeries[x],_[2]={x:v[1][2],y:v[1][1],time:v[1][0]},_[3]={x:v[3][2],y:v[3][1],time:v[3][0]}}var M=(s(o,w),s(o,_),"l"),k="h",O=.05,E=n(o,w,"support",M,O),R=n(o,_,"resist",k,O);return{extremeSupports:E,extremeResist:R,supportPoints:w,resistPoints:_,points:v}}return!1},iChart.Charting.TA.prototype.autoResistSupport=function(t){t=!!t;var e=this.analyseResistSupport();if(e){this.clearResistSupport();var i="l",a="h";if(e.extremeSupports.length>2||t){var r=this.chart.overlay.createElement("Line");r.points=[{x:e.supportPoints[0].time,y:e.supportPoints[0].y},{x:e.supportPoints[1].time,y:e.supportPoints[1].y}],r.drawType="auto",r.storageEnable=!1,r.controlEnable=!1,r.id="SR_analyzer",this.chart.overlay.history.push(r)}if(e.extremeResist.length>2||t){var r=this.chart.overlay.createElement("Line");r.points=[{x:e.resistPoints[0].time,y:e.resistPoints[0].y},{x:e.resistPoints[1].time,y:e.resistPoints[1].y}],r.drawType="auto",r.storageEnable=!1,r.controlEnable=!1,r.id="SR_analyzer",this.chart.overlay.history.push(r)}if(t){var r=this.chart.overlay.createElement("Polygon");r.points=[{x:e.points[2][0],y:e.points[2][1]},{x:e.points[0][0],y:e.points[0][1]},{x:e.points[1][0],y:e.points[1][1]},{x:e.points[3][0],y:e.points[3][1]}],r.storageEnable=!1,r.drawType="auto",r.id="SR_analyzer",this.chart.overlay.history.push(r);for(var s=0;s<e.extremeSupports.length;s++){var r=this.chart.overlay.createElement("Trade");r.hasSettings=!0,r.settings={type_id:1,qb:"",mode:1,date_time:"",summ:e.extremeSupports[s]["d"+i]/e.extremeSupports[s][i]*100},r.points=[{x:e.extremeSupports[s].time,y:e.extremeSupports[s][i]}],r.id="SR_analyzer",this.chart.overlay.history.push(r)}for(var s=0;s<e.extremeResist.length;s++){var r=this.chart.overlay.createElement("Trade");r.hasSettings=!0,r.drawType="auto",r.settings={type_id:0,qb:"",mode:1,date_time:"",summ:e.extremeResist[s]["d"+a]/e.extremeResist[s][a]*100},r.points=[{x:e.extremeResist[s].time,y:e.extremeResist[s][a]}],r.id="SR_analyzer",this.chart.overlay.history.push(r)}}this.chart.overlay.render()}},iChart.Charting.TA.prototype.clearResistSupport=function(){for(var t=this.chart.overlay.history,e=0;e<t.length;e++){var i=t[e];"SR_analyzer"==i.id&&(t.splice(e,1),e--)}this.chart.overlay.render()}}();